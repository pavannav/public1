# 7.3 Step-03- Create Kubernetes Manifests for Storage Class, PVC and ConfigMap

-: Welcome back.In this lecture we are going to create theMaya Scale related Kubernetes manifestwhich are required for us and then we aregoing to build them using live template writing.And then we are going to deployand then see that how we are going tohow the Maya scale is going to comeup with the persistent storage using elastic block storewhich is EBS service in AWS.So let's go to 0402 SCPVC,which is nothing but storage class,persistent volume claim, ConfigMapsand then Maya scale deployment and then service.So we are going to create file manifests here.So we'll start with our step one.So if you see here we are going to create thestorage class manifest persistent volume claimuser management ConfigMap, Maya scale deployment engine,Maya scale cluster IP service.So let's start with the first onewhich is our create storage class manifest.Okay, so let's go back to our visual studio core here.And I have created the empty files here and thenput them ready for our development of live template writing,okay.So we are in the zero one storage class.So as usual we are going to create our basic template firstwhich is nothing but APA version kind metadata.And next is spec,right?So now let's start with the APA kind.Kind is nothing but we are going to createa storage class, okay?And next is API version.So for storage class the API version is going to looklike this, okay?Storage.k8s.//v1So let's see in our API specification document.We can see it here now storage.k8s.//v1So that's what we have implemented it for our storage class.And now the metadata we are going to queue as taband then nameand then I'm going to say EBS storage class.Okay?And now when coming to this storage classit is not going to be spec here.So it is going to be the provisioner.Okay?So who is going to be the parishioner?My provisioner.My provisioner is going to be if it is agile disc carIf it is GC persistent discthen the provisioner is going to differand now we are going to use it in AWS.So it is going to be ebs.csi.aws.com,Right?So and now one more important thing here we need to work onisvolumebinding mode.So this can be immediate or wait for first consumer,right?So let me save thisand then see what is this wait for first consumer?So let's come back here and if you see here this waitfor first consumer mode will delay the volume bindingand provisioning of the persistent volumeuntil a pod using the persistent volume claim is created.So what happens is like whenever the storage classyou create itand then whenever you create your persistent volume claim.So if you don't add this volume binding mode to waitfor first customerthen it is going to immediately dynamically provisionand then mount your volume.So means like it is going to provision your volume there.So in which availability zone we really don't know,it is dynamic, right?So it can be in available zone oneor means like US-East-1 hereor US-East-1 we really don't know.And whenever you go aheadand then later you go and then create the podwhat happens is like if your volume is mountedin US-East-1 here and your pod got scheduledor created in US-East-1 B, then you have the issue, right?So considering all those thingsthere is a new option provided herewait for first consumer.So what happens in this case is like whenever,whenever you create the pod at that time onlyit'll provision the equivalent volume for you.So what happensat that time is both will get created in the same topologywhich is nothing but in the same a availability zone.So that is one key important thing.So that's the reason whenever we are using in our AWS herewe can use wait for first consumer.Anyway even though using ABS with Maya scale databases hereon Kubernetes it'll have equivalentsetbacks and then drawbacks,we'll see in our later lecture those things.And then already a next lecture is plannedin detail for this like to avoid these EBS related issues.So then how we are going to use the RDS databasein Kubernetes cluster, all those things already planned.But for now let's go aheadand then start writing our template relatedto ConfigMap and then persistent volume claim.So we just now completed the storage class related manifest.Okay?So in our next step we are going tocreate the persistent volume claim related manifest.So I'm not going to go for everything to pay version.We are not going to go to refer the APA referencedoc every time.So you can refer whenever you have time there.But for now we'll go with the standard stuff here.Okay?So this is the standard APA version kindand then metadata and then spec.And now what we are creating is persistentvolumeclaimright?And it's version is going to be V1.And then in metadata our standard thingis to create a name, right?So I'm going to say EBS Maya scaleEV claim,right?And in spec we will have three thingson a very high level that is access modesand next is storage class name this respectivepersistent volume claim need to refer, right?And next is resources.How much you want to reserve the space.Means like how much you want to take the spacefor your respective mount pointof your Maya scale database example, right?So your volume mount, how much you want to take.So let's start with access modes.So we wantread,write,once, okay?And the storage class name whatever we created hereis EBS SC, right?EBS storage class.So I'm going to give that,and resources in thatwe are going to request how much, okay?So we are going to request the storage,and storage is going to be four gigabytes, okay?4GiOkay,So that's all.Now we have completed the persistent volumeclaim relatedKubernetes manifest.Okay?So we'll also complete user managementConfigMap manifest and then we'll go to the next one.So we are going to create a ConfigMapmanifest which will be mountedin our Maya scale deployment.So that whenever this,whenever the Maya scale port is got createdautomatically, it also need to create one small Schema namedUser MGMT Schema.So that we'll usefor our user management microservice deployment.So whenever the user management microservices is deployed,it expects that there is a User MGMT Schema presentin your respective database.So for that purpose we introduceto the ConfigMap concept here means likewhy ConfigMap is like whatever you want to do,whatever the configuration you want to sendto your ports, right?In whatever the way you can define itas a ConfigMap and then mount it in your container.So we are going to container a definition which is nothingwhatever deployment.So we are going to do that so that we know the userof ConfigMap, how we are going to use it.So our standard API versionKindMetadata.And here it is not spec, it is going to be data.Okay?So then what we are going to create ConfigMapand the version is going to be V1 in the metadata.And here I'm going to write the name.It is going to beUsermanagementhyphenDV creation script.Okay?So in data I'm going to create aMayascale_usermgmt.skl script okay?So, and I'm going to write the content of my skl scriptokay?So I'm going to saydropdatabaseifexists.Okay?And database name is User MGMT, okay?And then createdatabaseUserMGMT,so we can use more or big,whatever it is.Okay?So create database User MGMT.So this is about creation of our ConfigMaphow we are going to mount it in our Maya scaledeployment file.We are going to see in our next stepsokay?But for now,one thing we need to understand here islet's save it and go back here.So these are few steps to execute herein persistent volume claims manifest.That is nothing,but let's create storage class in PVCand then list them and then see how it is going to looklike.We discuss about wait for first consumer, right?So what happens, we are going to see here now.So let's go hereandgo to,what is this section?Section is zero four, right?So let's go tozero four.And in zero fourwe'll have something called kube manifest.We need to go tozero four,zero two.Right?Inside that you'll find kube manifest,right?Right, we have that.Okay, so I'm going to say kubctl-f kube manifest.So it need to create three things for us, okay?So storage class,persistent volume claim,and it's equivalent the DB creations scriptrelated ConfigMap.So I'll say Qctl get SC,which is nothing but the storage class, okay?And I have got my EBS CSI AWS.comwhich is the EBSS. created.So now I'll say get PVCwhich is nothing but persistent volume claim.Now you can see, right?It is waiting.It is waiting for the first consumer.You can see the status is waiting.So it is not already allocated our volumealready binded.Okay?So if you want get PV, nothing.So persistent volume still not yet created,volume claim is waiting to create the volume untiland unless the part got created,it is not going to,it is not going to create it, okay?It is not going to bind the volumeand then create the persistent volume.So let's wait for it.Okay, So now we have completed these things,so let's if you want we can even delete itor we can leave it as is.Okay?That's not a big deal.Okay?So in our next lecture we are going to focuson creating the Maya scale deploymentand then Maya scale cluster IP service.And then we'll move onwith the creating those deployment serviceall these manifests and then testing it.Okay?So I'll see you in the next lecture.Until then, bye bye.Thank you.