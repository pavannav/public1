# 24.6 Step-06- [NEW] Build Stage- Review buildspec-build.yml file

Instructor: Welcome back.We are in step 06, which is nothing,but we are going to implement the build stage.So, if we go back to our picture here, right?In this pipeline.So, we have created a GitHub repositoryand checked in the latest code whatever is available for uswith all the buildspec files and all those details.So, this part we have completed,which means we have created our GitHub repository.Now we will complete the build part.So, let's go ahead and then reviewthe buildspec-build.yaml file.So, this is the buildspec-build.yaml file.So, we'll go back to our vision studio code hereand we are in AWS EKS DevOps.And here we have the buildspec-build.yaml.From here,or even from our 11 new and GitHub files,buildspec build anywherewe can go ahead and then review it.So, we'll open this,and this is the buildspec-build.yaml file,and we are using version 0.2.And first thing what we have done here is we have definedthe environmental variablesand also defined exported variables also.Why we are doing this exported variablesis because further downstream phases,if we need these values then we need to export them.So, let's start with the variables.So, we have defined image URI here,and we have provided the value here.So, if you go back here, right?So, go to our elastic container registry.So, here you can find the URI in the repositories.So, you'll find the URI of your elastic container registry.So, you need to copy this and paste it here.So, in your case it is going to be your value,what you are going to define.So, it'll be your DevOps, the thing here, okay?And your account ID here.So, all those things will change.So, you need to definitely update your buildspec-build.yaml,which is nothing but whatever is presentin your registry, right?Whatever is present in your GitHub repo,you need to update it.And this is we have exported the variables image URIand image tagbecause we are going to use that in our deploy phase.So, for that purpose we are exporting the image URIand image tags.Now let's come back here in phases,install, pre-build, build and post buildare the four things which we have in buildspecas a standard.And in install we have nothing to do.We don't need to install anything here.So, when we are creating a CodeBuild project,we'll see there we are going to use directlythe Amazon Linux docker image,wherein inside that everything is pre-installedand ready for us, which is like dockeror something like any Linux related tools,most of the things will be available inside that,unless we have a specific needwhich is not present inside this Amazon Linux docker image,those things, you can install them here.But in our case, for our use case,we don't need to install any prerequisite related binariesin our Amazon Linux docker image.So, in this phase, nothing is needed,and from pre-built phase, right?So, what we are going to dois we are going to get the image tag.So, what is going to be our image tag?So, there will be a default environment variable availablein CodeBuild,which is called CodeBuild resolved source version.So, it is going to have the source versionof our GitHub commit, whatever we have provided.So, 1 to 7 characters.First 1 to 7 characters of that source versionwe are going to put it as image tag.So, what exactly that means?So, if you go back to your AWS EKS DevOps,so recently you have made a changeand then this is the CommitCode.So, this should be something around seven characters.So, 4a00a20.So, this will be your image tag.So, if you go to any docker image, right?So, in addition to the image nameyou'll also have something called tag.And that tag for our docker image is going to be this oneso that you can easily track.Which means as part of this code version, right?So, this docker image is created.So, it'll have a direct linking,which means like whatever the code changes you have done,it's sequel and docker image is availablein the elastic container registry.So, it is a very good way of implementing it.So, for that purpose CodeBuild results source version,inside that 1 to 7,first seven characters of the commit value,you are making it as a image tag.So, now after that you're going to authenticate to...Authenticate docker with ECR.It means like you're going to authenticateto elastic container registry.So, how you are going to do that?This is the commandto log into your elastic container registry.AWS ECR get login password pipe to docker login.Username is AWS and password is your image,your password standard inand then image URI you need to provide.Image URI means this complete URI.you need to provide it here.So, in that way we will be authenticatingto your ECR report.So, once you are authenticated to ECR report,so now you can push anythingto your ECR report related to your docker images.So, first in the build phaseyou'll go ahead and then buildthe docker image using docker file.So, you said docker build and then hyphen Tand dollar image URI.So, which means this is the URI, right?So, this is the image URI, and colon image tag.Image tag is nothingbut whatever the resolved source versionand then dot,dot is nothing but the current directory.So, in the current directory itself,you'll find the docker file.So, where is it present?In the directly itself.So, this is the AWS EKS DevOps,and in the current directly itself you have the docker file.So, now let's go back here.And so that's about building your docker image.So, once your docker image is built,in post-build, you are going to push that docker imageto ECR repository.Command here is docker push,and dollar image URI colon dollar image tag.You'll be able to push that docker imageto elastic container registry.And after that you can export image URIand image tag to exported vars ENV.So, CodeBuild source DIR.In this location you are putting this exported vars.envand inside that you are putting your image URI.And then you are also going to define the artifacts here,files that will be included as artifacts for next stage.So, these artifacts, whatever you use here,these can be used in your next stages.So, in your next stages in the senseif you want whatever the artifacts you define here,which means those will be availablefor your next stages.In any stage if you want those artifacts,like in deployment approval or in deployare in some other stages, you can use them from artifacts.So, what we are doing here?So, we are creating a exported vars.envand then creating it as artifact.And in addition to that, in your deployment stage,you also need buildspec-deploy.yaml.So, that also you are going to exportand define as a artifactand also your complete Kube Manifests also,you are going to define it as artifact.So, whatever, not only creating a docker imageand pushing it to ECR,but when this build kick it in, right?So, this build will kick in by checking outall the code present inside this source, right?So, whatever the latest code availablethat code, it'll check out and it'll be presentin your code buildup temporary mission.So, those data, right?So, whatever you have,that data you are going to export it as artifactsso that those data, you can carry it till deployment phaseand use that.That is the key thing.If not, from deployment itself,again, you need to make a connection to source to get it.That is not a right way.You need to go in the forward flow.You should not again, come back to sourceand take the content.So, for that purpose, you need to export your artifacts,whatever is needed for you in the next stages.So, whatever is needed for me is my image,image URI and image tag is needed in my deployment phaseand buildspec deploy, whatever is present here, right?So, that is also needed for me in my deployment phaseand this Kube Manifests is also needed for mein the deployment phase.So, all those things, I am exporting them as artifacts.This completes the review about the buildspec file.In our next lecture we'll focus on other steps relatedto the build stage.I'll see you in the next lecture,until then, bye-bye, thank you.