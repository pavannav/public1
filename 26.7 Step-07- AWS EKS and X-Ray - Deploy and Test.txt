# 26.7 Step-07- AWS EKS and X-Ray - Deploy and Test

-: Welcome back.In this lecture we are going to go aheadand then deploy the manifest and test it.So before going there we are going to quickly look intoI have changed the DN, DNS namesfor us to be services iPhone xray.cube1cloud.comand then xraydemo.cube1cloud.com.And I have also updated the samein our architecture diagrams and alsoin our respective Ingress manifest also.Okay, so why I change it isbecause there might be DNS cash issues once we execute ouronce we execute this sectionthe previous section related to microservice too welland then immediately we execute 13.So there might be issues related to DNS cachingand all those things we might encounterand example I can show you here.Okay, so there is no services.cubeon cloud.com in my record sets here, okay?So, but if you see the DNS resolution hereit keeps resolving to the older IPS.So like this, there might be some issues you might encounterand then face other issues and then youryour demo might not work for a whileand then later after one hour or two hours it might work.But wasting our time like that is not good.So that's the reason what I've done is like I have ensuredthat we have new domain names for this x-ray demo also.So like that only we continuein our previous sections also we are going tocontinue the same thing here.So now let's go back and then deploy the stuff.So cube CTL apply-F and then cube manifestand our content is present in 02 applications folder.So till there we are going to go aheadand then execute the stuff.Okay, so I will say copy paste, I amin 13 microservices section and I am deploying the manifest.So it is creating the user management microserviceall the microservices.So cube CTL and get what should list the partsand I'll also verify that Ingress.Okay, so that Ingress also got created.So now if we go back to our route 53ideally our route 53 domain should be created.Now it should be getting createdit'll take a while to create.So what we'll do is like we'll pause the videountil entire whatever the EC2 related loadbalancer also got provisioned.So it should be in provisioning state.Once this is completed then we will resumeand then test all other stuff.Our load balancer is active now.So let's copy the DNS, let's do the DNS checks first.So Ns look upand paste itand it has 2 1 3 and then 1 5 6 at the end.So keepI'll also say NS lookup xraydemo dot(typing sounds)cube1cloud.com.So 2 1 3 and then 1 5 6.This looks good.So we'll be able to access our serviceand then test it, right?So now the next thing is let's go back hereand then you can access the serviceon our browser and then test it.So I can even take this directlyand then access it on the browser.So if you see it hereapplication is notification microservice app version is V1and then messages enable AWS xray.So we can even test thisvia postman by adding the environment.So I'll add the environment and then sayX-ray microservicesand allow the URLand URL is going to be this much right?(mouse clicks)Alright it and I'll change to x-ray microservicesand this is the notification x-ray service.So I'm going to access itand notification microservice and then V1and then enable AWS x-ray for this respective service.We are getting that.So I'm going to access a coupleof times here and then go aheadand then go to the x-ray and then see the stuff.Okay? So you can even verify your route 53domains already created, right?So I need to browser refresh to get these details usually.Okay, so we got everything relatedto services xray.cube1cloud.comor x-raydemo.cube1cloud.com.So now let's go back to our x-ray service, right?So X-rayLet me close this and now the service map is creatingfor our last five minutes.So let it get created.So now you can see here the service map from clientit went to user management microserviceand from user management microservice it wentto notification microservice.Okay, so in service map we can see that very clearly.So now if you want to get the traces of this informationso we can go and then clickon traces and we can select the specific trace.So these are health check related URLswhich is triggering from load balancer orfrom our node port service, whatever we have created, right?So those things, but this is specificallywhatever we have accessed from browser, right?X-raydemo.cube1cloud.com/usermgmt/notificationX-raySo let's go inside that and you can sayinside that you can find these are the tracesthese many times I have access it as of now.Okay, so if I want I can keep sending the requestand then these traces keeps getting increased.Okay, so I'mI'm going to access five more times I have access it.So currently five is there.So when I refresh itso now you should see 1, 2, 3, 4, 5, 6, 7, 8, 9, 10.So we have got 10 traces.Okay? So any trace you can open it like this, right?And if you see it here it's map will be displayed herein detail.So response is 200 and duration is 677 milliseconds.Age is like 2.9 minutes before I have access to this.Okay? And let me make this bigger.So it is the same thing, right?So user management microserviceand then V1 notification microservice.So where are these hosted?So that you can see here AWS EKS container you can seein the down right EKS container and as usual if you seeand then go inside traces how the request went in.So the request first hit the user managementmicroservice container, right?So it's information is here, this is the start timeand time how much it took and the requestURL is this one and request user is from Mac OS browser.I have tried once.That is the first request, right?And the client IPs this one, okay, soif you go back and then take another trace, right?So like recent traces.So what what will happenwith the recent traces is so let's make it bigger here.Yeah. And if you go downand then if you open the user management microserviceif you see the request user agent now is postman run time.So because we access it via postmanand then ask forward for true and then response status 200.So this is the overview section, but you will havethe resources section which will provide the log groupin which our logs are present.And in additionto that availability zone where this request is runningand then instance ID use our worker node ID andthen our worker node size and the AIM ID our workernode Kubernetes worker node and as SDK versionit has used and SDK it used is x-ray for Java, right?And now this is the important fact, okay so whichin Kubernetes to which part it went and inside that partto which container it went also we can identifyusing x-ray tracing which is nothing but it wentto user management microservice part so and so part, okayso if you want KMG6G, okayso if you want we can say cube CTL get ports andthen match our port name here, right?So see KMG6Gthat is the one and inside that, this is thecontainer ID it went, where the request went in.So that's about the user management microservicestracing here it took 24 milliseconds and from there it wentto the get notification app in four, right?So that is my method presentin my user management microservice.So inside that method it went in and thenfrom there it called the notification cluster IP servicecorrect? Right?So if you take the architectureafter UMS part from this, it comes thenit'll call the notification cluster IP service.So it called the notification cluster IP serviceand notification cluster IP services notificationcluster IP:8096/notification/x-ray.So that is the path it has called.And now from there it is going to goto the notification service.The next thing is from there it went to hereit took eight milliseconds near this serviceand then it went to notification microservice, okay?Which is nothingbut the notification microservice deployment insidethat the respective container and then port, right?So if you go herenotification microservice pod and it's equivalent container.So that's good.So now from there it went into the, again, the methodinside that container there will be a code running, right?What is that method?Okay, so this is the method notificationapp version service method, it wentin and then it server the request back.So to this level we can seethat detailed tracing what happened for our application.And if you see herethis is whatever you are seeing in the UM model, you can seein the GSN format data, raw data also you can see it.So this is about the entire tracing.Whatever we have done meanslike the request came from client to user managementuser management to notification service, as I told earlieronly for specific service inside user controller.I have enabled this stuffwhich means whenever you call call only this respectivenotification, microservice related x-ray servicethen only this from user managementto notification will go and then it'll be displayed here.So it's equal and module I have user hereto develop this codebut rest of the other stuff which is like nothing.But if I call other notificationhealth status services example, you have something hereright? Notification, service infoand then notification health status.So for them the new note is going to get createdand then it'll showas client only client to that notification services.I am going to show it to you now.So let's go back and then access them now.So there are additional core changes requiredfor every service to do and then get this onemicroservice calling another microservice.How you want to do all these things are developmentrelated efforts when we are doing it, okay?But I just want to show you a few things here.Okay, so I'm calling notification health statusservice, right?And I'll call for some time, right?And I'll also call service in for service, okay?All we are calling via user management only.Okay, so what happens?We are going to see let's go hereand then refresh it, right?So now the map updates in a different way.So let the map see now you can seeso client to notification, right?So this client here is nothing but whenever you'recalling it is user management microservice also call thisand then you'll get some additional data here, okay?So another picture you'll get, okayso I'll say our last 15 minutes I'll say and then refresh.So you'll get a different picture here.So whatever you are calling this notification microserviceit is going by a user management microservicebut still that user management microservicesystem is feeling that it is going to be client only.The reason for that is I didn't enable theSTTP client builderfor this notification health service.I'm using standard spring boot related REST templatefor calling another microservice.So this is core development relatedbut why I am trying to explain this here is whenyou are enabling x-ray in your applicationsthere will be a good amountof development effort required for you.And then lot of thought process thinking is required here.So if you see herethere will be lots of references which tells usin which section what we need to doand all these things, okay?So these are related to X-ray enablement on Kubernetes.But if you see here, right?So SDK Java configuration andSDK Java configuration pluginsand STTP clients and filters and then SQL clients.So like this, there will be multiple other stuffs in x-raysSDK for Java or x-rays, SDK for node JSand then other Python or whatever, right?So good amount of development level of work is requiredin your application to enable this, but when you enable itthese are the benefits you are going to get.Hand in hand means like you are able to see everythingin a detailed way, step by step.So that's about the X-ray so far.So in our next lecture we are going to clean up the stuff.I'll see you in the next lecture.Until then, bye bye.Thank you.