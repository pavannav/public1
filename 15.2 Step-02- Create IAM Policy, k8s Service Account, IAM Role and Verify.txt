# 15.2 Step-02- Create IAM Policy, k8s Service Account, IAM Role and Verify

-: Welcome back.Let's go back to our GitHub repository and enterinto the section 0 8 0 6 deploy external DNS on EKS.And as part of step zero one introduction,we already know what we are going to implementas part of this external DNS.So let's go to our step two herewhich is create IAM policy.So this IAM policy will allowexternal DNS part toadd, remove DNS entries are record sets in hosted zone inAWS Route 53 service.So let's go to AWS management console and goto IAM serviceand go to policies hereand click on create a policy and go to the Jason taband in the visual editor add this policy, right?So whatever the policy here it is there,add it and then name the policyas allow external updates and then create that policy.So click on policiesand create a policy and go to the Jason tab.And so let me remove thisand go here and add this entire thing.Copy and paste it, right?And go to the visual editor tab.And you can see here it will be like Route 53.And Route 53 change resource record sets is one thinginside the hosted zone, any hosted zone.And in route 53 you have something called list hosted zonesand list resource record sets.So these are the permissions we have given currently.So let me minimize this and click on next and no tags.So we'll provide the name here.So the name here is,allow external DNS updatesand allow access to Route 53 resourcesfor external DNS is the description.And click on create the policy.So once the policy is createdwe'll move on to the next step, right?So we'll make a note of the policy ARN.So in your case it is going to be differentbecause your AWS account ID will be present here.Maybe the name might be same but your AWS accountID will be different here.So this is allow external DNS updates andfrom here you can take the ARN and then make a note of it.So this is the ARN,we need to make a note of.And now in step zero three we are going to createa IAM role Kubernetes service account and associate thatIAM policy.All these things, right?Creating a IAM role and annotate that IAM role insidethis Kubernetes service account and also associateIAM policy to IAM role.So all these things can be done using one command ineksctl CLI, right?So that is called EKS CTLcreate IAM service account.So using this IAM is nothing but creating a IAM role.And in this part service account is nothingbut Kubernetes service account.So IAM service account,what it does is,so it'll create a Kubernetesservice account named external DNS and also itcreates a AWS IAM role and also associates themby annotating a role ARN in service account.So this external DNS service account will beannotated with the IAM role it is going to create.And in addition to that theallow external DNS updatesIAM policy whatever we have created in step two.So that one will be associated to the IAM role,it is going to create.Accordingly you can see hereeksctl create IAM service account,a name of the service account you need to provideand in which name space in the Kubernetes thisservice account should be created so far as itis going to be in the default name space, right?So the default name space and the cluster, right?The name of your EKS cluster and also the policy,IAM policy that need to be attached.IAM policy ARNand whatever we have made a note here and we are going toapprove and override any existing serviceaccounts with the same name, right?So this is the command,it replays the name externalDNS will be the name of my service accountand name space it is going to bedefault name spaceand cluster it is going to be EKS demo oneand IAM policy ARN, right?So whatever you have took the notein step two in your case this is going to changeand this,mainly your AWS account ID will change here.So we'll place that allow external DNS updatespolicy related ARNand rest approve and override existing service account.These two are same.So let me copy this and go here and provide this command.And this should create the Kubernetes service accountand also it need to create a IAM role for us, right?So it's getting created, existing account will be updatedas override existing service accounts was set.So let's wait for it.It is going to create a cloud format and stack for us.So this is completely,eksctl is automated,means like the CLI is triggering to create a cloud formatand stack for us with the details whatever we have provided.So let's wait for the service account to get createdand after that we can search for kubectl getand then SCA is nothing but service account external DNS.And you should findthat external DNS in our default name space.So it is created now.So we'll say kubectl get SCAit'll list the service accounts presentin your local default name space.So let's wait for it.So you can see external DNS related serviceaccount created 11 seconds before, right?So let me say kubectldescribe SCAand then you'll say external hyphen DNS, right?So you are describingthat external DNS related service account and you'llin the annotations you can findeks.amazonaws.com/roleARNand it has a IAM role ARN.So this IAM roleis created and associated withthis external DNS.So now let's come back here, right?And verify,go to the cloud formation stack and verify.So let's go to servicesand go to cloud formation.And in cloud formation we'll find this equivalent stack.So we'll find it here.Eksctl, EKS demo one add on IAM service accountwith in the default name space whose name is external DNS.So let's open it.And if you see here in the resources, right?In the resources section.So let me close this.You can see the physical ID,this is the IAM service account it has created.So which is nothing but IAM role it has created.So if you click on this physical ID, right?It'll take us to the IAM role it has created.So this is the IAM role it created and this isthe IAM role ARN and we need to make a note ofthis role ARN.Note of this IAM role ARN,in this approach.Or we can also get the IAM role usingeksctl get IAM service accountand the cluster name is EKS demo one.So using this command also we can get the IAM role ARN.So let's run this command eksctl get IAM serviceaccount and in cluster EKS demo one.So it should provide us two IAM service accounts.One we have created for AWS load balancer controllerand one which we recently created, which is external DNS.And from here also we can make a note of this role ARN.So why do we need to make a noteof this role ARN is in the next step wheneverwe are updating the external DNS related manifest.So there we need to provide this role ARN.So that external DNS pod is the referencefor this role ARN from that respective manifest.So now let's come back hereand in our next step we are going to move tostep zero four to discussabout our review the external DNS Kubernetes manifest.So I'll see you in the next lecture.Until then, bye bye thank you.