# 22.8 Step-07- NLB Elastic IPs Demo using k8s Service

-: Welcome back.In this demo, we are going to create a network load balancerwith Kubernetes serviceand ensure that that network load balanceruses elastic IPs, right?So, first we will create the elastic IPsand take those elastic IP EIP allocation IDsand associate them or update themin our elastic IP related annotationin our Kubernetes load balancer service manifest.So, from network design perspective, there are no changes.Only thing is, we are going to add additional elastic IPshere in the public subnets.One important thing here is,whenever we add this elastic IP related annotationAWS load balancer EIP allocations,so we need to ensure that these elastic IPsare directly proportional to the number of subnetswhere your network load balancer is getting created.So which means, we are creating in the public subnetsour respect to network load balancer.So our EIP allocations or our elastic IPs should beequal to the number of subnetsif we are not specifying any subnets annotation.If we specify the subnets annotationand where you specify number of subnets there,so those number of subnets is directly proportionalto elastic IPs you should create.So, that is one important note.And second one is your NLB must bein the internet facing edgefor these elastic IPs to be associated for your NLB.So now, network load balancers not only deals with the TCP,but also it deals with UDP and also TLS connections.So, for some applications which are using UDP,so, instead of DNS if they expect toconnect to your NLB using IP address, right?So at that point of time, giving a static elastic IPwhich never changes is a reasonable option.So at that point of time,so this elastic IP association to our network load balancerwill be a big advantage.So for that purpose, we'll also see this demo practically.So let's go back to our GitHub repoin 19 ELB network load balances with LBC.So, we are in 1904 LBC and NLB elastic IP.So as part of step two,step one is introduction, which we have seen.So we are going to go aheadand then create two elastic IPs for us.So in the EC2 section in the AWS management console,in network and security, we can see the elastic IPs here.So we have one elastic IP already createdas part of EKS cluster control plane creation.So wherein this elastic IP is used tofor the EKS worker notes present in the private subnetto communicate to your EKS cluster control plane outbound.So now, we'll create two elastic IPs.So, US east 1 is the regionand we'll say allocate, right?And we'll create one more.So I can also say this as IP 1.Or I can say EIP,EIP 1And I'll create one more elastic IP addressand I'll say allocate in US east 1 region and allocate.And I'll say it as EIP 2.Save.So, now you can see we have created two IPs,EIP 1 and EIP 2.So now, let's go to the next stepwhich is review elastic IPS annotations.So we'll go here, right?In 1904 LBC NLB elastic IPin 02 and LBC NLB load balancer service.So for this EIP allocation ideas,I'll remove these two things, right?For this respect to annotationAWS load balancer EIP allocations.So I'll come here and come here, right?And this is the EIP 1 and that is the EIP 2.So I'll go here and take these allocation IDs.So this is the first one and I'll put it here comma.And this is the second one.So, I have updated both allocation,EIP allocation IDsto our EIP allocation annotation in my Kubernetes service.And name also you can see elastic IP LBC network LB.And here also it is same.Rest all is going to be as is from the previous demoand nginx app three deployment also no changes.So let's go to the terminaland in section 19, we'll go inside 1904, right?LBC NLB elastic IPand we'll say cube CTL applyhyphen F and cube manifests.So, this should create the app three nginx deploymentand also create the elastic IP related Kubernetes service.So, we'll say cube CTL get as pods.App 3 nginx should be running.This is good.And we'll also run the SVC.So, this should provide the servicewhich is elastic IP LBC network LB, right?And you can see port 80 and 443 listeners created.And now, the important thing here is,so this one, right?Should have the elastic IP addresses.So let's come back here right to your load balanceror you can, from here itself get SVC, right?And take this DNS name, right?Copy and say NS lookup.And this elastic IP related load balancerwhatever you have created,so once it completes the creation,so we can see the NS lookupand the DNS name, whatever here,this resolves to the elastic IPsto whatever you have created.So let's wait for it.So, it should resolve to these two IP addresses.We can see here this load balancer is in active state now.So, let's do the NS lookup and the DNS name.And you can see it is resolving to two IP addresses.100, 24, 223, 234.And this one also 34, 238, 77, 28.So this should match the elastic IPs,which is 100, 24, 223, 234and also this is with the 34 238, 77, 28.So, this is good.In addition to that, if you also verify this one, right?So you are custom DNS, NLB EIP 201.So if you do the NS look up for this one also,it should result to the same IP address,100, 24, 223, 234.Why? Because this DNS is an alias to this DNS only, right?So, now let's come back hereand also access it in the browser.And your application should be accessible with httpand also https.So this completes the elastic IPs demo.So let's go ahead and then clean up the stuff here.So the first thing is clear and cube CTL,delete, hyphen F and cube manifests.So once these are deleted,we'll go here and also delete the elastic IPs, right?So, let's wait for it.So these are deleted.So now let's say, refresh, right?And select this one.And disassociate elastic IP,it's already disassociated I think.So let's wait for some timefor these things to be released and shown as released state.I see here, or I will refresh thisSelect.So it'll take a little whileafter network load balancer is deleted.So now you can see EIP and release this elastic IP, right?And this one also release elastic IP.This should be good now.Now, let's come back hereand also ensure that we verifyour network load balancer is deleted successfully.So that is very important thing.Because if by any chance it is present,it is going to cost lot of money for usif we leave it idol without knowing.So, this completes the elastic IP demo.In our next demo,we are going to focus on NLB with internal,means like creating a internal network load balancer.So I'll see you in the next lecture.Until, then, bye-bye.Thank you.