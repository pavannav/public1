# 22.7 Step-06- NLB External DNS Demo using k8s Service

-: Welcome back.In this section we are going to implementnetwork load balancer with external DNSusing Kubernetes service.So as part of that we are going to add additional annotationto our Kubernetes service manifest.So all these things we have implemented till previous demo.So now we are going to add external DNS host namerelated annotation to our Kubernetes service.So what happens at this point?So whenever you deploy your Kubernetes servicewith this annotation added,so we already deploy the external DNS related podon our AKS cluster whenever we are implementingthe ALB ingress related use cases.So this external DNS podwill be watching this (indistinct) API serverfor any ingress R service resourceswhich contains external DNS host name annotation.If it finds, then automatically it is going to go aheadand then pick that respect to annotationand create our updateor delete the DNS recording AWS route 53.So once the DNS record is added,so we can access our application with HTTP or HTTPSusing the DNS name, whatever we have registered.Example, NLB EXT DNS dot stack simplify dot com.So now at this point alreadyour SSL certificate we have created isstar dot stack simplify dot com.So this NLB EXT DNS dot stack simplify dot com,whenever you access, this time you should not any,get any SSL certificate pop-up error what we have gotin our previous PLS demo.So now let's see the same network design here, right?So we are going to add the external DNSand when we deploy this network load balancer relatedKubernetes service manifest,so it is going to add the DNS in the Amazon route 53and whenever we access we will be able to access bothvia HTPP, HTTPS and the requestsgo to our respective network load balancerand to our respective pod in the worker nodesvia node ports.And this is the annotation we are going to add,external DNS dot all four dot Kubernetes dot IO slashhost name and we'll define the DNS name here,something like NLB DNS 1, 0, 1 dot stack simplify dot com.So let's go back to our GitHub repositoryand enter into the section 19 ELB network load balancerwith LBC and inside that 19, 0, 3 LBC and LB external DNS.And here we'll go and then verifywhether this respective entry is presentin the kube manifest.So let's go to Visual Studio Codeand we are entering the section 19, 0, 3 LBC NLBexternal DNS and inside that, zero, one NGINX app threeis going to be same as previous demos.So we'll go to zero, two, LBC NLB load balancer service,right and you can see external DNS related recordis added here right?And you have the port 80 and 4, 4, 3 listeners,so that you will be able to access your applicationwith port 80 and also with 4, 4, 3.So now let's come back to our terminal hereand enter into the section 19, 0, 3, LBC NLB external DNSand verify our kube manifestand then say kubectl, apply hyphen F kube manifestand let's wait for it to get created.So we can see here app three NGINX deploymentand EXT DNS LBC network LBS created.So if you see here the name also,as per the demo usually we change itin the metadata section, right?So EXT DNS LBC network LBand same we have mentioned for the load balancer name also,here the same thing, so now let's come back hereand verify the ports, services and if you wantyou can also verify the controller port locks.But now we'll come here, kubectl and get pods.Our app three NGINX should be running rightand before deploying this kube manifest,you need to always ensure that,so whether you have the external DNS port running, right.So before deploying only you need to checkbecause you are, you added the external DNS related hostand annotation in your service.So we can see it's already running.So obviously you can do this deployment, right?So it's already running here.So now let's come back here and we have verified the podsand we'll also verify the servicesand the service should be created for usEXT DNS LBC network LBand you can see that DNS name for the same thing.Another important thing, you need to verify easierexternal DNS logs.So this is the command to verify your external DNS pod logs.Either you can say kubectl, get podsand you can also say kubectl logs hyphen Fand your external DNS pod logs, you can verify this way alsoor you can directly give this command and then verify.So let's wait for the logs to rolland we'll get the final logwherein whether it has created the NLB DNS 1, 0, 1in our route 53 or not, it is going to show us.So we can see here the desired change,it created NLB DNS 1, 0, 1 in our route 53 service.So let's go hereand start with first the route 53 service, right?And our DNS should be added here,so go to hosted zones and go to www.stacksimplify.comand in www.stacksimplify.com NLB DNS 1, 0, 1 is added, good.So now we'll also go to our load balancer here, right?And our load balancer EXT DNS LBC network LBis currently provisioning.So port 80 listener, you have Port 4, 4, 3 listener you haveand you'll also see the target groups.Two target groups for two listenersand let's see if they are healthy.So they are in the registration state.So let's wait for the load balancer to become active.Let's go back to target groups and refreshand they are still registeringso let's wait for them to be healthy.After that we can go ahead and then access the stuff.So in meantime we can do the NS lookup, test.So let's come back hereand say NS lookup NLB DNS 1, 0, 1 stack simplify dot com.So it is resolving to two IP addresses for usand this should be same as the NLB DNS name.So let me refresh, this seems to, one should be healthy.Let's come back here and this is the NLB DNS, right?So that custom DNS and this DNS should resolveto the same IPs and you can see both are same, good.So now let's wait for the load balancer relatedtarget groups to be healthy.So both are healthy, let's also verify the second oneand both are healthy here also.So now let's go here and access with the URLHTTP and also HTTPS.So this is the HTTP one and HTTPSalso should not throw any SSL pop-up, right?You can see the lock symbol here.This is non-secure, which is HTTPand this is secure and it doesn't throw any SSL pop-up,because the domain matches star dot stack simplify dot comoff over SSL certificate matches here.So now go to connection is secure, certificate is validand star dot stack simplify dot com right?So this completes the external DNS demofor network load balancer.So we'll go here and clean up the stuff kubectl,delete hyphen F, kube manifest.So this should delete our app three NGINX deploymentand EXT DNS LBC network LB.And let's come back here and verify alwayswhether your load balancer successfully deleted or not.And if you want you can also verify your DNS record,so whether it is deleted or not.So we can go here first and take the logs, right?So let's come back hereand this is the command for external DNS logsand let's wait for the logs to displaywhether it has deleted or not.So we can see here delete NLB DNS 1, 0, 1 dotstack simplify dot com.So if you go here to www.stacksimplify.com.So you should find nothing related to NLB DNS 1, 0, 1.I'll see you in the next lecture with another NLB demo.Until then, bye bye.Thank you.