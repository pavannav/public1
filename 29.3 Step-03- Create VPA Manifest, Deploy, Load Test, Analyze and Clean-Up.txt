# 29.3 Step-03- Create VPA Manifest, Deploy, Load Test, Analyze and Clean-Up

-: Welcome back.In this lecture we are going to create a VPA manifestrequired for our application, whatever we have deployed.So vertical port autoscaler related manifestwe are creating now.So if you see here, so it's APA version is auto scalingks i v one beta and the kind is vertical port autoscalerand ized cube engineer vpa whatever we want toput it in spec.We have a few things, two important thingstarget reference and then resource policy.So target references to which deployment youare going to point to.So my deployment is meanslike to which application you are going to pointto and of what kind, whether it is a deploymentor state full set or whatever it is, right?So mine is a API version.Apps we one and its kind is deploymentand its name is VPA demo deployment.So that information we have provided in target referenceand we also have resource policy where the policy relatedto respect to container we need to define.So in our part, if we have multiple containersalso per container how much it need to be defined.Also you can provide the container nameand then provide the information.So controlled resources we are doing is CPUand then memory by vpa, vertical portat scaler and minimum alert is whatever we have putin our request section.Okay? So in request section, okayand max load how much it is allowedfor my respective deployment for this respective containerhow much it is load is one CPUand then memory is 500 mi it is allowed.So that is the max limit it can use and but it can usethis is the max limit but it can use anythingbetween five M two one cpu, 0.00521 cpuhow much it want it can use and even memory alsofrom five MI two 500 mi, it can use how much it want.It can use that much.So based on the load, whatever it is coming, it is goingto auto configure our respective parts resources thereand then let us know.So if we describe the part after generating some loadwe'll know that how much it is going to be.So that's about the VPA manifest.Okay, so we can even see the same manifest here.Z zero two VPA manifest.Okay, so let's go aheadand then deploy our VPA manifest Q CTL apply hyphen Fand cube manifest.And inside that we have zero two VPA manifest dot yml.So let's deploy this and then we can say cube ctlget VPA to see our list of our VPs.So we have one VPA Q CTL describe VPAand cube engineer is the name of the cube engines VPs.So let's make paste it here and we can see that.So for container names starokay Max Lotes CPU one and then memory is 500 I.So that's about the information, the policyof vertical port scaler for our respective deployment.Whatever we have defined, we can see it here.Okay, so the next thing here is we'll go hereand then we'll generate some loadand then test what happens.Okay, so on terminal one we are going to put clearand I'm going to say cube CT get partsand then keep watching the ports.So I have four ports here which are runningfrom six minutes.Okay, so now I'm going to take a new terminaland then paste the command, which isIt should not be, Hello?It should be just til here.Okay, so let me fix this off as it is cube engine image.So on the root context itself, we have the indexdo TML reality didn't apply any hello vault service here.So it is just a slash okay, so I'm going to run thison three terminals continuously.Okay, so let me go here and then paste it and run it.Okay, so in one more also I'm going to run it andin one more also I'm going to run it.Okay, so and then let me see how it goes.Okay, so what happened?So let me take one more time.So we are going to copy one by one and then why?Because the names are going to be different.Apache bench one, Apache bench two and thenApache bench three.So let me copy bench one here and then run it.And this is bench two.Okay, already exists.So here it is running, no, what happened?So let me close, close right so we can run itRight? So anywhere one load is also sufficient for us.We can see it here.So continuously it is changingit is terminating and then recreating the pods.Okay? So if you want you can go hereand then get pods and then take a newly created pod.Okay? So which is 68 seconds beforeokay cube C here describe podand then verify this 68 seconds latest created pod copyand then past it, right?And then if you see here it is taking 25 M and then 26, 2 4this is this much CPU and then memory it is requesting.But ideally how much we have allocatedwe have allocated only this much.If you see here in our re respect tool deployment manifest.Okay, so that's about it.So it is taking automatically and then allocating it basedon the load, how much we are getting.So if you want we can even say get port watchand then some more ports will be terminatingand then recreating it based on the need, how much we need.Okay, so all these port already terminated and thenrecreated. Okay, so that's about it.So cube CTL get ports one more timeif you want we can check.Okay, so this, these are running from three minuteswe can even see those informationhow much it is taking, okay, so that you get a clarityon what happened, copy and then past it.So for this it is 25 M and then 2 6 2 1 4 4 K.So from whatever we have requestedvertical port autoscaler automatically increased the CPUand then memory of our four ports.So which means al port where we have increased the numberof ports for our application from 1 2 10but when we come to vpa, vertical port data scalerso all four parts are going to be as is four partsbut they CPU and then memory got increased basedon the load, whatever we are getting right?So that's about it if you want to run moreand more load so you can keep running these thingsin different different terminals.Okay, so in one terminal with Apache bench as your pardonyou are going to run in another terminalyou're going to run it as Apache bench twoand then in another terminal you're going to run itas Apache bench three part names I am saying okayso that it'll get more and more loadand then you'll get more clarityon how much it is going to increase based on the load.But as far as we have seen how VPA workwe already got the clarity.So now a few important notesabout VPA is VPA updater can relaunch Newportwith updated CPU n memory when youat least have two parts in deployment.So this is very important.So we have four parts, that's the reason two parts at a timefor if you see here that is the important catch point hereokay, so for these two parts it is four minutes, 54 secondsas they launch time right from, it's like it, it tookfrom last four minutes they are running and these two partsit is running from three minutes 54 seconds.So what it does is, so out of four partsfirst it took two parts and then modified its CPUn memory and then relaunched it and then it waitedfor one more minute and then launch it again.Two more parts with with the, again the CPU N memory.So it didn't make any of the entire services downit ensured that it has done in a rolling update fashion.So, but when, what happens if it is only one pod you have.So that also we need to understand rightif we have only one pod runningunless we manually delete that part, it will notlaunch a new quad with the VPA recommended CPUN memory considering the application availability scenario.So it is very intelligentand then understands that there is only one partand then if you term, if I terminateand then recreate it due topa recommendationsthere will be downtime for the application I Ishould not be the cause for that downtime.So it'll feel that way and then it'll ensurethat that part it is not going to deleteif it is only one part in your deployment.So if we terminate it manually go and then terminate itthen it is going to relaunchwith new VPA recommended CPU and then memory resources.So that'sabout the very important point we need to know about vpa.So let's go ahead and then delete whatever we have createdas part of this section.Okay, so I'll go here and then clear the stuff.And Q ctl, delete H and F Q manifest.So whatever the VP we have createdand then deployment and then service, it got deleted.So this completes the vertical port Autoscaler demo.And then understandingin our next lecture we are going to focuson cluster autoscaler four elastic service eks.So I'll see you in the next lecture.Until then, bye bye.Thank you.