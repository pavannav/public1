# 22.5 Step-04- Introduction to NLB TLS with k8s Service

-: Welcome back.In this section, we are going to learnabout Network Load Balancer,TLS or SSL using Kubernetes Service.And if you see here, earlier we have seenthe Kubernetes service with the annotations relatedto NLB with listener, port 80and all standard annotations,which is required for creating the Network Load Balancerusing the Kubernetes service.So now we are going to add additional things here,which is nothing but the listeners requiredand SSL annotations required for us.So listener is nothing but your service relater port,which is port 80, is your target port,and your service port is going to be 443.In addition, you're also going to defineSSL ports annotation, and SSL certificate annotation,which is where you are goingto update your SSL certificate YARNfrom your AWS certificate manager.So, if you remember, when we are implementingthat NLB demos,so we have created a wildcard certificate,and if you go to that certificate,you'll find the YARN, so that YARN you can updatefor this SSL cert YARN, right?And you're also define that SSL negotiation policy,and this SSL negotiation policy you can get itfrom your, so, 19 NLB Network Balancer LBC,and we are in section 1902 LBC NLB DLS.And if you go to step two here,so you'll find the security policy slip,and you'll open it, it will take you here.So there are the security policiesand you can use the security policies accordingly.So these will help us in defining the cipher standards,and all those things for us.So if you'll go here and go to our Visual Studio code,and go to 1902 NLB DLS, and go to 02 LBC NLB,load balancer service,and go to that respective annotation, right?So you'll find something called'specifies the security policyfor NLB front-end connections'.So allowing us to control the protocol and ciphers.So this is the one currently it is present.So whatever is the latest our level,that is what is updated here.And next annotation we are going to discuss here isback-end protocol.So this back-end protocol annotation supports PCPand then TLS fielding cipher.So the communication from this network load balancer tool,this back-end application engine it's R/3,should be 3CPRPLS, so that need to be decided.So if your back-end application is listening on SSLand you want the communicationfrom this network load balancerto your back end port with SSL only or TLS only,at that point you can use TLS.In our case, our back-end port is listening on,the container inside the port is listening on port 80.So ours is going to be PCP.And one important annotation stillwe didn't discuss is SSL ports 443.So what does this annotation does is,specify this annotation if you needboth TLS and non-TLS listeners on the same load balancer.So if you don't specify this annotation,you don't get the non-TLS annotations, right?Only TLS annotations are supported.So if you want non-TLS annotations also should be presenton your network load balancer,specify this annotation, right?So that's about the thing.And now if you see here this is the network we signed.So already we have discussedabout these things multiple times.So in a AWS cloud, whenever we are creatingan EKS cluster control thing,it has created it, the PC for us,and public and private subnets,and we created an EKS private node group,and deployed the R/3 application here,and also deployed the Kubernetes servicewith NLB annotationso that it created a network load balancer.In addition, we created a certificate manager relater,SSL certificate inside that, wildcard certificate,Stardock Stack Simplified.com.And associated that respect to certificate YARNin our TLS related annotationsin our network load balancer.So that this network load balancer can determinate the SSLon this network load balancer.So now if you'll see here, you can accesswith both HTTP, with port 80 your application,and also with HTTPS NLB, DNS YARN,with SSL certificate,so that SSL determination happenson the network load balancerand the request will go to your back-end portand port 80 PCP connections.Now, if you come back here,so these are the annotations we have discussedand if you see in the service portsyou'll find all these things.So these are nothing but, let's discuss in detailor we can even go back to our Visual Studio code here,and you will find here.So this is the port 80 relater HTTP port.So this is the front-end port, right,which is your service port, is 80.And this is your back-end container port.So now when you specify the front-end port here,it creates a port 80 listener on NLB.And whenever you provide a target port,this one will create a target group for us.The same way for 443 also, it creates a 443 listenerand 80 related target group.Here also 81, 82, also will create 81 listener, 82 listener,and target group also port 80.So if you see here, target port 80 is commonin all these things, your back-end port,your back-end container port.And if you see here, this is target group 1 you are seeing,this is target group 2 you are seeing,this is target group 3 you are seeing.So, what is happening here is,whenever you map a port like this in your service, right,so when it is time to create a network load balancer,it is not going to use the single target group,whatever it has created for this port,for all these things, even though it is 80,it is going to create a separate target groupfor each front-end listener.So that is what it is going to do.So listener to target group is a 1 to 1 mappingand it is going to create equivalent target groupin our respective network load balancer.So every listener will have its own new target group createdwith the port mentioned in the target port field.So this might not be effective behavior,but unfortunately when you create a Kubernetes servicethat's the behavior.So now let's come back hereand if you see this is the screenshotswhenever the network load balancer is created.So if you take only these two things, right?So let's consider only port 80 and 443.TLS and non-TLS.So it creates port 80 and 443 listenersand this is the security policy,it is also saved with our network load balancer,and this is the SSL certificate also.See there we have the 443 listener,and these are the target groups,see, these two are two different ones.This ID is different in both the things, right?So because you have created two ports hereand even though the target port is the samefor both of ports, still it creates two target groups.So you can see here the two target groupsand the node ports, and it's a protocol PCP,and they are of target type instance node.And if you go to any target group,so you can find the wildcard nodes registered hereand then they are held here,and here is the health check part also,which is of protocol HTTP.So this completes the introductory partof EKS NLB TLS demo.Now next lecture we are goingto deploy the Kubernetes manifest and then test it.So I'll see you in the next lecture,until then bye-bye, thank you.