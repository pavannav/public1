# 2.8 Step-08- Verify EKS Cluster Nodes

-: Welcome back.In this lecture we are going to verify our clusterand then node groups and then nodes all those thingsin different different steps, okay?So our first step is to verify our node group subnetswhich means likewhether this respective node group is createdin public subnet or not.So let's go ahead and then verify that.So how we are going to verify is nothing but for the subnetsassociated for our node groupif we have the internet gateway route,which is nothing but, it is present in the public subnet.So let's go to EC 2,in the sense, like our management consoleand then go to Elastic Kubernetes service.So we can see the cluster with the EKS demo got created.Inside that, if we go to compute tab,we can find our node group, right?So EKS demo 1 NG public 1.So it has desired sizes two nodes, okay?So let's open that and if we see here,it has the subnet here, okay?So we'll click on any one of the subnet,it'll open our VPC subnet section hereand inside that we are going to verify.We are going to go to respective route tablesand then verify, okay?So here is the route table, right?In subnets, in the route table tab,you can see that we have the internet route enabledwith the internet gateway, which confirms thatour respective node group is created in the public subnets.So that is our first step. we have verified.So now verify cluster node groupsin EKS management console.That one also we have verified.So we went hereand then we have seen our cluster configuration here.We can see the API server endpoint herefor our respective cluster,which is nothing but Kube-apiserver endpoint.And this is our open edit connect provider URL.So, and in addition to that,in compute, we have seen the node groupsand then inside node groups we have seen the subnetand all those stuff.And it also created a auto-scaling group for this.And why?Because we have enabled the ASG accesswhich is nothingbut auto-scaling group access and all those stuff.Automatically, it'll create anywhere with eksctl.We really don't need to worry about those things.So let me close it here.This is the auto-scaling group it has created.So using the cluster auto-scaler concepts,based on the resources we are going to use,we can increase or decrease these things.So we'll see at that respective time.So let's close these things and then go backand we can see the networking informationfor our cluster and then logging information,by default, it is disabled.If you want, we can even enable it.We can add this eksctl manager cluster,always it is recommended to use eksctl 2.Enable logging, disabled, logging,whatever the modifications we want to do.Instead of this management console,if you do it via eksctl, that is a good option for us, okay?And any updates currently it is using latest,we really don't have any latest updates here.So that's about on a high levelfor verifying the cluster node group and then cluster.And now to list the clusters,we have already seen eksctl get cluster or get clusters.So if you want to verify that node group,means like under this cluster, you can copyand then provide that cluster name hereand then you get the node groups present inside this, okay?Get node group and --cluster.So I'll correct that.So this should be like this, okay?And I'll correct that command. I've corrected it.So now list nodes you have already seenthat eksctl get nodes hyphen or wide.So you can see this.And another thing is eksctl config view minify, okay?So to see our config context, okay?So our respective to EKS demo 1's config context.We can see here the current context isKalan Adered, EKS demo 1, US east 1, eksctl.io.So this is the current context.So to see the current context of your Kube CTL,you can use this command.So the next thing is worker nodesIAM role and list of policies.So if you remember in eksctl, right?In eksctl here, node group --health,you know that you have added all these add-on flags, right?So which is nothing but we are going to provide respectiveIAM policies for our worker node, IAM role.So let's see that now.So let's go to EC2.These are core fundamentalsand then it might take close to 30, 40 or 45 minutesto create your cluster.But it's very important to know what is whatbefore going and then deploying the workloads.So that's the reason we are taking a little bitof time instead of just executing two commandsour cluster might have createdbut we need to understand deeper.So if you see it here in our EC2 instances,two instances got created,which are nothing but worker nodes.And inside that,if we go here we should find the IAM role, right?So you can see that IAM role is eksctland then cluster name -node group.Whatever you see with node group it is nothing but the nodegroup related node instance role.So if I click on that,so it'll open the respective IAM consoleand then that respective role.So let's wait for it.Okay, so now if you see here, so by default,worker node policy container registry read only.If you see here, you have additional stuff here, okay?So policy for ALB ingress,policy for app mesh, policy for auto-scaling,policy for DNS. which is nothing but external DNS.And you have also policy for container registry read only.And then container registry power userwhich is nothing but ECR full access,Elastic Container Registry full access.So all these policies got added for our worker node IAM,means like worker nodes IAM role.So why this is required?This is nothing but whatever the ports,Kubernetes ports you are going to runin your cluster worker nodes, they need to access it.They need to access these resources,which is nothing but if we want to accessthe elastic container registry to downloadthe container image.So then, it needs accessand then you have two ways to do it.So one is create a Kubernetes service accountand then create a IAM role and then associate them togetherand then provide that informationfor your respective port,means like for your respective container,so that it can pick up and then use that.So other way is like directly give itin your respective worker node IAM roles.So that these worker node, whatever the parts runningon this worker node will have access to these resources.So the parts running on this worker nodes will have accessto these resources to perform the action for that purpose.We can do this way and we are also going todo the other ways like create a IAM role,create a policy and then create a Kubernetes service accountand then associate everything together.All those things, we are going to do it separatelyfor ALB ingress controller and for external DNSand for multiple things we are going to anyway do it.So let's go there.And then we have seen the IAM role,also see the security group associatedto worker nodes.So let's go here.And before going to security groups,first we'll see the cloud formation stackand then we'll go back to security groups, okay?So we'll go to cloud formation, right?So let me click on this.And why we are seeing here is like what is happening?I just executed that command and then what happened?We need to know, right?So now if you see it here,you can see these two are the thingswhich has been created today.So today's 14-6-2020.And then as part of thiswhat it created is eksctl, EKS demo 1 cluster.So whenever you have executed the create cluster command,it has created the cluster and the associated eventsyou can see here what all it has created, right?So it'll be creating lots of stuff.It'll create the NAT gateway, it'll create cloud tables,and lots of stuff it'll create underlying, okay?And what are the outputs of thatand all these things, you can see.So this is your endpoint.Endpoint is nothing but your Kube API server endpoint.So this cloud formation stack, whenever you sayeksctl create cluster, automatically it'll post the contentto the cloud formation API.And using that it creates,means like using cloud formation only, it has created.So now you also need to see one more thing here,important thing is, NAT gateway.So why?Because if you deploy your worker nodesmeans like your workloads in the private subnetand your node group is in private subnet,it needs access to the EKS cluster,which is nothing but control plane.In addition to that, your parts also need to have access todocker hub or anything, right?So for that purposesNAT gateway outbound is going to be helpful.So by default it'll create a single NAT gatewayand you have options to create higher availabilityNAT gateway or even disable the NAT gateway, right?So these are important things which we need to know.So on a high level, I'm trying to explain.And whenever we go to those respective sections,we'll get in detail.So the next section is security groups, right?So before going to security groups,we'll also complete the worker nodeusing key pair Kube demo, right?So let's go to our EC2, right?And see what is the key pair associated to it.So ideally it should have Kube demo, right?So let's go here, come down.See the key pair name it is associated is Kube demo.So let me go to my SSHand take the public IP of any of these nodes.I have took one, okay?And then I will say ssh -iand I have my Kube demo perm file here.And then I'm going to say EC2 user Aderedand it should allow us to log in, right?Right. I have logged into the EC 2 userwith 192.168.42.229 is my private IP, right?And then I can even see my disc space, okay?On the server, right?So it has mounted 20 GB, whatever we said, right?So 20 GB, it has mounted for us, okay?So this is about the login to our respective worker nodes.So I'll add this command in the dock.Now let's go back to the security group step, okay?So any security group which has the remote in between it,that is nothing but the security group relatedto inbound access to our worker nodes, okay?So in this, if you see here you havethe cluster security groupand you see something called remote access, okay?So this is the security group we are interested in, right?So let me open that security group here.And in the inbound rules, it is open onlyto 22 to the internet.So that's the reason, just know whatever we have donethe terminal accesses worker, ssh -i, right?So now what we are going to do iswe are going to add one more rule here.So that is nothing but all traffic we are going to allowfrom anywhere.So for our testing initial sections, we are going touse the node port service for the workloadswe are going to deploy.So for those workloads,if you're going to use node port service,then node port generates different different dynamic IPs,our dynamic ports.So our cluster public IPmeans like our worker nodes public IP:and the dynamic port, whatever it generates.So using that, we should be able to access our applications.So for that purpose, this rule is required.So I'm adding this rule here, okay?So which means like I'm saying that addingan additional ruleall traffic from anywhere is allowed for my worker nodes.That's the step six, okay?So this completes the creation of EKS clusterand then associating EKS cluster to IAM OIDC providerand creating the node groupsand verifying everything step-by-step.So in our next lecture, we'll focus on other section.Until then, bye bye.Thank you.