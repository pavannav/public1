Welcome back and in this demo lesson you're going to create the AWS account structure
which you'll be using for the remainder of the course.
Now at this point what we need to do is to log in to the general AWS account.
So I'm currently logged in as the IAM admin user of my general AWS account
and I've got the Northern Virginia region selected.
You're also going to need either two different web browsers
or a web browser such as Firefox which is capable of using different sessions
because we're going to be logged in to multiple AWS accounts at once.
So the first thing that we're going to need to do is create the AWS organisation.
So because I'm logged in to the general AWS account
I'm logged in to an account which is a standard AWS account.
It isn't part of an AWS organisation
and so it's not a management account and it's not a member account.
So what we need to do is to move to the AWS organisations part of the console
and create the organisation. So let's do that.
So to do that go to find services and just start typing organisations
and then click to move to the AWS organisations console.
Once we're here go ahead and click on create organisation.
This is going to start the process of creating this AWS organisation
and as part of that it will convert this standard account
to be the management account of the organisation.
So go ahead and click on create organisation and that will complete the process.
So now we have the AWS organisation and within it this one single AWS account.
So the general account has now been converted to the management account of this AWS organisation.
Now you might see a message saying that we've sent a verification email to this email address.
So this is the email address that's associated with the general AWS account
which is now the management account of the organisation.
And you'll need to click the link within this email to verify this address
so you can continue using AWS organisations.
So if you do have that notification on screen go ahead and verify that email before continuing.
If you don't have a notification you're good to continue.
Now at this point what I'll need you to do is to open a brand new web browser
or a web browser such as Firefox which is capable of handling different sessions
and I'll want you to log in to the production AWS account.
So just be careful at this point you need to make sure that this is a completely separate session
and if in doubt use a completely different web browser
because we need to maintain logins to both this management account and the production account.
So I'm going to go ahead and log in to the IAM admin user of the production AWS account.
So now I'm logged into the production AWS account with this separate browser session
so either you'll use a separate browser session or a completely different browser.
At this point you're going to need the account ID for the production AWS account
so click on the account drop down and make sure that you copy this account ID into your clipboard
and it needs to be the account ID for the production AWS account.
Once you've got that go back to the browser or the session where you have the general account open
so this is now the management account of the AWS organisation.
And we're going to invite the production AWS account into this organisation
so currently the only account which is a member of this organisation is the general account
which is the management account of the organisation and we're going to invite the production account.
So go ahead and click on add account.
We're going to be inviting an existing account into this organisation so click on invite account
and you'll need to provide either the email address of the production account which you used while signing up
or the account ID and I've just demonstrated getting the account ID of the production account
from this drop down so I'm going to enter this account ID into the box.
Now if you're inviting an account which you administer you don't have to put any notes
but optionally if you're inviting an account that's administered by somebody else
then it might be nice to type a message.
In either case once you've entered the email or the account ID just scroll down and click on send invitation.
Now depending on your specific AWS account it is possible that you might receive an error message
at this point telling you there are too many accounts within the organisation.
Different AWS accounts are created with different account quotas and so it's possible that you might get an error at this point.
If you do you just need to log a support request asking for an increase in the number of AWS accounts
which can be part of an AWS organisation.
If you don't get an error message then this invite process has started.
What we need to do now is to accept this invite from the production AWS account.
So let's go back to this other tab and move across to the organisations console.
So in the find services box just type organisations and then click to move to the organisations console
and towards the middle left you should see this heading saying invitations
and if you just click on invitations you'll be able to see an overview of all of the invitations
which apply to this production AWS account.
So this is the invite that we just sent from the general AWS account
which is the management account for our organisation.
So go ahead and click on accept and this completes the process of joining the organisation.
So now the production account is a member of the AWS organisation
and we can verify that by returning to the tab where we logged in to the general AWS account
which is now the management account for this organisation
and just hit refresh and now we should see two AWS accounts, the general account and the production account.
So next I'm going to demonstrate how we can role switch into this production AWS account
which is now a member of the organisation.
So when you add an account to an organisation you can do it in two ways.
You can either invite an existing account or you can create an account within the organisation.
If you create an account within the organisation then a role is created within that account
which can be role switched into by other accounts within the organisation.
If you invite an existing AWS account into the organisation then you need to manually add this role
and that's what we're going to do next so this only applies if you're inviting existing accounts into the organisation.
So what we're going to do is to move across to the browser or session where you're logged in to the production AWS account
click in the services search box at the top of the screen and type IAM
and then we're going to move to the IAM console because this is where we create IAM roles.
So move to IAM and then go to roles
and we're going to create a role which can be assumed from the general account
so click on create role and the type of trusted entity is going to be another AWS account
so select this box and then for the account ID we need the account ID of the general AWS account
which is now the management account of the organisation.
So move back to the browser or the session where you're open in the general account
and you need to copy down the account ID of the general AWS account.
Make sure you get the general account not the production account.
Once you've got that in your clipboard we're going to paste this into this account ID box
and this is going to mean that the general AWS account is trusted to assume this role.
So enter that into the box and click next.
This role is going to have administrator access attached because it's going to be an administration role.
So look in the policies and look for administrator access, check that box,
scroll to the bottom and click on next to move to the next screen
and we need to give this role a name.
So this role is going to be used when we're logged into the general account
and we want to role switch into the production account to perform administrative functions.
Now we're going to give this role a very specific name, it's a standard name.
This is the same name which AWS use when they automatically create the equivalent role
within accounts that you create within the organization.
So I like to keep things consistent.
So the name of the role is going to be organization account access role with uppercase O, A, A and R
and note that it's the US spelling of organization so make sure you use a Z rather than an S.
Once you've done that go ahead and click on create role.
Now if we look inside this role, so select the role and then click on trust relationships
you'll be able to see that this role trusts the account ID of your general AWS account
and this will be different for you, this will be the account ID of your general AWS account
and this is what will allow identities within the general account to assume this role.
So the account that's now the management account of the AWS organization.
So now I'm going to show you how we can use this role to switch from the general account
to the production account and we're going to need to copy down the account ID
for the production AWS account because we're going to switch in to that account using role switch.
So copy down the account ID of the production AWS account.
You'll need to make sure you're logged into the IAM admin user of the general account.
This will only work with IAM identities.
Before we do role switch just move back to the main part of the AWS console.
So we've got the main console selected and then click on the account dropdown
and then select switch roles.
Now this starts the process of role switching from the general account to the production AWS account.
So to start that go ahead and click on switch role.
We need to provide the account ID of the production AWS account.
So that should be in your clipboard, just go ahead and paste that in.
Next we need to provide the name of the role within the production account which we want to switch to.
This is the role that you just created.
So the role which is called organization account access role with uppercase O, A, A and R
and the US spelling of organization.
So we need to enter that into the role name.
Now we need to give this role switch a display name.
So the way that this works is that when you initially do a switch role
it's going to create an entry within the console UI and this is stored in your browser.
So this is nothing to do with AWS.
This is just creating a shortcut so you can easily access this in the future.
So you need to give it a suitable display name.
I suggest prod for production.
You also need to pick a color and I try to be consistent with this.
So if I'm creating a role switch which is going into a production AWS account
then I pick red so I know that this is an important account.
So select red, make sure it's called prod, double check the spelling of the role name
and make sure this account ID is for the production AWS account and then click on switch role.
Now at this point this is role switching into the production AWS account.
It's actually using the assume role API call to assume the role that you just created
within the production AWS account.
And you can see that we've switched role because at the top here it's got the color red
and it has the display name of prod.
So this means that we've switched into this switch role shortcut that we just created.
Now let's go back to the general account by clicking on switch back.
So this now takes us back into the general AWS account.
And if we click on the account drop down again we can see a role history section.
Now when we were just creating this switch role I mentioned how it creates a shortcut
and this is that shortcut.
So now if I click on prod again it's going to automatically do a switch roles
into the organization account access role within the production account.
So by clicking this we go back to the production AWS account.
What happens behind the scenes is that we assume the role,
we're provided with temporary credentials that that role grants when we assume it
and then the console UI automatically handles this move across to the production account.
So now we're interacting with the production account using the temporary credentials
that we gained by assuming the role.
Role switching makes it easy to administer multiple AWS accounts within an AWS organization.
Currently we only have the one but the process would be the same if we had hundreds of AWS accounts.
Now let's go back to the general account by clicking on switch back.
Because now we're going to create the development AWS account within our organization.
This is going to be the third and final account that's a member of this organization
and this will complete the account structure you'll be using throughout the course.
At this point you can close down the browser window which you have open to the production AWS account
or the separate tab because we won't be needing that anymore.
Next we're going to create a brand new account within this organization.
So go back to the AWS organizations console, click on add account.
This time though we're going to create an account within the organization.
So click on create account.
You need to give the account a name and so I'm going to keep the same naming structure that I've used so far
only using development instead of general or production.
And you should do the same.
You also need to provide a unique email address which is going to be associated with this development AWS account.
So every AWS account even those created within an organization they all need to have unique email addresses.
Now keep in mind the trick that I talked about at the start of the course
where you can create an unlimited number of unique email addresses for one single Gmail account.
But each account does need a unique email address.
Now for the accounts that I've previously created as part of this structure
I've used my name so Adrian and then plus and then training AWS and then the name of the account.
So I'm going to use that same structure here so Adrian plus and then training AWS development
and you should use the same structure of emails you've been using so far
but use one for the development AWS account.
In this box you can provide the name of the role which will be created within this brand new AWS account.
Now this is the same role that you just created manually for the production account.
But this is created automatically by AWS because when you create an account within an organization
the only method that you have to access this account is by switching role into that account.
So we need to give the role a name.
Now the default is organization account access role with uppercase O, A, A and R
with the US spelling so with a Z and we're going to use that default.
And then I'll scroll down and click on create and you should do the same
and at this point it will create this development account within the AWS organization.
Now again if you get an error message at this point saying you've got too many accounts within the organization
then you might have to lodge a support request to have the limit of the number of accounts within an organization increased.
In my case I haven't had that error and the development account is being created within the organization
and that can take a few minutes.
But if we refresh this after a few minutes we should see this populated with values.
There we go we can see the development account has been created and it's been allocated with its own individual account ID.
Now I want you to go ahead and copy this account ID into your clipboard
because we're going to go ahead and create a new entry in this switch role dialog
to allow us to connect to the development AWS account which is now a member of this organization.
So click on the account drop down and select switch roles.
We're going to follow the same process that we did for the production AWS account.
First we'll need to enter the account ID for this new development account that we've just created.
You'll need to enter the role name.
So assuming you picked all of the defaults this should be organization account access role
with uppercase O, A, A and R and the US spelling so with a Z.
For the display name this time we're going to put dev for development
and rather than picking red my standard for any development accounts is to pick yellow.
So this indicates to us that we should still be careful but we can be less careful than for a production account which is in red.
So once you've entered all of that information just go ahead and click on switch role
and this will follow the same process as before.
So now it's switched role into the development AWS account.
So if we move to the main AWS console this is now a completely new account.
The development account.
We can click on the drop down and see that we've got a new entry in the role history.
We could switch back to general.
We could move across to the production AWS account.
We can move directly to the development account so we don't have to go back to the general account
before moving to the development account.
We can just use these role switch shortcuts to move directly between accounts.
So now that we're in the development account if we just go to the IAM console
I want to point out that even though we didn't directly create it
by creating a brand new account within this organization
AWS has created this organization account access role on our behalf
and if we click on it and then go to trust relationships
this role trusts the same general account ID.
So this is the general or the management account of the organization.
So by creating this account directly within the organization
AWS has created this role on our behalf that we can switch into from the general AWS account.
So at this point that's everything that I wanted to cover in this demo lesson.
Now you have three different AWS accounts.
You have the general AWS account which was originally a standard AWS account
which is now the management account of this AWS organization that we've just created.
In addition to this management account we've invited the production AWS account into this organization
and we've manually created the role allowing us to switch role into the production account.
And then finally we've created a brand new account directly within the organization
which is the development account and AWS automatically on our behalf
has created the role within the development account that we can switch role into.
So now we have these three AWS accounts.
We have the management account, the production account and the development account
and that's everything which I wanted you to do in this demo lesson.
So go ahead and complete this video and when you're ready
I look forward to you joining me in the next.
