Welcome back to part 5 of this demo series, where we'll be adding the final piece of the puzzle, the client side application.
Now this application will be delivered from an S3 bucket using static hosting, so you're going to create the bucket,
set it as publicly accessible, configure it as a static website, and then edit the client application files
to point at your specific installation of this serverless application using the address of the API Gateway
that you created in the previous demo of this series. Then once you've done that, you'll upload all the files
and you get to test that the application functions as expected. So let's go ahead and get started,
and to do that we'll move to the AWS console.
OK, so to get started, first we need to create the S3 bucket where the front-end component of our serverless architecture
will run from. To do that, go ahead and click on Services, and then into the Find Services box just type S3,
and then open the S3 console in a new tab. Now once you're there, click on Create Bucket,
and you'll need to pick a random bucket name. I'm going to go ahead and pick Pet Cuddletron 1337,
but you'll need to pick something that's unique, so different from me and different from any other students.
Once you've done that, make sure the region is set to US East 1. That will need to be US East 1 in order for this demonstration to work.
Then scroll down, and because this bucket will be public access, it will need to be hosting the client part
of our serverless application. You'll need to go ahead and untick Block All Public Access.
In addition to that, you'll need to check the box directly below it to acknowledge that you know this might result
in an open access bucket. And that's fine, that's what we want for this component of this serverless architecture.
So check this box, and then scroll all the way down to the bottom and click on Create Bucket.
Now if you get an error message like I've done, that the bucket name already exists, then you'll need to change the name.
So I'll just change it by one digit, try again, click on Create Bucket, and this time it's created the bucket successfully.
Now that we have the bucket, the next step is to make it publicly accessible, and we're going to do that using a bucket policy.
So click to move into your bucket, and then click on the Permissions tab, and then scroll down to Bucket Policy and click Edit.
Now there's a bucket policy contained in this stage's instructions and attached to this lesson.
So go ahead and get that bucket policy, and then paste it into this box.
Now there's a placeholder in this bucket policy, and we're going to replace it with the ARN of the actual bucket.
So just above the box here, it shows the ARN for this bucket, and you'll need the ARN for your bucket.
It will be different than mine, so just copy that into your clipboard, and then in the bucket policy there is a placeholder that you'll need to replace.
So this is within the two speech marks, so start before the R, and we need to select Replace Me, Underscore Pet, Underscore Cuddle, Underscore O, Underscore Tron, Underscore Bucket, and then finally Underscore ARN.
Make sure that you don't select the forward slash or the asterisk. We just want the placeholder text.
And then once you've got that, paste in the ARN which you just copied into your clipboard.
It should look something like this, only instead of the name of my bucket, it should have the name of your bucket.
Once you've done that, go ahead and click on Save.
Now as well as the bucket block public access settings, I just want to make sure that you've also got this set correctly at an account level.
So on the menu on the left, I want you to select Block Public Access Settings for this account.
And then if needed, click on Edit and just make sure that Off is selected for all of these options.
You need to make sure that Block All Public Access is set to Off at the top level, and Off for all of the four sub-settings.
Now depending on the age of your AWS account, you may not have to do this, but it is a good idea just to check.
Now once you've done this, you need to go back to the bucket that you've just created.
So go back to the main S3 console and click on the bucket.
The next step of enabling this serverless application is to enable static website hosting so that it can function as a front-end hosting point for the application itself.
So click on the Properties tab, then scroll all the way down to the bottom of this dialog.
And under Static Website Hosting, click on Edit.
Click Enable.
Then under Hosting Type, select Host a Static Website.
And then in both the index and error document boxes, go ahead and enter index.html.
And then once you've entered both of those, go ahead and click on Save.
And that bucket is now enabled to be a static website.
Now also attached to this lesson is a link for downloading the serverless front-end asset.
So go ahead and open that in a new tab, and it should automatically download a zip file.
Now you can go ahead and either save that zip file and then extract it, or you can extract it directly.
In either case, we need all of the files available and we need the ability to edit one of them.
So make sure they're available somewhere accessible on your local machine.
Now there are four files inside the zip file that you've just downloaded.
There's index.html and main.css.
And these provide the look and feel of the serverless application.
So index.html is the HTML document which contains the definition of the front-end website.
And main.css is a stylesheet which controls the look and feel.
And then we've got whiskers.png, which is an image loaded on the serverless website.
Now we need to edit the serverless.js file, so go ahead and open that in your favorite code editor.
Now once you have this open in your code editor, this is the JavaScript file that's called
whenever any buttons are clicked on the serverless website.
It's the JavaScript file that runs in your browser and communicates with the API gateway.
Now in order for it to communicate with the API gateway, you need to edit this placeholder
so that it can communicate with that specific API gateway.
So to do that, go back to the AWS console and if you didn't copy this into your clipboard,
you should still have a tab open to API gateway, so go ahead and click on that tab.
And you'll need to copy down this invoke URL and make sure you get everything.
It should start with HTTPS and finish with prod, so copy that into your clipboard.
Now back in this JavaScript file, I want you to go ahead and select this entire placeholder.
So replace me underscore API underscore gateway underscore invoke underscore URL.
You need to select that entire placeholder and then paste in what you've just copied into your clipboard.
Now position your cursor so it's straight after the prod.
This should be next to the D of prod and you need to type forward slash and then pet cuddle-o-tron.
So the entire thing should be the invoke URL and then a forward slash and then pet cuddle-o-tron.
All one word, all lowercase.
And once you've done that, go ahead and save this file.
So that's now customized and that means that this file will be able to communicate with the API gateway.
Now return back to the AWS console.
Go to the S3 console and click on the objects tab.
Click upload. Click add files.
Locate the front end files you downloaded and edited.
Select them all. Click on open.
Scroll down to the bottom and click upload.
And you'll need to wait for this process to complete.
It will take a few minutes and once the process has finished,
You'll need to click on close to close down this dialog.
Then click on properties. Scroll all the way down to the bottom.
And then click on this icon on the right to open the pet cuddle-o-tron application in a new tab.
So this is the HTML and CSS.
So the HTML document and the style sheet now loaded in the browser.
And at the bottom we have the email minion button.
And when we click on that button, it will execute the JavaScript inside our browser.
And it will send API gateway a command.
And that command will include which button is clicked together with the contents of all these boxes.
So all that remains now is to test out whether this serverless application functions.
Now before we actually run anything on this serverless application,
Just go back to the AWS console and then go to the step functions console.
So you can either use the history or type it in the find services box.
Once you're at the step functions console, locate the pet cuddle-o-tron state machine and then open that.
Go ahead and click on the logging tab and just scroll down.
And wait for it to load and you should see that there are no logs for this particular state machine because it's never been executed.
Likewise if you click on the executions tab, even if you hit refresh, there are no executions because it's never been executed.
This is the first time we've loaded this serverless application.
Returning to the tab where we have the S3 static website open.
Now we're going to do a test of the serverless application.
Now for the values, what I suggest is 120, so 120 seconds for the timer.
This controls how long the state machine will wait before sending notifications.
For the message, I suggest human come home now in caps because it's so urgent.
Now for the email address, you'll need to enter the other email address that you created right at the start of this demo series.
So I'm going to go ahead and enter my email address.
So at this point, all that remains is for us to click this button to test our serverless application.
So go ahead and click that button.
If everything's working successfully, you should see submitted, but check the result below.
And then at the bottom, you should see status success.
Now if you do see that, then everything's working as it should be.
And go ahead and move back to the step functions tab that you opened moments ago.
Back at this tab, go ahead and refresh the executions tab.
You'll see that we've got a currently running execution.
So let's go ahead and click on that execution to explore it further.
Now we can see this current execution visually.
And the part that's in blue is the part that's currently running.
And this is the timer state.
So this is the part of the state that's going to wait that 120 seconds.
And only when that time has passed will it continue on to the email state.
And remember, the email state is the task state, which is going to invoke the lambda function.
And that lambda function is going to send an email notification.
Once both of those have completed, it will move on to the next state, which is called next state.
And then once that's completed, it will move to the end of the state machine execution.
So that's how it looks visually.
If we move to the top and click on the execution input tab,
then we're able to see the parameters passed into this state machine.
And these came via the boxes on the website.
They were captured by the JavaScript, passed through to the API gateway,
passed through to the API lambda,
and that lambda function, when it was invoked, passed those through to this state machine.
So this is how these parameters have made it all the way from text boxes on a website
all the way through to this state machine.
Now if we click on PetCodeLatron at the top and click on Logging,
and then scroll down, we'll be able to see all of the log items for this state machine execution.
Now there is a delay, so you might have to press on Refresh a couple of times
to see the full output of all of these different states.
After a couple more refreshes, we've now got the full log output of this entire state machine execution.
And at this point, that's been our first successful execution of this serverless application.
So this is a really simple example of a serverless application,
but all of the techniques that you've used to create it are equally applicable
to much larger and much more complex applications.
With this application, you've created an S3 bucket and loaded some assets into that bucket,
including HTML, a style sheet, and JavaScript.
The JavaScript, which you've customized, communicates with API Gateway.
That in turn uses a lambda function as the backing compute.
That lambda function executes a state machine,
and that state machine integrates with other AWS services to send our notifications.
With that being said though, that is everything that you need to do in this advanced demo series.
The only thing that remains is to clean up the account,
and that's something that we're going to do in the next part of this series.
So go ahead and complete this video, and when you're ready,
I look forward to you joining me in the final stage of this demo series,
where we'll clean up the account and return it to the same state as it was before we started this advanced demo.
