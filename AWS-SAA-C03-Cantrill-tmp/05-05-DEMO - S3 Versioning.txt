Welcome back and in this demo lesson you're going to gain some practical experience of working with the versioning feature of S3.
So to get started just make sure that you're logged in to the management account of the organization, so the general account,
and then make sure that you've got the Northern Virginia region selected, so US-E-1.
Now there is a link attached to this lesson which you need to click on and then extract.
This is going to contain all of the files that you'll be using throughout this demo.
So go ahead and click on that link, extract it and it should create a folder called S3 underscore versioning.
Once you've confirmed that you're logged in and have the right region selected then go ahead and move to the S3 console.
So you can get there either using the recently visited services or you can type S3 into the find services box and click to move to the S3 console.
Now to demonstrate versioning we're going to go ahead and create an S3 bucket.
We're going to set it up for static website hosting, enable versioning and then experiment with some objects
and just observe how versioning changes the default behavior inside an S3 bucket.
So go ahead and click on create bucket.
As long as the bucket name is unique its specific name isn't important because we won't be using it with Route 53.
So just give the bucket a name and make sure that it's something unique.
So I'm going to use AC bucket 133337.
You should pick something different than me and different from something that any other student would use.
Once you've selected a unique bucket name just scroll down and uncheck block all public access.
We're going to be using this as a static website hosting bucket so this is fine.
And we'll need to acknowledge that we understand the changes that we're making so check this box.
Scroll down a little bit more and then under bucket versioning we're going to click to enable versioning.
Keep scrolling down and at the bottom click on create bucket.
Next go inside the bucket, click on properties, scroll all the way down to the bottom
and we need to enable static website hosting.
So click on edit, check the box to enable static website hosting.
For hosting type we'll set it to host a static website.
And then for the index document just type index.html and then for the error document type error.html.
Once you've set both of those you can scroll down to the bottom and click on save changes.
Now as you learned in the previous demo lesson just enabling static website hosting isn't enough to allow access.
We need to apply a bucket policy.
So click on the permissions tab, scroll down and under bucket policy click on edit.
Now inside the link attached to this lesson which you should have downloaded and extracted
there should be a file called bucket underscore policy dot json which is an example bucket policy.
So go ahead and open that file and copy the contents into your clipboard,
move back to the console and paste it into the policy box
and we need to replace this example bucket placeholder with the ARN for this bucket.
So copy the bucket ARN into your clipboard by clicking this icon.
Because this ARN references objects in this bucket and we know this because it's got forward slash star at the end
we need to replace only the first part of this placeholder ARN with the actual bucket ARN from the top.
So select from the A all the way up to the T so not including the forward slash and the star
and then paste in the bucket ARN that you've copied onto your clipboard.
Once you've done that you can scroll down and then click on save changes.
Next click on the objects tab and we're going to upload some of the files
that you downloaded from the link attached to this lesson.
So click on upload and first we're going to add the files so click on add files.
Then you'll need to go to the location where you downloaded and extracted the file that's attached to this lesson
and once you're there go into the folder called S3 underscore versioning
and you'll see a folder called website.
Open that folder, select index.html and click on open and then click on add folder
and select the IMG folder that's also in that same location.
So select that folder and then click on upload.
So this is going to upload an index.html object and it's going to upload a folder called IMG
which contains winky.jpeg.
Once you've done that scroll down to the bottom and just click on upload.
Now once the upload's completed you can go ahead and click on close
and what you'll see in the objects dialog inside the bucket is index.html and then a folder called IMG
and as we know by now S3 doesn't actually have folders it uses prefixes
but if we go inside there you'll see a single object called winky.jpeg.
Now go back to the bucket and what we're going to do is click on properties, scroll down to the bottom
and then click on this icon to open our bucket in a new browser tab.
All being well you should see animalsforlife.org, Animal of the Week
and a picture of my one-eyed cat called Winky.
So this is using the same architecture as the previous demo lesson where you experienced static website hosting.
What we're going to do now though is experiment with versions.
So go back to the main S3 console, scroll to the top and click on objects.
So because we've got versioning enabled on this bucket as I talked about in the previous theory lesson
it means that every time you upload an object to this S3 bucket it's assigned a version ID.
And if you upload an object with the same name then instead of overwriting that object
it just creates a new version of that object.
Now with versioning enabled and using the default settings we don't see all of the individual versions
but we can elect to see them by toggling this show versions toggle.
So go ahead and do that.
Now what you'll see for every object inside the S3 bucket you'll see a particular version ID
and this is a unique code which represents this particular version of this particular object.
So if we go inside the IMG folder you'll see that we have the same for Winky.jpg.
Toggle show versions to disable and you'll see that that version ID disappears.
What I want you to do now is to click on the upload button inside this IMG folder.
So click on upload and then click on add files.
Now inside this lesson's folder, so S3 versioning, at the top level you've got a number of folders.
You have website which is what you uploaded to this S3 bucket and this image folder contains Winky.jpg.
So this is a particular file Winky.jpg that contains the picture of Winky, my one-eyed cat.
Now if you expand version 1 and version 2 you might be able to tell that version 1 is the same one-eyed cat.
And we can expand that and see that it is actually Winky.
Inside version 2 we have an object with the same name but if we expand this, this is not Winky.
This is a picture of truffles.
So let's say that an administrator of this bucket makes a mistake and uploads this second version of Winky.jpg
which is not actually Winky, it's actually truffles the cat.
But let's say that we do this, so we select Winky.jpg from the version 2 folder and we click on open.
Once we've selected that for upload we scroll all the way down to the bottom and click on upload.
So that might take a few seconds to complete the upload because these are relatively large image files
but once it's uploaded you can click on close.
So now we're still inside this image folder and if we refresh all we can see is one object, Winky.jpg.
So it looks with this default configuration of the user interface like we've overwritten that previous object with this new object.
And if we go back to the tab which has got the static website open and hit refresh
you'll see that this image has indeed been replaced by the truffles image.
So even though it's called Winky.jpg this is clearly truffles.
Now if we go back to the S3 console and now if we enable the versions toggle
now we can see that we've got two different versions of this same object.
We've got the original version at the bottom and a new version at the top.
And note how both of these have different version IDs.
Now what S3 does is it always picks the latest version whenever you use any operations which simply request that one object.
So if we just request the object like we're doing with the static website hosting
then it will always pick the current or the latest version of this object.
But we do still have access to the older versions because we have versioning enabled on this bucket.
Nothing is ever truly deleted as long as we're operating with objects.
So let's experiment with exactly what functionality this gives us.
Go ahead and toggle show versions.
Once you've done that select the Winky.jpg object and then click delete.
You'll need to type or copy and paste delete into this delete objects box and then click on delete.
Before we do that note what it says at the top.
Deleting the specified objects adds delete markers to them.
If you need to undo the delete action you can delete the delete markers.
So let's explore what this means.
Go ahead and click on delete objects.
And once it's completed click on close.
Now how this looks at the moment we're still in the image folder.
And because we've got show versions set to off it looks like we've deleted the object.
But this is not what's occurred because we've got versioning enabled.
What's actually occurred is that it's added a new version of this object.
But instead of an actual new version of the object it's simply added a delete marker as that new version.
So if we toggle show versions back to on.
Now what we see are the previous versions of Winky.jpg.
So the original version at the bottom and the one that we replaced in the middle.
And then at the top we have this delete marker.
Now the delete marker is the thing which makes it look to be deleted in the console UI when we have show versions set to off.
So this is how S3 handles deletions when versioning is enabled.
If you're interacting with an object and if you delete that object it doesn't actually delete the object.
It simply adds a delete marker as the most recent version of that object.
Now if we just select that delete marker and then click on delete that has the effect of undeleting the object.
Now it's important to highlight that because we're dealing with object versions anything that we do is permanent.
If you're operating with an object and you have versioning enabled on a bucket.
If you overwrite it or delete it all it's going to do is either add a new version or add a delete marker.
When you're operating with versions everything is permanent.
So in this case we're going to be permanently deleting the delete marker.
So you need to confirm that by either typing or copying and pasting permanently delete into this box and click on delete objects.
What this is going to do is delete the delete marker.
So if we click on close now we're left with these two versions of Winky.jpg so we've deleted the delete marker.
If we toggle show versions to off we can see that we now have our object back in the bucket.
If we go back to static website hosting and refresh we can see though that it's still truffles.
So this is a mistake it's not actually Winky in this particular image.
So what we can do is go back to the S3 console.
We can enable show versions.
We know that the most recent version is actually truffles rather than Winky.
So what we can do is select this incorrect version so the most recent version and select delete.
Now again we're working with an object version so this is permanent.
You need to make sure that this is what you intend.
In our case it is.
So you need to either type or copy and paste permanently delete into the box and click on delete objects.
Now this is going to delete the most recent version of this object.
What happens when you do that is it makes the next most recent version of that object the current or latest version.
So now this is the original version of Winky.jpeg the one that we first uploaded to this bucket.
So this is now the only version of this object.
If we go back to the static website hosting tab and hit refresh this time it loads the correct version of this image.
So this is actually Winky my one-eyed cat.
So this is how you can interact with versioning in an S3 bucket.
Whenever it's enabled it means that whenever you upload an object to the same name instead of overwriting it simply creates a new version.
Whenever you delete an object it simply adds a delete marker.
When you're operating with objects it's always creating new versions or adding delete markers.
But when you're working with particular versions rather than objects any operations are permanent.
So you can actually delete specific versions of an object permanently and you can delete delete markers to undelete that object.
Now it's not possible to turn off versioning on a bucket.
Once it's enabled on that bucket you don't have the ability to disable it.
You only have the ability to suspend it.
Now when you suspend it it stops new versions being created but it does nothing about the existing versions.
The only way to remove the additional costs for a version enabled bucket is either to delete the bucket and then re-upload the objects to a new bucket or go through the existing bucket and then manually purge any specific versions of objects which aren't required.
So you need to be careful when you're enabling versioning on a bucket because it can cause additional costs.
If you have a bucket where you're uploading objects over and over again and specifically if they're large objects then if you have versioning enabled you can incur significantly higher costs than if you have a bucket which doesn't have versioning enabled.
So that's something that you need to keep in mind if you enable versioning you need to manage those versions of those objects inside the bucket.
With that being said though let's tidy up so let's go back to the main S3 console, select the bucket, click on empty, copy and paste or type permanently delete and click on empty.
When it's finished click on exit and with the bucket still selected click on delete.
Copy and paste or type the name of the bucket and confirm with delete bucket.
And once you've done that the account is back in the same state as it was at the start of this demo lesson.
Now at this point that's everything that I wanted you to do in this demo lesson.
You've gained some practical exposure with how to deal with object versions inside an S3 bucket.
At this point go ahead and complete this video and when you're ready I'll look forward to you joining me in the next lesson.
