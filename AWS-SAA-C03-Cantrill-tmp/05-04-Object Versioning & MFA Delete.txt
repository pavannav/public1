Welcome back, and in this lesson I'm going to cover Object Versioning and MFA Delete,
two essential features of S3.
These are two things I can almost guarantee will feature on the exam,
and almost every major project I've been involved in has needed solid knowledge of both.
So let's jump in and get started.
Object Versioning is something which is controlled at a bucket level.
It starts off in a disabled state.
You can optionally enable versioning on a disabled bucket,
but once enabled, you cannot disable it again.
Just to be super clear, you can never switch a bucket versioning back to disabled
once it's been enabled.
What you can do, though, is suspend it,
and if desired, a suspended bucket can be re-enabled.
It's really important for the exam to remember these state changes.
So make a point of noting them down, and when revising, try to repeat until it sticks.
So a bucket starts off as disabled, it can be re-enabled again,
an enabled bucket can be moved to suspended and then moved back to enabled,
but the important one is that an enabled bucket can never be switched back to disabled.
That is critical to understand for the exam.
I've seen many a trick question which will test your knowledge on that point.
Without versioning enabled on a bucket, each object is identified solely by the object key,
its name, which is unique inside the bucket.
If you modify an object, the original version of that object is replaced.
Versioning lets you store multiple versions of an object within a bucket.
Any operations which would modify an object generate a new version of that object
and leave the original one in place.
For example, let's say I have a bucket, and inside the bucket is a picture of one of my cats, Winky.
So the object is called Winky.jpg.
It's identified in the bucket by the key, essentially its name, and the key is unique.
If I modify the Winky.jpg object or delete it, those changes impact this object.
Now there's an attribute of an object which I haven't introduced yet, and that's the ID of the object.
When versioning on a bucket is disabled, the ID of the objects in that bucket are set to null.
That's what versioning being off on a bucket means. All of the objects have an ID of null.
Now if you upload or put a new object into a bucket with versioning enabled,
then S3 allocates an ID to that object, in this case, 111.111.
If any modifications are made to this object,
so let's say somebody accidentally overwrites the Winky.jpg object with a dog picture,
but still calls it Winky.jpg, S3 doesn't remove the original object.
It allocates a new ID to the newer version, and it retains the old version.
The newest version of any object in a version enabled bucket is known as the current version of that object.
So in this case, the object called Winky.jpg with an ID of 222.222,
which is actually a dog picture, that is the current version of this object.
Now if an object is accessed without explicitly indicating to S3 which version is required,
then it's always the current version which will be returned.
But you've always got the ability of requesting an object from S3
and providing the ID of a specific version to get that particular version back rather than the current version.
So versions can be individually accessed by specifying the ID,
and if you don't specify the ID, then it's assumed that you want to interact with the current version, the most recent version.
Now versioning also impacts deletions.
Let's say we've got these two different versions of Winky.jpg stored in a version enabled bucket.
If we indicate to S3 that we want to delete the object and we don't give any specific version ID,
then what S3 will do is to add a new special version of that object known as a delete marker.
Now the delete marker essentially is just a new version of that object,
so S3 doesn't actually delete anything, but the delete marker makes it look deleted.
In reality though, it's just hidden.
The delete marker is a special version of an object which hides all previous versions of that object.
But you can delete the delete marker, which essentially undeletes the object,
returning the current version to being active again,
and all the previous versions of the object still exist, accessible using their unique version ID.
Now even with versioning enabled, you can actually fully delete a version of an object,
and that actually really deletes it.
To do that, you just need to delete an object and specify the particular version ID that you want to remove.
And if you are deleting a particular version of an object,
and the version that you're deleting is the most recent version, so the current version,
then the next most recent version of that object then becomes the current version.
Now some really important points that you need to be aware about object versioning.
I've mentioned this at the start of the lesson, it cannot be switched off, it can only be suspended.
Now why that matters is that when versioning is enabled on a bucket,
all the versions of that object stay in that bucket,
and so you're consuming space for all of the different versions of an object.
If you have one single object that's 5 gig in size, and you have five versions of that object,
then that's 5 times 5 gig of space that you're consuming for that one single object and its multiple versions.
And logically, you'll build for all of those versions of all of those objects inside an S3 bucket.
And the only way that you can zero those costs out is to delete the bucket,
and then re-upload all those objects to a bucket without versioning enabled.
That's why it's important that you can't disable versioning.
You can only suspend it, and when you suspend it, it doesn't actually remove any of those old versions.
So you still build for them.
Now there's one other relevant feature of S3 which does make it to the exam all of the time,
and that's known as MFA delete.
Now MFA delete is something that's enabled within the versioning configuration on a bucket.
And when you enable MFA delete, it means that MFA is required to change bucket versioning states.
So if you move from enabled to suspended or vice versa, you need this MFA to be able to do that.
And also, MFA is required to delete any versions of an object.
So to fully delete any versions, you need this MFA token.
Now the way that this works is that when you're performing API calls
in order to change a bucket's versioning state or delete a particular version of an object,
you need to provide the serial number of your MFA token as well as the code that it generates.
You concatenate both of those together, and you pass that along with any API calls
to interact, i.e. delete versions or change the versioning state of a bucket.
Okay, so that's all of the theory for object versioning inside S3.
But at this point, that's everything I wanted to cover in this lesson, so go ahead and complete the video.
And when you're ready, I'll look forward to you joining me in the next.
