Welcome back and welcome to this demo of the functionality provided by IAM groups.
What we're going to do in this demo is use the same
architecture that we had in the IAM users demo, so the Sally user
and those two S3 buckets, but we're going to migrate the permissions that the Sally
user has from the user
to a group that Sally is a member of. Before we get started just make sure
that you are logged in
as the IAM admin user of the general AWS account
and as always you'll need to have the Northern Virginia
region selected. Now attached to this video
is a demo files link that will download all of the files you're going to use
throughout the demo.
So to save some time go ahead and click on that link and just start that file
downloading.
Once it's finished go ahead and extract it and it will create a folder
which contains all of the files you'll need
as you move through the demo. Now you should have deleted
all of the infrastructure that you used in the previous demo lesson
so at this point we need to go ahead and recreate it.
Now to do that attached to this lesson is a one-click deployment link
so go ahead and click that link. Everything is pre-populated
so you need to make sure that you put in a suitable password which doesn't
breach any password policy on your account.
So I've included a suitable default which includes some substitution
so that should be okay for all common password policies.
So just go ahead scroll down to the bottom, click on the capabilities checkbox
and then create stack. That'll take a few moments to create
so I'm going to pause the video and resume it once that stack
create has completed. Okay so that's created now
so click on services and open the S3 console
in a new tab, this can be a normal tab. Go to the cat pics bucket
click upload, add file, locate the demo files folder that you downloaded and
extracted earlier
inside that folder should be a folder called cat pics
go in there and then select Merlin.jpg
click on open and upload. Wait for that to finish
once it's finished back to the console go to animal pics
upload again, add files, this time
inside the animal pics folder upload thor.jpg again
and click upload. Once that's done
go back to cloud formation, click on resources
click on the sally user, inside the sally user
click on add permissions, attach policies directly
select the allow all S3 except cats
click on next and add permissions
so that brings us to the point of where we were
in the IAM users demo lesson, so that's the infrastructure
set back up in exactly the same way as we left
the IAM users demo. So now we can click on dashboard
you'll need to copy the IAM signing users link for the general account
so copy that into your clipboard and again you're going to need
ideally a separate browser, a fully separate browser
or you can potentially use a private browsing tab
in your current browser but it is just easier to understand
probably for you at this point in your learning
if you have a separate browser window. I'm going to use
an isolated tab because it's easier for me to show you
and you'll need to paste in this IAM URL because now we're going to sign into this
account
using the sally user. So go back to cloud formation
click on outputs and you'll just need the sally username
so copy that into your clipboard, go back to this separate browser window
and paste that in, then back to cloud formation
go to the parameters tab and get the password for the sally user
and then enter the password that you chose for sally
when you created the stack. Then move across to the S3 console and just verify
that the sally user has access to both
of these buckets. The easiest way of doing that is to just
open both of these animal pictures so we'll start with Thor
Thor's a big doggo so it might take some time for him to load in, there we go he's loaded in
and the cat pics bucket and we get access denied because remember
sally doesn't have access to the cat pics bucket, that's
as intended. So now we'll go back to our
other browser window, the one where we logged into the general account as the
IAM admin user and this is where we're going to make the modifications to the
permissions, we're going to change the permissions
over to using a group rather than directly on the sally user
so click on the resources tab first and select sally
to move across to the sally user. Now note how sally currently has this manage
policy
directly attached to her user, so step one
is we're going to remove that, so remove this managed policy from sally
so detach that. That now means that sally has no permissions
on S3 and if we go back to the separate browser window
that we've got sally logged into and then hit refresh
see she doesn't have any permissions now on S3
so now back to the other browser, back to the one where we logged in as
and then we'll click user groups and then we're going to create
a developers group, so click on create new group and call it developers
so that's the group name, then down at the bottom here
this is where we can attach a managed policy to this group
so we're going to attach the same managed policy
that sally had previously directly on her user
so allow all S3 except cats
so type allow into the filter box and press enter
and then check the box to select this managed policy
we could also directly at this stage
add users to this group but we're not going to do that we're going to do that as
a separate process
so click on create group, so that's the developers
group created, so notice how there's not that many steps to create a group
simply because it doesn't offer that much in the way of functionality
so open up the group, the only options that you see here
are user membership and any attached permissions
now as with a user you can attach inline policies
or attach managed policies and we've got the managed policy
but what we're going to do next is click on users and then
add users to group and we're going to select
the sally IAM user and click on add user
so now our IAM user sally
is a member of the developers group and the developers group has this attached
managed policy that allows them to access everything on S3
except the cat pics bucket so now if I move back to my
other browser window where I've got the sally user logged into
and then refresh now that the sally user has been
added to that group we've got permissions again
over S3, if I try to access the cat pics bucket
I won't be able to because that managed policy that the development team have
doesn't include access for this but if I open the
animal pics bucket and open Thor again, he's a big doggo so it will take a couple of seconds
but it will load in that picture absolutely fine so there we go
there's Thor and that's pretty much everything I wanted to demonstrate
in this lesson it's been a nice quick demo lesson
all we've done is create a new group called developers
we've added sally to this developers group
and we've removed the managed policy giving access to S3
from sally directly and added it to the developers group
that she's now a member of and you'll note that no matter whether the policy is
attached to sally directly
or attached to a group that sally is a member of
she still gets those permissions and that's everything that I wanted to cover
in this demo lesson
so before we finish up let's just tidy our account up
so what we need to do is go to developers and then detach this managed policy from
the developers group
so detach it then go to groups and just delete that developers group
because it wasn't created as part of the cloud formation template
and then as the IAM admin
user open up the S3 console
and we need to empty both of these buckets so select cat pics
click on empty you'll need to type or copy and paste
permanently delete into that box and confirm the deletion
then click exit then select the animal pics bucket and do the same process
copy and paste permanently delete and then confirm by clicking on empty
and then exit now we've done that we should have no problems
by opening up cloud formation and selecting the IAM stack
and then hitting delete and again note if you do have any
errors deleting this stack then just go
into the stack select events and see
what the status reason is for any of those deletion problems
and it should be fairly obvious if it can't delete the stack because it can't
delete
one or more resources and it will give you the reason why that being said
at this point assume the stack deletions worked successfully
we've cleaned up our account so that's everything I wanted to cover in this demo
lesson
go ahead complete this video and when you're ready
I'll see you in the next lesson
