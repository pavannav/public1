Welcome back. In this lesson, I want to continue immediately from the last one
by discussing when and where you might use IAM roles.
By talking through some good scenarios for using roles, I want to make sure that you're comfortable
with selecting these types of situations where you would choose to use an IAM role and where you wouldn't,
because that's essential for real-world AWS usage and for answering exam questions correctly.
So let's get started.
Now one of the most common uses of roles within the same AWS account are for AWS services themselves.
AWS services operate on your behalf and they need access rights to perform certain actions.
An example of this is AWS Lambda.
Now I know I haven't covered Lambda yet, but it's a function as a service product.
What this means is that you give Lambda some code and create a Lambda function.
This function, when it runs, might do things like start and stop EC2 instances,
or it might perform backups, or it might be running real-time data processing.
What it does exactly isn't all that relevant for this lesson.
The key thing though is a Lambda function, as with most AWS things, has no permissions by default.
A Lambda function is not an AWS identity, it's a component of a service,
and so it needs some way of getting permissions to do things when it runs.
And running a Lambda function is known as a function invocation or a function execution using Lambda terminology.
So anything that's not an AWS identity, this might be an application or a script running on a piece of computer hardware somewhere,
you know now that you need to give the application or that script permissions on AWS using access keys.
Rather than hard-coding some access keys into your Lambda function, there's actually a better way.
To provide these permissions, we can create an IAM role, known as a Lambda execution role.
Now this execution role has a trust policy which trusts the Lambda service,
and this means that Lambda is allowed to assume that role whenever a function is executed.
This role has a permissions policy which grants access to AWS products and services.
Now when the function runs, it uses the STS assume role operation,
and then the secure token service generates temporary security credentials,
and then the runtime environment that the Lambda function runs in can use these temporary credentials
to access AWS resources based on whatever permissions the role's permissions policy has.
So the code is running in a runtime environment, and it's the runtime environment that assumes the role.
The runtime environment gets these temporary security credentials,
and then the whole environment which the code is running inside can use these credentials to access AWS resources.
So why would you use a role for this? What makes this scenario perfect for using a role?
Well if we didn't use a role, you would need to hard-code permissions into the Lambda function
by explicitly providing access keys for that function to use.
And where possible, you should avoid doing that, because A, it's a security risk,
and B, it causes problems if you ever need to change or rotate those access keys.
It's always better for AWS products and services where possible to use a role,
because when a role is assumed, it provides a temporary set of credentials with enough time to complete a task,
and then these are discarded.
Now also, for a given Lambda function, you might have one copy running at once,
zero copies, fifty copies, a hundred copies or even more.
Because you can't determine this number because it's unknown,
if you remember my rule that I talked about in the previous lesson,
if you don't know the number of principles, if it's multiple or if it's an uncertain number,
then it suggests a role might be the most ideal identity to use.
In this case, it is the ideal way of providing Lambda with these credentials is to use a role
and allow it to get these temporary credentials.
It's always the preferred option when using AWS services to do something on your behalf,
use a role because you don't need to provide any static credentials.
OK, so let's move on to the next scenario.
Another situation where roles are useful are emergency or out-of-the-usual situations.
And here's a pretty familiar situation that you might find in a workplace.
So this is Wayne, and Wayne works in a Businesses Service Desk team.
This team is given read-only access to a customer's AWS account so that they can keep an eye on performance.
The idea is that anything more risky than this read-only level of access is handled by a more senior technical team.
We don't want to give Wayne's team long-term permissions to do anything more destructive than this read-only access,
but there are always going to be situations which occur when we least want them,
normally 3am on a Sunday morning, when a customer might call with an urgent issue where they need Wayne's help
to maybe stop or start an instance or maybe even terminate an EC2 instance and recreate it.
So 99% of the time, Wayne and his team are happy with this read-only access,
but there are situations when he needs more.
And this is a break glass style situation, which is named after this.
The idea of break glass in the physical world is that there is a key for something behind glass.
It might be a key for a room that a certain team don't normally have access to.
Maybe it's a safe or a filing cabinet.
Whatever it is, the glass provides a barrier, meaning that when people break it, they really mean to break it.
It's a confirmation step.
So if you break a piece of glass to get a key to do something, there needs to be an intention behind it.
Anyone can break the glass and retrieve the key,
but having the glass results in the action only happening when it's really needed.
At other times, whatever the key is for remains locked, and you can also tell when it's being used and when it hasn't.
A role can perform the same thing inside an AWS account.
Wayne can assume an emergency role when absolutely required.
When he does, he'll gain additional permissions based on the role's permission policy.
For a short time, Wayne will, in effect, become the role.
Now this access will be logged, and Wayne will know to only use the role under exceptional circumstances.
Wayne's normal permissions can remain at read-only, which protects him and the customer,
but he can obtain more if required when it's really needed.
So that's another situation where a role might be a great solution.
Another scenario when roles come in handy is when you're adding AWS into an existing corporate environment.
You might have an existing physical network and an existing provider of identities,
known as an identity provider, that your staff use to log into various systems.
And for the sake of this example, let's just say that it's Microsoft Active Directory.
In this scenario, you might want to offer your staff single sign-on, known as SSO,
allowing them to use their existing logins to access AWS.
Or you might have upwards of 5,000 accounts.
Remember, there's the 5,000 IAM user limit.
So for a corporate with more than 5,000 staff, you can't offer each of them an IAM user.
That is beyond the capabilities of IAM.
Roles are often used when you want to reuse your existing identities for use within AWS.
Why? Because external accounts can't be used directly.
You can't access an S3 bucket directly using an Active Directory account.
Remember this fact. External accounts or external identities cannot be used directly to access AWS resources.
You can't directly use Facebook, Twitter or Google identities to interact with AWS.
There is a separate process which allows you to use these external identities,
which I'll be talking about later in the course.
Now, architecturally, how this works is you allow an IAM role inside your AWS account
to be assumed by one of the external identities, which is in Active Directory in this case.
When the role is assumed, temporary credentials are generated and these are used to access the resources.
Now, there are ways that this is hidden behind the console UI so that it appears seamless,
but that's what happens behind the scenes.
I'll be covering this in much more detail later in the course when I talk about identity federation,
but I wanted to introduce it here because it is one of the major use cases for IAM roles.
Now, why roles are so important when an existing ID provider such as Active Directory is involved
is that, remember, there is this 5,000 IAM user limit in an account.
So if your business has more than 5,000 accounts, then you can't simply create an IAM user for each of those accounts,
even if you wanted to. 5,000 is a hard limit. It can't be changed.
Even if you could create more than 5,000 IAM users, would you actually want to manage 5,000 extra accounts?
Using a role in this way, so giving permissions to an external identity provider
and allowing external identities to assume this role, is called ID federation.
It means you have a small number of roles to manage and external identities can use these roles to access your AWS resources.
Another common situation where you might use roles is if you're designing the architecture for a popular mobile application.
Maybe it's a ride sharing application which has millions of users.
The application needs to store and retrieve data from a database product in AWS such as DynamoDB.
Now, I've already explained two very important but related concepts on the previous screen.
Firstly, that when you interact with AWS resources, you need to use an AWS identity.
And then secondly, that there's this 5,000 IAM user limit per account.
So designing an application with this many users which needs access to AWS resources,
if you could only use IAM users or identities in AWS, it would be a problem because of this 5,000 user limit.
It's a hard limit and it can't be raised.
Now, this is a problem which can be fixed with a process called Web Identity Federation which uses IAM roles.
Most mobile applications that you've used, you might have noticed they allow you to sign in using a web identity.
This might be Twitter, Facebook, Google and potentially many others.
Now, if we utilize this architecture for our web application,
we can trust these identities and we can allow these identities to assume an IAM role.
And this is based on that role's trust policy.
So they can assume that role, gain access to temporary security credentials
and use those credentials to access AWS resources such as DynamoDB.
This is a form of Web Identity Federation and I'll be covering it in much more detail later in the course.
The use of roles in this situation has many advantages.
First, there are no AWS credentials stored in the application
which makes it a much more preferred option from a security point of view.
If an application is exploited for whatever reason, there's no chance of credentials being leaked
and it uses an IAM role which you can directly control from your AWS account.
Secondly, it makes use of existing accounts that your customers probably already have
so they don't need yet another account to access your service.
And lastly, it can scale to hundreds of millions of users and beyond
and it means you don't need to worry about the 5,000 user IAM limit.
This is really important for the exam.
There are very often questions on how you can architect solutions which will work for mobile applications.
Using ID Federation, so using IAM roles, is how you can accomplish that.
And again, I'll be providing much more information on ID Federation later in the course.
Now one scenario I want to cover before we finish up this lesson and that is cross account access.
In an upcoming lesson, I'll be introducing AWS organizations
and you will get to see this type of usage in practice.
It's actually how we work in a multi-account environment.
Picture the scenario that's on screen now, two AWS accounts, yours and a partner account.
Now let's say your partner organization offers an application which processes scientific data
and they want you to store any data inside an S3 bucket that's in their account.
Your account has thousands of identities and the partner IT team don't want to create IAM users
in their account for all of your staff.
In this situation, the best approach is to use a role in the partner account.
Your users can assume that role, get temporary security credentials and use those to upload objects.
Because the IAM role in the partner account is an identity in that account,
then using that role means that any objects that you upload to that bucket are owned by the partner account.
So it's a very simple way of handling permissions when operating between accounts.
Now roles can be used cross account to give access to individual resources like S3 in the on screen example
or you can use roles to give access to a whole account
and you'll see this in the upcoming AWS organization demo lesson.
In that lesson we're going to configure it so a role in all of the different AWS accounts
that we'll be using for this course can be assumed from the general account
and it means you won't need to log in to all of these different AWS accounts.
It makes multi account management really simple.
Now I hope by this point you start to get a feel for when roles are used.
Even if you're a little vague, you will learn more as you go through the course.
For now, just a basic understanding is enough.
Roles are difficult to understand at first, so you're doing well if you're anything but confused at this point.
I promise you as we go through the course and you get more experience, it will become second nature.
So at this point that's everything I wanted to cover.
Thanks for watching, go ahead and complete this video and when you're ready, join me in the next lesson.
