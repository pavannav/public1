Welcome back. This lesson will be a pretty brief one. We're going to be covering
instance status checks and EC2 auto recovery.
They're both pretty simple features but let's quickly step through
exactly what both of them do and what capabilities they offer because they're
great things to understand.
Every instance within EC2 has two
high level per instance status checks.
When you initially launch an instance you might see these listed
as initializing and then you might see only one of two passing but eventually
all instances should move into the two out of two
passed checks which indicate that all is well within the instance.
If not, you have a problem. Each of the two checks represents
a separate set of tests and so a failure of
either of them suggests a different set of underlying problems.
The first status check is the system status, the second
is the instant status. A failure of the system status check
could indicate one of a few major problems
things like the loss of system power, loss of network connectivity
or software or hardware issues with the EC2 host.
So this check is focused on issues impacting the EC2 service
or the EC2 host. The second check
focuses on instances so a failure of this one could indicate things like a
corrupt file system,
incorrect networking on the instance itself,
so maybe you statically set a public IP version 4 address
on the internal interface of the operating system which you now know
won't work, ever, or maybe the instance
is having operating system kernel issues preventing it
from correctly starting up. Assuming that you haven't
just launched an instance, anything but two out of two checks
represents an issue which needs to be resolved.
One way to handle it is manually, so you could manually stop and start an
instance or restart an instance or terminate
and recreate an instance, they're all manual activities that you could perform
but EC2 comes with a feature allowing you to recover
automatically to any system check issues.
You can ask the EC2 to stop a failed instance,
reboot it, terminate it, or you can ask EC2 to perform
auto recovery. Auto recovery moves the instance to a new host
starts it up with exactly the same configuration as before so
all IP addressing is maintained and if software on the instance is set to
auto start, this process could mean that the instance
as the name suggests automatically recovers
fully from any failed status check issues.
Now it's far easier to show you exactly how this works
so let me quickly switch over to my console. Now I'm currently logged in
to the general AWS account, so the management account of the organization
I'm using the IAM admin user and I've currently got the Northern
Virginia region selected. Now the demo part of this lesson is going to be
really brief
and so it's probably not worth you following along in your own environment.
If you do want to though, there is a one-click deployment
that's attached to this lesson, so if you're following along click that link,
scroll to the bottom, check the acknowledgement box
and click create stack. It'll need to be in a create complete state before you
continue so if you are following along, pause the video,
wait for your stack to move into create complete and then you're good
to continue. So now we're in a create complete state, let's go ahead
and move to the EC2 console. This one-click deployment link has created
a single instance so that should already be in place
so go ahead and select it and then click on the status checks tab.
So if we select the status checks tab for this particular instance
you'll see the system status checks and the instant status checks
and for both of these my EC2 instance has passed, so system reliability check has
passed
and instance reachability check has passed, so that's good.
Now if you wanted to create a process which will be capable of
auto recovery on this instance, to do that we'd click on the actions drop down
and then create status check alarm, so go ahead and do that
and that will open this dialog. So this is an alarm
inside CloudWatch which will alarm if this
instance fails any of these status checks.
What we can do as a default is to have it send a notification
to an SNS topic and the conditions mean this notification will be sent
whenever any status checks fail, so either of the two,
for at least one consecutive period of five minutes.
So it will need to fail either of these status checks
for one period in five minutes and then this alarm
will be triggered. Now we can also select this box
which means that action will be taken in addition to notification being sent
and we can have it reboot the instance, so just the equivalent of an
operating system reboot, we can have it stop the instance which is useful
if we want to perform any diagnostics, we can have it terminate the instance. Now
this is useful if you have any sort of high availability configured
which I'll be demonstrating later in the course because what this means
is if you terminate an instance you can configure EC2 to
automatically re-provision a brand new instance
in its place. If we do this in isolation on a single instance
it will simply terminate the instance and it won't be replaced.
But what I want to focus on is this option which is
recover this instance. This uses the auto
recovery feature of EC2. This feature will attempt to recover this instance, it will
take a set of actions. It could be a simple restart or it could be to migrate
the instance to a whole new EC2 host
but importantly it would need to be in the same availability zone, remember EC2
is an AZ based service and so logically this won't protect you
against an entire AZ failure. It will only take action
for an isolated failure, either the host or the instance.
Now this feature does rely on having spare EC2 host capacity so in the case
of major failure
in multiple availability zones in a region there is a potential that this
won't work
if there is not spare capacity. You also need to be using
modern types of instances so things like A1
C4, C5, M4, M5
R3, R4, R5. I'll make sure I include a link in the lesson text which gives a full
overview of all of the supported types
and also this feature won't work if you're using
instance store volume so it will only work on
instances which solely have EBS volumes
attached. It's a simple way that EC2 adds some
automation which can attempt to recover an instance
and avoid waking up a sysadmin. It's not designed
to automatically recover against large-scale
or complex system issues. So do keep that in mind it's a very
simple feature which answers a very narrow set
of error based scenarios. It's not something that's going to fix
every problem in EC2. There are other ways of doing that which we'll talk about
later in the course. Now we are at the end of everything that I wanted to cover
in this demo lesson but we're not going to clear up
the infrastructure that we used because I'll be using it in the following demo
lesson to demonstrate
EC2 termination protection. So if you are following along with these in your
own environment then don't delete the one-click deployment
that you used at the start of this lesson because we'll be using it
in the following demo lesson. So that's it though, that's everything that I wanted to
cover in this lesson. I did promise
it would be brief. Go ahead and complete the video and when you're ready
I'll see you in the next.
