Welcome back, and in this lesson I want to talk about AWS CloudFormation.
I'm going to be brief because learning CloudFormation is something which will happen throughout the course
because we'll be using it to automate certain things.
Before we do that though, I want to introduce the concepts that you'll need throughout the course
and give you a chance to experience a simple, practical example.
CloudFormation is a tool which lets you create, update and delete infrastructure in AWS
in a consistent and repeatable way using templates.
So rather than creating and updating resources manually, you create a template
and CloudFormation will do the rest on your behalf.
So let's jump in and explore this.
At its base, CloudFormation uses templates.
You can use a template to create AWS infrastructure using CloudFormation.
You can also update a template and reapply it, which causes CloudFormation to update infrastructure.
And eventually, you can use CloudFormation to delete that very same infrastructure.
A CloudFormation template is written either in YAML or JSON.
And depending on your experience, you might be familiar with one of these or both.
But if you haven't touched YAML or JSON before, don't worry, it's fine.
The key takeaway right now is that they achieve the same thing and it's easy to convert between them.
Now you might get to pick which one of these to use when writing templates
or your business might inflict this on you.
But in summary, it's a preference thing.
Most people who work in the AWS space like one and hate the other.
Very few people in my experience like both.
Now I am one of those people. I do like both.
I started my AWS career using JSON, but I've come to appreciate the extra functionality that YAML offers.
But to counter that, YAML is easier to make mistakes with
because it uses white spaces to indicate which bits belong to which other bits.
Since you can't see spaces easily, it can be a problem for less experienced engineers or architects.
If I have to pick one though, I'll use YAML.
So for the rest of this lesson at least, that's what I'll focus on.
I want to really quickly step through what makes a template.
So what components there are of a template.
And then I'll talk about the architecture of CloudFormation and then we'll move on to a demo.
All templates have a list of resources, at least one.
It's the resources section of a CloudFormation template that tells CloudFormation what to do.
If resources are added to it, then CloudFormation creates resources.
If resources are updated, then it updates those resources.
If resources are removed from a template and that template is reapplied, then physical resources are removed.
The resources section of a template is the only mandatory part of a CloudFormation template,
which makes sense. Without resources, the template wouldn't actually do anything.
The simple template that we'll use in the demo lesson that immediately follows this one has resources defined in it
and we'll step through those and evaluate exactly what they do.
Next is Description.
And this is a free text field which lets the author of the template add, as the name suggests, a description.
And generally you would use this to give some details about what the template does, what resources get changed,
the costs of a template, anything that you want the users of a template to know, you can put in the description.
Now the only restriction which you need to be aware of is if you have both a description and an AWS template format version,
then the description needs to immediately follow the template format version.
The template format version isn't itself mandatory, but if you use them both, then description needs to directly follow the template format version.
I've seen this used almost as a trick question in many AWS exams, so it really does pay to be aware of this particular restriction.
Now the template format version is the way that AWS allow for extending the standards over time.
If it's omitted, this value is assumed.
Now the metadata in the template is the next part that I want to talk about.
It's got many functions, including some pretty advanced ones.
But one of the things that it does is it can control how the different things in the CloudFormation template are presented through the console UI,
so through the AWS console if you're applying it.
So you can specify groupings, you can control the order, you can add descriptions and labels.
It's a way that you can force how the UI presents the template.
Generally, the bigger your template, the wider the audience, the more likely it's going to have a metadata section.
But metadata is used for other things, but I'll discuss those later in the course.
Now the parameters section of a template is where you can add fields, which prompt the user for more information.
So if you apply the template from the console UI, you will see boxes that you need to type in or select from dropdowns.
Now things that you might use this for, which size of instance to create, the name of something, the number of availability zones to use.
Parameters can even have settings for which are valid entries.
So you can apply criteria for values that can be added as parameters, and you can also apply default values.
Again, you're going to get lots of exposure to this as we go through the course and use CloudFormation templates.
The next section is mappings, and this is another optional section of the CloudFormation template.
And something that we won't use as much, especially when you just get started with CloudFormation, it allows you to create lookup tables.
And this is the example that's shown on the right. So we create a mappings table, region and instance type to AMI,
and then based on the region that it's in and then the environment type, so test or prod, it selects a specific Amazon machine image to use.
So again, this is something that you will get experience with as you go through the course.
I just wanted to introduce it at this point.
The next thing about templates that I want to talk about are conditions, and these allow decision making in the template.
So you can set certain things in a template that will only occur if a condition is met.
Now using conditions is a two-step process. Step one is to create the condition.
In this case, if a parameter is equal to prod, i.e. if the template is being used to create prod resources,
then we'll create a condition called create prod resources.
So if I set the parameter of prod under the environment type parameter, then the condition of create prod resources will be set to true.
And then step two is that that condition is used within resources in the CloudFormation template.
So in this case, the resource of prod cat gif server will only be created if the condition create prod resources is true.
And that will only be true if the parameter of environment type is set to prod rather than test.
If it's set to test, that resource won't be created.
Next, we've got outputs, and outputs are a way that once the template is finished,
it can present outputs based on what's being created, updated, or deleted.
Now an example might be to return the instance ID of an EC2 instance that's been created.
Or if the template creates a WordPress blog, it could return the admin or setup address for that WordPress blog.
Now they're the main parts of a template, but how exactly does CloudFormation use templates?
Let's have a look at that next.
CloudFormation starts with a template.
And put simply, a template contains resources and all of that other stuff which you'll get used to as we use CloudFormation more.
Let's take a simple example, a template which creates an EC2 instance.
I mentioned earlier that the resources section is a list of resources.
Now resources inside a CloudFormation template are called logical resources.
The logical resource in this case is called instance.
A logical resource has a type, and this one is AWS double colon EC2 double colon instance.
And it's the type that CloudFormation uses to know exactly what to create.
Logical resources generally also have properties which CloudFormation uses to configure the resources in a certain way.
Now when you take a template and initially give it to CloudFormation, then CloudFormation creates what's known as a stack.
And a stack contains all of the logical resources that the template tells it to contain.
So a stack is a living and active representation of a template.
One template could create one stack, or ten stacks, or even more, or anywhere in between.
But a stack is basically created when you take a template and tell CloudFormation to do something with that template.
Now this next part is important because it's the whole point of CloudFormation.
For any logical resources in the stack, CloudFormation makes a corresponding physical resource in your AWS account.
So where in this example the stack contained a logical resource called instance, which is a definition for an EC2 instance,
the physical resource is the actual EC2 instance which CloudFormation creates.
It's CloudFormation's job to keep the logical and physical resources in sync.
So when you use a template to create a stack, CloudFormation will scan the template, create a stack with logical resources inside,
and then create physical resources which match.
You can also take a template, update it, and then use it to update that same stack.
And when you do that, the stack's logical resources will change.
Either new logical resources are added or existing ones are updated or deleted.
And CloudFormation will perform the same actions on the physical resources.
So it will add new ones, update existing ones, or remove physical resources entirely if the logical resources have been removed from the template
and then the template used to update the stack.
If you delete a stack, its logical resources are deleted, which causes CloudFormation to delete the matching physical resources.
So CloudFormation is a really powerful tool which I'll talk about much more as the course continues.
It lets you automate infrastructure.
Imagine you host WordPress blogs.
You can use one template to create one, ten, a hundred, or more deployments rather than having to create a hundred individual sites.
CloudFormation can also be used as part of change management.
You can store templates in source code repositories, add changes, get approval, and do all of this before applying them.
Or they can be used to just quickly spin up one-off deployments.
I'll be using CloudFormation throughout this course so you can easily implement certain things in demo lessons.
If I'm talking about a certain product in a demo lesson, but it needs other products to function,
then I might give you a CloudFormation template to create that base infrastructure.
Alternatively, you can just use a CloudFormation template to implement the entire demo end-to-end.
CloudFormation is super powerful and throughout this course you're going to get lots of exposure to it.
Now that's all of the theory that I wanted to cover.
The next lesson is going to be a demo where you'll use CloudFormation to create an EC2 instance.
So remember in the EC2 demo lesson where you created an EC2 instance,
well in the next demo lesson you're going to create a similar EC2 instance, only you're going to use CloudFormation.
And that will just illustrate how much quicker and easier it is to use CloudFormation to automate infrastructure tasks.
So go ahead, complete this video and when you're ready, join me in the next lesson where we'll demo CloudFormation.
