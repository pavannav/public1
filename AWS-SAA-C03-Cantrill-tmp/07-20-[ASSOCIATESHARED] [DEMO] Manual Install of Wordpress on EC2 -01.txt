Welcome back, this is part two of this lesson. We're going to continue immediately from the end of part one, so let's get started.
So this is the folder containing the WordPress installation files.
Now there's one particular file that's really important and that's the configuration file.
So there's a file called wp-config-sample and this is actually the file that contains a template of the configuration items for WordPress.
So what we need to do is to take this template and change the file name to be the proper file name.
So wp-config.php. So we're going to create a copy of this file with the correct name.
And to do that we run this command. So we're copying the template or the sample file to its real file name.
So wp-config.php. And this is the name that WordPress expects when it initially loads its configuration information.
So run that command and that now means that we have a live config file.
Now this command isn't in the instructions, but if I just take a moment to open up this file, you don't need to do this.
I'm just demonstrating what's in this file for your benefit.
But if I run a sudo nano and then wp and then hyphen config and then php, this is how the file looks.
So this has got all of the configuration information in.
So it stores the database name, the database user, the database host and lots of other information.
Now notice how it has some placeholders.
So this is where we would need to replace the placeholders with the actual configuration information.
So the database name itself, the host name, the database username, the database password, all that information would need to be replaced.
Now we're not going to type this in manually, so I'm going to control X to exit out of this and then clear the screen again to make it easy to see.
We're going to use the Linux utility sed, or S-E-D.
And this is a utility which can perform a search and replace within a text file.
It's actually much more complex and capable than that.
It can perform many different manipulation operations.
But for this demonstration, we're going to use it as a simple search and replace.
Now we're going to do this a number of times.
First we're going to run this command, which is going to replace this placeholder.
Remember this is one of the placeholders inside the configuration file that I've just demonstrated, WP-config.
We're going to replace the placeholder here with the contents of the variable name dbname that we set at the start of this demo.
So this is going to replace the placeholder with our actual database name.
So I'm going to enter that so you can do the same.
We're going to run the sed command again, but this time it's going to replace the username placeholder with the dbuser variable that we set at the start of this demo.
So use that command as well.
And then lastly we'll do the same for the database password.
So type or copy and paste this command and press enter.
And that now means that this WP-config has the actual configuration information inside.
And just to demonstrate that, you don't need to do this part, I'll just do it to demonstrate.
If I edit this file again, you'll see that all of these placeholders have actually been replaced with actual values.
So I'm going to control X out of that and then clear the screen.
And that concludes the configuration for the WordPress application.
So now it's ready, now it knows how to communicate with the database.
What we need to do to finish off the configuration though is just to make sure that the web server has access to all of the files within this folder.
And to do that we use this command.
So we're making sure that we use the shown command or chown and set the ownership of all of the files in this folder and any subfolders to be the Apache user and the Apache group.
And the Apache user and Apache group belong to the web server.
So this just makes sure that the web server is able to access and control all of the files in the web root folder.
So run that command and press enter and that concludes the installation part of the WordPress application.
There's one final thing that we need to do and that's to create the database that WordPress will use.
So I'm going to clear the screen to make it easy to see.
Now what we're going to do in order to configure the database is we're going to make a database setup script.
We're going to put this script inside the forward slash tmp folder and we're going to call it db.setup.
So what we need to do is enter the commands into this file that will create the database.
After the database is created it needs to create a database user and then it needs to grant that user permissions on that database.
Now again instead of manually entering this we're going to use those variable names that we created at the start of the demo.
So we're going to run a number of commands. These are all in the lessons commands document.
The first one is this.
So this echoes this text and because it has a variable name in this variable name will be replaced by the actual contents of the variable.
Then it's going to take this text with the replacement of the contents of this variable and it's going to enter that into this file.
So forward slash tmp forward slash db setup.
So run that and that command is going to create the WordPress database.
Then we're going to use this command and this is the same so it echoes this text but it replaces these variable names with the contents of the variables.
This is going to create our WordPress database user.
It's going to set its password and then it's going to append this text to the db setup file that we're creating.
Now all of these are actually database commands that we're going to execute within the MariaDB database.
So enter that to add that line to db.setup.
Then we have another line which uses the same architecture as the ones above it.
It echoes the text, it replaces these variable names with the contents and then outputs that to this db.setup file.
And this command grants our database user permissions to our WordPress database.
And then the last command is this one which just flushes the privileges and again we're going to add this to our db.setup script.
So now I'm just going to cat the contents of this file so you can just see exactly what it looks like.
So cat and then space forward slash tmp forward slash db.setup.
So as you'll see it's replaced all of these variable names with the actual contents.
So this is what the contents of this script actually looks like.
So these are commands which will be run by the MariaDB database platform.
To run those commands we use this.
So this is the MySQL command line interface.
So we're using MySQL to connect to the MariaDB database server.
We're using the username of root.
We're passing in the password and then using the contents of the db root password variable.
And then once we authenticate to the database we're passing in the contents of our db.setup script.
And so this means that all of the lines of our db.setup script will be run by the MariaDB database.
And this will create the WordPress database, the WordPress user and configure all of the required permissions.
So go ahead and press enter.
That command is run by the MariaDB platform and that means that our WordPress database has been successfully configured.
And then lastly just to keep things secure because we don't want to leave files laying around on the file system
with authentication information inside we're just going to run this command to delete this db.setup file.
Okay so that concludes the setup process for WordPress.
It's been a fairly long intensive process but that now means that we have an installation of WordPress on this EC2 instance,
a database which has been installed and configured.
So now what we can do is to go back to the AWS console, click on instances.
We need to select the A4L-Public EC2 and then we need to locate its IP address.
Now make sure that you don't use this open address link because this will attempt to open the IP address using HTTPS
and we don't have that configured on this WordPress instance.
Instead just copy the IP address into your clipboard and then open that in a new tab.
If everything's successful you should see the WordPress installation dialog
and just to verify this is working successfully let's follow this process through.
So pick English, United States for the language.
For the blog title just put all the cats and then admin as the username.
You can accept the default strong password.
Just copy that into your clipboard so we can use it to log in in a second
and then just go ahead and enter your email, it doesn't have to be a correct one so I normally use test at test.com
and then go ahead and click on install WordPress.
You should see a success dialog, go ahead and click on login.
Username will be admin, the password that you just copied into your clipboard and then click on login.
And there you go, we've got a working WordPress installation.
We're not going to configure it in any detail but if you want to just check out that it works properly
go ahead and click on this all the cats at the top and then visit site
and you'll be able to see a generic WordPress blog.
And that means you've completed the installation of the WordPress application
and the database using a monolithic architecture on a single EC2 instance.
So this has been a slow process, it's been manual and it's a process which is wide open
for mistakes to be made at every point throughout that process.
Can you imagine doing this twice? What about 10 times? What about 100 times?
It gets pretty annoying pretty quickly.
In reality this is never done manually.
We use automation or infrastructure as code systems such as cloud formation
and as we move through the course you're going to get experience of using all of these different methods.
Now that we're close to finishing up the basics of VPC and EC2 within the course
things will start to get much more efficient quickly because I'm going to start showing you
how to use many of the automation and infrastructure as code services within AWS
and these are really awesome to use and you'll see just how much power is granted
to an architect, a developer or an engineer by using these services.
For now though that is the end of this demo lesson.
Now what we're going to do is to clear up our account.
So we need to go ahead and clear all of this infrastructure that we've used throughout this demo lesson.
To do that just move back to the AWS console.
If you still have the cloud formation tab open then move back to that tab.
Otherwise click on services and then click on cloud formation.
If you don't see it anywhere you can use this box to search for it.
Select the WordPress stack, select delete and then confirm that deletion.
And that will delete the stack, clear up all of the infrastructure that we've used throughout this demo lesson
and the account will now be in the same state as it was at the start of this lesson.
So from this point onward in the course we're going to start using automation.
Now there is a lesson coming up in a little while in this section of the course
where you're going to create an Amazon machine image which is going to contain a pre-baked copy of the WordPress application.
So as part of that lesson you are going to be required to perform one more manual installation of WordPress
but that's going to be part of automating the installation.
So you'll start to get some experience of how to actually perform automated installations
and how to design architectures which have WordPress as a component.
At this point though that's everything I wanted to cover.
So go ahead, complete this video and when you're ready I'll look forward to you joining me in the next.
