Welcome back and in this demo lesson I'm just wanting to give you some practical experience with interacting with the parameter store inside AWS.
So to do that make sure you're logged into the IAM admin user of the management account of the organization and you'll need to have the Northern Virginia region selected.
Now there's also a lesson commands document linked to this lesson which contain all of the commands that you'll need for this lessons demonstration.
So before we start interacting with the parameter store from the command line we need to create some parameters and the way that we do that is first move to systems manager.
So the parameter store is actually a sub product of systems manager so move over to the systems manager console and once you're there you'll need to select the parameter store from the menu on the left.
So it should be about half way down on the left and it's under application management so go ahead and select parameter store.
Now once you're in parameter store the first thing that you'll need to do to remove this default welcome screen logically is to create a parameter so go ahead and click on create parameter.
Now when you create a parameter you're able to pick between standard or advanced.
Standard is the default and that meets most of the needs that most people have for the product and you can create up to 10,000 parameters using the standard tier.
With the advanced tier you can create more than 10,000 parameters the parameter value can be longer at 8 kilobytes versus the 4 kilobytes of standard and you do gain access to some additional features.
But in most cases most parameters are fine using the default which is the standard tier with the standard tier there's no additional charge to use this up to the limit of 10,000 parameters.
The only point at which parameter store costs any extra is if you use the faster throughput options or make use of this advanced tier.
And we won't be doing that at any point throughout the course we'll only be using standard and so there won't be any extra parameter store related charges on your bill.
Now I mentioned that a parameter is essentially a parameter name and a parameter value and it's here where you set both of those.
There's an optional description that you can use and you can set the type of the parameter.
The options being string, string list which is a comma separated list of individual strings and then secure string which utilises encryption.
So we're going to go ahead at this point and create some parameters that we're then going to interact with from the command line.
So the first one we'll create is one that's called forward slash my hyphen cat hyphen app forward slash DB string.
So this is the name of a parameter and it will also establish a hierarchy.
So anytime we use forward slashers we're establishing a hierarchy inside the parameter store.
So imagine this being a directory structure. Imagine this being the root of the structure.
Imagine my hyphen cat hyphen app being the top level folder and inside there imagine that we've got a file called DB string.
So we're going to store this we're going to store this hierarchy and we need to set its value.
So we'll keep this for now as a string and this is going to be the database connection string for my cat app.
So we'll just enter the value that's in the lesson commands document so db.allthecats.com colon 3306 and 3306 of course is the MySQL standard port number.
At this point we could enter an optional description so let's go ahead and do that connection string for cat application.
So just type in a description here it doesn't matter really what you type and then scroll down and hit create parameter.
So that's created our first parameter my hyphen cat hyphen app forward slash DB string.
Now we're going to go ahead and do the same thing but for DB user.
So click on create parameter and then just click in this name box and notice how it presents you with this hierarchy.
So now we've got two levels of this hierarchical structure.
We've got the my hyphen cat hyphen app at the top and then we've got the actual parameter that we created at the bottom here.
So this is already established this structure.
So let's go ahead and create a new parameter.
This time it's going to be forward slash my hyphen cat hyphen app forward slash DB user.
We'll not bother with the description for this one we'll keep it at the default of standard and it will also be a string.
And then for the value it will be boss cat.
So enter all that and click on create parameter.
Next let's create a parameter again.
If we click in this name this time we've got this hierarchy that's ever expanding.
So we've got the top level at the top and then below it two additional parameters DB string and DB user.
And we're going to create a third one at this level.
So this time it's going to be called forward slash my hyphen cat hyphen app forward slash DB password.
This time though instead of type string it's going to be a secure string so that it encrypts this parameter.
And it's going to use KMS to encrypt the parameter.
And because it's using KMS we'll need to select the key to use to perform the cryptographic operations.
We can either select a key from the current account so the account that we're in or we can select another AWS account.
And in either case we'll need to pick the key ID to use and by default it uses the product default key for SSM.
So that's using alias forward slash AWS forward slash SSM.
And you always have the option of clicking on this drop down and changing it if you want to benefit from the extra functionality that you get by using a customer managed KMS key.
This is an AWS managed one so you won't be able to configure rotation and you won't be able to set these advanced key policies.
But in most cases you can use this default key.
So at this point we'll leave it as the default and we'll enter our super secret password amazing secret password 1337 and then click create parameter.
We're not finished yet though click on create parameter again.
And I like to be inclusive so not everything in my course is going to be about cats.
We're going to create another parameter my hyphen dog hyphen app forward slash DB string.
We'll keep standard we'll keep the type of string and then the value for connecting to the my dog application.
So the DB string is going to be DB if we really must have dogs dot com colon three three oh six.
So type that in and then click on create parameter.
And then lastly we're going to create one more parameter.
This time the name is going to be forward slash rate my lizard.
So rate hyphen my hyphen lizard forward slash DB string.
The tier is going to be standard again the type is going to be string and for the value it will be DB dot this is pretty random dot com colon three three oh six.
So type that in and then click on create parameter.
So now we've created a total of five parameters.
We've created the DB string the DB user and the DB password for the cat application and then the DB string for the dog application as well as the rate my lizard application.
So a total of five parameters and one of them is using encryption.
So that's the DB password for the my cat application.
So now let's switch over to the command line and interact with these parameters and to keep things simple we're going to use the cloud shell.
So this is a relatively new feature made available by AWS and this means that we don't have to interact with AWS using our local machine.
We can do it directly from the AWS console.
So click on the cloud shell icon on the menu on the top.
This will take a few moments to provision because this is creating a dedicated environment for you to interact with AWS using the command line interface.
So you'll need to wait for this process to complete.
So go ahead and pause the video and wait until this logs you into the cloud shell environment at which point you can resume the video and we're good to continue.
It'll say preparing your terminal and then you'll see a familiar looking shell much like you would if you were connected to a Linux instance.
And now you'll be able to interact with AWS using the command line interface using the credentials that you're currently logged in with.
Now to interact with parameter store using the command line we start by using AWS and then a space SSM and then a space.
And then the command that we're going to use is get hyphen parameters.
Now by default what we need to provide the get hyphen parameters command with is the path to a parameter.
So in this case if we wanted to retrieve the database connection string for the rate my lizard application then we could provide it with this name.
So forward slash rate hyphen my hyphen lizard forward slash DB string.
And this directly maps back through to the parameter that we've just created inside the parameter store.
So this parameter.
So if you go ahead and type that and press enter it's going to return a JSON object inside that JSON object is going to be a list of parameters.
And then for each parameter so everything inside these inner curly braces we're going to see the name of the parameter that we wanted to retrieve the type of the parameter.
The value of the parameter in this case DB dot this is pretty random dot com colon 3306 the version number of the parameter because we can have different version numbers.
The last modified date the data type and then the unique ARN of this specific parameter.
And so this is an effective way that you can store and retrieve configuration information from AWS.
Now we can also use the same structure of command to retrieve all of those other parameters that we stored within the parameter store.
So if we wanted to get the DB string for the my hyphen dog hyphen app then we could use this command and again it would return the same data structure.
So a JSON object containing a list of parameters and each of those parameters would contain all of this information.
I'll clear the screen to keep this easy to see.
We could do the same for the my hyphen cat hyphen app retrieving its database connection string.
And again it would return the same JSON object with the parameters list and then for each parameter this familiar data structure.
Now what you can also do and I'm going to clear the screen before I run this is instead of providing a specific path to a parameter.
So if you remember we had almost a hierarchy that we created with these different names.
So we have the my hyphen cat hyphen app hierarchy and then inside there DB password DB string DB user.
We have my hyphen dog hyphen app and inside there DB string and then rate hyphen my hyphen lizard and also DB string.
So rather than having to retrieve each of these individual parameters by specifying the exact name we can actually use get parameters by path.
So let's demonstrate exactly how that works.
So with this command we're doing a get hyphen parameters hyphen by hyphen path and we're specifying a path to a group of a number of parameters.
So in this case my hyphen cat hyphen app is actually going to be the first part of the path of DB password DB string and DB user.
So by creating a hierarchical structure inside the parameter store we can retrieve multiple parameters at once.
So this time we're returning a JSON structure inside this JSON structure.
We have a list of parameters and then we're retrieving three different parameters DB password DB string and DB user.
Now note how DB password is actually a type of secure string and by default if we don't specify anything we return the encrypted version of this parameter.
So the cipher text version of this parameter.
This ensures that we can interact with parameters without actually decrypting them and this offers several security advantages.
Now I've cleared the screen to make this next part easy to see because it's very important.
Because we're using KMS to encrypt parameters the permissions to access KMS keys to perform this decryption this is separate than the permissions to access the parameter store.
So this user I am admin in this case has the necessary permissions to interact with KMS to use the keys to decrypt these parameters.
Then we can also ask the parameter store to perform that decryption whilst we retrieve the parameters.
The important thing to understand is the permissions to interact with the parameter store is separate than the permissions to interact with KMS.
So to perform a decryption whilst we're retrieving the parameters we would use this command.
So it's the same command as before AWS SSM get hyphen parameters hyphen by hyphen path and then we're specifying the my hyphen cat hyphen app part of the hierarchy.
So remember this represents these three parameters.
Now if we ran just this part on its own which was the command we previously ran this would retrieve the parameters without performing decryption.
But by adding this last part this is the part that performs the decryption on any parameter types which are encrypted.
And if you recall one of the parameters that we created was this DB password which is encrypted.
So if we run this command this time it's going to retrieve the forward slash my hyphen cat hyphen app forward slash DB password parameter.
But it's going to decrypt it as part of that retrieval operation and return the plain text version of this parameter.
And just to reiterate that requires both the permissions to interact with the parameter store as well as the permissions to interact with the KMS key that we chose when creating this parameter.
Now we're logged in as the I am admin user which has admin permissions and so we do have permissions on both of those on SSM and on KMS so we can perform this decryption operation.
Now you're going to be using the parameter store extensively for the rest of the course and my other courses.
It's a great way of providing configuration information to applications both AWS and bespoke applications within the AWS platform.
It's a much better way to inject configuration information when you're automatically building applications or you need applications to retrieve their own configuration information.
It's much better to retrieve it from the parameter store than to pass it in using other methods.
So we're going to use it in various different lessons as we move throughout the course.
In this demo lesson I just wanted to give you a brief experience of working with the product and the different types of parameters.
But at this point let's go ahead and clear up all of the things that we've created inside this demo lesson.
So close down this tab open to Cloud Shell.
Back at the parameter store console just go ahead and check the box at the top to select all of these existing parameters.
If you do have any other parameters apart from the ones that you've created within this demo lesson then do make sure that you uncheck them.
You should be using an account dedicated for this training so you shouldn't have any others at this point.
But if you do make sure you uncheck them.
You should only be deleting ones for Ate My Lizard, My Dog App and My Cat App.
So make sure that all of those are selected and then click on delete to delete those parameters and you'll need to confirm that deletion process.
And at this point that's everything that I wanted you to do in this lesson.
You've cleared up the account back to the point it was at the start of this demo lesson.
So go ahead complete this video and when you're ready I'll look forward to you joining me in the next.
