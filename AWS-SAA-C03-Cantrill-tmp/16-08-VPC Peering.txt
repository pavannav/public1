Welcome back and in this lesson I'm going to be covering another important piece of networking functionality, VPC peering.
I want to cover the theory and architecture quickly and then move on to a demo so you can experience exactly how it works.
So let's jump in and get started.
VPC peering is a service that lets you create a private and encrypted network link between two VPCs.
One peering connection links two and only two VPCs. Remember that? No more than two.
It's important for the exam.
A peering connection can be created between VPCs in the same region or cross region,
and the VPCs can be in the same account or between different AWS accounts.
Now there are some limitations when running a VPC peering connection between VPCs in different regions,
but it still can be accomplished.
When you create a VPC peer, you can enable an option so that public hostnames of services in the peered VPCs resolve to the private internal IP addresses.
And this means that you can use the same DNS names to locate services whether they're in peered VPCs or not.
If a VPC peer exists between one VPC and another and this option is enabled,
then if you attempt to resolve the public DNS hostname of an EC2 instance, it will resolve to the private IP address of that EC2 instance.
And if your VPCs are in the same region, then they can reference each other by using Security Group ID,
and so you can do the same efficient referencing and nesting of security groups that you can do if you're inside the same VPC.
This is a feature that only works with VPC peers inside the same region.
In different regions, you can still utilise security groups, but you'll need to reference IP addresses or IP ranges.
If the VPC peers are in the same region, then you can do the logical referencing of an entire security group,
and that massively improves the efficiency of the security of VPC peers.
Now if you can take away just two important facts from this theory lesson about VPC peers,
it's that VPC peering connections connect two VPCs and only two.
One VPC peer connects two VPCs.
And the second fact that I want you to take away is that this connection is not transitive.
Now what I mean by that, and I'll show you it visually on the next screen,
is that if you have VPC A peered to VPC B, and you have VPC B peered to VPC C,
that does not mean that there is a connection between A and C.
If you want VPC A, B and C to all communicate with each other, then you need a total of three peers.
One between A and B, one between B and C, and one between A and C.
So you need to make sure that for any connectivity requirements that you have,
there is always a peering connection between every VPC pair that you want to connect.
You can't route through interconnected VPCs.
And you'll see exactly how that looks visually on the next screen.
Now when you create a VPC peering connection between two VPCs,
what you're actually doing is creating a logical gateway object inside of both of those VPCs.
And to fully configure connectivity between those VPCs, you need to configure routing.
So route tables with routes on them pointing at the remote VPC IP address range
and using the VPC peering connection gateway object as the target.
And don't worry, you'll get to see exactly how this works when you implement it in the next demo lesson.
I do want you to keep in mind that as well as creating the VPC peering connection and configuring routing,
you also need to make sure that traffic is allowed to flow between the two VPCs
by configuring any security groups or network ACLs as appropriate.
So let's look at the architecture visually before we move on to a demo lesson
where you'll get the chance to implement VPC peering between a number of different VPCs.
So architecturally, let's say that we have three VPCs belonging to animals for life.
So we've got VPC A, which is using an IP sider of 10.16.0.0.16.
We've got VPC B at the bottom, which is using 10.17.0.0.16.
And then VPC C on the right, which is using 10.18.0.0.16.
By default, each of these VPCs are isolated networks, so no communication is allowed between any of the VPCs.
Now to allow communications, we can create a peering connection between VPC A and VPC B.
And we can add another peering connection between VPC B and VPC C.
Now what that would do, as I mentioned on the previous screen, is establish a networking link
and create a logical gateway object inside each VPC.
So step two would be to configure routing tables within each VPC and associate these with subnets.
And these routing tables have the remote VPC sider and as the target, the VPC peering connection
or the gateway object that's created when we create the VPC peering connection.
Now this would mean that the VPC router in VPC A would know to send traffic destined for the IP range of VPC B
toward the VPC peering logical gateway object.
That configuration would be needed on all subnets at both sides of all peering connections,
assuming we wanted to allow completely open communications.
Now something to understand for the exam, it does come up in questions at an associate level,
is that the IP address ranges of the VPCs, so the VPC siders, cannot overlap if you want to create VPC peering connections.
So this is another reason why right at the start of the course I cautioned against ever using the same IP address ranges.
If you want to allow VPCs to communicate with each other using VPC peers, you cannot have overlapping IP addresses.
Now assuming that you have followed best practice and don't have any overlapping sider ranges inside your VPCs,
then you will have connectivity between your isolated networks.
But one really, really important thing to understand, both for production usage and the exam,
is that with the architecture that you see now, VPC A and B have one peering relationship,
and VPC B and C have another peering relationship.
But there is no link between VPC A and VPC C.
And while it might seem logical to assume that they could communicate through VPC B as an intermediary,
that's not the case. Routing isn't transitive.
What this means is that you cannot communicate through an intermediary.
You need to have a VPC peer created between all of the VPCs that you want to be able to communicate with each other,
at least if you only use VPC peers.
There is a product called the Transit Gateway, which I'll talk about later in the course,
which is a little bit more feature-rich.
But for VPC peers, you need to make sure that you have one peering connection between all VPCs that you want to communicate.
So in this example, for VPC A to communicate with VPC C,
they would need their own independent peering connection created between those two VPCs.
Now with VPC peering, any data that's transferred between VPCs is encrypted.
And if you're utilizing a cross-region VPC peer, then the data transits over AWS's global secure network.
So you get secure transit and you gain the performance from using the global AWS transit network versus the public internet.
Okay, so that's it for the features and architecture of VPC peering.
That's everything that I wanted to cover in this lesson.
Next, you're going to be doing a demo where you'll have the chance to implement this within your own AWS environment.
So thanks for watching. Go ahead and complete this video.
And then when you're ready, I look forward to you joining me in the next lesson.
