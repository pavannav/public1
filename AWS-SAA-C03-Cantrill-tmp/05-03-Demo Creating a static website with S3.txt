Welcome back and in this demo lesson you're going to get some experience
using the S3 static website hosting feature
which I talked about in the previous lesson. Now to get started just make sure
that you're logged in to the management account of the organization
and that you're using the IAM admin user. So this just makes sure that you have
admin permissions over the general or management account of the organization.
Also make sure that you have the Northern Virginia region selected which is US-East-1.
Normally with S3 when you're interacting with the product you're doing so using the AWS console UI
or the S3 APIs and in this demo lesson you'll be enabling a feature which allows S3
to essentially operate as a web server. It allows anybody with a web browser
to interact with an S3 bucket to load an index page and load pictures or other media
that are contained within that bucket using standard HTTP.
So that's what we're going to do and to get started we need to move across to the S3 console.
So either use S3 in recently visited services or you can click on the services drop down,
type S3 and then click it in this list.
Now that we're at the S3 console we're going to create an S3 bucket.
Now if you chose to register a domain earlier in the course like I did so I registered animalsforlife.io
then we're going to connect this S3 bucket with the custom domain that we registered
so we can access it using that domain. If you chose not to use a domain then don't worry
you can still do this demo. What you need to do is to go ahead and click on create bucket.
Now for the bucket name if you are not using a custom domain then you can enter whatever you want
in this bucket name as long as it's unique. If you did register a custom domain and you want to use
this bucket with that domain then you need to enter a DNS formatted bucket name. So in my case
I'm going to create a bucket which is called top10. It's going to store the world's best cat pictures,
the top 10 cat pictures in the world ever and it's going to be part of the animalsforlife.io
domain and so at the end of this I'm going to add dot and then animalsforlife.io and if you've
registered your own custom domain then obviously you need to add your own domain at the end.
You can't use the same name as me. Once you've entered that name then just scroll down and uncheck
block all public access. This is a safety feature of S3 but because we're intentionally creating
an S3 bucket to be used as a static website we need to uncheck this box. Now unchecking this box
means that you will be able to grant public access. It doesn't mean that public access is granted
automatically when you uncheck this box. They're separate steps. You will though need to acknowledge
that you understand the risks of unticking that box. So check this box just to confirm that you
understand. We'll be carefully configuring the security so you don't have to worry about any of
those risks. And once you've set that we can leave everything else as default. So just scroll all the
way down to the bottom and click on create bucket. So the bucket's been created but right now this
only allows access using the S3 API's or the console UI so we need to enable static website
hosting. Now to do that we're going to click on the bucket. Once we have the bucket open we're
going to select the properties tab. On the properties tab scroll all the way down to the
bottom and right at the very bottom we've got static website hosting and you need to click on
the edit button next to that. It's a simple yes or no choice at this point so check the box to
enable static website hosting. There are a number of different types of hosting. You can either just
host a static website which is what we'll choose or you can redirect requests for an object. So
this allows you to redirect to a different S3 bucket. We'll be covering this later in the course
for now just leave this selected so host a static website. Now in order to use the static website
hosting feature you'll need to provide S3 with two different documents. The index document is
used as the home or default page for the static website hosting so if you don't specify a particular
object when you're browsing to the bucket for example winky.jpg if you just browse to the
bucket itself then the index document is used and we're going to specify index.html so this means
that an object called index.html will be loaded if we don't specify one. Now the error document
is used whenever you have any errors so if you specify that you want to retrieve an object from
the bucket which doesn't exist the error document is used and for the error document we're going to
call this error.html so these two values always need to be provided when you enable static website
hosting so now we've provided those we can scroll down and click on save changes. Now that that
feature is enabled if we just scroll all the way down to the bottom you'll see that we have a url
for this bucket. So go ahead and copy that into your clipboard we're going to need this
shortly so this is the url that you'll use by default to browse to this bucket. Now next what
we need to do is to upload some objects to the bucket which this static website hosting feature
is going to use. Now to do that scroll all the way to the top and just click on objects and then
click on upload. So this is the most recent UI version for S3 and so you have the ability to
add files or add folders. Now we're going to use both of these we're going to use the add files
button to add the index.html and the error.html and we're going to use the add folder to add a folder
of images. So first let's do the add files so click on add files now attached to this video
is a link which downloads all of the assets that you'll need for this demo so go ahead and click
on that link to download the zip file and then extract that zip file to your local machine
and you'll need to move to the folder that you extracted from this zip file it should be called
static underscore website underscore hosting so go to that folder and then again there should
be a folder in there called website underscore files so go ahead and click on there to go into
that folder now there are three things inside this folder index.html error.html and img so we'll start
by uploading both of these html documents so select index.html and error.html and then click
on open and that will add both of these to this upload table next click on add folder and then
select the img folder and click on upload so this has prepared all of these different objects
ready to upload to this s3 bucket if we scroll down we'll see that the destination for these
uploads is our s3 bucket and your name here will be different as long as it's the same as the name
you picked for the bucket that's fine go all the way to the bottom and then go ahead and click on
upload and that will upload the index.html the error.html and then the folder called img
as well as the contents of that folder so at this point that's all of the objects uploaded to the s3
bucket and we can go ahead and click on close so now let's try browsing to this bucket using
static website hosting so go ahead and click on properties scroll all the way down to the bottom
and here we've got the url for this s3 bucket so go ahead and copy this into your clipboard open
a new tab and then open this url or click on this symbol to open it in a new tab what you'll see is
a 403 forbidden error and this is an access denied you're getting this error because you don't have
any permissions to access the objects within this s3 bucket remember s3 is private by default and
just because we've enabled static website hosting doesn't mean that we have any permissions to access
the objects within this s3 bucket we're accessing this bucket as an anonymous or unauthenticated
user so we have no method of providing any credentials to s3 when we're accessing objects
via static website hosting so we need to give permissions to any unauthenticated or anonymous
users to access the objects within this bucket so that's the next thing we need to do we need
to grant permissions to be able to read these objects to any unauthenticated user so how do
we do that the preferred method is to use a bucket policy so that's what i'm going to
demonstrate in order to grant access to these objects now to add a bucket policy we need to
select the permissions tab so click on permissions and then below block public access there's a box
to specify a bucket policy so click on edit and we need to add a bucket policy now also in the
folder that you extracted from this lesson's zip file is a file called bucket underscore policy
dot json and this is a generic bucket policy so this bucket policy has an effect of allow
and it applies to any principle because we have this star wildcard and because the effect is
allow it grants any principle the ability to use the s3 get object action which allows anyone to
read an object inside an s3 bucket and it applies to this resource so this is a generic template we
need to update it but go ahead and copy it into your clipboard go back to the s3 console and paste
it into this box now we need to replace this generic arn so this example bucket arn so what
i want you to do is to copy this bucket arn at the top of the screen so copy this into your clipboard
and we need to replace part of this template arn with what we've just copied now an important
point to highlight is that this arn has forward slash star on the end because this arn refers
to any objects within this s3 bucket so we need to select only the part before the forward slash
so starting at the a and then ending at the end of example bucket and then just paste in the arn
of our bucket that we just copied into our clipboard what you should end up with is this
full arn with the name of the bucket that you created and then forward slash star and once
you've got that go ahead and click on save changes this applies a bucket policy which allows any
principle so even unauthenticated principles the ability to get any of the objects inside this
bucket so this means that any principle will be able to read objects inside this bucket at this
point assuming everything's okay if you've still got the tab open to the bucket then go back to
that tab and hit refresh and what you should see is the top 10 animals in the world so at position
number one we've got merlin at position number two we've got merlin again position number three
another merlin four still merlin and then merlin again at number five at number six we've got
boris so the token non-merlin cat number seven samson another token non-merlin cat and then at
number eight we've got different cat one he looks quite a lot like merlin number nine different cat
two again kind of looks like merlin and then number ten we've got the family and then you might not
have guessed this but this entire top 10 contest was judged by you guessed it merlin so what you're
loading here is the index dot html document inside the bucket so we haven't specified an object to
load and because of that it's using the index document that we specified on the bucket we can
load the same object by typing specifically index dot html on the end and that will load in the same
object now if we specify an object which doesn't exist so let's say we used wrong index dot html
then instead of the index document now it's going to load the error document so this is the error
document that you specified which is loading error dot html so this is just an example of
how you can configure an s3 bucket to act as a standard static website so what it's doing is
index dot html object inside the bucket and that index dot html is loading in images which are also
stored in the bucket so if i right click and copy the image location and open this in a new tab
this is essentially just loading this image from the same s3 bucket so it's loading it from this
folder called img and it's called merlin dot jpeg it's just an object loading from within the bucket
now if i go back to the s3 console and just move across to the properties tab and then scroll down
so far in this lesson you've been accessing this bucket using the bucket website endpoint so this
is an endpoint that's derived from the name of the bucket now your url will be different because
you will have called your bucket name something else now if you chose to register a custom domain
name at the start of this course you can customize this further as long as you call the bucket the
same as the dns name that you want to use you can actually use route 53 to assign a custom dns name
for this bucket so this part of the demo you'll only be able to do if you've registered a domain
within route 53 if you haven't you can skip to the end of this demo where we're going to tidy up
but if you do want to customize this using route 53 then you can click on the services
drop down and type route 53 and then click to move to the route 53 console once you're there
you can click on hosted zones and you should have a hosted zone that matches the domain that you
registered at the start of the course go inside that and click on create record now we're going
to be creating a simple routing record so make sure that's selected and then click on next and
we're going to define a simple record now i'm going to type the first part of the name of the
buckets so i used top10.animalsforlife.io as my bucket name so i'm going to put top 10 in this
box now because we want to point this at our s3 bucket we need to choose an end point in this
drop down so click in this drop down and then scroll down and we're going to pick alias to
s3 website endpoint so select that next you need to choose the region and you should have created
the s3 bucket in the us east 1 region because this is the default for everything that we do in the
course so go ahead and type us-east-1 and then select us east northern virginia and you should
be able to click in enter s3 endpoint and select your bucket name now if you don't see your bucket
here then either you've picked the wrong region or you've not used the same name in this part of
the record name as you picked for your bucket so make sure this entire name so this component
plus the domain that you use matches the name that you selected for the bucket assuming it does you
should be able to pick your bucket in this drop down once you've selected it go ahead and click
on define simple record and once that's populated in the box click on create records now once this
record's created you might have to wait a few moments but you should find that you can then
open this bucket using this full dns name so there we go we did it using an alias to our s3
endpoint now again you can only do this if you create a bucket with the same name as the fully
qualified domain name that we've just configured so this is an example of a fully qualified
domain name now this is the host component of dns and this is the domain component so together
they make up a fully qualified domain name and for this to work you need to create an s3 bucket
with the same bucket name as this fully qualified domain name and that's what i did at the start of
this lesson which is why it works for me and as long as you've done the same as long as you've
registered a custom domain as long as you've called the bucket the same as what you're creating
within route 53 then you should be able to reference that bucket and then access it using
this custom url at this point we're going to tidy up so go back to the route 53 console and select
this record that you've created and then click on delete you'll need to confirm it by clicking
delete again then we need to go back to the s3 console select the bucket that you've created
click on empty and you'll need to either type or copy and paste permanently delete into this box
and then click on empty it'll take a few minutes to empty the bucket once it's completed click on
exit and with the bucket still selected click on delete to delete the bucket and you'll need
to confirm that by either typing or copy and pasting the name of the bucket and then click
delete bucket now at this point that's everything that you need to do in this lesson it's just an
opportunity to experience the theory that you learned in the previous lesson now there's a
lot more that you can do with static website hosting and i'll be going into many more complex
examples later on in the course but for now this is everything that you need to do
so go ahead and complete this video and when you're ready i'll look forward to you joining me in the
next
