Welcome back, this is part two of this lesson. We're going to continue immediately from the end of part one, so let's get started.
Now in addition to using this user data feature and launching instances manually, populating this user data and using that to bootstrap the launch process of an EC2 instance,
we can also take advantage of this functionality from within CloudFormation.
And attached to this lesson is a supplementary one-click deployment link which will deploy another WordPress EC2 instance, and I want to step through exactly what this one-click deployment does.
So this is another CloudFormation template. Now I'll be talking much more about CloudFormation as we move through the course. You don't need to understand what this does at this point.
Just think about this as a form of automation that you can use to deploy AWS resources. Now one particular point I want to draw out if we scroll down through this file,
I want to draw your attention to where we create an EC2 instance. I'm just going to keep scrolling until I find this. Here we go, we've got public EC2.
Now what you can do inside a CloudFormation template as well as automatically launching an EC2 instance, you can also provide user data.
So in this particular case, notice how I'm using this function because remember, user data needs to be provided in Base64 encoding.
While the console UI allows you to provide a text file and have it automatically converted as part of the launch process, when you're using CloudFormation though,
you need to take plain text and run it through a Base64 encoder function, which is what this does. Otherwise, this is exactly the same.
It just means this instance, when it's been launched by CloudFormation, will have user data run as part of the launch process.
So it will perform exactly the same set of actions. It will provision an instance and automatically configure it during the launch process.
So you'll recognize the same commands, the same installation, the configuration and the custom login banner.
So this is linked additionally attached to this lesson as a supplementary or optional one-click deployment.
So if you click that additional link that's attached to this lesson, that will take you to the Quick Create Stack screen.
This time this will be called Bootstrap CFN. Because we're using CloudFormation to Bootstrap this instance,
it's going to ask you for all of the important values. So the database name, the database password, the database root password, the database user.
They're all preset using defaults. All you need to do is check the capabilities box at the bottom and click on Create Stack.
Now make sure Bootstrap CFN is selected and if you select template, this is the template that's being used to create this stack.
So this is the one where if we scroll down, you'll see that the user data is being provided as part of this CloudFormation template.
So we're using the Base64 function to encode this plain text into Base64. We're passing that into the instance as part of its launch process.
And so this will use the same user data that I demonstrated earlier in this lesson.
The end result is another EC2 instance that's been provisioned using user data. So it's been Bootstrapped, but this time it's used CloudFormation.
We'll need to give that a few minutes to finish creating. So go ahead and pause the video and resume it once the Bootstrap CFN stack is in the Create Complete state.
OK, so now this stack's moved into a Create Complete state. If we click on Resources, scroll down, locate public EC2 inside the Bootstrap CFN stack and click on its physical ID.
This will move us to the EC2 console with only this instance visible. So this is the instance created by the second stack.
Let's go ahead and select this instance. We'll need to give it a few minutes to finish the provisioning process, but once it has, if we copy down its public IP version 4 address into our clipboard,
don't use this open address link. Copy that address and then open that in a new tab.
What you'll see, just like the previous example of Bootstrapping by manually entering user data, is the WordPress installation dialog.
And if we right-click on this instance, go to Connect, choose Instance Connect, we will see our Custom Animals for Life login banner.
So we've done the same process of Bootstrapping this instance, only this time we've stored the user data within the CloudFormation template.
And as you move through the course, you're going to see more and more complex examples of using CloudFormation, which utilize this Bootstrapping process.
You're also going to have access to a CloudFormation mini deep dive, where I'm going to be going into a lot more detail of how CloudFormation works and how you can create your own CloudFormation templates.
Now at this point, that is everything that I wanted to demonstrate in this video.
So let's start the process of account cleanup. We need to return the account into the same state as it was at the start of this demo lesson.
So return to the EC2 console and go to Instances, and we need to manually terminate one of these instances.
We need to terminate A4L-ManualWordPress, because this wasn't created by CloudFormation, so we need to terminate it.
So right-click on A4L-ManualWordPress and terminate the instance, and then confirm.
You'll need to wait for this to finish, for the instance to move into the terminated state, before you can continue on to the next step.
So go ahead and pause the video, wait for the instance to change to terminated, and then you can continue.
Now that that's terminated, we can go ahead and move back to the CloudFormation console, and we need to delete both of these stacks.
So select Bootstrap CFN, and then click on Delete, and then confirm that deletion.
At the same time, you can select Bootstrap, click on Delete again, confirm that deletion,
and once both of those have been deleted, the account will be in the same state as it was at the start of this demo lesson.
So I hope this demo has been useful. You've got some experience of bootstrapping EC2 instances both manually and using CloudFormation.
At this point that is everything though, so go ahead and complete this video, and when you're ready, I'll look forward to you joining me in the next lesson.
