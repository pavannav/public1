Welcome back, this is part two of this lesson, we're going to continue immediately from the end of part one, so let's get started.
Now one final thing before we finish with this demo lesson, and I want to talk about Private Hosted Zones.
So move back to the Route 53 console, I'm going to go to Hosted Zones, and I'm going to create a Private Hosted Zone.
So click Create Hosted Zone, because it's a Private Hosted Zone, it doesn't even need to be one that I actually own.
So I'm going to call my hosted zone, ilikedogsreally.com, it's going to be a Private Hosted Zone, and for now I'm going to associate it with the default VPC in US-E-1.
So I'm going to pick the region, US-E, and then select Northern Virginia, and then click in the VPC ID box, and we should see two VPCs listed.
One is the Animals for Life VPC, it's tagged A4L-VPC1, but I'm not going to pick this one, I'm going to pick the one without any text after it, which is the default VPC.
So once that's set, I'm going to create the hosted zone, then inside the hosted zone I'm going to create a record.
The record's going to use the simple routing policy, click on Next, I'm going to define a simple record, going to call it WWW.
The record type is going to be A, routes traffic to an IP version 4 address and some resources.
Going to click in this end point box and select IP address or another value depending on record type, and then into this box I'm just going to put a test IP address of 1.1.1.1.
And then down at the bottom I'm going to click 1M to change this TTL to 60 seconds, and I'm going to click Define Simple Record.
And then finally, Create Records. So now we have a record called WWW.ILikedogsreally.com.
So copy that into the clipboard, move back to the EC2 console, click on Dashboard, click on Instances Running, right click, Connect.
We're going to use EC2 Instance Connect and then just click on Connect.
Once connected I'm going to try pinging the record which I just created, so ping space and then paste in WWW.ILikedogsreally.com and press Enter.
What you should see is name or service not found.
The reason for this is the private hosted zone which we created is currently associated with the default VPC and this instance is not in the default VPC.
To enable this instance to resolve records inside this private hosted zone we need to associate it with the Animals for Life VPC.
So go back to the Route 53 console, expand Hosted Zone Details and then Edit Hosted Zone.
Scroll down and we're going to add another VPC.
Then drop down, US-EAST-1 and then in the Choose VPC box select A4L-VPC1.
Scroll down and Save Changes.
Now this might take a few seconds to take effect but if we go back to the EC2 instance and try to run this ping again and we still get name or service not found.
So what I want you to do is go ahead and pause this video, wait for 4 or 5 minutes and then resume and try this command again.
Now in my case it took about 5 minutes but after a while I can now ping www.ilikedogsreally.com
because I've now associated this private hosted zone with the VPC that this instance is running from.
Now that's everything that I wanted to cover in this demo lesson so all that remains is for us to clean up all of the infrastructure which we've created in this demo lesson.
So if we go back to the Route 53 console and select Health Checks, first we're going to delete the health check.
So select A4L-Health and click on Delete Health Check and Confirm.
Click on Hosted Zones, go inside the private hosted zone that you created.
Select the www.ilikedogsreally.com record and then click on Delete Record, confirm that deletion.
Go back to Hosted Zones, select the entire private hosted zone and click on Delete.
Type Delete and then click to confirm and that will delete the entire private hosted zone.
Then go inside the public hosted zone that you have, select the two www records that you created earlier in this lesson.
Click on Delete Records, click Delete to confirm.
Then go to the S3 console, click on the bucket that you created earlier in this lesson.
Click Empty, copy and paste or type permanently delete and click on Empty.
Once that bucket's emptied, click on Exit.
With it still selected, click on Delete.
Copy and paste or type the full name into the box and click on Delete Bucket.
Then go to the EC2 console, click the hamburger menu, scroll down.
Click Elastic IPs, select the Elastic IP that you associated with the EC2 instance.
Click on the Actions dropdown, Disassociate and then click to Disassociate.
With it still selected, click on Actions, release Elastic IP addresses and click on Release.
And at that point, all of the manually created infrastructure has been removed.
So go back to the CloudFormation console, go to Stacks.
Select the stack that you created at the start of this lesson using the one-click deployment.
It should be called DNS and Failover Demo.
So select it, click on Delete and then click on Delete Stack to confirm that deletion.
And once that's deleted, the account will be back in the same state as it was at the start of the lesson.
Now at this point, that's everything I wanted to cover in this demo.
I hope it's been enjoyable and it's given you some good practical experience
of how to use Failover Routing and Private Hosted Zones.
And that will be useful both for the exam and real-world usage.
So at this point, that's everything. So go ahead and complete this video.
And when you're ready, I'll look forward to you joining me in the next.
