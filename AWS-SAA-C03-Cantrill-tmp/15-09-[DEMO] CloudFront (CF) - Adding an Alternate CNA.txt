Welcome to this demo lesson, and in this lesson you're going to get the practical experience of configuring your CloudFront distribution with a custom domain name and giving it the ability to use that custom domain name with SSL.
And you're going to do that by applying an SSL certificate generated by ACM to the CloudFront distribution.
This demo lesson is a continuation of the previous demo where we looked at creating a CloudFront distribution and using it with an S3 origin.
And so it's going to be using the same infrastructure that you left in place within your AWS account at the end of the previous demo lesson.
So that means that you should have used the one-click deployment in the previous demo lesson that created an S3 static website and you created a CloudFront distribution which points at that S3 origin.
So this demo lesson is going to be a continuation of that demo lesson and we're going to add a custom domain name and SSL.
To do the demo you'll need to make sure that you're logged in as the IAM admin user and you'll need to be using the general AWS account which is the management account of the organization.
And with this demo it is especially important that you have the Northern Virginia region selected.
Parts of this demo utilize ACM with CloudFront and in ACM you absolutely have to be using Northern Virginia or it won't work.
You won't be able to assign the certificate to CloudFront. So please make sure at all points you're using Northern Virginia.
Now one other requirement for this lesson, you do need to have your own domain name registered and hosted by Route 53.
So this was an optional step at the start of the course. If you did do that then you should have a domain name in Route 53.
If you didn't do that then you won't be able to do this demo and you just need to watch me perform the steps.
If you do have your own domain name configured inside Route 53 then you can perform this demo.
Now the first step that you need to do is to decide on a name that you're going to use with the CloudFront distribution.
In my case I'm going to use Merlin.animalsforlife1337.org.
Now you can pick the same or different name, so Merlin or something else.
To keep things consistent I would recommend you also using Merlin.
Now your domain name will be different so when you see me use Merlin.animalsforlife1337.org.
You need to use something different.
So to get started click in the search box at the top and let's go ahead and move back to CloudFront.
So open that in a new tab because we're going to need to come back to Route 53 before we finish this demo.
Once you're at the CloudFront console then click on the distribution ID and click on edit.
Now we need to enter the name that we're going to use into this alternate domain names box.
And to get that box you need to click on add item.
So in my case I'm going to use Merlin.animalsforlife1337.org.
You'll obviously be picking something different.
It might be Merlin. and then your domain name or you might be picking something different.
But what we need to do first is to register a certificate to use for this process.
So go ahead and click on request certificate.
Pick request a public certificate and then click next.
And into this domain name box you need to type the name that you want the certificate to provide verified encryption in transit for.
So in my case I'm going to use Merlin.animalsforlife1337.org.
So this is the name that's going to be on the certificate.
This is what your users are going to use to access the CloudFront distribution in order to see the shield icon and benefit from the safety around using SSL.
So in order for everything to be verified, to get the shield, not to get any warnings, this name needs to match the name on the certificate.
That needs to match the DNS name and that needs to match the certificate that's on the CloudFront distribution.
They all need to align.
You need to put your own fully qualified domain name into this box.
You'll need to verify that you own the domain.
So ACM will only issue certificates for domains that you own or control.
Now it needs a way to verify that you do own or control this domain.
You can either use email validation or you can use DNS validation which is much easier.
With DNS validation you'll be given a DNS record that you need to add inside your domain and once it's added Route 53 will be able to query that
and if it can see that record it knows that you control the domain.
So that's what we're going to use, DNS validation.
So select DNS validation, we can leave everything else as is and click on request.
Now if the domain is hosted elsewhere this is much more complicated but if it's hosted inside Route 53 then we can click refresh,
open the certificate and click create record in Route 53 and this is going to create this record, it's a CNAME record with this value
and this will be created within our Route 53 domain.
So let's do this, let's go ahead and create that record by clicking on create records
and just to demonstrate if I go back to the Route 53 console and then go inside my Animals for Life hosted zone
then you'll be able to see this record that's just been created by ACM and this is how ACM is going to verify that I control this domain.
So I'm going to go back to the ACM console and then let's refresh and sometimes it takes a few minutes to verify ownership of this domain.
In my case it's gone straight to issued but it can take anywhere up to about 15 or 20 minutes.
If it takes significantly longer than this, this points to an issue with your domain,
perhaps it's not configured properly or isn't properly delegating at Route 53.
So if it takes longer than 20 minutes you should probably start to worry and evaluate whether you have a misconfiguration.
In my case the configuration's fine, it's verified my control or ownership of this domain and the certificate has been issued.
So now I can go back to CloudFront, then I can click on the refresh icon to the right side of the custom SSL certificate drop down.
Once that's done I can click in the drop down and select the certificate that I've just generated.
You should do the same and then just make sure that the name that you've entered inside alternate domain name matches the name on this certificate.
Now we can leave everything else as default because we generally won't need to support legacy clients.
As long as clients support Server Name Indication or SNI then we don't need to pay any extra.
We can leave everything as default, scroll down to the bottom and click on save changes.
And this will deploy this certificate and configuration out to the entire CloudFront network,
so all of the edge locations that are servicing our distribution.
Now if we just click on CloudFront distributions it will show us deploying and we need this to move away from deploying before we can continue.
So go ahead and pause the video and resume once this deployment completes.
So that's now deployed and in my case that took about 15 minutes so your deployment time might vary.
It could be quicker or it could be slower.
Once it's deployed though we can go to the Route 53 console, click on hosted zones, select your hosted zone.
Then we're going to create a record.
You can choose to switch either between the wizard or the quick create screen depending on what your level of experience is with Route 53.
For this demo let's just use the wizard.
We're going to use simple routing because we just want to create a single record that points at a single resource.
So click on simple routing and then next.
Go ahead and click on define simple record.
You need to name this record the same as what we just created the certificate for.
So in my case it's Merlin and then .animalsforlife1337.org.
But that part's already specified so we just need to specify the record name which is Merlin.
And then in this drop down, so value route traffic to, just go ahead and pick alias to cloud front distribution.
Make sure that the region is set to US East Northern Virginia and then if you click in the choose distribution drop down you should see your cloud front distribution.
So select it from that list.
If you don't see it then just maybe leave it 10 or 15 minutes more but do make sure that you have US East Northern Virginia selected.
And make sure the name you're using is the same as the one that you added to the cloud front distribution and the same as the one that you defined on the SSL certificate.
Once you've done that you can pick for the record type either A or AAAA.
Obviously A is for IP version 4 and then AAAA is for IP version 6.
We're going to use IP version 4 for this demo so make sure it's just an A record type.
And then click on define simple record and then click on create records.
Now that's going to take a few moments but then you will have the record within your hosted zone and then depending on the DNS system which can be relatively varied you should then be able to open a new tab and browse to this name.
So in my case I'm going to open a new tab and then browse to https://merlin.animalsforlife1337.org
And this is now being loaded from cloud front using HTTPS using the custom name and the custom SSL certificate that you've created using ACM.
And that's the process that you need to follow with all cloud front distributions whenever you want to add custom naming and custom SSL.
Now at this point that's everything that you need to do in this demo lesson.
Because our usage of cloud front and the ACM certificate all fall under the free tier we're not going to do an infrastructure clean up.
Instead we're going to leave all of this infrastructure within our AWS environment because we're going to be using it within the next demo lesson.
Now don't worry if you couldn't complete this demo lesson because you don't have your own registered domain in Route 53 the following demo lesson while it will be using this infrastructure won't rely on having SSL configured.
So in either case you can leave everything in place in your account and continue with that infrastructure straight away in the next demo lesson.
At this point though that's everything you need to do so go ahead and complete this video and when you're ready I'll look forward to you joining me in the next.
