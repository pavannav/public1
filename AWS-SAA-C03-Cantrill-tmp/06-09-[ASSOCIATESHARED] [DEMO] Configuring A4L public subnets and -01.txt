Welcome back. This is part two of this lesson.
We're going to continue immediately from the end of part one,
so let's get started. Now the only thing that remains is just to test out this
configuration.
And to do that we're going to launch an EC2 instance
into the WebA subnet. So click on Services
and just type EC2 to move across to the EC2 console.
Now once we're on the EC2 console just click on
Launch Instance. Then you'll be taken to the Launch Instance console
into the name box just go ahead and type A4L
hyphen bastion. Scroll down and we're going to create
a bastion instance using Amazon Linux. So click
on Amazon Linux. In the drop down below go ahead and select the latest version
of Amazon Linux. Just make sure that it does say free tier
eligible on the right of this drop down. Assuming that's all good
just below that make sure that in the architecture drop down
it's set to 64 bit x86.
Moving down further still, under instance type
just make sure that this is set to a free tier eligible
instance. It should default to t2.micro
or t3.micro. Depending on your region
either of these could be free tier eligible. In my case it's t2.micro
but whatever yours shows just make sure that it's similar sized and says
free tier eligible. Now directly below that
under key pair just click in this box you should
at this point in the course have a key pair created
called A4L. If you do go ahead
and select that key pair in the box. If you don't
don't worry you can just go ahead and click on create
new key pair. Enter A4L into the key pair name
select RSA and then select PEM for the private key format
and click on create key pair. This will download the key pair to your local machine
and then you can continue following along with this video.
So select that from the drop down. Directly below
under network settings click on edit. This instance is going to go into the
animals for life VPC. So click on the VPC drop down
and select A4L-VPC1
Directly below that click in the subnet drop down
and we want to go ahead and look for SN-WEB-A
so select the WEB-A subnet. This should change
both of the drop downs below so auto assign
public IP and auto assign IPv6 IP
to enable. So just make sure that both of those are set to enable.
Directly below this make sure that create security group
is checked. We're going to create a new security group
under security group name just go ahead and enter A4L-bastian-sg
and then put that same text in the description box directly below.
Now all of these defaults should be good just make sure it's set to
SSH, source, anywhere. Make sure that 0.0.0.0.0
and double colon forward slash 0 are both
present directly below source. Everything else looks good
we can accept the rest of the defaults just go ahead and click
on launch instance. Then click on instances
at the top left of the screen and at this point the instance is launching
and we'll see that A4L-bastian is currently running
we'll see the status check is showing initializing so we need to give this
instance
a few minutes to fully provision. So go ahead and pause this video
and we're going to resume it once this instance is ready to go
and it has two out of two status checks.
So our instance is now showing two out of two
status checks and that means everything's good and we're ready to connect.
Now if you select the instance you'll see in the details pane below how it has a
public
IP version 4 address, a private IP version 4 address,
public and private IP version 4 DNS and if we scroll down
you'll see lots of other information about this instance. Now we're
only concerned with the public IP version 4 address.
We're going to go ahead and connect to this instance this time using a local
SSH client on our machine. So right click
and then select connect. Now if we want to quickly connect into this instance we can
choose to use
EC2 instance connect which is a way to connect
into the instance using a web console. Now this does need an instance with a
public
IP version 4 address but we have
allocated a public address so if we wanted to we can just make sure that the
username is correct it should be
EC2-user. If we hit connect it will
open up a connection to this instance
using a web console and this is often much
easier to connect to EC2 instances if you don't have access to a local
SSH client or if you just want to quickly connect to perform
some administration. We can also connect with an
SSH client. If we select SSH client
it gives us the commands to run in order to connect
to this EC2 instance. So right at the bottom is an example
so SSH we pick the key to use
and then we pick the user at and then the public
IP version 4 DNS. So if we copy that
into our clipboard and then move across to our terminal
or command prompt, move into the folder where you downloaded
the SSH keypair into in my case downloads
and paste in that command and press enter that should connect us to the EC2
instance.
We'll have to verify the fingerprint so we need to verify the
authenticity of this host. For this purpose we can just go ahead and answer yes and
press
enter. Now if it's the first time we're connecting
using a particular key and if you're running
either macOS or Linux you might be informed
that the permissions on the key are too open. In this case
the permissions are 0644 which are too
open and we get this error. Now it's possible to correct that if we move back
to the AWS console
it also gives us the command to correct these permissions
so chmod space 400 space
and then the name of the key. So I'm going to copy that into my clipboard and move
back to my terminal
paste that in and press enter and that will correct
those permissions. Now if I get the connection command
again so copy that into my clipboard and this time I'll paste it in and press
enter and now I will be connected to this
EC2 instance. Now if you're doing this demonstration on Windows 10
you probably won't have to correct those permissions
this is something specific to macOS or Linux.
So whenever you're connecting to EC2 instances which have a public
IP version 4 address you've always got the ability to use
either EC2 instance connect or a local
SSH client. Now the third option which is session manager
this is a way that you can connect to instances even if they don't have
public IP version 4 addressing
and I'll be detailing this product fully later on in the course because there is
some additional configuration that's required. Now this bastion host
it's an EC2 instance and it does fall under the free tier
so because it's a T2.micro or whatever type of instance you picked which
falls
under the free tier you're not going to be billed for any
usage of this instance in a given month. Now as a general rule as you're moving
through the course
if you're ever intending to take a break then you always have the option
of deleting all the infrastructure that you've created within
a specific demo lesson. So most of the more complex demo lessons that you'll have
moving through the course
at the end of every demo lesson there will be a brief set of steps where I
explain
how to clean up the account and return it into the same state
as it was at the start of the lesson. But in certain situations I might tell you
that one option
is not to delete the infrastructure whether you do delete it
or not depends on whether you're intending to complete the next demo
straight away or you're taking a break. Now in this particular case I'm going to
demonstrate
exactly how you can clear up this infrastructure.
In the next demo lesson you're going to be continuing using this structure
but I'm going to demonstrate how we can automate the creation
using a cloud formation template. To clear up this infrastructure though go
ahead
and right click on this bastion host and select
terminate instance. You'll need to click terminate to confirm
and that will terminate and delete the instance. You won't be charged for
any further usage of that instance. We need to wait for that instance to fully
terminate so pause the video
and wait for it to move into a terminated state and then we can
continue.
So that instance is terminated and now that that's done
we can click on services and move across to the VPC console
and we're going to delete the entire Animals for Life
VPC and don't worry in the next demo lesson I'll explain how we can
automate the creation. So for now and in the course we're going to be using much
more
automation so that anything that you've done previously we're going to automate
the creation
and focus your valuable time only on the things that you've just learned.
So click on your VPCs. It should list two VPCs, the default one and the
Animals for Life
VPC. Select the Animals for Life VPC, click on actions
and then delete the VPC. Now this is going to delete
all of the resources that are associated with this VPC.
So the internet gateway, the route tables and all the subnets that you've created
as part of the demo lessons to this point in the course.
So go ahead and type delete and then click delete to confirm that process
and that will fully tidy up the account and return it into the same state
as it was at the start of the VPC section.
Now with that being said this is the end of this lesson. You've successfully
converted three subnets, so Web A, Web B
and Web C to be public and you've done that by creating an internet gateway,
associating that with the VPC, creating a route table,
associating that with those subnets, adding two routes,
pointing those routes at the internet gateway and then configuring those subnets
to allocate
a public IP version 4 address to any resources launched
into those subnets. So that's the same set of steps that you'll need to do
to make any subnets public from an IP version 4 perspective
in future. So this is going to be the same tasks that you would use in larger
production projects,
although in production you would probably automate it and I'm going to
show you how to do that
as you move through the course. Now at this point you've finished
everything that you need to do in this demo lesson, so great job
you've actually created something that is production ready
and production useful. Over the remainder of this section of the course
we're going to refine the design that we've got and add
additional capabilities. So in the upcoming lessons I'll be talking
about network address translation and how that can be used to give private
EC2 instances access to the internet for things like software updates,
we'll be talking about the security of subnets using network access control
lists
known as NACLs and much much more, but you're doing a fantastic job
so far. This is not a trivial thing that you've implemented to this point
so really great job. But at this point just go ahead and complete the video
and then when you're ready I'll look forward to you joining me in the next.
