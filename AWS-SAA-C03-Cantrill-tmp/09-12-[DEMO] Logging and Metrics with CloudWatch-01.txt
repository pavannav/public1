welcome back this is part two of this lesson
we're going to continue immediately from the end of part one
so let's get started so let's go back to the instance now
just press enter a few times to make sure it hasn't timed out that's good
now there's a small bug fix that we need to do before we move on the cloud watch
agent expects a piece of system software to be installed
called collect D and on Amazon Linux that
is not installed so we need to do two things the first
is to create a directory that the agent expects to exist
so run that command and the second is to create
a database file that the agent also expects to exist and we can do that by
running
this command now at this point we're ready to move on to the final step
so we've installed the agent and we've run the configuration wizard
to generate the agent configuration and this is now safely stored
inside the parameter store the final step
up the cloud watch agent and provide it
with the configuration that stored inside the parameter store
and by doing that the agent can access the configuration can download it can
configure
itself as per that configuration and then because we've got an attached
instance role that has the permissions required it can also inject
all the logging data for the web server and the system
into cloud watch logs so the final step is to run this command
so this essentially runs the Amazon hyphen cloud watch hyphen
agent hyphen CTL and it specifies a command line option to fetch the
configuration
and it uses hyphen C and specifies
SSM colon and then the parameter store parameter name
essentially what this command does is to start up the agent pull the config
from the parameter store make sure the agent is running and then it will start
capturing that logging data
and start injecting it into cloud watch logs
so at this point if it's functioning correctly what you should be able to do
is go back to the AWS console go to services
type cloud watch and then select cloud watch to move to the cloud watch console
then if we go to log groups now you might see a lot of log groups here
that's fine every time you apply
the animals for life VPC templates it's actually using
a lambda function which we haven't covered yet to apply
an IP version 6 work around which I'll explain
later in the course when we cover lambda what you should find though is if you
just scroll down
all the way to the bottom you should see either one
two or three at the log groups that we've created
in this example on screen now you can see that I have
slash var slash log slash HTTBD
slash error underscore log now these logs will start to appear
when they start getting new entries and those entries are sent
into cloud watch so right now you can see that
I only have the error log now if you don't see
access underscore log what you can do
is go back to the EC2 consoles select the WordPress instance that you've
created
using the one click deployment and then copy the public
IP version 4 address into your clipboard don't use this link
just copy the IP address and then open that in a new tab
now by doing that it will generate some activity
within the Apache web server and that will put some log
items into the access log and that will mean
that that logging information will then be injected
into cloud watch logs using the cloud watch agent
so if we move back to cloud watch logs and then refresh
scroll down to the bottom now we can see the
access underscore log file open the log stream for the CC2 instance
this log file details any accesses
to the web server on the CC2 instance you won't have a lot of
entries in this likewise if you go back to log groups
and look for the error log that will detail any
errors any accesses which weren't successfully served
so if you try to access a web page which doesn't exist if there's a server error
or any module errors these will show inside
this log group now also because we're using the cloud watch
agent we also have access to some metrics inside the EC2 instance that we
otherwise would not have had
if we click on metrics and just drag this up slightly so we can see it
you'll see the AWS namespaces so these are namespaces with metrics
inside that you would have had access to before
but they'll also be the CWAgent namespace
and inside here just maybe select the image ID
instance ID instance type name inside that
you'll see all of the metrics that you now have access to
because you have the cloud watch agent installed on this
EC2 instance so these are detailed operating system
level metrics such as disk, IO, read
and write and you would have not had access to these before
installing the agent if we select another one image ID
instance ID instance type CPU we'll be able to see the CPU
cores that are on this instance together with the IO weight
and the user values again these are things that you would not have had access to at
this level of detail
without the cloud watch agent being installed
now I do encourage you to explore all of the different
metrics that you now have access to as well
as to how the log groups and log streams look with this
agent installed but this is the end
of what I had planned for this demo lesson so as always we want to clear up
all of the infrastructure that we've created within this demo lesson
so to do that I want you to move back to the
EC2 console right click on this instance
go down to security select modify
IAM role and then remove the cloud watch role
from this instance you'll need to confirm that by following the instructions so to
detach that role
then click on services and move back to IAM
click on roles and I want you to remove the cloud watch role that you created
earlier in this demo so select it and then click
delete role you'll need to confirm that deletion
what we're not going to do
is delete the parameter value that we've created so if we go to services
and then move back to systems manager go to parameter store
because this is a standard parameter this won't
incur any charges and we're going to be using this
later on in future lessons of this course
and other courses so this is a standard configuration for the cloud watch
agent which will be using elsewhere in the course so we're going to leave this
in place the last piece of clean up that you'll need to do
is to go back to the cloud formation console you should have the single
CW agent stack in place that you created at the start of the demo
using the one click deployment go ahead and select this stack
click on delete and then confirm that deletion and once that's completed
all of the infrastructure you've used in this demo will be removed
and the account will be back in the same state as it was
at the start of this demo now that's everything that I wanted you to do
in this demo I just wanted to give you a brief overview
of how to manually install the cloud watch
agent within an EC2 instance now there are other ways to perform this
installation
you can use systems manager or bake it
into AMIs or you can bootstrap it in using the process that you've seen
earlier in the course we're going to be using the cloud watch
agent during future demos of the course to get access to this rich
metric and logging information so most
of the demos which follow in the course will include the cloud watch
agent configuration at this point though that is
everything I wanted you to do in this demo go ahead complete this video
and when you're ready I look forward to you joining me in the next
