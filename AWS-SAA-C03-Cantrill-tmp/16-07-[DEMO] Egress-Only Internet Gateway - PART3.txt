Welcome back and welcome to part 3, which is the last part of this demo series.
And in this part of the demo series, you're going to create an egress-only internet gateway,
which is going to allow this private EC2 instance to use its allocated IPv6 addressing
to communicate out with the public IPv6 internet and receive responses,
but won't allow any IPv6 IP address to initiate communications with this EC2 instance.
So let's move back across to the EC2 console and we'll implement this final piece of configuration.
Now I'll just clear the screen to make it a little bit easier to see.
And one way that we can verify whether we have IPv6 connectivity is to run this command.
So ping space hyphen six space and then ipv6.google.com.
And if we run that command, we'll be able to see that it's pinging an IP version six DNS name
with an IP version six IP address shown on the right hand side of the output.
So we don't get a response.
So we know that this instance is unable to ping using IP version six.
And that's logical because currently this VPC has no IP version six gateway object
that's created and configured so this instance can use it.
So press control C just to escape out of this command and move back to the AWS console.
Now we need to be in the VPC console
and we need to be in the egress-only internet gateway section on the left hand side.
So select egress-only internet gateways.
And then I want you to click on create egress-only internet gateway.
So call this one A4L IPv6.
Just like normal internet gateways, they're created and associated with a specific VPC.
So click on the drop down and make sure that you select the A4L hyphen secret VPC.
So select that and click on create.
And that creates the egress-only internet gateway
and associates it with the animals for life secret VPC.
So if we move back across to the EC2 console and again try to run a ping space hyphen six,
we still don't get a ping response.
Now that's because even though we have the gateway created and associated,
we still need to configure the routing to allow the VPC router to direct traffic flow toward it.
So again, CTRL C out of that command.
Move back to the VPC console and go ahead and click on route tables.
Now scroll to the right and again we're only focusing on ones
that are associated with the A4L hyphen secret VPC.
I want you to make sure that you pick the main route table for this VPC.
So there should only be one main route table for the animals for life VPC.
Don't mistakenly pick the other main route table.
You want to make sure that you're using the one for the A4L hyphen secret VPC.
So select that one and then click on routes.
Now if it's the correct one, it should still have the prefix list added to it
from the earlier part of this demo series.
If it does, go ahead and click on edit routes and we need to add a default IP version six route.
So click on add route.
The way of specifying default routes for IP version six is colon colon forward slash zero,
which references all IP version six IP addresses.
Now the target for this needs to be the egress only internet gateway.
So go ahead and click on the drop down.
Select egress only internet gateway from the list.
It should only show one, which is the one that you've just created.
So go ahead and select that.
So that's now set as the target for this route.
And it means that when the VPC router encounters any traffic
leaving any of the subnets that this route table is associated with.
If there are no other IP version six routes that apply, it will use this capsule
and it will direct that traffic towards the egress only internet gateway.
So go ahead and click on save to commit that route to the route table.
The VPC router will now be using that route on that route table.
And it means that if we go back to the EC2 instance
and rerun this previous command, now we'll get a ping response from ipv6.google.com.
And the reason why we're getting that ping response
is because we've now configured the route table on the subnet that this instance is in.
This instance already has an IP version six allocation on it.
Because this route table has been configured,
the VPC router will direct the traffic flow through itself,
through to the egress only gateway.
And that will allow connectivity to any IP version six hosts on the IP version six internet.
And crucially, because it's a stateful device,
because the egress only internet gateway understands traffic state,
it will allow the responses from the ping test host back to the EC2 instance.
And that's everything that you needed to do in the third and final part of this demo series.
And all that remains is for us to tidy up from this series of demo lessons.
So to do that, go back to the VPC console and click on endpoints.
And we need to delete both of these endpoints that we've created during this demo series.
So select the private S3 endpoint first, click on actions and delete and confirm that deletion.
And then select the EC2 instance connect endpoint,
click on actions and delete and confirm that deletion.
Now that will take a few minutes to delete.
It will immediately move into the deleting state.
And once it's completed, it will vanish from this list.
While that's deleting, click on services,
type in S3 and then open that in a new tab.
Locate the bucket that we uploaded the object to.
So it should say A4L secret VPC hyphen bucket.
So select it and click on empty.
You'll need to copy and paste or type permanently delete into the field and then click on empty.
That will empty the bucket of all its contents
and that will allow the cloud formation stack to delete that bucket automatically when we delete it.
You'll also need to delete the egress only internet gateway.
So select that in the VPC console, select the gateway that you created,
click on actions and then delete,
type delete and then click on delete egress only internet gateway to complete the deletion.
Then just go back to endpoints and refresh
and make sure that you have no endpoints listed in this screen.
If you do, we just need to wait until any of the remaining endpoints vanish.
Now it's gone.
Now we can click in the search box and type cloud formation.
Then click on that to move to the cloud formation console.
Click on A4L secret VPC which is the stack we created at the start using the one click deployment.
Click on delete and then confirm that deletion.
Now I hope you've enjoyed this series of demos.
You've actually performed some fairly complex steps.
You've created both a gateway and an interface endpoint.
You've configured the VPC configuration to allow you to interact with those public space services
without having any public addressing
and you've created an egress only internet gateway.
So that's three fairly complicated tasks that I know will benefit you in the exam.
But at this point, that's everything.
So go ahead and complete the video.
And when you're ready, I look forward to you joining me in the next.
