Welcome to this lesson where I'm going to be introducing CloudTrail.
CloudTrail is a product which logs API actions which affect AWS accounts.
If you stop an instance, that's logged. If you change a security group, that's logged too.
If you create or delete an S3 bucket, that's logged by CloudTrail.
Almost everything which can be done to an AWS account is logged by this product.
Now I want to quickly start with the CloudTrail basics.
The product logs API calls or account activities and every one of those logged activities is called a CloudTrail event.
A CloudTrail event is a record of an activity in an AWS account.
This activity can be an action taken by a user, a role or a service.
Now CloudTrail by default stores the last 90 days of CloudTrail events in the CloudTrail event history.
This is an area of CloudTrail which is enabled by default in AWS accounts.
And it's available at no cost and provides 90 days of history on an AWS account.
Now if you want to customize CloudTrail in any way beyond this 90 day event history, you need to create a trail.
And we'll be looking at the architecture of a trail in a few moments time.
Now CloudTrail events can be one of three different types.
We have management events, data events and insight events.
Now if applicable to the course that you're studying, I'll be talking about insight events in a separate video.
For now we're going to focus on management events and data events.
Management events provide information about management operations that are performed on resources in your AWS account.
These are also known as control plane operations.
Think of things like creating an EC2 instance, terminating an EC2 instance, creating a VPC.
These are all control plane operations.
Now data events contain information about resource operations performed on or in a resource.
So examples of this might be objects being uploaded to S3 or objects being accessed from S3.
Or when a Lambda function is being invoked.
By default CloudTrail only logs management events because data events are often much higher volume.
Imagine if every access to an S3 object was logged. It could add up pretty quickly.
Now a CloudTrail trail is the unit of configuration within the CloudTrail product.
It's a way you provide configuration to CloudTrail on how to operate.
A trail logs events for the AWS region that it's created in.
That's critical to understand. CloudTrail is a regional service.
But when you create a trail it can be configured to operate in one of two ways.
You can create a trail which is a one region trail or a trail can be set to all regions.
Now a single region trail is only ever in the region that it's created in.
And it only logs events for that region.
An all region trail you can think of as a collection of trails in every AWS region.
But it's managed as one logical trail.
And it's got an additional benefit that if AWS adds any new regions then an all region trail is automatically updated.
Now there's a specific configuration item on a trail which determines if it only logs events for the region that it's in.
Or if it also logs global services events.
Now most services log events in the region where the event occurred.
So if you create an EC2 instance in AP Southeast 2 then it's logged to that region.
And a trail would either need to be a one region trail in that region or it would need to be an all regions trail to pick up that event.
A very small number of services log events globally to one region.
So global services such as IAM or STS or CloudFront, these services are very globally focused services.
And they always log their events to US East 1 which is Northern Virginia.
Now these type of events are called global service events.
And a trail needs to have this enabled in order to log these events.
This feature is normally enabled by default if you create a trail inside the user interface.
So this is really critical to understand.
AWS services are largely split up into regional services and global services.
So when these different types of services log to CloudTrail they either log in the region that the event is generated in or they log to US East 1 if they're global services.
So when you're diagnosing problems, when you're architecting solutions, if whatever logs you're trying to reach are generated by services which are global,
so IAM, STS and CloudFront, then these are going to be classified as global service events and that will need to be enabled on a trail.
Otherwise a trail will only log events for that isolated region that it's created in.
And when you create a trail, it's one of two types.
One region, so it is always isolated to that one region and you would need to create one region trails in every region if you wanted to do it manually.
Alternatively you could create an all regions trail and that encompasses all of the regions in AWS and it's automatically updated as AWS add new regions.
Now once you've got a trail created, management events and data events are all captured by the trail.
And this is based on whether it's isolated to a region or set to all regions.
But if we keep focused on an all region trail for now, then this trail is now capturing management events and if we enable it, data events.
So data events is not something that's generally enabled by default.
It's something you have to explicitly set when you create a trail.
So this trail is now listening to everything that's occurring in the account.
If it's an all region trail and it's got global services event logging turned on as well, it's listening to everything that's happening in the account.
Now remember that the cloud trail event history is limited to 90 days.
But when you create a trail, you can be much more flexible.
A trail by default can store the events in a definable S3 bucket.
And the logs which are generated and stored in an S3 bucket can be stored there indefinitely.
You're only charged for the storage that's used in S3.
Now these logs are stored as a set of compressed JSON log files and so they consume hardly any space.
But they have the benefit because they're JSON formatted of being able to be passed by any tooling capable of reading these standard format files.
So that's a really great feature of cloud trail that it stores this information in a fairly standard format.
Now another option is that cloud trail can be integrated with cloud watch logs and the data can be stored into that product.
So cloud trail can take all of the logging data that it generates and in addition to putting it into S3, it can put it into cloud watch logs.
And once it's in cloud watch logs, you can use that product to search through it or using a metric filter to take advantage of the data that's put into cloud watch logs.
It makes it much more powerful and you get access to a lot more features if you use cloud watch logs versus S3.
Now one of the more recent additions to the cloud trail product is that you can now create an organizational trail.
And this means if you create this trail from the management account of an organization, it can store all of the information for all of the accounts inside that organization.
So it's a single management point for all API and account events across every account in the organization.
So that's super powerful and it makes managing multi-account environments much easier.
So we need to talk through some important elements of cloud trail point by point.
So cloud trail is enabled by default on AWS accounts, but it's only the 90-day event history that's enabled by default.
So you don't get any storage in S3 unless you configure a trail.
Trails are how you can take the data that cloud trails got access to and store it in better places such as S3 and cloud watch logs.
Now the default for trails is to store management events only.
So this only includes management plane events, creating an instance, stopping an instance, terminating an instance, creating or deleting S3 buckets, logins to the console.
Anything that's interacting with AWS products and services from a management perspective is logged by default in cloud trail.
Data events need to be specifically enabled and they come at an extra cost.
I'll talk about that in a little bit more detail in the demo lesson because you need to be aware of the pricing of cloud trail.
Much of the service is free, but there are certain elements that do carry a cost that you do need to be aware of, especially if you use this in production.
Now most AWS services log data to the same region that that service is in.
There are a few specific services, IAM, STS and CloudFront, which are classified as true global services,
and they log their data as global service events, which gets logged to US East 1, and a trail will need to be enabled to capture that data.
So that's critical. You might find that come up as an exam question.
What you will also definitely find coming up as an exam style question is whether you can use cloud trail for real time logging.
Well, this is one of the limitations of the product. It is not real time.
Cloud trail typically delivers log files within 15 minutes of the account activity occurring, and it generally publishes log files multiple times per hour.
What this means is it's not real time.
You can't trust that logging into cloud trail will give you a complete exhaustive list of events that have happened up to the very point that you're looking.
Sometimes it does take a few minutes for that data to arrive in S3 or for that data to arrive in CloudWatch logs.
So keep that in mind. If you face any exam questions which talk about real time logging, cloud trail is not the product.
OK, so that's the end of the theory in this lesson. It's time for a demo.
In the next lesson, we're going to be setting up an organizational trail within our AWS account structure.
We're going to be setting it up so it's capturing all of the data for all of our member accounts and our management account.
And it's going to be storing this data in an S3 bucket and CloudWatch logs within the management account.
Now, I can't wait to get started. It's a fun one, and it's something which will prove very useful for the exam as well as real world usage.
So go ahead, complete this video, and when you're ready, you can join me in the demo lesson.
