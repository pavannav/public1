# 30.2 Step-02- Deploy Cluster Autoscaler and Verify

-: Welcome back.So we are looking into cluster autoscaler now.So which is nothing but17 EKS auto scaling cluster autoscaler.So as part of its step two we are going to verifywhether our node group whatever we havehas the ASG access or not, right?So we have created our recent node groupwhich is nothing but inside the private subnetsas part of 07 sectionwhich is ELB classic and then network load balancers.So inside that we have created a private node group.So when we created a private node groupso we have ensured thatso we have the ASG access enabled.So what does ASG access enable mean?Auto scaling group access and its equivalent rolesor its equivalent policies will be associatedto the node group role.In the same waywhenever we created our public subnet alsomeans like public subnet related node group initially also,we ensured that we are following the standardswherein our respective node group,whatever we created in EKS clusteralways will have the standard stuff.So if you see here, here alsofor our public node group also we ensured thatwe created the ASG access.So that's about it.So now let's come back to our section herewhich is 17 and in step two,so we verify that ASG access is enabled.So that's what from command perspective,but let's go back to our management consoleand go to our EC2, right?So that is what this step outlines, okay?So whether we have that respective inline policyassociated with our node group, IAM rule.So running instances,so we have two EC2 instances available here,running for our EKS cluster.And if you go here, the IAM role, right?So this is the IAM role and if you go inside thatand if you see, there will be a inline policies added. Okay?So one is for ingress, one is for app meshone is for auto scaling, right?So this is for external DNS.So if you see herethis is the one whatever you are seeing policy auto scaling.So this is the one whatever we have given for our ASG accessit auto associated here. Okay?So for this node, for this node IAM rolenode group, IAM role,this respect to policy auto scaling has been associated.So we are good with that step now. Okay?So now we are going to move on with thedeploying our cluster autoscaler in step three.So there is a direct link available from Kubernetes.How to install the cluster autoscaler,which is nothing butthis is the cluster autoscaler auto discover.yaml.So the same concept, whatever regular Kubernetes supplies,the same is also associated with theelastic Kubernetes service which is EKS.So the same component we can use here.So and we are using the master thing so that alwayswe'll use the latest cluster autoscaler stuff.So let me copy this.So deploy the cluster autoscaler to your cluster.So let me come here and I'm going to come outand then go to 17 and then be ready there.And anyway, this is from the URL we are deploying.We really don't need to worry.So kubectl apply -f and thenI'm installing the cluster autoscaler auto discover.yaml.So it is creating the equivalent service accountroll bindings and then deployment and all the stuff.So let me clear this.And now,are the cluster autoscaler cf2 evictannotation to the deployment. Okay?So which is false, it will be there by default.So we need to add this annotation. Okay?So let me copy this and then paste it, right?So it's getting updated.So let's wait for it to get updated.So we have annotated it.So the next step is to edit thecluster autoscaler deploymentto add cluster name and then two more parameters.So in our cluster name fieldmeans like before change it is going to look like thisyour cluster name.So there we are going to give our cluster name as EKS demo1.So whatever we have created.So you can even say eks ctl let get clustersto get our cluster name also,which is nothing but EKS demo1. Okay?So this is one changeand we are also going to add two more parameters, okay?To our cluster autoscaler deployment.So we need to add those informationat this respective locationunder spec containers under command,so we are going to add this whatever is there withnode group auto discovery information there.For the cluster name value, we are going to put EKS demo1and these two additional parameters we are going to add.So how we are going to do thatusing kubectl edit deployment.So if you see here kubectl and namespace is kube systemand the deployment name is cluster autoscaler.So let me copy this command and paste it here, okay?And once we go inside that, so we'll start fromand so shift G will take,escape shift G will take me to the end of fileand I'll go little uplittle up, little up, so you can see it here, right?So the cluster name,so here we need to provide the cluster name.So let me click on insertand I'll go back, back, back, back, back like this, right?(keys clanging)And I'll say EKS demo1 and enter.I will also copy two more thingswhich is balance similar node groupsand then skip nodes with system ports false, okay?So I'm going to also paste those things.Okay, so now I added two more parameters here,in addition to my cluster name change. Okay?So now let me save this and my deployment got editedwhich means kubectl get pods -n kube systemif you see there, okay?So existing cluster autoscaler will get terminatedand the new one will get creating from seven seconds.You can see this, right?So that's a good thing. Okay?So now next thing is to set the cluster autoscaler imagerelated to our current EKS cluster version. Okay?So our EKS cluster we are using is 1.16. Okay?So if we go hereand then go to elastic Kubernetes service, right?So if we go here, we can find our clustersand see, we can see 1.16 is our cluster version, okay?And the new Kubernetes version is available for this clusterand if you want we can even update it.So if we can click on thisand then 1.7 is available now, 1.17.If you want we can upgrade this cluster to 1.7.I'm not going to do anything now, just I'll cancel thisand then my version is 1.16 as part of 1.16.So I need to find the cluster autoscaler version also1.16.minor version, whatever latest available.That will be my image version here. Okay?So I'll go to this link here, right?And open it.And if you see here, so these are add on resizers.So let me go down.So this is vertical pod autoscaler pre-release stuff.So let me go down.So if you see here cluster autoscaler 1.18, this is okay,so let me go down, cluster autoscaler 1,17.2and now here is the cluster autoscaler1.16.5 is the latest in 16.x versions. Okay?So we can use 1.16.5 now. Okay?So that is what I also mentioned here.So we need to update that using this command.So at the end, whatever the version is thereyou can put it here.So xy.z you can see here, right?So mine is 1.16.5and then kubectl set image deploymentwhich we have seen in our earlier demos also.So which is related to rollout changes demowe have seen this. Okay?So with set image how you can update yourrespective deployments image version. Okay?So we'll copy this and then run itso that it will update the version to v.1,16. Okay?So our deployment is updated.So verify if for image version got updated. Okay?So using kubectl get deploymentand then export with yaml, so we can see that. Okay?So let me clear this and past it here. Okay?And if you see, go here.See, now our image is v1.16.5.It looks good. Okay?So that's good.So now this completes the step sixand then now we are moving onto step sevenwhich is verifying our cluster autoscaler logs. Okay?So let me copy this and then clear this outand then paste it. Okay?So now, if you see thatstart refreshing cloud provider instancesand we really don't see any issuesrelated to our this thing.Locks look good.So let's wait for a minute or less than thatto see if any issues we have. Okay?Node group means reached and all these thingsthese are standard logs, okay?So we really don't need to worry.So zero other pods unschedulables, you can see right?The sample logs you can seeand then the same we can see it here.No schedulable,no schedulable pods are no unschedulable pods,calculating unneeded nodes, all these things,it is doing it. Okay?So in our next lecturewe'll focus on deploying the sample appand then cluster scale up and then scale in,we are going to look into.So I'll see you in the next lecture.Until then, bye bye. Thank you.