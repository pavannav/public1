# 31.4 Step-04- CloudWatch Log Insights in Depth

-: Welcome back.In this lecture, we are going to understand aboutLog Insights in depth from container insightsperspective for EKS cluster, right?So we are going to look into log groups, Log Insightsand then create a performance dashboard for us, okay?So let's go back to CloudWatch Management Consoleand if you go to logs here,so we'll have something called Log Groupsand then Log Insights, okay?So, on a very high level we have seen Log Insightsin our previous lecture, so we'll go in depthand then implement few of the things here, okay?So let's go to log groups hereand if you find, we can find following four log groupsrelated to container insights for our EKS demo one cluster.So one is for applications, one is for data planand one is for host and then one is for performance, okay?So primarily we are going to look into performanceand then application and then create few metricsfor those things, okay?Means like create dashboardsusing few of the filters inside the Log Insights, okay?So let's start with something calledcreate graph for average node CPU utilization, okay?So, now what we are going to do iswe are going to write a simple query heresaying that from Performance log group.we are going to get the information from stats section,average node CPU utilization as end by node nameand average node CPU utilizationusing descending order, okay?So we can copy this, right?And come here and then pastein the respective section here, editorand then select the log group as performance, okay?So in performance log group, we are going to run this queryand then see what happens, okay?So, node CPU utilization, so this is the one, okay?So average node CPU utilization value we are gettingby node name we said, okay?So by node name, so this is one nodeand this is one node, okay?So it is average CPU utilization is 3% for our both nodes.And if you want to get this,means like if you want this query informationto be listed on dashboard so that one more timewe really don't need to run this query, right?So we can save them, save them on our dashboardand then continuously monitor them.So I'll say add to dashboardand I'll create a new dashboard here, okay?So I'll create a new dashboardand I will say EKS performanceor we can say EKS demo one performance,just I'm saying EKS performance.So I'm going to create this oneand then I'm going to say bar chart for this, okay?So whatever is applicable based on these four widget types,you can select that one, okay?So I selected line and then when I preview,nothing is coming here, okay?So I selected stacked area, it also doesn't look good.And I checked log table, that looks good for meand if I want I can even use bar.Okay, so I'll say add to dashboard.So now this is added to the dashboard.So now the next thing is we'll go backand then add container restarts, okay?So from performance you can find somethingcalled number of containers restarted, okay?So as average by pod name, means like by pod nameand in a descending orderprovide that stats information, okay?So let's come here, so now you can see our graph here,average node CPU utilization is always three, okay?So now let's go back to our insightsand then add this also, okay?And select the log group as performance and run the query,we'll get a high level data and select it as a table, okay?So I said it is going to be a simple table widget typeand if you see here, none of the containers got restartedinside these things, okay?So now I'll say add dashboard and I'll select table, right?And this table is going to be there for mealways there, okay?So add to dashboard.Okay, so in last three hours there are no restarts.So like that we can see those things, okay?And we have one more thing here, node failures,if you are in a cluster,so count of node failures anything happen,you can create one more off type tableand CPU usage by container, okay?So I'm excluding node failures, anything you can do,so we can go and then add it also.So we can go to Log Insights and again, same drill, okay?Select the performance and copy thisand then run the query, okay?So cluster failed node countas count of node failures, okay?So we see zero, so nothing happened, okay?So I am not writing anything or adding it to dashboard.So I'll move on by CPU usage by counter,this is one important stat, right?CPU usage by container, right?Container CPU usage total, okay?So Q1 it is that container name.So if you see here, per container how the CPU is happening,will come to know.So we can see, right?So if you see here, CloudWatch agent is using this muchand then this much, this much, whatever it is using,we are getting the information.So I'll go and then add it to our this one, okay?So I'm going to add it as a bar chart also,we can add if you want, okay?So we can even add it as a barand to see which one is taking highest CPU also,so add to dashboard.And the next thing is let's come to Log Insightsand one more we have is pods requested versus pods running.So if you don't have the capacity,so the requested will be there but running will be thereand there will be also a pods pending alsoyou'll be able to see, right?So but we didn't request a huge amount of pods,so we really don't get that type of information here.But it's good to have such type of information also,means like that is provided in the performance.So you have requested hundred podsand only 10 pods are running right?So, like that, so FluentD only one part you requestedand then only one is running.So cube proxy, only one you have requestedand one only running, sample engine-x one you have requestedand only one is running, so like that, okay?So we can add this one also, add to dashboardand this is only a table data,so we can throw it under table or even a bar.So bar also we can see it looks good, okay?So I'll say add dashboard, right?So whatever you want, you can change it based on the widgetwhatever is available for you,means like whatever is flexible for you, okay?And the next one is we'll go back to Insightsand then we'll also add something called error, okay?So application log errors by container name.So this is from the log group application, okay?So any STD errors are there, those are going to log for us.So this is one more, okay?So very important one, so if you go here to applicationand then run the query,so you'll find those information here, okay?So if any errors are there, we'll come to know.So we can see there are some errors for few applications.So, and then you can add them as a bar chart, okay?So add to dashboard and you can even see logs tableand only in cube proxy you have 230and I can add it under bar and then add to the dashboard.So once we add all the metrics here to the dashboard,so click on Save Dashboard, okay?So if you don't click on Save Dashboard,so and then if you try to createanother dashboard or anything, it is going to have issues.So one important thing we need to know here is,so these information, right?These filters whatever I have broughtis from directly AWS documentation, okay?So you can click on this linkand you can find how you can use the container inside metricto create your custom dashboards from the log informationwhatever you brought from EKS using FluentD.So using that you can create all these metrics.So you can write whatever you want in parallel,means like on the CloudWatch console itself,so whenever you are creating the Log Insights, right?So you can find the fields here, okay?So let me also show that for you.So let me take any filter, so this is one filter, right?So let me, so go here and then in application logs, right?So let me make it bigger.So application and then run the query, right?So for this respective application related log group,so what all the fields available,so you will get here everything in detail.So using this information,discover the fields using for these logsinside this application log group,these fields are discovered and using these fields,whatever you want to write here, so filter by xyz,filter by docker container IDor filter by whatever you want,you can do using this discovered fields.So that's about it.So like this, you have now a custom dashboardin last one hour, what is my CPU usage?And in three hours, what is it are in from custom datefrom this minutes to these hours in custom dates also.You can have all this information now.So one time you have stored,one time you have written these queries and then stored itas a dashboard and then everything is available for youforever from EKS perspective, right?So in the same way, in our next lecture,we'll focus on creating the alarms, okay?So I'll see you in the next lecture.Until then, bye bye, thank you.