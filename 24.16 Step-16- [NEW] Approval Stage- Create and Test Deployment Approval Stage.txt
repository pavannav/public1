# 24.16 Step-16- [NEW] Approval Stage- Create and Test Deployment Approval Stage

Instructor: Welcome back.In this step,we are going to implement a manual approval stagebefore deployment and after build stage,we can add a additional approval stage.So once we approve, then only the deployment will happen.So for that purpose, we need to create a SNS topicand SNS subscription.So those things we are going to do now.Let's go ahead and then add a SNS topic now.So we'll say, SNS and simple notification service.And here we will go ahead and then create a new topic,and we'll try to click here on create topicand we'll create a standard topic.This is the topic name and this is the display name.And restore will try to put it as defaultsand inside this topic.So if you go inside this topic, you'll have subscriptions,and here we'll create a subscription.And protocol will select email.So this is the EKS DevOps topic one and protocol is email.And I'll try to use stacksimplify@gmail.comand click on create subscription.So you have the subscription created,now pending confirmation.So from EKS DevOps, topic one,you'll get a email like this.And when you click on this confirmed subscription, right?So this subscription will be confirmed.So let me, so it is in the pending confirmation,let me try to again, click on subscriptions.I have already confirmed the subscription.So this is confirmed.So you have created a topic,and for this topic you have also created a subscriptionwith an email ID.And you went to the email IDand then confirmed that subscription.Now let's come back to our pipeline,and we will edit the pipeline.And there we are going to add this manual approval.So after the build stage andbefore the deploy stage, which means here, add stage,and I will say, manual approval, or you just say, approval.That is fine, right?You can also say simply more relevantdeployment approval, okay?And click on add stage.And here in the deployment approval,you'll click on add action groupand you'll say, Deployment Approval to EKS,whatever it is, right?And in the action provider you can say manual approvaland you can select the SNS topic,which is our EKS DevOps topic one and Restore.You can leave it to defaults and click on done.And now we will go ahead and then save this.Okay, save this pipeline.And now, see you have the deployment approvalrelated thing added here.In the same way, if you want,you can also add a build approval also.Only after you have checked in the code.But whenever you approve it,only it'll move to the next step.So that is fine.We'll try with one thing,which is deployment approval.So we'll come back here and move to the next stepas adding a V5 version of code here.And then testing the end to end workflow here.So V4 is over.So we'll say version V5 and we'll go to the terminal hereand we will say, git status.And we have the change in app one, index.html.So I'll say git, commit -am and V5and I'll say, git push.And this should create a sourceand build version should be trigger.And then it should create a new docket image for us,but it'll hold data approval stage.So let's verify the same thing now. Okay?So we'll go to pipelines and click on this pipeline.And you can see source V5 is done,and build thing is running currently.So let's wait for it to complete the build process.So we can see it here.It got failed for some reason.So we'll try to click on that and verify it. Okay?So we'll click on open itand in pipeline.Pipeline.And this is the approval and the revisions.Now let's click on this pipeline and go to the executions.And this is the execution. We got failed.So let me open that execution.And if you see the execution summary,it is saying that latest action execution message,the pipeline or action rule does not have permissionto publish to topic in Amazon SNS.Add the SNS published permission to the roles policyand then try again.So we will go here and we might have misread it.So we'll go to settings and we'll open this role, right?And this is the code pipeline role.And we will try to add a, attach a permission, right?SNS related, I'll try to give full access.That is fine for now, but you can, and now we'll come backand then run one more time and then see what happens.So we'll come back here and we'll say V6, right?We'll try to use V6and git status,git commit -am and V6then git push, right?And this should create a V6 version of our this one.Okay, let me come back to the pipelines here.And our pipeline should be running.So ideally this should work. Let's see what happens.Okay, after build, it should come for deployment approval.Ha. So we can see it here.It is in the deployment approval state.And we can go to the execution hereand then open that respective execution also.And here also we can see it is in progress,and it is waiting for this approval stage.Okay, so if I go here in my email,I got approval needed for this respective pipeline.So we can click on this link,and it should open the pipeline related thing only.And there if you click on this manual approval,so you can click on approve and click on submit.So once the deployment approval is succeeded,then only it'll move to that deploy phase.Okay, so you can see source V6, source V6,and this is also source V6.So this is successful. And now the deploy phase started.And there it is also picking up with source V6.And for source V6, the commit code is zero.Let me try to refresh it here.And it is 01acf04.And if you go to our elastic container registryand refresh also, you should see the same thing, 01acf04.So let's wait for the pipeline to be completed.So we'll go back here to pipelinesand the deploy phase is currently runningand it is successful.Okay, now if we go to our browser here and try to refresh,we should see V6 version of our application is running now.So this completes the demo about end-to-end flowwhere build approval and deploy stages successful.So one step I forget to document here,which is providing access for code pipeline roletwo topics, okay, SNS topics. I will add it right away.I have added the step herefor 10-04: Give SNS full access to AWS Code Pipeline Role,so that whatever the will have accessto publish the message to SNSso that it can be delivered via email for usso that we can approve at that point.So this completes the demo aboutEKS DevOps using GitHub code pipeline and then code build.So in our next lecture,we'll go ahead and then clean up whatever we have created.I'll see you in the next lecture.Until then, bye bye. Thank you.