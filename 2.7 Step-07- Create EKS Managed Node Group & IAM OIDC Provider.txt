# 2.7 Step-07- Create EKS Managed Node Group & IAM OIDC Provider

-: Welcome back.In this step we are going to createand associate the IAM OIDC provider for our EKS cluster.So for basics, ideally this is not required,but we are going to create everything in an orderly manner.So which will be helpful,for when we are using the EKS related,application load balancers or external DNS,are many things we are going to execute,as part of this course.So if we want to use everything effectively,so following it in a orderly manner helps us.So that's the reason,we are going to also execute this step now.So to enable and use AWS IAM roles,in relation with Kubernetes service accounts.So on our EKS cluster we must createand associate OIDC identity provider.So we can do that using EKS CTL or AWS management console.So when you go via AWS management console,multiple steps and multiple things you need to doand most of the time we might mess up something there.So but with EKS CTL it is just one command,saying that EKS UTILS associate IAM OIDC provider,in that respective region for this respective cluster.That's all.So my cluster is in US east oneand then my cluster name is EKS demo one.So if I exclude this command,immediately it'll be associated.So let me do that now.So it's going to do it in a second, it'll be quick.So we'll create, IAM am open ID connect provider,for cluster EKS demo one.So it has created and then associated.So the next step is to create the EC2 key pair.So why we need to create this EC2 key pair?So we need to create this key pair because,so whenever we create the node group,it creates the worker nodes,which is nothing but the EC2 instances.So if we want the login,like if you want the access to our worker nodes,so than definitely we need to create our key pairand then associate it.We can even do it manually in a with our custom key.But ideally it is always good to use AWS integrated servicesand I prefer that and I recommend that.So we are going to create a key pair with cube demoand then download it and then put it in your desktop,the respective pen file and then this name,whatever the cube demo key pair name you're going to use,you are going to use in that node group.You are going to see that now.So let's go to the management console,go to EC2 and go to security groups in network and securityand go to key pairs, sorry.So in key pairs you can see I already have the cube demo.So if you want you can create a key pairand then provide the name as cube demo,so based on your OS you can use PEM or PPK,but if you have PEM,again you can convert into PPK for your Windows missions,if you want for when you're connecting via PuTTY.So whatever the option.So I always use PEM so that I'll be able to,even create the PPK using for PuTTY using PuTTYgen.So that's the reason.So you can use cube-demo and then create key pair.So automatically it'll download the file pen file for youand then you can leverage that,when connecting to the worker nodes.So with that said, I'm going to cancel it,I already have it so I'm not going to recreate it, one more.So this completes the creation of key pairand then associating the creating and associating,IAM OIDC provider.So the next thing is to create the node group,with additional in the public subnet.So let's see, what is this creation of node group?So everything, whatever you see here,EKSCTL, create cluster and hyphen hyphen help.And then you get all the options available for you.What all you want to use.In the same way, EKSCTL, create minus minus help,with create what you can create,you can create cluster, node group, IAM service account,IAM identity mapping and then far get profile.So in the same way when you're creating the node group,what all the options available for the node group,you can see here, okay?So there are a lot of options available here.So the primarily we need to look into these,add on flags for the first time.So ASG access is nothing but auto scaling group access.It'll enable the IAM policy for our,cluster autoscaler in the worker node IAM role,I'll show you that, okay?So and it'll also enable for external DNS access.This is nothing but,whenever you create your Ingres controllerand a load balancer,automatically your Route 53 DNS also need to be registered.And then we'll see in our load balancer section.But that related IAM policy will get created.This is for elastic container register related,IAM policy will create,means like IAM policy will be created,with a worker node IAM role.So in the same way app mesh access,ALB ingress access, install new run plugin.So all these things comes into the picture from,add-on flags perspective, right?So we are using all these 1, 2, 3, 4, 5,these add-ons in our command.So excluding those things,which is nothing but ALB app mesh, full ECR access,which is nothing but elastic container register access,external DNS access and then auto scaling groups access.So remaining things, let's see, what are these, okay?So EKSCTL create node groupand the cluster I'm going to create is in EKS demo one,I'm going to create this node group.And the region is US east one.And the name of my node group is,EKS demo one-node group NG-public one.It is our comfort whatever we want to giveand node type I'm going to use this T3 medium,for costing purposes, I am using T3,which means like it should not burn lot of money for us.So I'm using T3 medium.And number of notes we are going to use is two nodesand minimum number of notes is two and maximum is four.This is design number of nodes always, okay?And the next is node volume size,which is nothing but on the EC2 instance as work nodes,how much is your underlying storage?So I said 20 means 20 GB of size, it is going to be.And now these two are nothing but,whenever you say SSH access, it is nothing but,the SSH access is equal to true.And when SSH access is equal to true,what is the key you want to use?So the cube demo is the key we have created here.So use the same key here,so that whatever is present in our key pair,will be associated to our worker nodes.And using this key, you'll be able to log into the,worker nodes for any troubleshooting.And one final thing is managed.So recently Kubernetes EKS added a managed worker nodes.So earlier it used to be unmanaged worker nodes,but now it is managed worker nodes,where AWS will take care of patching, auto upgradingand all those stuff from AWS perspective.So we will definitely want to use thatand then leverage that feature.So that's the reason, managed.And in future it is going to be everything managed.So we are going to use this, managed.So now let's go ahead and then create this now.So let's go to our command line,clear this and paste it, right?Click on enter.So it is creating, it'll use the version 1.16 for,new node groups based on control plane version, okay?So it is getting created,it'll take three to five minutes to create the node groups.So let's wait for that.Now our notes got created and our node group got created,we can see it's a re-try able error we have got,so sometimes usually when it posts EKC at,EKSCTL post to the cloud formation API,so sometimes it'll fail and then again it'll retryand then go ahead and then create it.So it automatically again went and then recreated it.So what we can do here is like,we can say cube CTL, get nodes.So whenever we type this command,if we have the nodes ready,so it is going to say they are ready.So we have over two nodes ready.And that is the thing if you want to see in a wider way,which means like with public IPs of our EC2 instances,we can see this way with -O and then void.So that's about the creation of node groups.So in our next step we are going to focus on,verifying the clusters and then nodes,in a step-by-step manner.So I'll see you in the next lecture.Until then, bye bye.Thank you.