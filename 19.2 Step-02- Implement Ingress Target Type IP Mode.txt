# 19.2 Step-02- Implement Ingress Target Type IP Mode

-: Welcome back.Let's go to our GitHub repository and we arein 08 new ELB application load balances section,and we are entering into the section here08 13 ingress target type IP.So as part of the introductory sectionwe already understood about what is a target typeand what is instance mode and then IP mode.So now we are movingonto step 02 which is ingress manifest.So let's go back here to visual studio core and we arein 08 13 ingress target type IPand we are entering into the sectionkube manifests folder, right?And inside that you can see01 Nginx app one, app two and app three deployment.And you see here the cluster IP service insteadof the node port service.So we'll discuss that first, we'll go back hereand then complete our 04 ALB target type IPand come back here.So now let's go hereand if you see the name of my ingress serviceis going to be ingress target type IP demo.And the load balancer name is target type IP ingress.And nowif you see here I also commented the certificate hereand here and ensure that I addedthat TLS host star.stack simplify.com,so that you really don't need to hardcodeyour certificate here and here.So this we already learnedabout the SSL discovery TLS demo therewe already learned it.And another important thing here is, soif you are domain name is different for your certificateit might be some some your domain.com.So that domain name you need to provide herefor your certificates or you can comment this partand then enable the certificate AR and related annotationand provide your certificate here and here.Anything is fine.And if you see this is a simple contextpart based routing use case wherein you havethe slash app one rules and slash app two rulesand also default backend wherein default backend goesto app three and slash app one goesto app one and slash app two goes toslash app two related Nginx cluster IP services.Okay so app one go to app oneNginx cluster IP service app two go to app to Nginxcluster IP service and app three goto app three Nginx cluster IP service.And if you see here target type is IP.So this is the core thing which we need to definein this respective use case.So you have provided the target type as IP more here.So now let's come backand understand why we defined cluster IP service, right?So there is no specific reasonso you can have it as node port or cluster IP.So both are same.Just to want to show youthat we really don't need to open ouror use the node port here.Why?Because the request comingto our application load balancer will directly goto this pod IP createdas part of this respect to deployment.So which means even thoughif you open the node related port it is of no use.So if that is the case then we can use the cluster IP,right?And now here comes another question.So if the request comingto my load balancer is directly goingto this respective pod created by this deploymentso then why do I need a service itself?That's a different thing here.You need service to have theingress created target groupand register the targets inside that.So which means the core concept here iseither the ingress of either the type, either the serviceof type notebook or cluster IPyou need to definitely define.So then only ingress can create a target groupin your application load balancer.And this is of your choice if you want to use node portthat is fine for this use case also instance type IP mode.So in in our fargate we have user node port only.Just for an additional option,so just to testI have user cluster IP and it works without any issues.So all the naming conventions insteadof node port has been changedfor all these three services too.Cluster IP and all the custom changes which meanslike par service, any custom related changeslike health check ports or any other settings.So you can providein this respect to service related annotation.So like if you see app three health check pathis slash index.stmland app two is slash app two index.stml.and app one is slash app one index.stml.So it is the same context part based at routing use casebut here instead of node port serviceyou are using the cluster IP serviceand providing those namesinside this alb ingress target type.So you can use node port service also no issues.So whatever the service we use herenode port or cluster IP, the request comesto our load balancer directly goes to our port.How? Why?Because so as you have userinside the ingress target type is IP.So it is going to register in the target typesright, in your application load balancer target types.So this setup is going to get the pod IPand then directly register thatas your target inside your target group.So now let's go back here and deploy these thingsand then review those things and get to understand moreabout it by seeing it on the EC2 management console.So let's go to our terminal here and we arein 08 new ELB application load balancesand we will enter intothe section 08 13 ingress target type IPand I'll say kubectl apply -F and kube manifest.So this should create the app one,app two, app three deploymentsand app one, app two, app three cluster IP servicesand also should create thetarget type IP ingress service for us.So I'll say kubectl and I'll say get portsshould provide us the app one, app two,app three ports for us, right?And I'll also say SVC servicesand it should provide the cluster IP threecluster IP services it has created for us.And you can see the cluster IP IPS 1099, 2 51some IP addresses, just remember them right?So now I'll also say kubectl, get ingressand it should create the ingress servicefor a target type IP ingress.And now, very important thing, I'll say kubectlget ports, -all, wideand see the IP addresses of your ports here.So that's important thing.See app one port is something like this 92.27,and app two port is 118.58,and app three port is 107.238.So we'll go to ourapplication load balancer here first, right?So and then I will rephrase thisand application load balancer is provisioning andif you go here right in and verify the rules here, right?See app one goes to app one target group,app two goes to app two related target groupand default goes to app three related target group.So rules are created no issueand you can also verify the certificatestar.stack simplify.com certificate also associatedno issues, this is good.So now let's go to target groups, for this demo.The core checking we need to do is the target groups.Why? Because from the application load balancerthe request will directly goto the target group related,pod IP and that pod IP need to be presentas a target inside this target groups.So let's first open this default app one Nginx relater,target group.And you can see total target is one, still it is not healthyit is registering currently.And if you see the value 192, 168 92.27.So this is the app one Nginx related target groupand this is 92.27.So now let's go here and if you see app one Nginxdeployment related pod, so this is the pod and it is runningand its IP address is 192, 168 92.27.So you can see in our application load balancetarget groups that target registered is directly the pod IP.So there is no indication of your servicethe cluster IP service, whatever we have created hereright? So it's nothing, it's not there here 1,000something that is not there.So directly the pod IP is registeredas a target in your application load balancerand you can see that is healthy also now.So now app one is done.So now let's go to app two here, right and app twoand it is healthy and it is registered and successful.And see the IP address 192, 168 11.118.58.So you can see here it is the same thingfor the app two you are seeing 192 168 118.58,matching with your pod IP.You said kubectl, get ports -all wide,and verifying your pod IP is matchingwith your target type,whatever the targets registered in your target groupsof your application load balancer.So now let's go to that default app three Nginx, right?Here you see 107.238 and it is healthy.So let's compare, here it is 107.238.So now we have successfullyverified the target groups which contains the pod IPs,instead of worker node IP with node ports.So now the next thing is we really don't need todo all these DNS logs checkings earlier,we have already seen those things.So we will come back hereand do DNS lookup and target type related thingand you can see the DNS is successful.So we can access these applicationvia browser and then test it.So here there is a space I need to remove that.So I'll remove that, see this space I will removeand you can see target type IP 501 stack simplified.com.It is accessible and we'll also access app twoand here some spaces therelet me remove and app two is accessible.So the request is goingfrom our application load balancer,directly to our pod IP.And this is the third application.So let's also access that app three, right?And it is also successful.And this completes the demonstrationof ingress concept target type equal to IP mode.So let's go ahead and then delete these things.Kubectl, delete -F kube manifest.So as usual, this should destroy our app one,app two, app three, deployment cluster IP serviceand also our ingress service.So in our next lecture are in our next sectionwe are going to focus on,ingress internal load balancer concept.So I'll see you in the next lecture.Until then, bye bye.Thank you.