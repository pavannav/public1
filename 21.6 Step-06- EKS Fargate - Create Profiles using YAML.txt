# 21.6 Step-06- EKS Fargate - Create Profiles using YAML

-: Welcome back.In this lecture, we are going to create Fargate profilesin advanced mode using YAML files.So in YAML, we'll be ableto create multiple Fargate profiles at a timeif we are in need of creating them.So let's go back to our Visual Studio Code,and in 0902 Fargate profiles advanced YAML,you can see kube manifest,and then you'll find under kube manifest two folders,Fargate Advanced Profiles, and then 02 applications.So right, so I'm going to use Fargate Advanced Profiles,and inside that you can find Fargateprofiles.yml.And if you see it here,API version, kind, and metadata, standard stuff.And this API version is nothing but it is EKS CTL,which is EKS CTL command line CLS related configuration,which we are performing now.So which is V-1 alpha five version as of today.So if you want this template to be as is,if you want to find it,so then you can go to eksctl.io,and any latest changes you can find here, right?So you can go to usage,and you can go to EKS Fargate support,and any latest changes, whatever happens here,we want alpha-5, we want alpha-4, or whatever comes in.You'll be able to find those information herebecause the documentation keeps updatingevery time, whenever the new release comesinto the picture, right?So now, so API version is this one,and then kind is cluster config,and the metadata, this is another important thing.So it is not just like normal metadata,but this metadata will have something called name,name in the sense the name of the cluster,where we want to create these Fargate profiles.So our cluster name is EKS Demo-1,and where our cluster is located is US East one.And now, under Fargate profile stack,you can have a list of Fargate profiles you can create.So name of my profile is FP app2.which is nothing but Fargate profile app two,and selectors are nothing but under selectors,you can define namespaces and also labels.So all workloads in the NS app two namespacein Kubernetes will be scheduledonto this respective Fargate profile.So whenever you deploy the workload,all the workloads which has the namespaceNS hyphen app2 will be scheduled to this Fargate profile.So that's what is the selector mean here.Okay, so it's going to check forif I have the namespace NS app twofor any of the deployed pods,and then it is going to schedule accordingly.In the same way, for FP UMS also.So the Fargate profile name is FP UMS,and under select is in addition to namespaces,we also have labels.So I'm saying labels run on Fargate,so in NS UMS, in addition to NS UMS namespace,so the workload also should have a label namerun on Fargate.So if only these two matches,only those workloads will be run on FP UMS Fargate profile.So let's go back over to our GitHub repo,and then go ahead and then create this Fargate profile.So we will go here,and then we'll go to zero nine EKS workloads on Fargate,and we'll go to 0902, and then we'll go aheadand then create the Fargate profile, right?Create Fargate profile from YAML file,which is hyphen F kube manifest slash zero one Fargateadvanced profile slash zero one Fargate profiles.Okay?So the entire path we have provided.So it will take a while to create it.So in the meantime, we can go ahead and then move onwith the discussing about the manifests, okay?So once it is created, we'll come backand then list the profiles, but for now we'll move onand then discuss app one, app two, and then UMS manifests.So let's go back to our Visual Studio Code,and come here, and I'll close this one in kube manifest.I'll close zero one Fargate.You can see you will have zero two applications,where you will have three namespaces,zero one NS app one, means like app one application,app two application,and then user management microservice application, right?Zero one, zero two, zero three.So each related manifest will be available inside them.So let's talk about app one.So first thing is we need to create NS app one namespace.So API version, kind, and metadata, standard namespace,which we have seen in our namespace section also.So apps deployed in this namespace will run on EC2,manage it, not group.Why?Because we didn't create any Fargate profilefor NS app one related namespace,only for NS app two.And then NS UMS, we are creating the Fargate profiles.So for NS app one, as we didn't create anythingrelated to Fargate profiles,it is going to by default run on easy to managein node groups provided if we have node groups.If not, the pods are going to be in the pending state.Next thing is NGINX app one deploymentand then NodePort service.So these deployment and NodePort serviceswhich we have written on our own earlier,so those are standard ones,nothing changed inside them, deployment,and then NodePort service.Only one thing changes here is we are goingto add a namespace in the metadata.In the metadata, just child item is namespace,and this deployment belongs to NS app one.In the same way, I'm going to say here this service,app one NGINX, NodePort service belongsto namespace NS app one, that's all.And now I'm also going to have a separate Ingressfor this NS app one because of it is going to bein separate namespace.So this NS app one is going to be in separate namespace.So already we have seen there is a limitation.It should have a separate Ingress service, right?So what we are going to achieve is we are tryingto see that mixture more with multiple deployments.Everything is working as expected, right?So let me come back here.And in LB Ingress, also the standard thing is,under metadata, you have the namespace and then NS app one.So this Ingress will get createdunder NS app one namespace.And here there is no Fargate related target type IP.But even if you want this one also to be with the target IP,IP only, which means you should have NodePort serviceif you want to route it directly to your port IP.You can even, these also supports that.And if you want you can put it.And DNS name I'm giving here is app one kube one cloud.comand path slash star will goto app one NGNIX NodePort service, that's all.So this is app one,and app two is also going to be same way, NS app two.And the changes here will be only the namespacefor deployment and another namespace for service, okay?It's like namespace information,and LB Ingress also will have app two Ingress servicewill be the name, and namespace,it'll be tied to NS app two.And here, you will have the, for Fargate,you'll say that because this NS app twowill be part of our Fargate profile, right?NS app two.So that's the reason you are going to have the target typeas IP, and as usual, slash star goesto app two NGNIX NodePort service.Okay, so let me close this and one more.You're going to have NS UMS.UMS is nothing but user management microservice, right?So namespace is going to be NS UMS,and you'll have somethingcalled MySQL external name service.So we need to ensure that our RDS database,whatever we have created as part of this section, right?EKS storage with RDS database.We are continuing that example herebecause in our next sections,we are going to have microserviceswith user management microserviceand notification microservice.And we are going to do many examples there.So as part of that,so this database should be continued with us, okay?So if it is not in use, you can even stop it, right?So RDS, and so I'll say RDS and go there.No, it went somewhere else.Okay.Come on.So this is the RDS,and let's crosscheck our database is up and running.And the endpoint is same.So I went to database, and it is running available,and it starts with the CXOJY is my endpoint here.Information, right?CXOJY user mgmt DB dot CXOJY.So user mgmt dot CXOJY.This looks good for me.So I'll move on with the user management,The microservice deployment service,which is nothing but namespace is goingto be NS UMS here, this is deployment.And as usual, for all the deployments,you need to ensure that you have the resources sectionfor the Fargate things, okay?Wherever you are deploying.So earlier in our previous section,we already discussed it here in our 0901,but just crosscheck, okay?And this is Secrets.And then here also you'll see the labels, right?So now one important thing here is an external label.So you have seen that labels run on Fargate.And then here also, we are putting everything,so to follow the standard, okay?So which means why to go into confusionthat I didn't put here, I didn't put here, right?So user management microservices.So for deployment object also you have run on Fargate,and then it's a template metadata also,you have run on Fargate.Primarily it is required here.Why?Because this port template meanslike this is the port template, right?In a deployment here, run on Fargate is requiredunder labels.But we have followed the standardwhere like for deployment, also run on Fargate.Here we have given, here we have given,and in Kubernetes Secrets,also labels we have given run on Fargate.And also namespace, also we have given NS hyphen UMS.Right?And in addition to that,user management NodePort service also,you'll have namespace NS UMS, and under labels,you'll have run on Fargate.Okay?And in addition to that, in LB Ingress also,you will have labels and then run on Fargate,and then namespace NS UMS.And again, this is going to run on Fargate.You are going to have target type as IP,and path is slash star, and the service nameis user management rest app NodePort service, right?So that is the name here,user management rest app NodePort service and 809.And my name here,it is going to be ums dot kube on cloud.com.And for app two, also name is goingto be app two dot kube on cloud.com.So this is about the review of our entire thing,whatever we discussed.This is app one, app two, and UMS manifests.So now let's go back and then see what happenedwith our profiles.So our profiles got created.So let's list those profiles once, right?Get Fargate profile cluster equals demo one, right?And once listed,so if you want to see our respective Fargate profilesin YAML format also, we can see.But that is fine.So here are the lists.So we have something called FP app two,Fargate profile, and FP UMS Fargate profile.And selector namespace for FP app two is NS app two.And selector namespace for FP UMS is NS UMS.Okay, so now in our next lecture,we'll go ahead and then deploy these thingsand then test it.So I'll see you in the next lecture.Until then, bye bye.Thank you.