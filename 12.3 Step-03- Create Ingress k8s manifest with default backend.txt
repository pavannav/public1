# 12.3 Step-03- Create Ingress k8s manifest with default backend

-: Welcome back.As part of step four,we are going to review or do a live template writingfor our Ingress Kube manifest with default backend option.So we need to gointo the file 01 Kube manifest default backend folder.And inside that 02 ALB Ingress basic.yaml.So let's go back here to our visual studio code,and we are in 802ALB Ingress basics,and inside that the folderis 01 Kube manifest default backend.And 01 nginx app1 deploymentand note port service related Kubernetes manifest code,we already reviewed in the previous lecture.So now we will enter into 02 ALB Ingress basic.yaml.So the standard template here,API version, kind, metadata, and then spec.So for latest Ingress, right?So for the latest Ingress resources,so we need to use the API version as networking.k8s.io/v1.And whatever the kind Kubernetes object we are goingto create here is Ingress.And in the metadata we are goingto provide the name of my Ingress serviceand my Ingress service name is ingress-nginxapp1.And I'm also going to define labels hereand I'm going to say it as app equal to app1 nginx.So this is purely optional.We really don't need to even define the labelfor my service here.So now let's come back hereand in the metadata itself,we will have something called annotations.If we go back to our presentation here,so in the Ingress manifest,the key items are Ingress annotationsand in Ingress spec, Ingress class name definitionand in Ingress spec, defining either Ingress routing rulesor default backend.So now we are at this pointwhere we are defining the load balancer settingswhich is nothing but defining the Ingress annotations.So I will say annotationsand we'll start with the first annotation.So let's go back hereand go to the annotations documentationand you'll find something calledALB Ingress load balancer name.So we'll provide the load balancer name here.And if you want to understand more about it,so open it in the new tab and you'll go there exactly.Specify the custom name to use for the load balancer name.So name longer than 32 characters will be treatedas an error.So once defined on a single Ingress,it impacts every Ingress within the Ingress group.So the Ingress group is a different conceptwhich we will see in upcoming sections,but for now we are goingto just define a simple name forever load balancer, right?So let's come back hereand define it as app1 Ingress, right?So this is the first setting of my annotations relatedto my load balancer.And another important thing is Ingress core setting.We call this as the Ingress core setting because,so this Ingress service should be a internal Ingress serviceor external Ingress service,which means this should be private load balanceror public load balancer.So that setting can be defined using something calledin annotation, you'll find the scheme here, right?So go to the scheme here and specifieswhether your load balancer will be internet facingor internal, right?So let me copy thisand define the scheme here.And it is going to be internet facing.So I'll say internet facing.You can also search for internet facing,see ALB Ingress Kubernetes cyber scheme internalor internet facing.So I N T E R N E T, internet facing.So this is good.And there will be one more annotationwhich we need to discuss in detail.But first we'll define the health check settings.So we have defined the load balancer name, schemeand we can also define the health check settingsfor our application load balancer here.So let's go here and go to the health check hereand you'll find the health check setting relatedall annotations here.The first one is protocol,health check protocol you want to use,and I'll put it as HTTP protocol I'm using.I can say this as health check setting.And this I can say as Ingress core setting.And this one I can say as load balancer name, right?And the first setting for health check is completed.And next one we are going to define is traffic port, right?On which port it need to do the health check?It is going to be traffic port.And another setting is health check path, right?And my health check path is going to be,so let me put this here,and is going to be app1/index.htmlWhere my application related files are present, right?index.html of my nginx is presentin the app1 folder so I'll use that.And next one, right?So let me enter and let me come back here.And next one is going to be health check interval seconds.And I can give that as 15 seconds and let me put that.And I'll also provide the health check timeout, right?I can provide that as something around fiveand in seconds.And we can also provide the success quotesand then healthy thresholds and all those things.So we can provide a single valueor we can provide multi value, right?200. 201 to 300, like this,we can provide those things.And I'll also provide the threshold countand also I'll provide the unhealthy threshold count.So this completes the health check setting definitionsfor my respective to Ingress resource.I have defined the load balancer nameand where this load balancer should be placed internalor internet facing and also health check settings here.So now let's come back hereand review one more thing here, right?So this is the app1index.html.So this Ingress is nothing but a combinationof multiple applications you can send that traffic to.That's the core definition, right?So which means an application load balancer createdfor using a single load balancer you can send trafficto multiple applications with different schemeslike using context path based or host header basedand all those things.In cases like now, you have only one application here.So that's the reason you can define thisas a global app1index.html,but in this Ingress,you are using the context part based routing,how we have discussed about accounts, products,and root context.And at that point of time in each application,there might not be a /app1and then index.html related things availablefor health check.So at that point of time,we need to move these things,this respect you thing, right,directly to your node port service so that,that becomes a service level one see.So now if you see here,need to add health check path annotation in service level.If you're planning to use multiple targetsin a load balancer.Multiple targets are nothingbut you are using multiple rules to defineand then add multiple things here,means like you're sending the trafficfrom a single Ingress service to multiple applications.At that point of time you move your health check path,off your respective thing from global,from global Ingress setting to you are service level,node port service level thing, you need to move there.So now let's come back here and then come back to the spec.So we have completed the annotations part hereand now we need to define the Ingress class name.So let's define the Ingress class name hereAnd I'll say Ingress class name.And in Ingress class name,we are going to get the Ingress class namefrom our 0 8 0 1 Kube manifestand get this value from here.Let's come back and provide this.And the next thing is,we also need to provide the default backend here.And in default backend,we need to provide the service informationand in service the name of the service,we need to provideand name of the service,we can get from our 01 nginx.And here is the nameof the node port service we need to define here, right?And we also need to define the portand we'll say the number as 80.So this completes the definition of your Ingress service.And another important thing to discuss here is,so let's come back hereand go to the Ingress class documentationand you'll discuss about it deprecated annotation.One important annotation.So you can say ALBor I can say kubernetes.io/ingress.class.So this is the earlier annotation which we used to useand it is widely implementedacross all the Ingress resources or Ingress controllers.So let's come back here,see deprecated kubernetes.io/ingress.class annotation.So before the Ingress class resourceand Ingress class name field were added in Kubernetes 1.18.So Ingress classes were specified with this name, right?So the newer is Ingress class name fieldwhatever we have added here, right?So let's come back here.And this is the one.So already you have defined it as a default controller,means like you are Ingress AWS ALB controller.You have defined it as a default controllerwith this respective setting.So which means you really don't needto even define this also.Why, because you already have a default controllerwhich is Ingress controller in your Kubernetes cluster.And then you don't needto specify the Ingress class name here.But just for notation and to understand for us,I have defined it here and let's come back here.So the newer Ingress class name fieldand Ingress is replacement for that respect to annotationwhich is kubernetes.io/ingress.class,but is not a direct equivalent.While the annotation was generally used toreference the name of Ingress controllersthat should implement the Ingress.The field is a reference to an Ingress class resourcethat contains additional Ingress configurationsincluding the name of the Ingress controller.In simple terms, in very, very simple terms.So this is now a optional thingwhether we want to use it or not.So if you use it or if you don't use it,there is no harm for us as on today.But why do we need to use a deprecated annotationin our latest Ingress manifest?So that's the reason,I didn't define any Ingress class right?Kubernetes.io/ingress.class here, right?We are directly using the Ingress class nameand referencing to the Ingress class,whatever we have createdin our load balancer install related section.So this completes the review and our live template writingof our Ingress resource with that default back end.So in our next lecture,we are going to deploy this send then test it.So I'll see you in the next lecture.Until then, bye bye.Thank you.