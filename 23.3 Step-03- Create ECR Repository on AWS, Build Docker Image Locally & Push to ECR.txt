# 23.3 Step-03- Create ECR Repository on AWS, Build Docker Image Locally & Push to ECR

-: Welcome back, in this lecture,we're going to create the ECR repository,and also create the Docker image locally,and then even push the Docker image to AWS ECR.So let's go aheadand then do the step one by one, okay?So we'll go to ECR service in AWS Management Console.So search for the service E-C-R,which is nothing but Elastic Container Registry.And let's go there and go to Repositories, right?So you can even directly click on Repositories here, right?ECR Repositories, so let me close thisand create a repository, right?So let's go here,and then take the name as aws-ecr-kube-nginx, okay?And then paste it here.So this is my repository name,so it's not just aws-ecr-kube-nginx.So this will be the repository namebut the repository URL means it is going to be entirefrom here to here, okay?So it is going to be unique for you.This value is going to be different for you also, okay?So also enable Tag Immutabilityto prevent image tags from being overwrittenby subsequent image pushes using the same tag.So we will enable it.And enable Scan on Push to have each imageautomatically scanned after pushed to repository.So it'll do a security scanof your image once you push it.So we can enable it.So that's a very good setting,so you can push it, okay?And then it'll provide a detailed security reportabout your Docker image.So I'll click on Create Repositoryand our repository should get created, right?So if you want, we can see our push commands herehow we're going to do it, okay?So this is the push command for uswhenever we build our Docker image, okay?So this is for our latest one, okay?So, but anyway, we can leave these things here.We have anywhere documented here,all those things in our lecturesor even if you want, you can select this,and then one more time if you want to refer for macOS,what will be your push commands,and then for Windows also.AWS also provided a detailed documentationhere for the same.So now we'll go back to our GitHub repoand then start workingon creating a Docker image locally, right?So let's go to 10 ECR Container Registry,01-aws-ecr-kube-nginx, right?So I want to change this name to EC,so I want to change this ECS to ECR.I have done it, so let me refresh it,and then it should come here, okay?So 01-aws-ecr-kube-nginx, okay?So we're going to go inside this folder,and then review the files,and then build it, and then push it, okay?So let me go to our this one.So which is nothing but our GitHub Visual Studio code.And if you see in 10 ECR Elastic Container Registryand EKS, you can find 01-aws-ecr-kube-nginx,and 02 is related to Kube manifest, okay?So first we'll focus on building our Docker image.So inside this, you'll find the Docker file.So from, means like Docker file, inside Docker file,what we're saying is bring the NGINX imageand then copy the index.html,whatever is present here, okay,to usr/share/nginx/html in the Docker image,whatever you're going to build.That's all, very simple Docker image we're going to build.And then we're going to push itto the ECR repository, right?So we need to go inside this folderand then run the docker build command.So we need to go to 01_aws_ecr_kube_nginx.So let's go to the terminaland go to 10 ECR Elastic Container Registry related folder,and I'll go to 01_aws_ecr_kube_nginx.So now we're going to build the Docker image.So the template is nothing but docker build -tand then ECR repository:tag.Means like repository URI:tag.And then the location.Location is nothing but the current location.So dot will be the story here, okay?So now let's see what is my repository URI, right?So let me go back here, right, ECR.And you can see that this is my repository URI.So which is us-east-1 and it is same.So ideally, these two things, if I copy this one.And whatever is, I'll just paste it hereand then remove it.And if I go back to my this oneand this one, both should be same for me.So but in your case, you need to build itaccordingly by putting in your notepad, okay?So it is same, okay?So not an issue for me.So what I'll do is I'll remove these things.I'll remove these things, okay?And then save it back, okay?So if you want, what you can dois you can say, File, New File,and then copy this command here,and then get your repository URI from here, right?So that is an easy job for you, right?So let me do this,and then here, you can give your version, right?So I'm going to give 1.0.0.And this is our docker build command,what we're going to use,and then execute there, okay?So that is the same one.So let me go here and then paste it.So successfully built the image.So I'm going to say docker images.So I'm going to have a lot of images.So let me say clear,and let me see my image here, okay?So this is the latest image,whatever I have built just now, 13 seconds before.So the image and then its tag also displaying here.So I want to run it locallyand then test how it is behaving, okay?So docker run --nameand the name of your container,whatever you want to run, okay?So you can give whatever you want.So I give whatever my image name,the same thing I have given here.And the port is local port,and then means like on my desktop portand the container port I'm mapping here.And --rm, what it does is like whenever youdo a docker stop, automaticallyyour Docker container will be killed, okay?So it'll not be available there, okay?In previous processes, okay?So and then -dand then the Docker-related image information,the entire image information.So I'm going to take this,and copy it, and then put it here.In your case, you provide your ECR repository URI:tagand the name of the container,you can put the same thing, not an issue, okay?So I'll say clear and then paste, okay?So now if I say docker ps,so I have this container running now, okay?So what I'll do now is like I'll go to localhostand then access it, okay?So it is running on port 80.So "Welcome to Stack Simplify AWS EKS Masterclass,Integration with ECR Registries,Up and Running Locally," right?So if I go ahead and then stop this container, right?So you can go here, and then take the command,and then stop this container,and verify, it should be not available, okay?So stopper, docker ps -a -q, nothing is available.That's good, okay?So now you have built the image locallyand then tested it, okay?In this step, we're going to push thatto our AWS ECR, right?So let's go ahead and then push that now, right?As usual, you need to have CLI version 2.6,which we already discussed in Prerequisites also.So first, we need to do is get the login passwordand then push the Docker image, okay?So I'm going to say aws ecr get-login-password,and region is us-east-1,and then take that password,and then pipe it to the next command, okay?So which is nothing but docker login --username is AWSand password is std, which is whateverthe command output coming from here,docker get ecr, get login.Whatever you're getting from there,you're passing the password here,and then which image you're going to push.So this is the Docker repository URI,you're going to push, okay?So, but one thing I am doubtful about hereis I didn't mention the tag, okay?So, but repository URI,only that, you're getting the login password here, okay?So push with tag is here, okay?So that's good, okay?So docker login, username/password,and the repository URI is this one, right?So that is the one.Good, so this is the repository URI, okay?So this looks good.So let me copy this and then paste it here, okay?And it should do the docker loginfor us successfully, okay?Your password will be stored unencryptedin so and so file, but that's fine.Login got succeeded.So now we want to push this image.So before pushing it, if you go inside and then verify,there are no images available here, okay?So let's go ahead and then push that now.So I'm going to push it.So in your case, it is going to be yourrepository URI:tag, okay?So let me come here and then paste it.So it is trying to push, it will take a while.So maybe less than a minute, it will push it.Small image, right?But here, you're clear, right?So you get your login password for this,respect to your region,and then for docker login with username AWSand password is this,and the repository URI is this,which you brought from here, right?So repository URI.So you're going to provide the passwordand then do the login to our Docker repository,to this respective Docker repository, okay?And then you're going to push it.So now let's see it got pushed, okay?So let's go inside and then do a refresh if you want.So now you can see that 1.0.0 image that got pushed, okay?And during the push, we also saidthat it need to scan the stuff, okay, so vulnerabilities.So this is a basic NGINX imagewhich we have taken out of the box,and these are the current scanning results.So with critical zero,but with high impact, one you have,and then medium 16, low 21,and then informational 52.So that's what the vulnerability scan it has done.So this is the very-high-impact thingrelated to Perl before has an integer overflow-relatedmishandling of a PL_XYZ, something, okay?So like that,you can have instruction-injection-related stuff,it might happen, something it is trying to tell us that.So you need to fix all these things to have a validand then highly-secure repository for you.So that's a very good optionin AWS Elastic Container Registryabout the vulnerability scanningautomatically happens on our images,whatever we push here, okay?So this completes the creation,means like a creation of a Docker imageand then pushing it to the DockerAWS Elastic Container Registry, okay?So in our next lecture,we'll focus on about Amazon EKS.So I'll see you in the next lecture.Until then, bye-bye, thank you.