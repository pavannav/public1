ript


16:29
Good morning everyone. So in this class we also invited HTTO learner. So firstly
16:35
we will give some basic overview of uh EKS cluster. Okay. So how we can create
16:40
it? Okay. So how how we can create AWS uh CLI uh configure command. Okay. So
16:46
first we will give some basic overview of EKS. Okay. So let's start with quick
16:53
revision of EKS overview. So firstly let me share screen.
17:04
I hope my screen is visible.
17:10
So let's start. So various IT companies are using EKS elastic Kubernetes cluster. So ETS stands for elastic
17:17
kubernetes uh service of AWS companies like Goldman Sach uh Netflix, Apple,
17:23
Amazon uh and many more. Okay. So EKS is a managed service of AWS. It is one of
17:30
service of AWS that have huge potential to perform managed service of Kubernetes. If you want to install uh
17:37
Kubernetes uh then uh we have a multiple way then
17:42
uh one of the way is AWS. So AWS provide EKS service and using that service we
17:48
can u create our own cluster. Okay. So EKS is a managed service is a fully
17:54
managed service of AWS. We don't have to manage anything. Okay. So entire
17:59
management of Kubernetes cluster is managed by EKS service of AWS. So here
18:04
Kubernetes cluster includes storage, load balancer, LB is a load balancer, active directories, RAM, CPU and lot
18:11
more. Powerful thing about EKS is that it is tightly integrated with AWS service like EC2, EC2 etc. Okay. So uh
18:20
whatever we create in EKS that will integrate with uh EC2 means if we uh
18:26
create a worker node then uh then worker node will be creating EC2 service. If we create a service service is a load
18:32
balancer. So uh EKS use um internal service of AWS that it's elastic load
18:40
balancer. Okay. So EKS CDL tool it is a third party tool to
18:45
ma manage EKS. If you want to manage EKS if you want to create a cluster of EKS
18:50
then EKS CDTL tool will be used. If you want to set up a web app we need a physical hardware like RAM CPU. Okay.
18:59
And u we need operating system runtime and uh run the web. So uh there are
19:07
three possibility to set up uh any uh app. Okay.
19:13
So uh uh we have a bare metal virtualization containerization. If you use a bare
19:19
metal so running directly on the laptop here we use OS virtualization uh launch
19:26
virtual machine or in AWS we use instance we have to configure the runtime there. Here we use a virtual
19:32
machine. And third is a container containerization. So launch VM install start that is a boot and run service in
19:39
a less than second. Here we use a containers. If you want to install any operating system within a second. Okay.
19:45
So containerization uh concept comes into the picture. Okay.
19:50
Today requirement is we need agility speed of great performance and in
19:56
container world if something fails it launch a new within a second. If uh in
20:01
container if one of the container fail then another container will uh run
20:08
within a second. That's why container is very useful. Okay. So to launch
20:14
container we have a ECS that is a elastic container service in AWS and
20:20
launch new container uh to make uh to make the application run. We have a container engine that helps to run
20:27
container. Some of the example are uh cryo containerd uh etc. Docker docker
20:33
use a container. So docker is one of the platform uh using that platform we can
20:38
uh install uh container and we have a multiple container engine cryo
20:44
container. So docker use a containerd. So this program is is uh known as a
20:51
hypervisor. Okay. Then uh where the container engine runs
20:57
it is known as a host OS or uh we can say container OS and also called as a uh
21:02
compute node or container node. Reason why compute node because it is one who
21:07
give a RAM CPU uh RAM or CPU etc to that container. Okay.
21:14
One minute, guys.
21:34
Okay guys, so this is a overview of EKS EKS cluster and if uh if you talk about
21:42
installation of EKS cluster. So EKS cluster is a uh one of the service of AWS. So we have to first log to AWS um
21:51
AWS uh through CLI or web UI. So if I talk about so there are three ways by
21:57
which we can uh use AWS EKS service. So one of the way one of the is a web UI um
22:03
EKS um provide web UI in AWS. Okay. Second way is a terapform is a third
22:09
party tool using Terapform we can install EKS and third way is a EKS CL tool. So EKS CDTL is a tool uh using
22:17
that tool or we can say using that command we can install EKS cluster. So
22:23
if you use EKSCL so behind the scene EKSCTL checks the um uh credential of
22:30
AWS account. So we have to first uh login using AWS uh using uh you we have
22:37
to login uh into the AWS for uh logging into AWS we have to use the AWS command
22:43
in a command line. Okay. So simply go to the browser and you can install the AWS
22:48
command and after installing you can check the version of the AWS command using AWS - version command. Okay. So
22:56
after this we have to create a user in AWS. So go to the IM service. So IM
23:02
service is one of the service using that service you can create a user in AWS. So go to the uh AWS console search for IM
23:10
service. Okay. Then create uh for creating a new user click on add user.
23:17
Then uh enter your uh user name whatever you want. Then click on next. Then here
23:23
set in set permission page uh select add attach policy uh directly and select uh
23:29
your um policy whichever you want. Here we select administrator access. Okay.
23:35
After this click on create user. Then we need something uh like username and
23:40
password. Then for this we create the access key and secret key. Okay. So go
23:45
to the security credential then uh select the CLI command line interface. Then click on create access key. After
23:53
this we will get the access key and secret key. Okay. So after getting the access key and secret key we already
24:00
install AWS command. So run the AWS configure command. Okay. And after it will prompt uh it will ask for access
24:07
key. So uh paste the access u access key. paste the secret key then type uh
24:12
default region okay and uh default output format after this you will log to
24:18
the AWS account using AWS configure command okay so now um you can run uh
24:25
any uh AWS command in command line okay so after this we need a EKSL command
24:32
that using that command we will uh launch EKS cluster okay so search for
24:37
EKSCL then go to that optic official link and download the software from
24:43
here. Okay. So after downloading if you go down uh download the software
24:49
simply extract it. Okay. And after extracting it set that path uh in
24:54
environment uh environmental variable. Okay. So this is a simple.
25:00
Now after uh after setting environmental variable we will create the cluster by
25:06
uh by uh by using command ekl create cluster. We have to just type the
25:12
command. Okay. So this is a command ekl create
25:18
cluster. So using that command we can uh install uh we can create our own cluster
25:24
using ekl command. After this command run successfully, we can see cluster created successfully in AWS uh console
25:32
page. Okay. So this is a um this is a screenshot of that uh EKS
25:39
cluster. If you run the uh any command uh for example EKSL get cluster then we
25:45
can see the our cluster using command line. Okay. So this is a basic overview
25:51
of uh EKS cluster how we can create. Okay. So that's it. If you have any
25:57
query then ask me in the chat
27:41
Okay. So guys, if you have any queries, you can ask in the chat box.
29:17
Uh Raj Kumar you can upgrade the uh I think cube ADM uh the question which you
29:22
asked. So to upgrade cluster so you have to upgrade cube ADM. So use command cube
29:28
adm upgrade. Okay. Um can we get PDF of document? Yes Disha
29:37
we have shared in the hash3 portal. Please check that we have updated the
29:42
PDF there as well. We will be uh sharing it in the discord channel. Okay. So you
29:47
can download that PDF from the discord.
30:02
Okay. Uh someone is asking that uh you are unable to get the PDF in the discord. So uh MD Sabir uh you would be
30:11
getting it again. I'll ask my team to reshare the PDF in the discord channel.
30:20
Uh I think no there won't be any challenge. Raj Kumar try this. Uh I mean if you get uh I
30:28
don't think so you will get any downtime error.
30:45
Okay, if someone is here from my team, uh Sor if you please note down that we
30:51
have to share the cluster role five file of previous session. So we will share them.
31:08
Okay. So, Dan, please uh share your mail ID here to me. I'll Check.
32:00
Okay Raj Kumar we will try if we could give you the cluster installation PDF
32:06
and everything. So we will we might update in the hash13 portal for your reference. Okay. Yes DNA I have noted
32:13
your mail ID and yes Raj Kumar I have noted your mail ID as well. So
32:25
uh Arpit uh I think we have shared one form if you have missed uh joining the
32:30
discord. So we have asked you again to refill the form. So I'll ask my team if we could uh help you again with that
32:37
form. Okay. So sir joined. Over to you sir.
33:06
is a very very good morning. Uh and uh let's continue with the next part. a very important topic very interesting
33:13
and might look bigger and complex also but I'll try
33:20
and I I can't say try but I'll do it make it very very simple for you right topic is ingress or I can say the
33:29
ingress controller right this is the topic so anyone who is working in this u
33:37
uh you know area of container or container related tools and technology like for
33:42
example Kubernetes or maybe open sift right or maybe you guys are work on
33:48
working on service mass for example right then having uh great knowledge of
33:57
ingress concepts or ingress resources that is to managed by ingress controller
34:04
is very very required okay without this you can't do much. Okay. So in the
34:11
today's class we will talk about ingress controller, ingress resources, gateway
34:17
and many more aspects uh concept something like this. But step by step I will explain to you okay. Uh so what
34:26
ingress is what kind of use case it going to solve. Before I go ahead we're
34:31
going to set up our demo or the practical on the top of Kubernetes.
34:39
Okay. And Kubernetes I'm going to launch on the top of AWS
34:45
with a service called EKS. Okay. Otherwise
34:50
it's not you have to use AWS only. You can go for Azure cloud also your own
34:56
vanilla kubernetes or you can go for open shift also to to uh to do this this
35:03
demo. Okay. But in my case the concept are same the code that we are going to use a
35:10
vimal code manifest file is also almost the same there might be small change but the core concept is exactly the same
35:18
right again I'm repeating if you belong to open sift world kubernetes world in
35:24
in the simple say I can say container uh world right
35:30
uh or because on the top of container normally we set up the service mass for
35:36
example is STU. Okay, in this area the ingress controller is very very uh
35:43
helpful. Okay, so we should know this. Today in
35:48
this class we have a participant from H2 classes also. So my S2 class is going on
35:55
but we'll call you in this class because uh this class moto maybe this class go
36:02
for two days today and maybe tomorrow because a big concept okay uh so moto of this classes today
36:10
and next class tomorrow maybe uh is to give you the complete context of ingress
36:18
with the practical and demo. Okay, after you understand the entire concept of ingress controller, then we will
36:23
implement this concept on the top of S2 then there will be some more extras STO
36:31
related uh you know resources going to come up right but without knowing this concept
36:38
then you can't work on the STO resources in the future classes of STO okay so
36:43
that is the reason uh knowing this concept what we going to discuss today and tomorrow is very very critical
36:50
Okay. So, so what I'm going to do right now, okay, because I'm going to set up
36:55
on the top of uh Kubernetes EKS. So, let me check very
37:02
quickly that I have the Kubernetes cluster or not with me. So, with EKSTL
37:07
command, okay, I'm going to check the cluster is available or not. So this is a command
37:13
that I have in my local system and this command go and contact to my AWS cloud
37:20
and check does I have the uh cubernetes
37:25
cluster setup or not. Okay. And my plan guys here today is to set up the cubernetes cluster on the top of uh in
37:32
the region called uh Singapore. Why Singapore? Nothing uh you know unique
37:38
but Singapore I'm trying to launch. Okay. So here my region name is uh
37:47
Singapore. This is ID for this region. Right. So let me write here. I'm going to check uh that in this region
37:55
do I have the EKS cluster and no cluster found. Even though we can check from here also I have no cluster in the uh in
38:04
the Singapore. So what I'm going to do, I'm going to launch a cluster very quickly because setting up the cluster
38:10
and launching the cluster will take almost 30 minutes. Okay. So let me run
38:15
the command quickly. So while the mean the command is is again going on, I will
38:21
explain you the ingress controller console. Right? So it will save the time and both the thing will be will be done
38:27
in parallel. Okay. So I'm going to run the one command. Okay. So command is ekpl. I want to
38:35
create a cluster. So if you want to create a cluster many more options and argument you have to
38:42
provide. Okay. So you can see the help and from the help
38:48
uh from the help what create cluster or
38:53
help so easy guess right. So in the help they will show you many
39:00
more options that you can set. Okay. So in my case I'm going to give
39:06
the name for this cluster. Let me uh let me store here. Let's say my cluster
39:14
name will be my cluster. That's what the name I'm going to give. Okay. Then you have to give the which
39:21
region you want to set up this cluster. So in my case the region I would like to
39:26
use is uh Singapore. That's what I'm setting up here. Then uh
39:34
and and then uh what is the version of for the uh for the Kubernetes? So the
39:42
latest version is 1.25. This is the version I would like to use
39:48
for my EKS version I'm talking about. Okay. And um what else?
39:55
U so do you want to enable YDC provider?
40:01
This is very important right in today's class. Okay. So I'm going to enable this provider YDC
40:09
why we need this I will explain you in in somewhere right so if you know little
40:14
bit about Kubernetes or open safe there's a concept called service account
40:20
okay today we are going to set up some service account there's going to contact to AWS resources
40:27
okay and for this we have to provide the authentication and we are going to give the authentication with the help of ids
40:34
So what I mean by this as I explain you the further concept of ingress controller I will explain you that part
40:40
right but by launching the cluster I'm going to enable the OI DC
40:46
uh concept it is mainly for the authentication purpose right but I explain to you why we are doing it right
40:54
then uh do you want to give a node group a name okay so let's say I want to give
41:00
my node group a name node group means we are going to launch a cluster of
41:05
Kubernetes and Kubernetes cluster we are going to launch a worker node okay so
41:11
you want to launch a worker node let's say 10 worker node you want to launch but all the worker node group together in a name this called node group so
41:17
let's say my node group one just a name I'm giving here okay so the name for the node group I'm
41:24
I'm giving here and uh next is in the how many node you want to launch let's
41:31
say I want to launch three nodes uh which a worker node I'm talking about
41:38
okay you set some minimum uh let's say in the minimum
41:46
I want to launch again I always want minimum three because they also support auto scaling right so if the load
41:54
increase I want they will might increase to maximum five node that's what we can set if you want okay Now what else? Uh I
42:04
want you can go for size of the node. We don't need let me skip this. Let me
42:10
enable SS access. Okay. So I would like to give uh
42:18
the access to maybe I want to do something on this worker node. So I
42:23
would like to allow the SSS access to this. And because you got allow access access then you need to give your public
42:29
key name. Okay. So I don't have the public key right now. So if you want to
42:35
create a public key, you can go for EC2.
42:41
Okay. And uh here you can create a public key or private key to which you
42:48
can connect to your instance. I I don't have any instance but they going to launch three instance in some minute.
42:54
But to connect to the instance I'm going to create a private key or public key. Let's say my EKS key.
43:02
Okay. Create in the pen format and save. So key name is this one. Right. This is
43:09
a public key private download in my system to connect in the future. But I'm just going to give my public key name
43:15
here or the key name here. Okay. What else? I also want to enable
43:21
the SSM. So I can also login via graphical way in AWS.
43:26
Okay. And uh what else?
43:31
Okay, I want my node worker node going to run in the private world of AWS. I
43:37
don't want to expose them to the public world is good for security. Okay. So if you guys know about AWS,
43:44
they will create a private subnet means they don't have a DAC access to internet. Okay. So ingress we will going to allow
43:51
today. What is mean by ingress? That's what we discuss in a minute. Right now just going to creating this command. Uh
43:58
explain some of the part of this command in some minute. Okay. When I explain the concept why I'm creating this command
44:03
because setting up the EKS cluster will take some time. So I'll run this command by the meantime the command is running.
44:09
I will explain the further console. Okay. And uh what else? This part is
44:17
done. This part is done. Node zone node instance name I don't need. I want
44:22
everything to be managed by EKS. So I'll make it managed. It means your worker node also to be
44:29
managed by EKS. Okay. Instance type I can use something.
44:36
Okay. So whatever type you want to use uh for the worker node. Let's say I want to use T3 medium
44:43
or small. How much RAM and CP you want to give to a worker node. That's what I'll
44:49
uh write here. That's called instance uh type is not instance type is called I
44:55
think node type right format and there's a node type
45:02
or maybe instance type that's okay instance type I wanted to give the main thing is okay
45:10
there's some extra add-ons we are going to install today and those add-ons I will explain you in detail
45:16
the add-ons that I'm going to install here is autoscaling access. Why we are
45:22
doing this? I explain to you. External DNS.
45:28
Why we want this? We'll discuss in the future. Full ECR support. We will
45:33
discuss. App mesh. It is like a service mesh. I'm going to enable this.
45:40
Okay. Or ALB ingress access.
45:46
Okay. I'll explain all the things why we are discussing why we we are also picking this add-ons. Okay. Almost all
45:54
the main add-ons what I'm looking for I'm going to enable. Right. Anything
46:00
else I would like to do here? Uh that's okay. Otherwise you can also
46:07
copy your config file otherwise they will overwrite your uh config file. Right. So these are the guys u
46:16
uh you know settings we are going to do for our EKS cluster. Some of the part
46:21
you might know you understand some of the part you might not does not matter especially this part I will explain you
46:26
in a minute. Okay so let me very quickly check I want apps I want full ACR want
46:34
external this one. So yeah that's okay guys this is the final command big command I know but the final
46:41
command. So let me run this command. We are going to run this command with EKS
46:46
create cl. Okay. So this is the command we are
46:52
going to uh use right and obviously you want to run the command uh you can't
47:00
give enter here. Okay. So either you can write the command in one single line or
47:06
you can write this forward slash.
47:11
Okay. Therefore has work in a command prompt as a new line.
47:18
So so I can copy paste and run it right.
47:24
So by the meantime the gas command is running it will take around half an hour to set up the cluster. The way we want
47:29
to use in today's ingress controller same setup can be used on the top of
47:36
also service mess if you know. Okay. And let me run this command. This command we
47:42
can't run directly on the Windows CL uh prompt. So you can have if you have a G batch kind of prompt is more look like a
47:48
Linux prompt that I have otherwise you can install in your system. I'm going to install over here. So let
47:55
me copy this command and paste right enter. And that's all our
48:03
cluster start setting up will take half an hour. Okay. So we will use this time to
48:11
understand the today's class called ingress controller and when I explain this ingress controller concept
48:18
automatically you understand these parts
48:24
okay this part why we are enabling some extra add-ons
48:29
okay so let's start guys with the today's uh topic called ingress
48:35
controller very very interesting topic very much realistic and useful full and
48:40
uh in the uh today's world of microervices or today's world of the way
48:45
the application has been managed. Okay. So let me explain you guys in this
48:51
way the use of ingress controller right. So idea is something like this. Let's
48:56
say in your company you have multiple products or multiple apps created by
49:01
your developers. Okay. one of the app that is created by
49:06
your developer. Okay, let's say the mailing app
49:13
with this app you uh we or your employees of company can mail and do
49:18
something. Okay, it's a mail app and obviously this app they will put in some
49:23
image container image and from this image they will launch a container that
49:30
you know they launch a port. How many port they launch depend let's say they
49:36
launch two or three port okay to manage the traffic or load balance.
49:41
So there's a port one port two port three and all the port
49:47
is same copy of the mail application. Okay. And to balance this load you guys
49:54
know in the kubernetes in open s we use uh load balancer that is mostly known as
50:01
service. Okay. Now service also give the facility
50:07
you want this load balancer to be used within the cluster
50:12
or outside the cluster. Okay. Outside the cluster of open ship and the kubernetes.
50:18
Okay. If you want this load balancer to be used outside the cluster also maybe
50:25
because some of my client is sitting outside the cluster they want to access
50:30
the the the port the mail services for this cubin give a capability called
50:38
node port okay so this service node port with this
50:45
we can expose our application to the outside You don't need any third party tool for
50:51
this. So, cubernetes has or open has a concept expose concept or route concept
50:57
or node core concept through which we can connect give the outside guest the
51:02
connectivity to our to our applications, right? Okay. So, let's say we want this. So, we have set up the node port
51:09
service. Okay. Uh so, it means my service. Okay. Let me give the service a
51:14
name also. This is the mail service. where they're managing the meal. So any
51:20
request come from the client outside they will load balance and also give the
51:25
client access to the to the internet. Okay. So this is the one
51:33
uh kind of application you have. Okay. And obviously because they're coming to the load balancer this load balancer
51:39
should also have IP address right. So let's say the IP address of this load balancer is 1.2.3.4 before with this IPA
51:45
for load balancer also service similarly let's say your company have
51:50
one more application okay is again created by your developer and let's say this application is more
51:57
like a your company internal search engine okay and similarly because there may be
52:04
multiple load going to come up so they will create and create multiple replica of this service again there's a port one
52:11
port two port three from the service search app similar same concept I want to manage
52:20
the load so we launch service here your client who is going to use the search
52:25
engine they are mostly outside the cluster obviously okay so I want my
52:32
service to be node portal means I want the these client from outside can
52:38
connect okay and let me give the service a name also let's say the search service.
52:45
So it means anyone come from the outside any client from outside okay they will
52:52
balance the load and plus do the connectivity also okay and because this is a service or the kind of load
52:58
balancer they also have the IP address let's lesser IP address of this guy maybe 2.3.4.5
53:03
4.5 okay like this there may many more
53:09
applications they have now these are the individual application maybe like a
53:14
monolithic or these can be a individual microservices also
53:20
okay so depend right what how you architect your involvement okay so you
53:25
consider these two applications servers and mail as a two microservices or two individual services application in your
53:34
Okay. Now point is like this there might be many more many more applications like this right
53:41
now. Point is the challenge here is right if this
53:47
product company okay let's say I'm taking my name our name company name Linux world okay I
53:54
want to provide these applications to my customers or I have around let's say 100
54:00
plus application like this now how can I give the u access to my my
54:07
client okay one approach is I have 100 plus application. So I will give IP4 is one
54:16
application where uh where email is running. IP5 this one is a one where
54:23
search engine is running and so on means 100 application 100 IP I have to manage.
54:31
So we can manage is no challenge but as a one company
54:38
giving 100 IP to my customer. So customer will does not feel good user experience right is a customer
54:44
perspective right for them is very harder to memorize okay memorize that okay IP5 belong to
54:51
source so they might have to maintain a some kind of
54:56
uh you know some kind of node for this right so does not my point is this does
55:02
not look makes any sense for the customer point of view right they can't memorize all IP and what this IP can
55:10
Other approach I can use is instead I give the IP address I can give every IP address a name DNS name. Okay. So name
55:19
can be for example my company name is Linux world. So maybe we might have purchased one domain
55:26
that's called Linuxorld.com and in this domain we can create one subdomain or one host name let's say
55:32
mail.lennxworld.com linuxorld.com. Okay. And this domain name we give
55:38
assign to this IP address. Then we purchase one more uh subdomain or maybe host name in in our DNS. Let's say
55:46
search.com that will be associated with IP5. Okay. IP5.
55:53
So this can be better approach. So I can give all those 100 names
56:01
to my uh uh to my uh clients right and say if you want to connect to sir then
56:07
come to s.lo.com mailmail mail.el.com and I'll try to give my name simple like
56:14
people. DB. So it will be it can be better approach
56:21
better approach right but in this approach so guys you know what I'm trying to do here right I'm trying to
56:27
make give a user a better experience this is one of my moto okay when we have multiple applications
56:34
to be to be running here okay so I don't want my customer will will manage
56:44
or memorize these many IP addresses Right. So well I'll make the name simple but again giving so much name
56:53
will lead many more issues. Okay one issue maybe you can say you can
57:01
say that how customer know this name. So this is one one issue maybe that we can
57:07
solve it other way by creating some extra application on the front on the top of this.
57:12
Okay. How the way Google has created. So if you go to Google
57:17
right so what they have done they get this kind of front end and here they give all
57:23
the application name so the different application from the Google
57:28
okay so there's multi-purpose we can manage this but the point here is different right if you give a different
57:34
different name then every name okay from our company perspective as a
57:40
Linux world perspective I have to maintain different different certificate So if you guys know HTTP we have HTTPS
57:47
also security right okay and every host name we have to maintain different different certificate
57:54
this called CRT or CS certificates they signed by C I can say server
57:59
certificates okay and many more other challenges also
58:06
okay so my point is why why I'm leading here right what I want to do right to
58:11
make the thing very simple I don't want to um give so many IP address to my
58:18
customer. I don't want to give so many different different host name to my customer. I want to give to one single
58:25
host name. Okay. One single host name.
58:31
Okay. And again guys, the moto is not moto is not about
58:37
about the certificate only, right? There's many many more things that I add in a minute. Okay. Because you guys
58:42
might say somebody also saying here we can use wild card center also that's that's true you can use wild card but there's many more examples I will add on
58:49
the top of this then managing the domain name or host name in this way does not make sense right so my my main point
58:55
here is then I can add many more use case on the top of this right is what I
59:02
want from my company perspective I want to use one single
59:10
domain name or host name. Okay. And I want to give this host name
59:17
to my customer and say just memorize memorize one host name.
59:24
Okay. It means if one host name means I have to only mention one IP only. My
59:30
company is going to manage only one single IP. Let's say IP 100. More host name more IPO to manage. More
59:38
host name more IP you have to purchase more host name more IP you have to
59:44
manage management is a big challenge management in in many more way maybe in
59:50
the words of firewall also many other ways also I want to keep one host name
59:56
it means one certificate one IP address does one single management
1:00:03
course that's what I want okay but by using one IP address or one
1:00:09
host name. Okay, I can give a way certain way to my customers.
1:00:17
Okay, to my customers or my clients, they can reach to this application also.
1:00:22
They can reach to this application also just by one single host.
1:00:30
Okay, let me give one realistic example then I'll tell you how it possible. Right? For example, if you go to Google,
1:00:39
okay, what they have done, they use only one single host name. Just go
1:00:44
ww.google.com. This is one single host name they use. It means they using one single
1:00:52
uh one single let's say IP address. Okay, even they might have many more.
1:00:58
There's a different reason for this. But let's say they using one single IP address. So client has to me manage one.
1:01:05
Google has to manage one certificate. They have to manage one IP address and all the respective settings of
1:01:10
management and security they have to manage for one. Okay. But Google has 100 plus application. Right. Now what they
1:01:17
have done that they say IP is one host name is one. But if you want to connect
1:01:23
to my search application in the last type search
1:01:28
I understand you on the client but if you type / search I will automatically understand by looking at this
1:01:36
path. Sometimes this path also known as route by looking at this route or the path
1:01:44
I will understand which application you want to connect. So I will connect you to my search app. Okay. To this search
1:01:52
app and this search is maybe managed by different cluster, different area, different cloud, different team does not
1:01:59
matter. I will connect to this app. See here they can do whole search.
1:02:06
But if some of my customer okay they want to connect to
1:02:13
to the different app of the Google. Okay, same IP, same name.
1:02:20
Just typing mail in the last. Okay, they will tell you. So guys, right
1:02:26
now I'm a client. Okay, I'm a client. Just by typing / search
1:02:33
or just by typing / mail. Okay, this is what client typing, right?
1:02:40
But we as a company somehow we understand by looking at this route
1:02:46
or also known as path where they want to connect to which
1:02:51
application they want to connect. Okay. By mail I understand they want to connect to very different set of uh
1:02:58
application. They want to connect to this service actually or this load balancer actually.
1:03:04
Okay. If you see see if I hit enter. Okay. same IP, same host name but now they connect to different manage by
1:03:10
different team, different cloud or different area maybe. Okay, this concept guys is known as
1:03:17
pathbased routing. Okay, just by looking at the path will
1:03:26
route our customer either this side or that side.
1:03:32
Okay, and this has a lot of advantages. One of the advantages I explained to you now we have to memorize only one host
1:03:39
name we have to maintain one IP address all things will be around this only we one certificate client has to memorize
1:03:46
only one IP address on the host name okay but just by typing the path they
1:03:52
will reach here and there this is one use case of it might not but is one use
1:03:58
case there may be many more use case okay on the top of this we can build
1:04:03
I'll explain you as we network is okay and by chance anyone anyone know
1:04:09
REST APIs again this is not a class for rest API but anyone know REST API rest API purely
1:04:16
work on the path based routing okay that has been totally been uh and
1:04:24
that has been totally been used in the microservices world right so so my point
1:04:30
is uh if you don't have a program they that can understand your path and
1:04:36
according path they will decide where to route then you can't do much in the micros
1:04:41
service world also I'll tell you some example in some sometime okay so let me again create
1:04:49
this diagram that's what the Google also using here that's what I want to show you here is okay let me create this
1:04:55
diagram one more time very very quickly so what I want I have a two application here one application is managed by this
1:05:02
service name is called as a mail running behind multiple port does not matter
1:05:08
that is managed by service that you don't have to handle you we don't have to worry about this and we have one more
1:05:15
service there is let's say search service that have their own application
1:05:20
port okay what I want now okay what I want
1:05:27
now I want now client will only type the post name.
1:05:37
Okay, let's say w2.google.com and then the path.
1:05:43
So what I want I want right when the client type this this is mostly known as
1:05:49
URL sometime known as end point. So when the client hit this end point I
1:05:56
need some program. Okay. And what this program will do
1:06:04
this program will will so it is something like this. When
1:06:09
a client write this this this this request go to this program how they go
1:06:15
to this program we'll discuss okay they go to this program and this program what
1:06:21
this program will do they will go go and check the path what path they use
1:06:28
okay or what route they use if they use the route SL/mail
1:06:35
then this program utility is to route this customer request to this service.
1:06:44
If there says search in the path then this program
1:06:51
okay is to take this request that's coming in and guys any request coming in
1:06:57
from outside world mostly from the customer are known as inbound traffic is also
1:07:03
known as ingress traffic. So any ingress traffic going to come up from the customer from this traffic by
1:07:10
looking at this URL. Okay. And you guys know also if any
1:07:16
request come from the customer no mostly if they kind of trying to connect with the application mostly the request is
1:07:22
HTTP or HTTPS. And if you guys know about HTTP, HTTPS,
1:07:28
this is the network packet and network packet we have multiple layer but top layer mostly known as layer 7
1:07:35
are known as application layer. Okay. And here in the application layer
1:07:42
we have maintained HTTP header on HTTP header
1:07:48
are the one who can maintain who maintain the path.
1:07:55
So any request come from the client it is stored in the packet and the packet in the
1:08:02
in the HTTP header and what they maintain which path they want to go
1:08:07
which route they want to go. many more things they also in the header. It means
1:08:13
I want a program that has a capability to read my HTTP header layer 7
1:08:22
or HTTP header or the application layer from there. Okay, any guess going to
1:08:28
come up from there they read the path and based on the path they decide which
1:08:33
side they want to route. Okay, they want to route this
1:08:39
application or they want to route this service is same thing.
1:08:45
Okay, this is what uh we're looking for. And name of this program,
1:08:51
this program is known as ingress resources.
1:09:00
Okay, so it's not controller, there is ingress resources.
1:09:05
Okay. So inress resource is a program that give you this facility. This is one of the example. There many more thing
1:09:12
again you can build on the top of this thing. Right. My point is if ingress resource is one program that is a
1:09:17
capability to read all the incoming traffic ingress traffic from the customer and can able to read your
1:09:26
HTTP header. Okay. Then we can achieve many more things. Okay. What many more things? We
1:09:33
will talk about one thing I explained to you is by reading the path
1:09:39
from the customer that's what I write here by reading the path from the customer. Okay, this request go to the
1:09:46
ingress resources of Google and uh by looking at the path they decide hey I'm
1:09:53
helping you in one way right now how routing right okay and I have a
1:10:01
rules okay that we have to create so as a IT operations guys or who are managing
1:10:08
these resources okay so let's say we are the IT operations team member or admins
1:10:14
So we have to create the rules. Rule means when this path come where to route
1:10:20
when this path come where to route and many more things we can do this called rules routing rules that we have to create where in the ingress resources we
1:10:28
have to create. Okay. Now point is ingress resources you can
1:10:36
think is like more like a rule more like instructions.
1:10:41
Okay. We as a team we know where where I want to uh route. So we will create a
1:10:48
rule and this rule will provide to this guy.
1:10:54
Okay. So in resources is more like a managing a rule or the instructions. But technically finally what we need we
1:11:03
need a program who will read these rules and accordingly they they they implement
1:11:09
what the what the rule says. Okay. Or I need a program that has a
1:11:15
capability to take the request from the client.
1:11:21
Okay. And obviously we need a program okay that we they can take the request from a client because client will type the host name also right. So this
1:11:28
program should be a kind of real program or real device maybe okay that has a capability to connect
1:11:37
to the from the client of over http https then read the packet and do many more things like routing or some more
1:11:44
things. Okay. This program is more look like a
1:11:51
like a router. Router guy is also known as sometime gateway
1:11:58
or this program is more look like a maybe we can say it's not perfect word but kind of load balancer
1:12:06
but not the typical load balancer. Okay. Okay, when I say when I use the word load balancer, it mostly means and
1:12:13
it will come we send here and here and here. But again, we have some kind of specialized load balancer also that has
1:12:20
a capability to read layer 7 or application layer. They known as
1:12:25
application load balancers and what they read depend on the read we can create a rules
1:12:33
and based on rules they can do some many more things. One thing is this is what I explained to you.
1:12:40
Okay. So this is a uh program
1:12:45
and in this program what can we use? We can use some some kind of application load balancer. Now this application load
1:12:51
balancer you can go for some some third party tools or appliances and devices available for this or you can take the
1:12:58
application load balancer. Again guys this is not a part of cubernetes or open
1:13:04
sift is a third party outside the kubernetes or outside the open sift. Okay. So we have to pick some
1:13:10
application load balancer that will control this entire routing. The example I
1:13:18
explained to you here is okay. So in this case this program or
1:13:24
maybe you can use gateway also as a term here right now or this program the same thing right are the one who is managing
1:13:31
the ingress traffic the controlling the ingress traffic. So then this program guys is known as ingress controller
1:13:41
and one of the ingress controller you can use called ALB application load balancer.
1:13:48
Okay, if you want to implement this this use case routing use case, this use case or path based routing use case is the
1:13:55
better term. Okay. Now,
1:14:01
which application load balancer you can use? Okay. So, there's many more application
1:14:06
load balancer guys in the market available. Okay. One is the opensource
1:14:12
softwarebased application load balancer is engineext
1:14:18
is a software. Okay. But this software we can use web server also load balancer also. But this
1:14:24
software has a capability of of uh uh application level or
1:14:33
application load balancer level of capability they have in Gen X. This you can use. Okay. So if you guys was have
1:14:41
done my cubernetes training CKD I think this is one of the demo I show you there that inside the cubernetes we installed
1:14:47
the engine x ingress controller to set up this informat
1:14:54
okay but this can also be used but in our class today because we are setting
1:15:00
up this entire cubernetes entire cubernetes on the top of AWS and
1:15:08
AWS has a powerful Full load balancer that work as ALB load
1:15:14
balancer is ALB only this called AWS ALB load balancer.
1:15:21
Okay. So those who know AWS this is the one load balancer. If you go to EC2
1:15:28
service if you go down here okay I'm in the Singapore region right
1:15:33
now. And if you look at load balancer so they have ELB load balancer. Okay, under
1:15:39
the ELB there's many more different kind of load balances they have depending use case to use case. Okay, so if we click
1:15:45
here so you go to GB, NLB, ALB.
1:15:52
If your use case is you want to do something on with the help of HTTP header or path based routing or uh
1:16:00
application level load balancer then this is what you can use.
1:16:05
Okay. and they give you lots of power and facilities. That's what we're looking for, right? So my point here is
1:16:11
it is your choice which software or which program you want to use or which service you want to use. You can go for
1:16:19
uh big IPF5 load balancers and real appliances or you can go for uh AWS
1:16:25
services called ALB. You can go for some software free software engineext traffic
1:16:31
and many more products and software available. You can pick one whatever is
1:16:36
feasible to your requirement. I'm going to pick this one ALB.
1:16:42
Okay. For this program, okay, or ALB would be my ingress
1:16:48
control. Okay, that's can be better term. So finally what I concluded guys.
1:16:56
Okay what I concluded I am and we are going to launch ALB
1:17:04
is a load balancer from AWS.
1:17:11
Okay. Uh AWS load balancer and this load balancer guys will belong to AWS only.
1:17:17
So they will reside in AWS world. Okay. But what AW will do is they will
1:17:26
do the load balancing. How? By looking at the layer 7
1:17:31
application layer. Means they can read your path.
1:17:36
Which path? What are the path client will provide? Okay. Provide to this load balancer. And
1:17:43
guys, this is load balance for AWS. So AWS also give the IP address, right? So
1:17:48
when you launch this load balancer right when you load this load balancer
1:17:56
here you can say internet facing means anybody over the internet can
1:18:03
connect it means they give a public IP address right so this ALB will give the
1:18:08
public IP to us so the client of anyone from the world can connect so there's no
1:18:14
connected issue and because application load balancer they support HTTP or HTTPS
1:18:19
as both. So the challenge also we don't have to worry about it. Plus they also
1:18:24
understand if the client have any path. So they understand the path. They can read the path.
1:18:31
Plus they can read the path. So we can create a rules also in ALB.
1:18:38
So we can the rule. Rule means the rule they explain to you. The rule can be if somebody write the path/
1:18:44
uh search then send to the different set of services.
1:18:51
Okay, the way I explained to you our rule is when somebody types less uh mail
1:18:56
than send to different set of computers or set of applications or set of microservices.
1:19:03
So the entire concept why I was trying to explain you guys
1:19:09
okay is there an ALB. The point is if there is the ALB so why
1:19:15
we are trying to connect with with with Kubernetes right why the role of
1:19:21
Kubernetes here right so technically what we want to do here is okay the final setup would be something like this
1:19:29
we are going to use AWS ALB
1:19:34
for rule creating also doing path routing also
1:19:41
path is When somebody come here we'll send somewhere somebody write this one
1:19:46
we'll send somewhere this path routing or path based uh routing
1:19:53
okay sometimes known as rulebased routing also okay everything we done here right the
1:19:59
point here is okay the point here is ALB
1:20:05
uh is uh great for your instances is
1:20:13
so anyone who ever work on ALB normally guys when you set up the ALB.
1:20:19
Okay. So if you go ahead here we type somewhere
1:20:25
okay in in the further the settings right you type the instances
1:20:31
the computers where or EC2 instances if you know
1:20:36
where the application is running. Okay. But in our case,
1:20:41
okay, our application running within the open and the cubernetes. What I mean by this, right? So technically this is the
1:20:50
this is the uh setup we have right we are into a
1:20:56
different world right. So we are into uh into or inside Kubernetes
1:21:04
or application inside the Kubernetes. What I mean by this?
1:21:10
Okay, we have a service here. Let's say mail service
1:21:17
running with ports. Everything inside the cluster.
1:21:23
We have one more service. Let's say search service is again inside the
1:21:29
Kubernetes or the open source environment. Okay. So this box is a cluster container
1:21:38
cluster less a kubernetes
1:21:43
okay this is kubernetes and this is AWS no relation is independent thing right
1:21:49
isolated thing or independent things okay now how we going to connect these
1:21:55
two boxes okay two things right what I want my
1:22:01
application is going to run in the port
1:22:06
that's what you want because I want kubernetes why why kubernetes you know
1:22:11
okay the port load b will be done by service only because service is the one who know
1:22:17
dynamic port creation and removing so I don't I can't remove this okay service is the one we want to use finally
1:22:25
okay so I don't want to my main point is I don't want to change this setup this is what we want this is the my
1:22:32
application This is my application two.
1:22:38
But on the top of this what Kubernetes does not support.
1:22:43
Okay. There we have to go for a concept called ingress controller. Okay. Here we
1:22:48
are going to use ALB. But how? AL from AWS.
1:22:55
Okay. How we connect this? And connecting is not the not only thing I
1:23:01
also want to manage also in the future. Manage means we as a Kubernetes admin.
1:23:09
Okay. If in the future one more service going to come up
1:23:16
I also would do some routing here or maybe some routing I want to change here. Some routing I want to change
1:23:22
here. I don't want to go to my ALB again and again and change the raw rules there
1:23:27
from the cubernetes point of view. Okay. Everything I would like to manage here
1:23:32
only. If you want to create a rule, I want to create a rule within the cubernetes.
1:23:39
I will update the rule within the Kubernetes with cubectl command. I don't want to go to
1:23:46
here. Two point is okay. I don't want to leave my platform. everything I want to do from kubernetes only.
1:23:53
Second thing is I don't want to go to uh
1:23:59
how I how we connect ALB to uh to cubernetes world. So here there's two
1:24:06
things going to come up guys. One that one program we have to inject here
1:24:13
inside the Kubernetes
1:24:26
Okay, this is what this program going to do. Okay, or I can say this program is going
1:24:32
to control our ALB.
1:24:37
Okay, two things they're going to do. And this program guys here is because ALB is not now a normal load balancer
1:24:44
for us. It is a ingress control also. This program is known as ingress control actually.
1:24:51
Why ingress controller? Because you're controlling our ingress traffic or the controlling who are the one who are
1:24:57
going to control our ingress traffic. Who are going to control traffic? ALB. So this program is called ALB ingress
1:25:04
controller. If you're using ALB of AWS or AWS ALB controller is a better term
1:25:11
or it can be engine X ingress control if you use engineX product somewhere.
1:25:19
Okay. So this program is to control and connect also.
1:25:25
Okay. And how to control? We are the one who going to control by creating the
1:25:31
rule. Now we don't have to get the rule here in AWS world. What we do? We can add one
1:25:37
more component here. This component is meant for the rules.
1:25:43
So we as a ID team, occupations team will connect to connect to this
1:25:48
component and change the rule, create the rule, modify the rule, you know,
1:25:54
like a routing rule. explained to you and any rule whatever you write here this rule will be injected here and this
1:26:00
control will go and say some reason change update your rule in AWS world
1:26:07
okay so that any customer come in the future whatever rule updated in you
1:26:14
by me who instructed me this rule rule my IT team
1:26:19
so thing to be can companyly managed within the kubernetes world and This component guys in the cubernet is known
1:26:26
as ingress. Okay, this is just a one one uh I can
1:26:33
say one new resource type in kubernetes right you know port resource service resource. So this is also one resource
1:26:39
we have this called ingress resource it meant for creating the rules or
1:26:44
managing the rules that's all okay for any rule you manage it will be
1:26:50
as soon as you change it will be directed to instructor to the controller
1:26:56
controller is just like a program actually okay and you know you guys know
1:27:01
any every program will run in the pool so it is like a pool and every port you guys know is run by deployment is like a
1:27:07
deployment So in control is like a deployment one kind of program
1:27:12
but this program is keep on taking the rules and keep on updating these guys and updating their rules without going
1:27:18
to AWS a it means if you don't know AWS if you
1:27:25
don't know ALB if you don't know any other other ingress load balancer or
1:27:31
external load balancer whatever you say here does not matter you don't need to know
1:27:36
Okay, for UI stand point of view, as a cuber stand point of view, okay, you
1:27:42
should know how to get the rule in this inquiry and this is this will be standard.
1:27:49
Okay, behind the scene use ALB load balancer or engine X does not matter for as a guys the way we create the rule is
1:27:57
the standard way. It won't change. Okay, only thing that changes is this
1:28:04
program. If you if you want to connect to the AWS, then this is AWS ALB ingress
1:28:12
controller or Azure ingress controller or engine uh
1:28:21
uh ingress controller only this program will change. Okay. And again this is one
1:28:27
time setup right you don't have to worry about initially one time setup we have to do this
1:28:33
okay one time setup one time connectivity otherwise in the future as a team we have to just keep on changing
1:28:39
the rule based on rule thing will work for us okay so this guys the architecture how
1:28:46
it going to uh uh it going to uh work
1:28:51
here okay so otherwise when we see this demo you will understand so My point here is
1:28:57
my point here is uh even the one more interesting thing is your ingress
1:29:02
controller will also set up the ALB load ber for you. It means you don't have to come to this page.
1:29:10
You don't have to create the ALB load balancer also. This also to be automatically
1:29:17
it means as such you don't have to go to a AWS environment. Everything to be done from the
1:29:23
Kubernetes only. Okay. So this also one one interesting
1:29:28
point. So a controller will create they will look if ALB is there what we're looking for is there that's okay. If
1:29:35
there is not there they will create the load balancer for you. Which load balancer?
1:29:41
Okay it can be ALB it can be NLB. Okay that's also we can write in the
1:29:46
controller. I want to create ALB load balancer or NLB load balancer depending on the requirement. You can you can tell
1:29:54
to the controller they will create for you and how we'll discuss and see.
1:30:00
Okay. And that is the reason guys. Oh come on.
1:30:08
This command not found why not found.
1:30:20
What should I do now? It should be there, right?
1:30:25
External DR.
1:30:32
So, this is not work. That's okay. But this might not create issue. But this
1:30:38
might create the issue. Let's see in the future. But technical micro cluster is up. And if I run the cubectl get node,
1:30:46
how many worker node we have? This come will tell you. So we asked them to create four worker node that's to
1:30:52
created and um if you see how many ports running right now I don't have any port
1:31:00
running this is a new cluster so cluster is guys up okay and this is a cuberance command from the command we can see
1:31:06
because asked them to create three worker node so three worker node they created for you so what I'm going to do
1:31:15
guys I'm going to set up this environment Okay. And it's a one time setup. Which
1:31:23
is one time setup? Setting up the ingress controller is the uh one time
1:31:28
setup. Okay. So let's go ahead and create this. So what
1:31:35
I'm going to do, okay, and and by the way guys, you might
1:31:40
also understood why we write this.
1:31:46
in this command ALB ingress access.
1:31:51
Okay, this is what we write while setting up the cluster.
1:31:56
Why? Because we are setting up this cluster
1:32:04
in EKS service of AWS and ALB
1:32:11
is a different service in AWS. And if you guys know about aircloud one
1:32:17
service want to access the service we have to give some permission this called IM permission this role
1:32:26
this IM role because in the future EKS will go to LB
1:32:32
and create it change the rule how who in the case is this controller
1:32:38
so if you don't give this they they will fail that's what we have to do
1:32:46
Okay, what about others? As I progress in this discussion, we will talk about what the need of other keyword. So this
1:32:53
keyword will create some rule for you in AWS.
1:33:00
Okay. So there's the reason why I given this keyword. So now what we I'm going to do here this kind of explain to you
1:33:08
and if you search that this is the document you can find from AWS okay how you can create ALB as a ingress
1:33:19
controller in the Kubernetes okay either you can create want to
1:33:25
create ALB or LLB whatever you want in my case I'm going to create ALB application load balancer so AWS
1:33:33
ALB we going to use with Kubernetes but as a Kubernetes ingress controller
1:33:42
okay and for this for this setup
1:33:47
okay and I told you guys this is one kind of program I'm talking about this green box here
1:33:53
is one program technically this program is a one kind of opensource program that's what is talking about is a kind
1:34:00
of opensource program they get find in the GitHub you want to see the code if you want to see
1:34:06
the managing here okay opensource program okay this is one
1:34:14
thing but uh main thing is
1:34:20
okay main thing is they will tell you the prerequisite to set up this what we need we need a EKS cluster I have
1:34:29
okay so we need a EKS cluster plus
1:34:34
okay we have to create OIDC in AWS and connect to this cluster
1:34:44
okay what are use of this as a progress in this further practicals
1:34:51
I will explain to you but what they're talking about the cluster that you have created you want to see your cluster
1:34:57
name ekl is a command eksc ctl get cluster and I can create a cluster in a
1:35:04
region called called uh AP southeast one.
1:35:15
Okay, this cluster is created even though you can see from AWS also page.
1:35:22
Okay, this cluster now refresh has been created in AWS in Singapore. Okay, this
1:35:30
cluster we have to give some extra power.
1:35:36
Okay, which power? So if you go to IM service,
1:35:42
there's one service that manage your authentication part in AWS cloud.
1:35:49
So in the IM service, there's a
1:35:54
lot of way we can do authentication. One of the way to do the authentication
1:36:00
right in the cloud services is by ID TT provider IDPS.
1:36:07
Okay. And here guys we have to create the identify OIDC.
1:36:13
And if you notice guys this is just now we created 36 minute ago.
1:36:18
This has been created automatically for us. Why we need I will tell to you in a minute. Right? But this is created
1:36:25
automatically. Why? Because I write in my command.
1:36:32
Why we need this? What what this will do? We'll discuss, right? But what I'm just trying to tell you, I'm just
1:36:38
following along the document of AWS. And they say no, we need OIDC
1:36:44
power for this cluster to be given. Okay. So that's what we read this
1:36:50
command and they created for you. What a use of this we will discuss about
1:36:57
for our cluster my cluster okay this was the name we have created
1:37:03
this extra component in AWS okay
1:37:09
but don't worry we'll discuss about why okay now next part is
1:37:16
uh there's some more things that might not be so much important right now as we need we'll discuss right but these two
1:37:22
things we need to Go ahead cluster we created OIDC we uh set up it is you can
1:37:29
think just for some time it's like for authentication purpose why and where we'll discuss
1:37:36
okay now let's follow along the next part of this
1:37:41
now uh they're talking about guys your EKS cluster mean Kubernetes and from EKS
1:37:48
you're going to use many more resources in AWS this.
1:37:54
Okay. Especially the application load balancer.
1:38:00
Okay. So for this you have to create a rule or rule I can say and this is the
1:38:07
document for the role. Okay. So copy this document.
1:38:15
Okay. And download here.
1:38:22
So ide simple uh from uh EKS we are
1:38:28
going to use lots of services ALB we going to use many more services we're
1:38:34
going to use for example EC2 instances EBS and cloud watch if you know okay so
1:38:42
what we are going to do uh we're going to get a policy for this even though if you open this file
1:38:51
just on you can say they're going to allow elastic load balancer, EC2 services,
1:38:59
some other IM service or many more services that we might need in the future classes.
1:39:06
Okay. So this policy we have to create. How?
1:39:12
Either you can go manually in IM services to go and create from here or
1:39:18
they give a command directly. So let me use this command.
1:39:23
Okay. So we are going to create this rule
1:39:29
AWS. In my case guys, I already have the A account uh AWS
1:39:37
uh what I say command line already installed and been configured. In my
1:39:43
case they giving me a error because they say this policy already created in my case in my setup. Let me check let me
1:39:50
remove then I can create one more time. and the policies if I search for this policy I already
1:39:58
have.
1:40:04
So I already have. So let me delete this so I can show you one more time to create.
1:40:12
So your choice you can come here and create or you can create from the command line.
1:40:19
Okay. So let me run this command one more time. and they create this policy.
1:40:26
So if you again refresh you can see this policy going to come up. What this policy will
1:40:32
give you they give you power allow power
1:40:37
allow power to is EK services. Okay for on other service also what EK
1:40:44
is going to use that was the policy we have created.
1:40:50
Okay, the next thing is okay. We have to create the cluster.
1:40:59
Uh that's what we No, not the cluster. Cluster we already created. Okay, we
1:41:04
have to update the cluster name space. Okay, because right now we create a
1:41:10
policy, right? So one minute. So we have created a
1:41:16
policy with the help of this policy my EKS service can connect to many other
1:41:24
service AWS just for example EC2 service for example
1:41:30
EPS service that they're going to use in the future okay this policy document
1:41:36
created but this policy document attached to this ES right then only they can use it
1:41:43
okay so we have to attach This poly recommend that this service or this EKS cluster now we are giving this power so
1:41:50
that they can point to the service in the future whatever they want to do they can do it
1:41:56
okay so that's what the command they have given to us okay in this command
1:42:04
only two things you have to change okay one
1:42:10
your cluster name in my case I use a create a cluster with my cluster this is for the name you to give which cluster
1:42:16
you want to change.
1:42:22
Okay. Second thing is I believe you to write a name of the region also where this
1:42:29
cluster is running
1:42:34
this one. And last thing is which policy you want to connect because there are lots of
1:42:41
policies we have. Okay. which policy you want to connect
1:42:47
sorry which policy you want to connect. So
1:42:53
every policy guys has a unique name this called a RN number.
1:43:00
Okay you give a which policy. So you can copy this AR number from here. Okay
1:43:05
either copy from here or your command line when you create it they give this a
1:43:10
number. You can copy from here. to tell which policy you want to
1:43:16
connect. So here have to update
1:43:22
this name. That's all. A small change you have to do here. That's all. Now
1:43:28
this command will give your cluster my cluster that you can
1:43:36
allocated to this policy means this power you will have.
1:43:41
Sorry. That is a one time again one time setup right. So you're updating in the cluster
1:43:48
some policies. So finally now your EKS cluster have power to connect to some of the
1:43:55
important services like ALB and many more whatever they need in the future we have given this power.
1:44:02
Okay. So this step has been done.
1:44:07
Okay. Next thing is this is optional. We don't need this option. We don't need.
1:44:14
Next is this part. Fifth step. Okay. Now guys, here we are going to
1:44:21
install a main thing. This ingress controller.
1:44:27
Okay. Ingress controller. Okay. What I mean by this? Uh
1:44:35
what I mean by this guys? Even though I want to show you one more thing before I go ahead. This part is done.
1:44:41
Okay, this part done. Now what this this guy has done, right? This guy has created
1:44:50
created a service account
1:44:55
in your name space called cube system name space.
1:45:03
Okay. And if you notice here there's one service account they created
1:45:10
with this name. Okay. So this command the last count I
1:45:15
run right this command has created a service account with this name
1:45:23
with this name. Okay. And what the service account doing? If I just further get this name.
1:45:34
Okay. What the service account is doing. Okay. So if you guys know a little bit
1:45:41
about kubernetes or open s right. If you want to give any code
1:45:49
some power in kubernetes.
1:45:55
Okay. or some authentication to some other other part of the Kubernetes then
1:46:01
we have to create a service account. Okay. So this service account we created
1:46:06
they're doing something for you and this is the service account where we
1:46:12
annotate means we write if anyone who use the service account they will have
1:46:18
this power from AWS. Okay. So in the simple term what we are
1:46:25
going to do okay we are going to launch this program
1:46:32
it's not yet been launched yet the main program inress controller
1:46:38
okay but this program is the one who is going to contact to AWS
1:46:47
for this we have to give this program a power and any pool or any program you have to give a over
1:46:54
or the authority or the authentication right especially the authentication part
1:47:00
then we create a service account concept in kubernetes or in the open
1:47:06
okay this is one thing second thing is because it's more of authentication part
1:47:15
mean this port is going to authenticate to AWS first to use ALB and to do something there
1:47:22
and guys if any other tool is going to authenticate to other tool or one
1:47:27
platform is going to a other platform here the role of OIDC come in play OIDC
1:47:35
come in play okay and that is the reason why we get
1:47:41
the OIDC here so what is OIDC is not a training
1:47:49
is a training Normally we discuss in the security training of AWS in detail but I'm just giving you a very
1:47:55
quick audio why we have to u enable this here
1:48:02
okay enable this here so that this
1:48:08
can able to authenticate to AWS then only they can do something right
1:48:14
and if you want they won't if you want they authenticate because cubid is a different problem maybe we are depending
1:48:19
on the AWS but Kubernetes is a different platform altogether. If one platform want to
1:48:26
um uh authenticate other authenticate to other platform then the concept called if you
1:48:33
guys know it's called identity federation concept come in play and there we have to set the OIDC
1:48:40
okay so this keyword have done all everything for us you don't have to worry so anyone from this cluster want
1:48:46
to go to AWS if they need authentication we have set up the OIDC for them okay
1:48:52
and that's What you can see from here also in AWS in identity provider this
1:48:58
OIDC has been set up and provided to us.
1:49:03
Okay. This one that's what we have done. OIDC
1:49:12
what OIDC how they work. All right. This is not at all the part
1:49:18
of this training. Normally we discuss in the or training and seml training and identify training or security training
1:49:24
this concept but I'm trying to explain you why we need this okay and that is a uh use of this uh
1:49:32
part okay now finally my this controller is going to installed
1:49:40
is not yet installed we're going to deploy this controller but this controller is going to connect to AWS
1:49:46
for this we have to provide them a service account and this service account has been already created. How? By
1:49:54
this command. Okay. And I show you already the service
1:50:00
account created. Okay. So this is a one thing. The next
1:50:08
step is okay. Finally we will deploy our
1:50:13
controller. And guys if you want to deploy any port any application in this case is a controller
1:50:20
okay uh there's a multiple way guys in the cubernetes to deploy some port some
1:50:26
applications right okay nowadays the most sophisticated way to deploy the
1:50:32
applications okay or the port is with the help of a
1:50:38
tool called helm hm helm so helm is a tool through which we can
1:50:43
deploy application or the port or deployment very quickly. Especially if a
1:50:48
bigger application there's you know multiplication or microservices. So lots of things we need to deploy right. So
1:50:55
just by having one helm run everything to be deployed. Okay. So uh so point here is what we
1:51:03
have to do we have to deploy this port okay with a tool called help.
1:51:09
That's what they also talking about here. Helm.
1:51:15
Okay. And get the helm guys. If you want to deploy something, then you need a helm code. And the name of the helm code
1:51:22
is called chart. You can first download the chart.
1:51:27
But before this, you have to install Helm software. And you can find the Helm software from here. And guys this this
1:51:35
code has been built on the top of Helm 3 not Helm 2 right helm 2 and helm 3 is
1:51:41
huge change okay this is helm three so if you're using helm 2 guys you have to change to
1:51:47
helm 3 then it will work this part will work okay so you have to install the helm
1:51:54
first okay and if you to install the helm um
1:52:00
according to me this is not the better document for is uh to install the helm
1:52:06
what can you do you can go to helm proper website it's called helm download
1:52:12
for windows and there's a website okay and right now my base system is
1:52:19
windows from where I'm to running the helm command so just go to helm this
1:52:25
page you will see some link here release okay I can because for me this also know
1:52:33
page. Okay. Go to release. It will take you the GitHub where you can find the latest
1:52:40
version of the Helm. I highly suggest go and use the latest version. Older version might not support something. And
1:52:48
here in this version if you go down and then you can go for Windows
1:52:55
in my case because my base system is Windows and I'm going to run the helm
1:53:00
from my Windows otherwise you can use Linux and Mac also okay and let me
1:53:06
download the software
1:53:11
okay so like cube seed is a client side tool similar helmet There's also client
1:53:18
cell tool. If you want to deploy some application either you can use cubectl
1:53:23
or you can use helm whatever you want to use. We are going to use helm here.
1:53:29
Okay. So extract this
1:53:35
sorry extract this and extract. That's okay. I already have. So otherwise you
1:53:42
can extract and use it. Right now how to use so wherever you extracted in my case
1:53:47
I extracted this tool in the download folder with helm
1:53:56
not two version right don't use two otherwise thing will fail uh use free version
1:54:04
okay in the windows folder this is tool I'm talking about I highly
1:54:10
recommend before use this tool just check the version which version you are in because I've investors wasted a lot
1:54:18
of time guys think everything fine but because the version thing is failing
1:54:23
right it's harder sometime to figure out why the thing failed right and after long I come to know I was using the
1:54:30
wrong version right okay but yeah just go and confirm this helm version three and above
1:54:38
okay now we have to download the repository This known as chart for EKS. This is
1:54:45
guys the code for deploying AWS
1:54:52
ELB ingress controller. Okay. So we going to write run this code
1:55:02
where the Helm installed same fold I'm running. So they're going to use the Helm
1:55:08
command. Okay. Even though I suggest to use exe
1:55:15
because I already have a helm installed in a path. So they might pick from a path. So I'm making sure I'm taking the
1:55:20
same helm what is there in this folder. Okay. So they say is already installed
1:55:27
because I already have this chart downloaded. It just they download it right. Suggest they also just to upgrade
1:55:33
this. any new thing going to come up in the chart repo update those who buy doesn't know
1:55:40
helm again this is not the helm training as such but if you want to know more from very basic how to create a chart
1:55:47
also then I asked my team they'll share one video of mine from my cubin classes
1:55:52
where I explain you how to use helm set up your own chart how the code work behind the scene okay but here you don't
1:55:59
need to know we're just installing the helm chart So
1:56:06
now this helm downloaded this chart and giving us a
1:56:11
latest updated code for deploying uh for deploying
1:56:18
u your uh what I say u
1:56:25
ease controller. Okay. And finally for deploying this is
1:56:31
the command we have to use. So one more thing guys they're talking about okay because you're deploying
1:56:40
the ingress controller okay is a program is a p and p guys we
1:56:47
always deploy from the from the image.
1:56:56
So where this image located? Okay, this image guys located maybe
1:57:02
publicly available somewhere or maybe occas
1:57:12
more like a docker hub but is a private service that maintain the container registry or container repository images.
1:57:20
Okay, this is what they're talking about. So when you deploy this they will download from the ECR.
1:57:29
Okay. It means if you don't have a ECR
1:57:34
access then it will fail. So it might fail guys in my case because
1:57:41
you know I told you when I setting up the cluster that point in time
1:57:47
this line will fail. Okay. So the possibility in my field
1:57:57
but because we have set the role already. Okay. So role might give a power I don't
1:58:04
know what did in the rule or policy the policy might give the power to access
1:58:09
the ECR at this different point. Okay. So no no con means let me check
1:58:16
the policy one very quickly. So we have created this policy name
1:58:21
uh you know I think IM service account. Yeah this policy we
1:58:28
created.
1:58:35
Okay. So I don't know this policy will allow to access ECR service.
1:58:44
EC is one service that is more like a docker hub means they're maintaining the the
1:58:50
repository but is a private nobody from public world can connect you to connect you need a power
1:59:02
so I'm checking ACR R
1:59:15
no it look does not look like it is there but let's see let's run it okay uh
1:59:22
maybe by default they might have other we'll do some change in the policy if you need okay so uh finally what I'm
1:59:31
going to do there's a final setup actually that's also what you're talking about right other we can change the
1:59:37
image also public image also we can use that publicly available but this image guys this image is going to set up this
1:59:45
ingress controller okay and I'm going to use this command
1:59:52
okay
1:59:57
I'm going to use this command
2:00:06
So uh this command guys is going to install right all the things and my
2:00:11
cluster name just update right and uh that's all nothing much
2:00:19
so copy and let me paste here
2:00:27
Okay. Now what they do even though before I run this I want to show you
2:00:33
with cubectl command. If you see there's no port in my current system because there's no application deploy but if you
2:00:39
see the cube system name space intel cubid name space there's some
2:00:47
ports are running but there's no port for ingress controller. Now which ingress controller engine X or in my
2:00:54
case ALB there's no controller port is there but as soon I run this command
2:01:02
again this is you if you see this field why because I doing something wrong the
2:01:07
wrong is I helm command here in my case I have set some path for the helm there
2:01:13
was a version two that was conflicting so you to run this command
2:01:19
okay from here right where I have the helmet new version. So let me do one thing.
2:01:27
Let me just make everything and then one line
2:01:32
one line. Why? Nothing technical. I want to run this command from this Windows
2:01:40
black screen where we have the helm command.
2:01:46
Okay, this one. And let me also use hel.exe. So there will be no conflicting right.
2:01:53
So your helm is going to install a chart.
2:01:58
Chart is going to install see here install a controller
2:02:04
and control they're going to deploy it means they deployed a port.
2:02:10
Okay. And now because they deploy the port. So what you will see uh what you
2:02:16
will see after the deploy let me run here only. You can see some port has been deployed
2:02:22
and fantastic guys they're running right. Okay, one of the reason why they're
2:02:28
running is because they have successfully downloaded the image.
2:02:34
Okay, maybe by that time guys my command was giving the error but they might have
2:02:39
picked behind the scene something happened but we have a power.
2:02:44
Okay. So they download the image from ECR which now image the controller image.
2:02:54
Okay. And after the download they deploy the port and how they deploy the port
2:03:00
internally they have deployed the deployment.
2:03:06
This deployment and this deployment deploy this. This is
2:03:11
your main code for your sorry for your ALB controller.
2:03:20
Okay. And this control has been launched. And because this controller
2:03:26
even though we can see some more thing here, let me go inside this port.
2:03:31
Okay. And uh let's go and check the logs
2:03:37
of this port. See what is happening. Right? They show you something.
2:03:43
Okay. So you can see the logs and it look like everything is started.
2:03:49
Okay. Everything is started. Mostly guys in the log they also tell you
2:03:55
they fail because image is not downloaded. They fail. They try to
2:04:00
connect to AWS uh where the diagram AWS ALB
2:04:08
they don't have power because of this they fail. So all the things guys they
2:04:13
will tell you here if something not work okay but it's working so there's no
2:04:21
error look like everything is starting starting starting so there's no uh challenge here
2:04:28
okay this one thing and one more thing if I go here guys in my ALB
2:04:34
page okay in ALB page
2:04:40
if you see guys nothing Right? Because we will launch the ingress resource then going to come up. But internally okay
2:04:46
till now there's no load balancer because there's no ingress resources been created only the controller has
2:04:52
been created that give you capability to go there and why they have power because we have
2:04:59
attached the service account as account take the authent so everything is right that's what they
2:05:06
run otherwise they will fail. Okay. So till here everything work looks
2:05:11
good. Great and there's no challenge. Technically a controller has been deployed.
2:05:18
Okay. Now what is next? So next is uh
2:05:25
next is we are going to let's follow this document only.
2:05:32
Okay. So this part is done and this is what I show you deployment is running.
2:05:38
So till here guys this this this deployment has been u
2:05:44
has been launched. Now next is what we have to do. Okay we
2:05:49
have to create the ingress resources.
2:05:55
Okay control is there but we have to create ingress resources.
2:06:00
Okay so what I mean by this? What I mean by this?
2:06:06
Uh so let me explain to you here. So we have a controller
2:06:13
this called AWS ALB ingress controller is a kind one kind of p
2:06:20
and uh and a and a application here running in the
2:06:26
kubernetes working successfully. This has a capability
2:06:32
to connect to ALB AWSB and do many more changes.
2:06:38
Okay. The first thing is we have to tell the controller. Okay. Tell the controller that you want
2:06:45
to connect to ALB or NLB because there are multiple load banks in AWS. Which one you want to connect?
2:06:54
The first requirement. Okay. So for this okay what we have to
2:07:01
do even though if you if you see here right now cubectl there's a one resource type called
2:07:08
ingress controller resource type
2:07:14
okay so ingress control I can say ingress I think
2:07:21
there's nothing here right the point here is right now my ingress control does not know okay does not know
2:07:29
uh even though not controller I can say this is the one term it's called ingress class actually not controller
2:07:36
okay even though they have actually they created by default one but my point here is my ingress controller does not know
2:07:43
right now right they want to connect to ALB or NLB which one so for this we have
2:07:51
to create a concept called classes
2:07:57
I charge one class already created that is pointing to ALB
2:08:02
but let's say your requirement is to contact to NLB okay or maybe CLB is older load balancer
2:08:11
then we have to create a class okay by chance I thought it was not there but if
2:08:16
you want you can create a class it's called ingress class and how can
2:08:22
you create the ingress class let me show you very quickly if you want to create otherwise we don't we don't need to create it they they already have but if
2:08:29
you want to create a class then you can search for ingress class
2:08:35
okay so you can get them document now now the
2:08:40
this document guys now come from kubernetes website because now belong more to
2:08:46
kubernetes and this is how we can create the ingress class
2:08:53
okay where you can define many more attribute about your load load balancer. Okay, about the load balancer. Uh so but
2:09:02
let me go for the basic one, right? We don't need much this this side. So what
2:09:07
I'm going to do, I'm going to create one file.
2:09:13
Let's say my or let's say ingress class
2:09:19
dot yml. And I'm going to write
2:09:25
this code. Okay, it's just a name of the class.
2:09:32
Keyword is ingress class and I'm going to create for ALB. Now you want to create for ALB or NLB that will be your
2:09:40
uh choice or you might have many more and if you have many more you can set to default setting also.
2:09:48
Okay. for default setting guys mostly in cubernetes where we use annotation
2:09:55
annotation and refer means if in the future when I use if it's not defined then use this as a default
2:10:03
okay so you might find some keyword here for setting up the this is called
2:10:09
Android I'm talking about to setting up the default
2:10:14
format if you want to set you can set it
2:10:20
One minute. Uh uh anodess
2:10:26
default class in
2:10:32
Kubernetes. This is what I'm talking about.
2:10:38
Okay. So this kind of keyword you can write here. But this class for keyword for storage.
2:10:44
In my case this is not the storage. It is a ingress
2:10:52
class. So in the ingress I'm setting a cubernetes that the default class is two
2:11:04
again not required but I'm just showing you keyword here. So point here is a
2:11:10
simple term in the uh
2:11:17
right now current setup is we are going to define this class. This class has a role somewhere. I'll tell you in in a minute. This class will tell
2:11:25
so somewhere we are going to call this class and we ask this class that we want to
2:11:31
use. You tell me where which uh in guess controller to use and which
2:11:38
ALB or NLB to use. Okay, it makes more sense when I start
2:11:44
explaining this concept in a minute about this meaning of this class. Right? So we are going to use a controller
2:11:51
called ingress controller. Okay, this program that will be launch.
2:11:59
Okay, and that will decide I want to use ALB or LB. In my case, let me go for ALB
2:12:06
only where the class name you can give anything. Let me go for awesome class only. And to run this command we use
2:12:13
cubectl apply
2:12:18
ingress. Now you have multiple ingress classes.
2:12:24
One is pointing to get ingress
2:12:30
classes. One is pointing to ALB. One is point to NLB. By sense I both are point to ALB.
2:12:38
So you can pick any one. Right now there's no difference but I'm just want to show you you can also create your own class that can point to NLB
2:12:46
or other load balancer service wherever you connect it.
2:12:51
Okay. So this this part is creating a class. The main thing now here is is the
2:12:59
rules but right so what do I mean by this? Okay.
2:13:06
Now we have a application for example and we deploy the application.
2:13:13
Okay. And now what I want my applications to be
2:13:18
managed by the rule the way I explained to you what I mean by this.
2:13:24
Okay. So let's say the way I explained to you I have one application running.
2:13:32
Okay. my multiple port and exposed by connected by the service.
2:13:40
Okay. What I want my application load balancer
2:13:45
if any traffic come to my application load balancer
2:13:52
okay they will route here and one thing that this is the inside
2:13:57
kubernetes this is outside cubernetes okay so this is more like a more like a
2:14:06
uh exposing from the external load balancer very basic concept Okay. But what I want here in the top on
2:14:13
the on the top of this if somebody type /
2:14:20
mail then they this guy understand and send to the service
2:14:26
this pathbased routing. Okay. So for this what we have to
2:14:32
create? We have to create a manifest file or rule file and the way I explained to you guys.
2:14:39
Okay, this is what we have to create. Let's understand one thing. Ingress
2:14:44
controller is done is one time setup. Connect AWS whatever done till now is
2:14:50
one time setup. This part is done. Now after this after doing this entire
2:14:57
setup remaining part we have to do again and again.
2:15:02
What we have to do launch a port launch a service.
2:15:08
Okay. and create the rule and rule we create in one component called ingress. I don't have any ingress with us right
2:15:17
so get ingress right now there's no rule set so ingress is one resource here and
2:15:24
right now there's no rule okay who set this rule now cubernetes
2:15:30
and this is what I talking about guys without going to AWS same thing we can do as also if you know ALB you can go
2:15:37
and get the rule there but I don't have to go to ALB AWS we create a rule given
2:15:43
to this guy. As soon as we give to this guy, this automatically go and give to this class
2:15:51
and this class automatically contact to this controller. And this controller is the one I always show you running as a
2:15:59
controller the ALB and set up the rule there. Okay, this is how the thing flow.
2:16:04
It means the setup that we have done till now is done one time setup.
2:16:12
If you understand the setup setup does not matter. Now we can take this is now onward is a new topic.
2:16:20
Okay. New topic and according to the new topic what I have we are having a
2:16:27
running controller that has been connected to ALB AWS somebody has set up
2:16:33
for us. For example, now as a cubernetes guys, you want to
2:16:38
deploy application monolithic, multiplication, microservices, whatever the case would
2:16:45
be. Okay. And you want your application your
2:16:51
your traffic will be routed to your
2:16:57
application via load balancer. Okay. via load balancer but in the load
2:17:05
balancer what rule we will set or what path routing will set it has been done
2:17:10
by us how we'll I'll tell you in a minute okay so let me start from here so
2:17:17
right now in my case let's say this new new setup everything is done I have no
2:17:23
application running no application running here
2:17:29
okay so what I'm going to do let me launch one application here and for launching the application guys, I
2:17:35
already have some code of my Kubernetes that I normally use in
2:17:40
my Kubernetes classes. Okay, so let me check some of the code
2:17:45
that I can run right now. Maybe I can use this.
2:17:52
Okay, what guys? So
2:17:59
service doml
2:18:06
maybe I can use this service service
2:18:11
and what port deploy
2:18:18
so let me use this code it's pretty simple we I'm going to deploy
2:18:24
one code from this image. This is one image I have in my g uh in
2:18:31
my docker docker hub.
2:18:36
Okay. So this image I'm going to deploy okay
2:18:42
uh by uh name of the deployment would be this one and three port we are going to create here.
2:18:48
Okay. So that is what we are uh doing here. Okay. Let me save and run this
2:18:57
code. Cubectl it can be microser what to deploy. Okay, you can also deploy with
2:19:03
the command line also. So application is going to deploy in the cubernetes.
2:19:09
Okay. So cubectl get port
2:19:15
which is three port deployed because we we have done this deployment of three
2:19:20
replica. So they deploy three portage and application is run.
2:19:27
Okay. But I don't have any service. Technically this three port has been deployed running with the application of
2:19:35
PHP in my case. But I don't have any service right now who will do the load
2:19:42
balancer in this port. So I'm going to launch a service.
2:19:48
Okay. So for this what I'm going to do here now port guys has a labels right
2:19:54
service always connect with levels. So this port has this level invol
2:19:59
production. So this I will tell to my service that any port who is running
2:20:06
with this level you have to do load balance. So I have one file of service
2:20:12
and here I'll tell my selector would be
2:20:18
this one. So this is very basic concept of Kubernetes.
2:20:23
Okay. So now what happen my uh service will create launch with the name called
2:20:30
my service is a name of my service. Okay. They're going to connect with all
2:20:36
the port who has this level and doing the load balancing.
2:20:41
Okay. That's what they will do. So cubectl
2:20:48
apply service.
2:20:54
Okay. And finally your service created. So according to this diagram this part is being created. And very quickly I
2:21:01
want to check one thing. I want to describe the service to check the thing is working or not. My service and what I
2:21:07
want to check does the register with a back end port or not.
2:21:15
If you see here guys, this service has connected with all the three port automatically because this is what the
2:21:22
selector we have given. Okay. Till here working fine. It means
2:21:27
anyone who connect to this service they can this port or this one. This one load bank done by this guy.
2:21:34
Okay. Till here this pure cubernetes thing. Nothing very technical. Now what I want here
2:21:43
sorry now what I want here okay I want to set up the ingress
2:21:50
using ALB now my requirement is very simple right now nothing technical but we'll add more
2:21:58
my requirement is very simple as soon as any client
2:22:04
come to ALB real ALB of AWS is
2:22:09
this al send to this service very basic requirement
2:22:16
even though if you want to do this requirement you don't have to go for this process there's a concept called load balancer keyword concept in EKS
2:22:23
cluster you can do this but let me start from here okay then slowly slowly we will uh add
2:22:33
path based routing the way I explained to So what I want to do here
2:22:39
okay I want to create a rule that's called ingress rule in my ingress
2:22:45
resources I'll tell here I want to use ALB
2:22:53
so anyone come to ALB ALB will contact to a service name what the name of
2:22:58
service would be okay that is what I want
2:23:05
and how we can do this is very simple. If you go to
2:23:11
Ingress uh guide,
2:23:18
okay, even though if you guys search for Kubernetes
2:23:27
inress, you might find this link.
2:23:33
Okay, you can find this example here. So ingress is one resource time from the
2:23:39
kubernetes. I don't have any ingress
2:23:45
ctl yet set
2:23:50
that we're going to set here. Okay. And this is what the kind of diagram I explain to you. We're going to
2:23:55
set up the routing rule in the ingress. Okay. And the rule I'm going to create
2:24:02
is mostly like this. There were some change but mostly like this.
2:24:09
Okay. So this inressl file
2:24:16
is what I want to set. Okay. And what I want to set here
2:24:24
okay is a rule that anyone
2:24:31
okay who connect to even though let me take the different
2:24:36
rule is a is a comparative a little bit complex rule.
2:24:43
Let me go for some other rule that become more simple
2:24:51
if they have.
2:24:57
So these are kind of rules we want to create in some time right let me go for this right I just want to
2:25:04
uh format in this specific let me start from here
2:25:09
okay this is what I was talking about in this file you tell which ingress class
2:25:15
you want to use okay so in my case the ingress class
2:25:22
that I have is multiple classes one class may be cont to ALB one class may
2:25:27
cont let's say I want to use this class so In the ingress resource you have to
2:25:33
tell which class you use. This is the one who will help users to connect. Okay. So in my case I want to use the
2:25:42
class that we have created this one.
2:25:49
Okay. Second thing was a rule. Okay. So rule is okay that I create. Let
2:25:58
me make this thing more simple that I explained to you. Let me remove this rule. Let me do something else that is
2:26:04
little bit more simpler. Okay. And what this we are going to do
2:26:10
here. I know I have one single back end. Okay. Only one back end we have. Back
2:26:16
end is called service. We have one single service. So there's no much rule we can create.
2:26:22
Right? So what I'm going to do I'm going to set my default back end
2:26:29
is what my service in AWS
2:26:34
and name of the service that I have in AWS uh uh right now
2:26:40
okay is this one. So this is what service we created. Okay, this one this is my service name.
2:26:53
Service name. Okay, so I want to connect to this service and this service running
2:26:59
on some port number. Okay, so number of port number I think
2:27:07
is 80 port. They're running over the 80 port.
2:27:12
Okay. So this is what guys we have written in this file. Okay. And let me
2:27:19
check the port number of service right is 80. Yeah port
2:27:26
they're running here. They say uh if any traffic come
2:27:33
to this ingress controller I will route to this service on this port number.
2:27:40
This what the one I explained to you here right hidden here. Okay. So there's
2:27:46
a port number we have given. Now interesting thing is this is pretty simple thing. Nothing very tedious. The
2:27:53
most interesting part here is this part annotation part.
2:28:00
Okay. By the way guys this is just a name of the ingress resource type. Okay is the metadata. Uh just give ingress a
2:28:08
name. Main thing guys in this world is called annotation.
2:28:13
Okay, what do you mean by annotation? Till now if you notice guys whatever we
2:28:19
have done in AWS if you call load balancer none of the
2:28:24
load balancer has been yet created. Okay, we have defined we want to use
2:28:32
this class and this class is going to create ALB load balancer only.
2:28:37
this load balancer only but this load balancer also has many more things right
2:28:42
okay one thing is scheme you want this load balancer to be internal or public
2:28:50
you this want this IPv4 support IPv6 support also
2:28:57
okay and many more things and even the guys in load balancer mostly guys load balancer work with uh they will have a
2:29:03
concept called health checking Okay, hell checking.
2:29:10
Okay, so when you create a load balancer, you tell the hell checks.
2:29:15
So when you create this listener, so we have to write a hell checks then. Okay, again you're going to work on HTTP or
2:29:21
HTTPS which port number. Okay, all the things we have to set
2:29:27
right in the in the uh load balancer setup, right? But I don't want to set up
2:29:32
from here. Okay, anything about this load balancer what I need in my application, I don't
2:29:38
have to come here. How to set up with this file? Which file? The ingress file.
2:29:46
Okay. And guys if you want to set up anything about the load balancer that you want to launch
2:29:54
okay this load balance I'm talking about to launch so any traffic come they will send to this service this service be
2:30:01
integrated already this service is more like a back end this we defined but what kind of load balancer you need
2:30:08
that you have to write here and for this we have annotation for ALB
2:30:15
Okay. So if you search for ingress ALB
2:30:21
annotation is the main part of this this discussion right then you can find there's lots of
2:30:29
ingress annotation available or ALB application load balancer there's
2:30:37
a whole list one is do you want to give a load
2:30:42
balancer name that's also you can control from your food.
2:30:50
I want to give a name to my load balancer. Let's say my ALB
2:30:57
test is not good practice mostly. Let's then create automatically for you. But if you want to give for some reason you
2:31:03
can give the name for the load balancer also.
2:31:09
Okay. Or do you want to give a scheme? Scheme very important here.
2:31:17
Okay, a scheme means you want to create a load balancer public or uh or private.
2:31:23
So in my case, we going to they also give the values which value they can support. So I want my load balancer to
2:31:29
be internet facing public. Okay, that's what we can uh write here.
2:31:38
Okay, public. And this is because there are the internal types. So mostly we don't write uh double
2:31:46
quotes this enter keyword name is a string so we write double
2:31:52
quotes. What else? Okay, let's say you want to set the
2:32:00
the let's say the protocol.
2:32:06
Okay. Or health checks a lot of thing is there guys. Whatever normally do authentication part everything you can
2:32:13
do from here. Maybe there's some defined predefined example we can copy paste there.
2:32:19
So what? So I want to use
2:32:29
let's say I'm let me take step by step right let me actually go to health checks
2:32:36
okay so what the health checks if you know little about load balancer health check means if you create any load
2:32:42
balancer they keep on checking your back end are they up are they up
2:32:50
okay if they up then only they register the connect then only they send the traffic to here. This called health
2:32:56
check. And for health check, you tell how to go
2:33:02
here. We have to build the protocol HTTP. How to check which port number to check
2:33:09
are they working or not? In the port number there might be multiple pages. Which page name you want to check? This
2:33:16
page is working. Let's say SL index.html then it's working.
2:33:22
Okay. So this is what we write in the health checks. Okay. So most the load balance is giving
2:33:28
the health checks mostly makes sense right. So I'm going to give my uh health
2:33:34
check. These are health checks things and in
2:33:39
the health checks I want to give my protocol
2:33:44
and I know right now my protocol is HTTP. So my application that I using
2:33:49
behind the scene I know is HTTP. So I use HTTP here. Uh they say capital
2:33:56
letter. So you have to use in capital letter. Okay. And now if you're using HTTP
2:34:05
okay then what is the port number?
2:34:12
Okay. So port number is where the traffic is going right now. This traffic port. So they give this word traffic
2:34:18
port. That's what you write. So if you if you notice that here is we
2:34:24
are managing the AWS ALB load balancer not by going to AWS
2:34:29
everything is doing from the cuber perspective right but you should know
2:34:35
your requirement okay so we set the scheme we set the protocol we set the boot uh we also set
2:34:42
the path okay path means which page you want to check because if you was checking
2:34:48
application right how you know application up or So maybe the application that you might
2:34:53
have index.php page or index.html page or you have same says ping page or the
2:34:59
health page depend upon the application which page you want to check if the page is up or downloadable accessible
2:35:07
it means your application running. Okay. And guys normally the health check we always give a health checks
2:35:12
intervals. Okay. So application can be done after
2:35:18
some time right. So we keep on checking the uh health of the application every 10 second 15 second. So is integer right
2:35:25
let's say 15 second let me take it then 15 second we go and check
2:35:34
okay and if application is not accessible so we can set the time
2:35:42
out for something so let's say I have to set the time out for um you can change the value but I'm
2:35:49
using this default value here for 5 seconds Okay. How you come to an application up?
2:35:57
So normally guys what they give you? They give you status code. If the status code is 200
2:36:05
then application up then only we can register the applications to the load balancer. In my case ALB it's 200 status
2:36:12
code. Okay. And uh if you want to see the
2:36:20
threshold count means maybe first go my application I test they are working but
2:36:26
they they can down after some time right. So we can set some threshold right means I have to check for two
2:36:31
times at least as a health check if both the two times every minute I check both two times both
2:36:38
two times they giving access or 200 then only the healthy then only I will connect my back end to my load balancer
2:36:44
then only and it will come I will send to this back end
2:36:50
okay and this is a very basic concept almost in all load balancer we always do this same thing for unhealthy also
2:36:57
before we mark them is unhealthy and removed from my my my back end I will
2:37:03
set let's say again for two times or three times maybe
2:37:09
okay so similarly many more thing we can do we can do with SSL authentication
2:37:15
part as we progress I will talk about this this is the minimum thing I I'm setting here
2:37:22
okay so this is your guys ingress hood this This is the very commonly used
2:37:29
keyword we always use. You don't have to memorize. You can come to this website or this is very commonly you can see
2:37:35
from multiple websites also you can see this code. Let me remove this. This is for inext but we using ALB. So this is
2:37:42
what we don't want. Now this code guys is the complete code
2:37:50
for ingress resource. By this we as IT engineer
2:37:59
IT engineer create this file contain two main thing one is called
2:38:07
annotation means we are defining
2:38:12
what kind of load balancer or I can say ingress controller we want
2:38:20
okay or whatever property they have.
2:38:26
So he say we say our roo name is this one interfacing this will go https
2:38:32
and we check the health of this guy or I can say a will check the health of my back end that's the
2:38:38
better to say okay next thing is in this file one is
2:38:44
annotation next is specification here the rule going to come in play so
2:38:51
all the rule that we will discuss in the future or Today we discussed right you know this routing rules
2:38:58
we have to write here it means anyone come to this load
2:39:04
balancer okay ons mail we route to this service once
2:39:12
less ser we route to other services. So this kind of rule we write in this part here and next class tomorrow guys we'll
2:39:20
talk more about the rules. Okay but this is a minimum requirement we just I just created here for testing
2:39:26
purpose to see the demo till you have thing working or not otherwise we'll add more thing in the future.
2:39:33
Right now nothing and it will come here only one back end we have is called
2:39:38
default back end this this service running on this portal. Okay. So let me save this
2:39:46
and uh let me run right and what you will see guys after I run without going to AWS application load balancer will be
2:39:53
created it's not yet created okay and let me apply this file even
2:40:00
though there's no ingress resource also there so let me apply this file if syntax is
2:40:06
right this code will run and guess code run
2:40:13
Ingress resource created and if you see guys here without coming to this page your ALB is also been deployed
2:40:23
it's creating right and name is this one right this is what I write in the file
2:40:29
okay this is what I write in the file the name
2:40:34
and we ask them to go for internet facing so they create internet facing right how I know if I click on my load
2:40:40
balancer you can say is uh internet face.
2:40:48
Okay, that's what they created. And one more thing guys, if you here see here, they automatically create the rules
2:40:53
here. Which rule? This rule. That's what I
2:41:00
write here. This protocol I wanted to use at port traffic port 80 at port
2:41:05
and one rule we created. Nothing much about the rule but only rule is we want to forward to the target group mean any
2:41:13
traffic come to this guy will forward to the service.
2:41:19
This rule we have see here we forward to the Kubernetes my service here my service name come up 100% traffic
2:41:24
because we only one back end okay one rule they have uh created
2:41:32
if you click on the rule what you see this is what the rule they created
2:41:38
only one rule okay but interesting thing is
2:41:44
now my load balancer is different kubernate different but now But my load man now connected to the Kubernetes
2:41:50
services. That's what the rule also talking about. Okay. And fantastic thing
2:41:56
is healthy, right? It's healthy.
2:42:02
Okay. It means your load balancer has successfully register with the services.
2:42:11
Okay. It means any traffic come from the client to the load balancer it's called
2:42:18
ALB they will go inside the Kubernetes connect to the service and serve will do
2:42:23
the load balancing whatever they default by default they do health checks right and how they check
2:42:31
and health check the way we write right in the health check we write what we write we going to check health
2:42:38
check this way 2 second two times 5 second 15 this interval you know success Cisco 200 everything we have defined.
2:42:48
Okay. And technically what you have seen all right in the
2:42:56
load balancer you have seen your load balancer has successfully deployed. If
2:43:02
you click in this load balancer is active. The most important thing in the
2:43:07
load balancer they always mostly active. The most important thing is is the the
2:43:15
maybe the marketing part if you see okay
2:43:23
not in the marketing part I can see what I'm going to show you the most important
2:43:28
part is is
2:43:34
uh one that can show in the target group because target group is also part of this load balancing
2:43:39
this target group. Okay. And if I click here in the target group, it should be
2:43:44
help. There's the most important point. Okay. And there are it means if anyone
2:43:53
go to a load balancer guys see here if you go to the load balancer of AWS this
2:43:59
is the name of the load balancer that what I was talking about client will connect to the load balancer
2:44:07
or the program.
2:44:13
Okay. If they connect to the load balancer.
2:44:18
Okay, finally see here guys application head right. Fantastic. So do you know
2:44:23
what happened? I am the client. I am the client
2:44:30
connected to this program that is called ALB
2:44:35
load balancer. Okay. And when I connect to this
2:44:41
program, this program sent to the back end this called service of Kubernetes.
2:44:47
So technically they come through cubernetes and connect to this service
2:44:55
and this service guys will balance these two ports. Three ports we launch right. So they send the data to one of the
2:45:03
port. Okay. Again if I if I show the IP of this port
2:45:09
they connect to one of the port either this one this one this one which one to connect I don't know service will decide
2:45:14
but to show you the demonstration in this port I have created a PHP application this PP application is printing the IP of port that's what you
2:45:22
can see here they're showing the IP of this port welcome to this coming from our PHP application and IP is 123
2:45:29
so this is what the connected right so it means finally your traffic is going from the client to the ALB of AWS to
2:45:36
finally inside the cubernetes to service to the port. Okay. And if I again refresh
2:45:44
see 80 29 see you connect to 8029.
2:45:50
If I again refresh 50 this one fantastic
2:45:55
lur is happening. No challenge here. Okay. But this topic I started is not
2:46:01
for this use case. This use case we can do other way also in very simplest way. This topic I started. Okay. So that now
2:46:09
we have a ingress resources cubectl get ingress
2:46:16
resources up. Okay. Now from this here also where you can find the address of u of your load
2:46:26
balancer. The same address you can see. Okay. But now because we have ingress
2:46:32
load balancer so ingress resource type now with this resource
2:46:38
type guys we can create lots of rules right now there's no rule as such only
2:46:46
rule is any traffic come to load balancer send to this service
2:46:53
that will send to this port that's all but tomorrow class I will open and edit
2:47:00
this file and create lots of fantastic rule. One of the rule the way I explained to you path based routing.
2:47:07
Okay, it means everything is doing by your load balance of AWS but we are not
2:47:14
touching there. we everything controlled by us from the Kubernetes resource type
2:47:19
that is the ingress controller means okay so that's all guys from my side
2:47:28
lots of thing we discussed believe me guys every part why we need I explain to you for
2:47:35
example if you go to as document some blocks also you can find for example why
2:47:40
we use oidc so they just write the command that's all run But I tried to give you some vocabulary
2:47:46
and some concept right why we need why where the things is created how they connected everything I explain to you
2:47:53
logic step by step to you and finally setup is successfully done okay and
2:48:00
we'll continue this class tomorrow where we guide go more deep into creating the
2:48:05
rule for the ingress okay that's it from my side any query if you have you guys
2:48:11
can ask
2:48:18
and guys this concept is going to help us in in STO also those who are learning
2:48:23
service mass STO okay there also we have to use ingress controller
2:48:29
ingress gateway okay so this is the core concept that's what we call you tomorrow
2:48:36
class you can go and some more rule and all this concept we will apply on the H2O classes in the S2 gateway or or the
2:48:45
ingress controller how and where in my S2 class respect to class I will explain
2:48:50
this point to you okay
2:48:59
so any query guy if you if you have uh you can ask me yes uh with you can also
2:49:06
have multiple ALB for one ingress controller then we have to create a proper had a key
2:49:13
but you should have one top in uh top one ingress controller that we manage
2:49:19
send the traffic to other in uh ALB controllers right but as a one ingress
2:49:25
perspective you should have one uh one ALB
2:49:32
but as a complete architecture perspective you can create one ALB inside this you can create multiple the
2:49:38
top one will manage the load If you have any other use case you can tell me I will accordingly give the
2:49:44
answer to you
2:49:52
so Manu I don't know which star you're talking about you're talking about this star right in this case use case this
2:49:58
star makes sense but the use case we I was talking about
2:50:04
okay um I was talking about
2:50:11
no no man is not good practice right giving a star in resources is not good practice yeah have just to quickly test
2:50:16
something norman test environment then you can give the star an IM policy thing
2:50:22
will work but obviously in the real process environment you to granual control right the resources which
2:50:28
resource you want to allow only that resources to give right otherwise just for practice purpose
2:50:34
other things you don't want to invest the time much on IM policy you can give the start there That's also workar means allow everything.
2:50:42
Okay. How to get annotation in guys? Uh we will talk about kal koshal. Sorry. So
2:50:48
tomorrow the topic would be purely in this file where we write more
2:50:55
annotations and more rules. So all the use case we're talking about
2:51:00
we will discuss tomorrow.
2:51:06
Yes. Why not go off? You can do so. You can create multiple. Okay. In single applic cluster you have
2:51:13
two application. Every clust application has two um um two separate ingress resources
2:51:24
and ingress controller also right technique ingress controller is one one program you need more you don't need
2:51:30
more one program can handle multiple ingress
2:51:36
gateways in my case inress gateway is ALB but if you want I want ALB also EngineX
2:51:44
also as your load balancer also then you have multiple controllers otherwise you
2:51:50
don't need many controllers this one thing okay second thing is what
2:51:55
you asking yes one ingress controller in this example is enough to create multiple ALBs
2:52:03
and one ALB route to one application one ALB route to other application I might give some idea in tomorrow class maybe
2:52:09
some kind of way handsome also hands on also
2:52:16
Yes. Uh almost same setup amole for open sift. Almost same setup for propens.
2:52:26
Okay. So it can be except from outside uh which
2:52:33
which except from outside if you can clarify more in detail what exactly you're talking about.
2:52:48
So team uploaded incorrect recording of April 13 cloud for integration IP gateway in CSA. I report this four day
2:52:56
nothing. Uh let me check uh summed let me correct to my team. Okay. I asked them to upload the right cloud fun
2:53:05
integation VP gateway video. Okay. So let me update them. You'll get soon.
2:53:13
Okay. So that's all guys from my side. See you all the remaining doubt if you
2:53:19
have uh uh you will be clarify uh tomorrow.
2:53:27
Uh no it is not work like this. It look like so first client hit to ALB ALB
2:53:34
directly connect to service and the board. None of the service sorry none of the in
2:53:41
ingress controller or ingress resource come in in between ingress controller ingress resource is
2:53:48
just to manage the thing. Okay very quickly just if I uh explain
2:53:54
you one one one single quick way. So it is something like this.
2:53:59
This is a client client connect to ALB of AWS. ALB is connect to service
2:54:06
directly and service will connect to port. This how the process will go. So
2:54:11
what is the role of ingress controller as a program?
2:54:19
All right. This controller program will listen from the ingress resources.
2:54:28
So we as IT team write the rule here. this rule vrite
2:54:34
will be applied here. Okay. And this controller is the one who
2:54:41
will go and update the ALBM.
2:54:46
Okay. This is how it go. But from the client perspective, combination perspective, they have no use of this
2:54:53
this part, right? Client will kind ALB is a D visibility service and the port.
2:55:00
Okay, this is how it work.
2:55:08
So that's all. Uh so anyone who part of service mass so we will do use this
2:55:14
concept on the top of service mass how we'll talk on the respective topic. That's all guys. See you tomorrow with
2:55:21
some more detailed discussion on this ingress control. Bye. Good day. Take care.

