ript


15:57
Good morning everyone. So let's start with a quick revision of last class. Okay. So in last class we learn about
16:04
ingress controller. Okay. So uh what is the ingress controller? Uh then we learn
16:09
about what is a ingress uh resource. What is the ingress uh resource in Kubernetes? Okay. So how we can uh
16:16
implement ingress uh controller using u ALB that is a application load balancer.
16:22
Okay. So we learned all of these things in last class. Okay. So we will revise
16:27
one by one. Uh okay. So let me first share screen.
16:33
I hope I am audible.
16:40
I think uh I hope uh screen is visible. So let's start with a quick revision.
16:47
So to launch a Kubernetes cluster using uh AWS EKS. So this is a command. Uh in
16:53
last lecture we also learn about uh means at the time of revision we al we
16:59
also learn about. If you want to launch a Kubernetes cluster then we have a multiple way. Okay. If you want to
17:06
launch a Kubernetes cluster then we can use a terapform like a third party tool. We have a uh web UI uh which provided uh
17:14
in AWS console. We have a EKSTL tool. If you use EKSTL tool then we can uh we can
17:21
use a command line tool uh means command line option. We can use YML kind of file. Okay. So in last class we use
17:29
EKSTL tool and we uh provide multiple option for launching Kubernetes cluster.
17:35
Okay. So uh if you want to launch a kubernetes cluster then eksctl create
17:41
cluster. If you provide hyphen h uh at last after uh this command then we can
17:47
see multiple option all of these option which support eksl. Okay. So this is u
17:52
some of the option. So if you want to provide a name of the cluster then we can use a hyphen name option. If you
17:59
want to provide a region name in AWS then we can provide we can use a hyphen
18:05
- region option. Okay. And if you want to uh provide version name of the EKS
18:12
then we can use iPhone version option. And if you don't provide um uh
18:19
this option then by default it will pick some of the version whichever they support. Okay. Then uh we use a hyphen -
18:27
with oidc. What is this option? We will see later in this uh revision. Okay. If
18:34
you want to provide a node group name then hyphen node group hyphen name option is used. If you want to provide
18:41
how much node we want to uh launch in a Kubernetes cluster then we can use
18:46
hyphen nodes option. Okay. Then if you want to launch how much um uh how much
18:53
minimum node we want, how much maximum node we want. So we have a two option. Uh for minimum we can use node minimum.
19:01
If you want uh maximum then uh we can use a node nodes - max option. If you
19:07
want to uh access that worker node using a ssh then we can provide hyphen - ssh
19:14
access. If you provide this option then obviously we need a public key for login. Okay. So using hyphen - ssh
19:23
public key using that uh using this option we can provide our public key
19:28
name. Okay. And if you want to uh access for uh for our worker node uh as a
19:36
console then we can provide - enable ssm. So this option will be used. If you
19:42
want our uh node uh will launch in a private world. So we can provide hyphen
19:47
- node - private networking option. Okay. So if you want our uh this uh
19:54
cluster will manage uh by cub AWS then we can provide iPhone manage option.
20:01
Okay. So if you want um uh whichever node we um we we launch that uh that uh
20:10
node uh instance type if you want to provide then we have option that is -
20:15
instance uh types. So here we provide uh t3.m medium. So this is a one of the
20:22
instance type. Okay. So uh there are multiple option this option we will see in this uh resume one by one. Okay. So
20:30
this is option if you want to launch then according to our need we can provide uh whichever option we need.
20:37
Okay. So this is a um launching of Kubernetes cluster and if you see here we provide a
20:45
key name. So we have to create first we have to create a public key because we need a provide when creating a
20:51
Kubernetes cluster. If you search for EC2 instance in the AWS console and if
20:56
you uh go to the key pair option and there we can see a create um key pair
21:02
button. Okay. So click on that button and enter the name of the key and select apm private key uh file format. Okay.
21:10
After this click on create uh create uh key pair. It will automatically download
21:15
the the public key. then we can use after downloading we can provide uh here
21:21
uh that public key. Okay. So if you go after launching the uh EKS
21:29
cluster and uh if you want to get the that that EKS cluster then we have a
21:35
command that is EKSCL get cluster and in AWS we already know about we already
21:41
know that we have a multiple regions. So using hyphen - region we can provide region name whichever in whichever reg
21:49
uh region we um launch the cluster we have to provide that region name. Okay. So this is a cluster and name of the
21:56
cluster is my cluster. If you want to get all nodes so if you
22:01
see in above uh above command we provide three nodes using hyphen node options.
22:07
Okay. So if we if we type the command cubectl get nodes then we can see we have total three nodes available and
22:14
that um status of that node is ready means we can use the that nodes. Then we
22:21
learn about um path based routing. So path uh path based routing allows you to
22:26
route traffic through different services based on the based on the path uh in the incoming uh request URL. So what is a
22:34
pathbased routing? So if you if you pick any of the uh URL for example
22:40
ww.google.com in last we have to type something that is a pathy slash and we have to type
22:47
something so that is a path. If we type uh for example search then we can see
22:53
the search engine page. If you type hyphen mail then we can see the mail page. So this is a path this is one of
23:00
the example of pathbased routing and whatever we pass after slash then that
23:07
uh then that traffic will be uh route to different different services.
23:13
So ingress traffic is a uh incoming traffic that is uh that is routed to
23:19
particular service. Okay. So whichever traffic will come into the um into the
23:25
website that traffic is known as uh ingress traffic we can say and ingress resource act as a gateway to our cluster
23:32
can be used to route traffic to different service based on various criteria for example host name URL path
23:39
or request method. Okay. So to if you see the diagram here,
23:44
this is one of the service mail service we can say. This is another service we can say search service. Okay. So this is
23:51
a uh we can say client. Okay. Here we can here we type our URL and this is a
23:58
um we can say gateway. This is a ingress resource. Okay.
24:04
So to handle incoming traffic through ingress resource you need some uh kind of program. You need to have a ingress
24:11
controller. That program is known as ingress controller running in Kubernetes cluster. The ingress controller is a
24:17
responsible for implementing the rule defined in the ingress resource. So what is the rule? We will see uh in this um
24:23
uh revision. Okay. So routing traffic to appropriate back end whichever rule we mention according to that rule we u
24:30
routing traffic to appropriate backend service. Okay. So what is a rule? So for
24:37
example if you pass uh at last uh slashmail then go to this service if you
24:44
pass uh / search then go to this service okay so this is this is a one kind of
24:49
rule okay so we have a multiple like this so if you want to implement ingress
24:56
control controller then we have a multiple way for example uh NX one of
25:02
the way and we have a another way uh that is is a load balancer and in load balancer we use ALB. Okay, ALB uh is a
25:11
application load balancer. So ALB ingress controller is is one of several option implementing an ingress
25:17
controller in Kubernetes. It provides an easy way to route traffic to serving running in a Kubernetes
25:24
cluster using an AWS application load balancer which can scale handle high
25:30
traffic loads and provide pathbased routing. If we know the uh application load balancer, so it will work uh as a
25:38
uh it will work for uh application layer that is a level uh layer 7. Okay, if you
25:44
know the OSI model and uh if you know the um if you know
25:50
the application layer then uh that will work uh for uh uh HTTP request or HTTPS
25:57
request. So pathbased routing that will benefit we will get if you use ALB. In
26:03
ingress is a Kubernetes resource that defines rules for routing external. If you want to define a rule, if you want
26:09
to create a rule, so ingress is a resource uh in a Kubernetes, we can create our rule using ingress resource.
26:18
So this is a di this is a diagram. Okay. So if you see the see this diagram, this
26:23
is a Kubernetes cluster. This is a one of the service. This is a another service. If you see here, this is a
26:29
ingress controller. Okay. And this is a rule. This is a ingress where we define
26:35
we can uh where we define uh our uh rule. Okay. So, and this is a ALB. So,
26:41
while ingress manage the rules for uh routing external traffic. So, ingress
26:47
manage the rule. So, this is ingress and a AWS ingress controller is a
26:54
responsible. So this is the ALB uh ingress controller is a responsive in uh
27:00
is responsible for trans translating this rule into the AWS specific load
27:05
balancer balancing rules and configuring the load balancer accordingly. So whichever uh we provide rule here in
27:13
ingress using that rule ingress controller will um contact to ALB that
27:18
is uh application load balancer and according to that rule uh application
27:24
load balancer will be created. Okay, if you go down,
27:32
so the uh - ALB ingress access option is used to enable AWS ALB ingress
27:39
controller and connect to the cluster. If you see here, so this is a Kubernetes
27:45
cluster and this is a ALV. ALV is outside of uh Kubernetes cluster. If you want to connect this, then we have to
27:52
provide this option. Okay, if you see the above uh um above command that is uh
27:59
AKS uh create a clct create cluster command there we provide this option. So
28:05
why we provide this option? So if you want to enable AWS ALB ingress
28:11
controller to connect with the cluster. Okay.
28:16
So this option uh creates a IM policy and role that grants a necessary
28:21
permission to the ALB ingress controller to interact with AWS resources required
28:26
for load load balancing and configure ALB ingress controller to use AWS
28:32
application load balancer to route traffic to service in the cluster base and on the roles defined in the ingress
28:39
resources. So for deploying AWS load balancer that is ALB controller to to an
28:45
Amazon EKS cluster. So for this we have to first create the IM policy. So why we
28:50
need IM policy? Because EKS uh as a EKS we have to uh access multiple service in
28:57
a in AWS and if you want to access uh one
29:02
uh from one service to another service so we have to create a policy. So rather than create a manual policy, we have a
29:10
pre-created policy in uh official document of AWS. So we have to download
29:15
it. So download IM policy for AWS load balancer controller that allows it to
29:20
make calls to AWS APIs. Okay. On on on our behalf. So this is a command. So
29:27
using hyphen curl uh using curl- o command and provide that URL we can uh
29:32
download the that policy. After downloading create IM policy using policy download in previous steps. Okay.
29:40
Uh uh whatever we download uh uh whatever we download uh so create IM
29:46
policy for that file. Okay. So this is a command after uh policy creation we have to
29:54
attach that policy to the EKS. So this is the command for attaching attaching
29:59
that policy to the EKS. Okay. So what is a service account? Uh so a service
30:05
account is uh we can say one of the resource of uh kubernetes. Uh if uh one
30:12
program want some extra permission then we can uh create a service account. Okay. So so simply we can say we have to
30:21
attach that policy whichever we create we have to attach to the EKS. Okay.
30:27
So if you want to get the service account, so service account will be created in uh cube uh - system uh name
30:35
space. So we can see the uh using cubectl get uh service account or we can
30:41
use a and name of the service account. We can see the um that service account using this command. If you want to
30:47
describe then simply describe uh desri describe what we can use for describe
30:52
the uh dials account to enable authentication between kubernetes ingress controller and aw
31:00
you can use oidc. So if you remember in uh if you remember we use hyphen with
31:07
oidc option. Okay. So this option will be used for enable authentication between ingress controller to AWS. If
31:15
you see the if you see this diagram so this is ingress controller and this
31:20
is ALB. So this is a different uh ALB is outside of u Kubernetes. If you want to
31:26
uh if you want to connect this then we need some uh authentication and that authentication we can provide using uh
31:34
hyphen with OIDC uh option. Okay. So this this is the use of this option and
31:41
if you want uh so we already know about that uh ingress controller is nothing
31:46
but one kind of uh program and for installing any of the program we need a
31:51
OS or we can say we need a pod. So for installing pod we have a multiple way available in Kubernetes. We can install
31:59
uh pod using cubectl command yml file but in a market we have a standard way
32:04
that is a helm. So using helm we can install u uh pod and in that pod we have
32:11
we can install our program. Okay. So uh if you want to launch a pod using helm
32:17
then we have to install the helm command first. So go to the official website of helm click on release. Then if you go
32:25
down that website that github website then we can see this command for windows. Okay. So download that extract
32:31
that command. Okay. And wherever we extract go there and for ensuring that
32:37
we install the helm command you uh type the command helm uh helm version. So we
32:44
can uh ensure that we can uh we already install the helm command. Okay. So add
32:50
the es chart. So chart is nothing but we can say here folder. Okay. So repository
32:56
uh in helm u we can say that file is known as a chart. So add the EKS chart
33:02
repository and update local report to make sure that you have to you have the
33:07
most recent chart. So um type this command. This first command will
33:12
download the uh add that report. Add that report. Okay. And uh second
33:19
command uh second command is used for update. Okay.
33:24
Then install the AWS load balancer controller chart using the helm install command. So this is a command for
33:30
installing that jar. Okay. And after installing if you see the
33:37
cubectl get ports in uh cube system um name space then we have a new pod will
33:44
launch that is AWS load balancer controller. Okay. So this pod will launch automatically.
33:52
Next is ingress class is used to select appropriate ingress controller. So we have a multiple ingress controller ALB,
33:59
EL um NLB then NGNX. So we have a multiple ingress controller for
34:04
selecting the appropriate we can use ingress class. Okay. So this is also one of the uh resource in the Kubernetes for
34:12
uh creating this uh we use a yml file here. So simply type the vim uh ingress
34:18
class yml file. Uh then here our client is ingress class. name of the ingress
34:25
class is a hyphen class and this a hyphen class will point to the ALB
34:31
controller. Okay. So if you want to make as a default class then we can add annotation. Okay. So this is a file. If
34:37
you want to apply that file if you want to u launch that ingress controller then
34:44
we can use cubectl apply f and that name of the file. If you want to get then
34:49
cubectl get ingress class. So we can see a class uh ingress class uh will
34:56
automatically created. Okay. So after that deploy an application with the service for deploying application we use
35:03
a deployment. So simply vim deploy iml. So here we can see this is the code of
35:10
the deployment. Okay. After uh launching uh so after this we
35:16
have to launch the deployment. So using cubectl apply command we can launch deployment.
35:23
So this is a command for um getting the label. Okay. So using that label we have
35:29
to uh launch service. Okay. So this is a ser uh service code. So after this we
35:35
have to launch a service. So this is a command cubectl apply - f service name.
35:41
Okay. So ingress is a again another resource of Kubernetes. Using ingress we can
35:48
define a routing rules for external traffic. So this is a rule. So when we
35:54
when you create a ingress resource specify the ingress uh class field to associate the resource with the specific
36:01
ingress class. So if you uh when we create a ingress we have to point to ingress class. Okay. So whichever
36:07
ingress class we create we have to point that. So, so if you see here, so using
36:13
ingress class hyphen name keyword, we can provide our ingress class name. Okay. So, this is a rule. So, when we uh
36:21
create when we launch ingress, then automatically load balancer uh will
36:27
launch. So, we can provide the name of the load balancer. We can provide the uh scheme that is internet facing or
36:34
private. Uh we can provide a protocol name. We can provide a port. we can provide a path name. So this is a u
36:41
multiple option a multiple uh we can say rule we can provide when we launch
36:47
ingress. Okay. So for creating ingress we can use a cubectl apply command and
36:53
if you get the if you want to get the ingress then we have a cubectl get ingress command. Now after this um after
37:02
this uh load balancer automatically will launch in AWS. Now if you want to go to
37:07
the a AWS load balancer so there you can see the DNS name. Okay. So copy the DNS
37:14
name and paste it into the browser. After this we can see our website. Okay.
37:20
So this is a quick revision of last class. If you have any query then ask me in the chat box.
37:34
I think sir is here. Hold you sir.
38:00
Uh hey guys uh very good morning and let's continue with the next part. Uh so
38:07
the plan is we was discussing about u EKS
38:13
right and uh in the EKS we have uh implemented the ingress controller right
38:21
so that was done successfully and step by step I explained to you okay the use
38:28
case of the ingress controller so the main thing is now we have to use the
38:33
ingress resources is uh to create our custom rules or custom plans. That's the
38:40
main uh plan and topic for today. Okay. Uh but the idea is if I very quickly uh
38:49
you know go through the setup very quickly what we have done yesterday. So
38:54
we have a EKS cluster EKT command we can use and we have this
39:01
cluster running. I think I launch in not in Mumbai there's a different cluster altogether I launch in a different
39:09
region altogether region would be 80 southeast something
39:15
80 south east one that is Singapore
39:20
so here our cluster is running okay and in this cluster we we have done
39:26
something right but after cluster launch now we can use cube uh cl command
39:31
cubernetes command right so from the Kubernetes I can check how many worker nodes we have so they are running with
39:40
three worker node okay plus how many name spaces they have in the cubernetes
39:46
these are name spaces cube system is an internal name space of cubernetes all the internal resources of cubernetes
39:53
they are managing here right for example you want to see how many ports you have in cube system name space n means name
40:01
space here. Okay. So there are lots of internal uh
40:06
ports running. Our port where we are interested on are these two ports. Okay.
40:13
So these are the controller port they are they are running. Okay. Okay, they're running two copy because of
40:19
maybe of replica but there are two controller port they are running and these are the main
40:26
port who actually communicate from our cubernetes cluster running maybe in the EKS to the uh AWS other services one of
40:36
the main services uh ALB okay or I can say the load balancer so
40:42
the it means the flow work in this way even though I explained to you but there might be a small doubt left maybe
40:49
somebody were asking the last uh so it is something like this we have a customer or the client okay they will
40:57
connect to the public IP and public IP is we have associated with the ALB
41:03
application load balancer of uh AWS
41:08
this has no right now relation with Kubernetes or EKS but as soon they sorry
41:15
they come up to uh they connect to ALB load balancer right in the ALB load
41:23
balancer uh we have to set up some rules.
41:28
This rule will decide where the traffic will route. So in this rule what we can write that
41:36
we have to send this traffic to the Kubernetes and we have to send this traffic to the Kubernetes services.
41:43
Okay. So your ALB is the one who will route this traffic to the Kubernetes
41:49
service and obviously after service get the traffic they will send to the underlying or back end ports or
41:56
application ports. Okay. But the main game here is uh this rules right this
42:03
rule define where this traffic to be routed. Okay. Now who will create this rule? Who
42:10
will manage this rule? Either this rule can be managed by the cloud engineers.
42:16
Okay. Or uh or what can we do? Uh we can manage this rule without
42:24
knowing as such about the cloud from directly from the Kubernetes environment.
42:30
Okay. So here I think they might also create some CRDs
42:35
if they have created in the setup. Yeah. Okay. So for this in the Kubernetes they
42:41
have created some CRDs custom resource definition means they create your own resources
42:50
okay these custom resources especially these one okay is not
42:56
actually by default available so the way we done the setup yesterday the setup
43:02
the controller all the things these resources has been created okay so what these resources will
43:09
do for you. Okay. So in the inside the cubain environment now our cubernetes engineers
43:17
okay without leaving this platform this again key uh are managing the ALB and
43:24
upgrading and setting and changing the rules. Okay. How for this? We have provided
43:32
them uh some kind of custom resource
43:39
and name of this kind custom resource is called ingress. What is resource type? You know like port is a resource type,
43:45
deployment is a resource type. Similarly, we have one more resource type. It is not available as such.
43:54
Okay. But we have provided this custom resource type ingress. So with this resource type we
44:02
from the Kubernetes um from the Kubernetes engineers they go
44:09
here and what are the rules they want to write they can write the rules where they can define that this is the one
44:16
service all right uh or we have one more service we have so some traffic will go
44:23
here some traffic will go here whatever the case would be they create the rule right but as soon as they write rule
44:30
here. This rule will be injected inside the ALB or this rule will be updated
44:35
without going there. How? For this we need some program that has a capability
44:40
to contact to ALB and that is called controller. It's called ALB controller or ALB ingress controller.
44:48
Okay. So we as engineer write the rule. This rule will be uh you
44:55
know will be accessed by controller and this control is the one who will go on
45:01
our behalf and update the ALB load balancer. Okay. So my point is ingress or the ALB
45:09
controller where is ALB controller? This is the ALB controller. That's what I was talking about. There's a pool is
45:16
application right and this LP controller has a power and
45:22
this power is given by service account.
45:28
Okay. So the service account is internally attached to this uh uh ALB
45:33
controller. Okay. And and inside the service account we have attached the OIDC IM or some
45:42
kind of way for authentication purpose. So my controller will use this service
45:48
account and the underline YBC okay and they first authenticate to ALB and say I
45:54
want to create change some rule or create some rule or maybe I want to create you also first time okay so this
46:01
how it work so point is this part has no relation with the client
46:09
okay if you see guys almost any and every diagram diagram available in the
46:15
market architecture diagram. Okay, they they confuse you.
46:22
Okay, they confuse you actually according to the diagram or architecture diagram available in the market. Okay,
46:29
they show you the flow something like this. Okay, they say here we have a client, then we have a then we have a
46:38
ingress controller, then we have a service, then we have port. So it look
46:44
like your traffic goes in this way is grow via controller.
46:49
Okay, but that is not at all the truth. Okay, the truth is the the the the
46:56
diagram that I uh showed to you. Okay. So um client contact to ALB and
47:05
traffic directly go directly go to the service running in the node or worker
47:10
node directly go to worker node and through the worker node uh they go to
47:16
service and the port. This is how it work. This portion
47:22
is only managing your
47:27
ingress traffic component in our case that is called ALB. That is the only uh
47:35
reason this component we have. Okay. And one more component we have by
47:41
chance when you create a ingress resource and create a rule there you can define.
47:48
Okay, you can define to the ALB controller.
47:54
Okay, that which uh load balancer I want to use. I want to use ALB, I want to use
48:03
NLB, multiple load balances we have, which one to use. So here the role of class
48:09
come in play. The English class is also
48:14
uh one resource. Only purpose is where we define uh right which um
48:24
particular uh you know uh provisioner or I can say controller we have to use.
48:32
Okay. So this is and that's what we have to write in the rules also. So in the rule we say I'll I'm just giving this
48:39
instruction that you I want to use ALB plus same time I want to use uh I want
48:45
to create this rules so that will be completely controlled by so the old moto guys is in today's world
48:53
we are almost kind of move in a hybrid world a hybrid cloud world uh right but
49:00
I want to have a setup in such a way okay that without leaving from one
49:07
platform like Kubernetes uh I don't want to do further things right just proceeding on the one single
49:14
platform doing one single command cubectl I want to manage the entire other infrastructure also even though
49:20
that is one of the reason right Kubernetes or the open s is famous for
49:26
containers right but now they start supporting virtual machines also so by
49:31
sitting on the kubernetes or the open s we can manage are virtual machine infrastructures you know virtualized
49:36
hypervisor VMware or KVM and many more okay that's also we can manage so
49:44
this is the point is one platform and to manage all the resources maybe cloud
49:50
virtualization and whatever you want to manage okay so there's a whole idea but let's
49:55
continue with the next part this setup we have done and one of the demo we have done there was if somebody come to this
50:03
ingress uh controller, they will tell you the IP address or the host name of
50:09
your uh ALB load balancer and if somebody hit
50:14
to this load balancer, finally they lend it to our code. That's what the last demo I've
50:21
shown you. But today's plan is we go more deep into the rules.
50:27
Okay, what I mean by this, right? So I'm going to show you the same setup the way I explained you yesterday. Okay. The
50:35
setup was let's say I have a two applications here. One is a mail
50:41
application for example. So I'm going to create one service. Let's say the service for mail service
50:48
and they have their own mail application code.
50:54
I have one more service is independent service all together has no relation as such with the mail. Let's say this
51:00
search service and they have their own application port for the search.
51:08
Okay. Now what I want I want my ALB
51:13
application load balancer. Okay. They will send the traffic. Okay.
51:20
According to the rules defined for the routing this called routing rules.
51:26
And I will tell in the uh ALB load balancer if some client
51:32
type / mail okay as a route or the path send the
51:38
traffic here. If somebody type / um
51:44
search in the last in the path okay send the traffic here.
51:50
Okay, this is what we write in the rule. And how to create this rule? Either you can go manually to ALB to get this rule
51:57
or you guys know uh we uh can uh do this
52:03
thing with the ingress uh resource type. So here again we can go for this ingress
52:09
type and create this rule. Okay. So let's see how we can do it.
52:16
Okay. In this in for this part of example what I'm going to do I'm going to use the
52:24
same service or let me get one more new service so no confusion so I'll go to my
52:31
one of the folder I have some not this one
52:38
I have some precursor code already we I have okay I don't have in the mail or
52:44
the uh ser search application but you can take any random example here just to
52:50
see the difference right okay so what I'm going to do here I'm going to uh
52:57
create some uh services and the port and for this I am going to use this file
53:06
not pad deploy and this file guys is going to create a deployment let's say I
53:14
want to give this deployment name mail deployment. Okay. And uh in this deployment they are
53:22
going to launch let's say three ports. Okay. And uh they are
53:30
having a name of the four port for app that is called let's say my mail. Every
53:37
port has been attached to my mail. Okay. And let's say this is the
53:45
my mail port. Small change I'm doing here. Okay. And one more small thing I'm
53:50
using this image. I'm just taking any random image for testing purpose. And uh
53:56
one more thing because you are launching the port by this level. So your match
54:02
level should be same here. Here. So let me change to app. And
54:09
this is my main. So this is a deploy file. Those who if
54:16
you know open for the cubernetes is a basic level knowledge we learn this
54:21
concepts right. But technically this is what they're going to launch. So let me run this file.
54:29
Cubectl apply deployment one new deployment launch.
54:37
And this deployment has uh created.
54:45
Okay. Uh three port. And if you see this port has been created, right?
54:52
Created running successfully. We need service also. So
54:58
I'm going to set up the service right where again in
55:03
my service they're going to looking for the port. There's my mail port they're
55:10
looking for. And this service guys because you're exposing server with a
55:15
node port. Node port will use the port number from your worker node and port
55:20
number should be unique. Okay, this port I used already in my last example. So let me use a different port number.
55:28
Okay. And this is one thing. And second thing is let me change my service name.
55:34
Not level name. Level name could be anything. Let me change the service my
55:40
mail service. Yes. So service file created and let me
55:45
so first set of application has been launched.
55:52
Okay. This part has been launched. Sorry. Just for devil purpose I use some random application you can use a
55:57
heading. Okay. And very quickly if I see service
56:02
created. Okay. Yes. I always want to check one more thing that in my service my email
56:11
service does they register with the old uh backend ports.
56:17
So yeah this service can this all the back end port. So they now they can balance the traffic between these ports.
56:24
So this part is done almost similar way. I am going to uh do the same thing for
56:31
the deployment called search. Okay. Again three port I'm running and
56:36
let's say this is my search. Okay. This app my search.
56:48
Okay. and let's say my search my search
56:55
okay only changes I'm just changing my image name so you can see the difference right I'm taking one of the random image
57:00
from the internet it's called HTTPD this image will launch one web server which it shows I think a message called it
57:07
works there's a different image with different content so you can see the different traffic is routing here and there only thing I'm changing the image
57:15
name image name like a different set of application I'm going launch.
57:20
Okay, so this part is I believe done. So let me
57:27
run my deployment file. Okay, almost same I am going to launch
57:35
my service also.
57:41
Okay, only changes the selector part, different port number I'm going to use
57:48
and let me give my service also a different name. My search service.
57:58
Okay, maybe change also here does not require but let's change.
58:03
So this part is done. So
58:08
service also. Now this this you know setup has been done. Two set of application has been launched very
58:15
quickly. Let me describe
58:21
a service called my third service. Let me show you tell you everything. Service
58:27
is running and now they connect to different set of ports. Okay. So thing is working great. No
58:34
challenge till now. Okay. And these are the ports we are running. Now what we have to do next
58:43
we have to balance the traffic here and there. For this we have to create the ingress rule.
58:50
How? Almost the way we have done yesterday. But we have to do some more extra stuff to to be written here.
58:56
Right? So what I'm going to do, I'm searching for EKS inress
59:03
uh controller or I can say ingress
59:08
rules. Let me search this line and they might
59:14
give you some rules that we have to use, right?
59:21
So we have to use some rules. for siddhis the rule we have discussed already
59:28
okay I'm just checking if I if they give me a
59:33
proper rule otherwise we have to type
59:39
this also a good example guys you can take this example this one kind of use case almost same thing okay they are uh
59:47
demonstrating here right so just go through this example just keep on copying paste and you will see the
59:53
entire set of will be done. Okay. But I am looking for
1:00:00
a rule. I think this is the yesterday document. It is still no. Uh so you
1:00:08
search for let me search for Kubernetes inress. So there they give you better rules.
1:00:16
Okay. So the web document from the in kubernetes in because finally is a part
1:00:21
of cubernetes only and here guys this is the kind of rule I would like to create
1:00:29
today okay so what I'm going to do I'm going to copy this uh rule okay and I'll
1:00:36
explain to you so this is aress alb
1:00:44
rule yiml file Okay.
1:00:49
And this is rule we have. Now first of all we have to change the most part is
1:00:54
annotation. Right. I told you in my last class about the annotation part. Uh now
1:01:02
I don't know where I c yesterday I c randomly somewhere. Let me check
1:01:12
in class. This is what we have printed yesterday and uh in
1:01:19
sorry format
1:01:25
I given the nameress
1:01:36
one guys I just want to do with the code from yesterday so it will save our time just wait for
1:02:15
Okay. So I got the link or kind of document somewhere.
1:02:21
So I am going to copy this code. This is
1:02:26
what I explained you already and we have built a step by step in my last class.
1:02:32
Right? So I'm going to use same code. Let me post over here. So this is my
1:02:39
ingress resource type. Okay. What a name you want to give you can give. And here I want to paste this.
1:02:49
Okay. This is a commands I don't need.
1:02:54
Okay. So uh uh format I don't need this part also
1:03:02
levels names and all the things we have written already.
1:03:07
this part also. So this concept guys I explained you already in my last class. Step by step
1:03:13
we have built this this setup.
1:03:18
Okay let me give a different name my app
1:03:26
ingress right is just a name for the ingress. So they are going to use
1:03:33
uh they're going to use ALB that's the internet facing protocol HTTP
1:03:40
okay whatever port number they have they're going to use uh health check in this case I'm going
1:03:47
to uh go in my SL only
1:03:52
okay to my health checks okay interval all things uh All
1:03:59
right. So this is what almost we have discussed right now main thing today we have to discuss of the about the
1:04:06
specifications right so in the specification we have to create a rule okay and how to get the rule that's what
1:04:13
we are going to discuss right according to our requirement guys okay what I want
1:04:19
I want if any customer okay type
1:04:25
where the diagram is if any customer type okay slice / mail. Okay. So this call guys path
1:04:36
but it's not complete path. So whatever you type in the last so technically customer is going to type http then the
1:04:44
uh URL IP address then the path.
1:04:49
Technically this path is known as path or route or here this is also known as
1:04:54
path prefix. So the type here is called path prefix
1:05:00
that's what we are using here path type is a prefix and the prefix is sl/
1:05:06
mail okay that's what we write if somebody type this URL
1:05:13
then I want to connect to my back end okay and my back end is a service
1:05:20
okay and name of the service that I want to connect in this case is that I
1:05:25
already have okay so qctl get services
1:05:32
our service name is this one the service I want to connect
1:05:39
okay that's all guys and this service one service can run in multiple port
1:05:46
number right so which port number you want to connect so this service is running on port number 80 or might they
1:05:51
might have many more to be exposed but in my case is 80 port number.
1:05:57
Okay. So this is one path we have created. So this guys one set of path we
1:06:03
have not set I say and if you see the keyword paths in one path we can create
1:06:08
multiple path right but this is one path we have created. Similarly okay what I can do I can copy paste this
1:06:16
code. Okay. And if you notice also guys if you know yl so here this path is a list and
1:06:23
in the list we use hyphen. So this is the first item.
1:07:19
So guys, there's some I think network disruption from my side.
1:07:24
So you didn't miss anything. I stopped speaking. So this what I was talking
1:07:30
about. Okay. So these are two different paths we have. Similarly we can type multipath
1:07:37
even though we can set default path also or we can also set this kind of path for
1:07:42
example uh copy and paste. So if somebody come
1:07:51
to uh I'll check the indent part I don't know the space should be equal but if
1:07:57
somebody come to slash then kind to different service or somebody come to SL
1:08:03
star also we can write for example any other path they come I want to connect to different page or maybe I want to
1:08:10
connect to different page where they say this page not found contact to this this customer and something like this right
1:08:15
customer representative. So those things we can also can done here but let me do and test
1:08:22
till here. Okay here guys I haven't give the name of my ALB so they will create some ALB
1:08:29
for you automatically and main thing is class name also I told you yesterday. So
1:08:34
in my case the class name we have ingress class either I can use the
1:08:40
pre-get class or the class that we have created that's called awesome class we have created. So let me use this. So two
1:08:49
main thing guys in the ingress resource tab file one is
1:08:54
this annotation. This will decide what kind of what setup you want in your uh
1:09:01
load balancer or this is a rule part. Okay, that's all.
1:09:08
And now we can run this. But before I run, let me do one thing. I'll go to my
1:09:13
ALB load balancer. Let me again sign on.
1:09:19
One minute, please. So I just want to show you that something is happening. Just give me one minute. Let me sign on.
1:09:31
Okay. So I was working on uh a region this was called Singapore in my case.
1:09:39
Okay. So in the Singapore our cluster is running but right now I'm interested on
1:09:47
uh EC2 because I have to give you load balancer services subservice. So if you
1:09:53
go here and load balancers uh you can see right now there's only one single
1:10:00
load balancer that's what we created yesterday. Okay. But now what happened when I run
1:10:06
this file? Okay. QCTL apply this file. The file name was
1:10:15
something I think ingress something. So this file then your one more ingress
1:10:25
created. One more created. And this ingress have
1:10:31
their own personal load balancer where normally the name
1:10:37
start with your load balancer name. This can be name they might have given automatically because I doesn't didn't
1:10:44
provide the name for the load balancer. Right? So they create automatic load balancer. If you notice also here one
1:10:50
load balancer automatically created. Okay. But interesting thing is in this
1:10:56
load balancer they create according to the rule what rule we have defined.
1:11:04
Okay. And second interesting thing is in this load balancer because this application load balancer support
1:11:10
application layer support L uh 7. So they know how to uh understand the the
1:11:20
you know different uh themes right or different HTTP headers. Okay. And they get this rules. This rule
1:11:27
is being given by us. Right. So these rules they have created. So we click on
1:11:32
this rule what they have created. This exactly what what we have defined. Right? See here this is what we have
1:11:39
defined. Okay. And they say if any traffic come on the path search or search star means
1:11:47
anything search or search star. That's what the by default path pattern they use.
1:11:54
Okay. So we send 100% traffic to
1:12:00
this service. Okay. So this entity using some service
1:12:05
this service whatever service we have defined. Okay. If some come to this path
1:12:11
we send to different service mail service 100% traffic there.
1:12:17
Okay. Otherwise if the rule does not match does not match we give 404 error.
1:12:23
This rule is given by them automatically because you does not define if somebody comes/st star then what to do.
1:12:32
So we can write one more default rule if the none of the path match then show me
1:12:37
show them this page that's a different point because we haven't defined. So they create themsel
1:12:43
a default rule 404. So three rules they created here. Okay. So that is the
1:12:50
reason they was showing you that they have created three rules.
1:12:57
Okay. And all these rule is not created by us is been created by
1:13:04
uh these guys. Okay. My point is if you know ALB load balancer
1:13:11
almost whatever you want to do in ALB you can control from Kubernetes creating
1:13:17
a rule setting default setting setting prefixes setting you know in sometime
1:13:22
URL we send the query strings uh maybe
1:13:28
content filtering on the query string or maybe redaction
1:13:33
maybe uh SSL terminations S maybe
1:13:38
session in affinities sticky bits okay sticky session I can say so everything
1:13:45
you can do right only thing is what you have to find the annotation for this just go and find your annotation for a
1:13:53
EKS for this purpose or can we can a rule for this so same approach is all based
1:14:00
upon the requirement just go and find out in the rules file the way I explained you yesterday
1:14:07
and thing would be done. No extra things you you guys have to do apart from this
1:14:13
right. So this load balancer is still provisioning. It might have provisioned
1:14:18
already. It's active now. And in this load balancer they given this DNS name
1:14:24
automatically that you can change also by yourself by setting the 53 in the
1:14:30
AWS. Okay. But let me use this uh
1:14:36
name. And now guys, if I connect here uh there's a by default slash you will
1:14:43
see page not found. That's true because this is what the rule set by default in the load balancer. But if I click on /
1:14:51
mail now what happen? It will it should root to uh this page.
1:15:00
Okay. As you know guys technically they routed actually this page
1:15:06
only challenge is okay the code that I was running they don't have this folder
1:15:11
actually okay so application in they also send
1:15:16
this this/ mail to the port so port should also
1:15:22
have this mail folder application should run with this respective right for example if I write right/ search
1:15:33
Okay, they will again routed to the same service
1:15:38
but your ports will also have this also one important point to be noted what I mean by this if I talk about the ports
1:15:48
okay so they routed here successfully but in this port they're asking I'm
1:15:54
looking for the mail folder or SL folder do you have this
1:15:59
so application should have this folder also because technically file requests come to this pool in this in this
1:16:04
particular URL. Okay. So what I can do right now very
1:16:09
quickly to perform this demo. So I'm going to do
1:16:15
something on this port. I'm going to execute for example let me test right command I can run.
1:16:22
So it execute in this code.
1:16:31
Yeah. So what I'm going to do I'm going to create a folder in vw wtml.
1:16:39
Why? Because let me check one more small thing. By default the present working directory
1:16:46
is SL or does they have a directory for wtml?
1:16:52
here. Yeah. So in this folder I am going to create a folder called mail folder.
1:17:00
Okay. Mail folder in this port and obviously this folder
1:17:06
is not there. I'm going to create obviously when you build the container image that time you have to manage this
1:17:13
but I don't have so I'm just creating manually. Okay. and plus in this folder I am going
1:17:20
to create a file let's say index dot html
1:17:26
and uh eco if this can't work here let me check
1:17:33
sorry
1:17:42
I think because this windows prompt
1:17:47
Okay, I'm just checking is is working or not. Uh otherwise let me do one small thing very quick. It will be quick.
1:17:55
So I'll go to this folder where html mail.
1:18:00
Okay. And let me create a file index.html im mail. That's all. Okay. Same thing
1:18:09
let me do with other ports also. Otherwise you can decrease the replica. So I think we will check but we're going
1:18:15
to see the same demo. Okay. So my next board is this one.
1:18:25
Okay. I'll do the same thing.
1:18:35
Mail. Inside the mail I'm going to create a file index.html.
1:18:42
get command and I am male two to see that different
1:18:49
port is there. Same thing in the last one.
1:18:55
Okay. Same thing you can do with search also but
1:19:00
let me show this demo with mail. So the application developer who will create this uh
1:19:08
particular you know uh images they obviously create this
1:19:17
path for the application. So application path right mail
1:19:23
okay now yeah every port has this. So finally if somebody writes as mail a
1:19:31
router or ALB will check this route/ mail uh by looking at this route they
1:19:37
will send to the service of the mail but your mail port also should have this
1:19:43
folder right in your bore folder and the B folder in your web server is vtml in
1:19:50
httpds services.
1:19:56
So now it should work.
1:20:02
No. Why is not working? They are
1:20:08
mail index. HTML.
1:20:15
I should work right.
1:20:41
So they are showing permanent reduction
1:20:50
mail index dot html. Yes. So it's
1:20:55
showing right. So this because this is might not be my index. Right? If you know uh
1:21:04
index concept in web server so there maybe this four folder my index will not set so I'm just typing here so otherwise
1:21:11
thing is working right so if I hit enter again see here they are doing right they're doing here they're doing the the
1:21:19
uh load balancing only within the mail ports right there's many more port running because I type SL mail so
1:21:26
they're doing the routing within the mail Right here it was not working because last time it was HTTP I think
1:21:34
here I write HTTPS somewhere that may be one of the reason. Okay.
1:21:40
So if I hit enter guys here it is working right. So load balancer is happening. Okay within the mail port
1:21:47
because I type this prefix here. Okay. But if I type / search
1:21:59
okay then it won't found right why request go to search port but in the search port we don't have a search
1:22:06
folder okay even though very quickly let me do it so what I'm going to do to make the
1:22:12
things little faster uh board I'm going to
1:22:18
scale my deployment name
1:22:24
and setting a replicas to one. So we have only one port running.
1:22:33
Okay, one port running and uh doing the same thing in this port
1:22:39
to have this part.
1:22:46
So but this is my default location guys in this case every server has their own
1:22:51
default location according to this default location where the application is hosted
1:22:58
okay uh I think this can be the full location I don't know about this food
1:23:03
let me check this default location maybe HT docs
1:23:10
format yeah I think this is default location actually we have in this particular board who We've created this
1:23:17
and I'm going to create a search folder because in the default location they will go to this folder. The application
1:23:24
has to be put over there and let me create one file. I am
1:23:32
search that's all okay now if I hit enter see here it's
1:23:39
connected right the interesting thing is the this is what I was explaining you
1:23:46
same URL if somebody come on list search they connect to very different set of
1:23:53
applications here right managed by a different team maybe okay and if
1:23:59
Somebody type / mail. This is exactly what happening in Google also the way I given you the example in my last class.
1:24:06
They connect to different set of services all together. Okay. All together. So this is how guys
1:24:13
the this is called pathbased routing rule based routing sometime also known
1:24:19
as context pathbased routing. multiple name it this
1:24:24
this concept has or a name if you can like you can use it to write okay
1:24:30
otherwise many more rules also we can create this is a cubernetes uh have a
1:24:35
great uh you know document for this many more rule back end we discussed already
1:24:42
yesterday uh this is a one more rule not is maybe for our thing for storage
1:24:49
bucket we don't need right now and this is the different different this path you can use.
1:24:55
Okay. So if you want to uh go for
1:25:01
uh kind of you know path for example somebody type as fu or say f/ anything
1:25:09
after fu then you can use kind called prefix you know so in my code I use the
1:25:15
kind this kind
1:25:21
pre prefix ap are both will work. But if you want to
1:25:28
go for exact match then you can change the kind to exact then only this exit
1:25:35
match happen then only the rule will be trigger. Okay. So this good example they given
1:25:41
you when match does not match. Okay. So there's multiple example they
1:25:46
give you accordingly you can uh write. Okay. This also work as a host name
1:25:53
because guys they also support and right now what I have done we have done
1:26:00
the path based routing so two kind of routing they support one is path based
1:26:06
routing or known as context based routing one they also support hostbased routing
1:26:13
okay and that's what they give in the example here so if you guys know the concept of virtual hosting
1:26:20
that This concept mainly used. So a hostbased routing if somebody customer
1:26:26
type this host name then we'll send to this guy. If the host name with something else anything
1:26:33
else is wgoogle.com we send here. Let's say mail.google.com we send here.
1:26:41
Okay. So is host obviously here the role of DNS going to come in play. We look at
1:26:46
a DNS record right. So this host routing also we can uh do in G class we have
1:26:53
discussed already and that's all. So these are guys some rules examples one
1:26:59
of the commonly very commonly used rule is this one that I showed to you this
1:27:07
one. Okay you can set one more path for example let me check very quickly.
1:27:14
Okay, format
1:27:20
this one is called SL. For example, if I say prefix, prefix means SL star
1:27:25
actually SL star. It means anyone go to anywhere
1:27:33
then they will lend it to this service. This can be any other service or same service may be whatever you want to use.
1:27:40
Okay, this can also be done. For example, right now if I try to go uh to
1:27:47
this page, let's say Jack for example,
1:27:53
they will say not not found uh 404.
1:27:58
But if I add SL or SL start means any traffic apart from these two above will
1:28:04
be sent here. Okay, let me check very quickly.
1:28:11
So I will apply this file
1:28:18
ingress. So we apply this file in this particular
1:28:26
ingress resource. Okay. If you even though if you just
1:28:32
describe this resource also you can see your rules. my I think this is what we have created.
1:28:45
Okay. So you can see this is your annotations. Okay. And uh and this is what the rule
1:28:53
you can find here. Okay. They're very clear. If somebody says a mail, we send here sess send here
1:29:01
SL send here. And most more part here is the sequence.
1:29:07
Okay, they will match in the same sequence. The way you write the rule. First they say as mail then search then
1:29:13
SL. What I mean about this? Let me show you which again get very important part. But because I now apply this rule, this
1:29:19
rule is finally landed to the application load balancer. So if you guys talk about this load balancer,
1:29:26
okay, what you will find in this load balancer. Okay. Now the this is the rule
1:29:32
we have and now what you will see there's some change in the rule
1:29:37
rule one is same search then mail okay now this rule was not there is been now
1:29:44
created so anybody come to any star they will
1:29:50
send to this service okay it means if somebody type / search
1:29:59
they landed some type mail they're related to mail service but some
1:30:05
type jack something like this okay
1:30:10
so again I think we have to write a because I don't have set the index pages
1:30:16
in my web services okay but they lended to last time guys
1:30:22
the error was what what the error was page it's 404 right it's not 404 this
1:30:28
error was not found it means they lended to the final port but they don't have a
1:30:34
jack folder. Okay, that's the reason this error was coming up. Okay, otherwise there's no
1:30:41
technically this routed successfully. Okay, but they don't have that page. So
1:30:46
that was the error was coming and last time also guys you see SL was not working right. But now then SL and as
1:30:53
the SL come they connect here. Why? because as SLS come they go to the
1:30:58
service in this service I was running HTTPD image that will give this output.
1:31:03
Okay. Now important thing is what I was talking about they will match the rule in the same sequence. What I mean by
1:31:09
this is again very important point to be understand right. So if you create a
1:31:15
rule in this sequence if you write the SL in the first
1:31:21
first rule. Okay. So what happen any traffic come up
1:31:27
they match this rule and slash is like SL star means every
1:31:33
rule match with SL okay if it it means if somebody said if
1:31:38
somebody type SL mail also this rule match and as soon as the first rule match they won't go to next rule
1:31:46
it means in all the cases they will only connect to this service only they never go to next it means they will not not
1:31:53
able to route to mail and other services right so sequence AI is very important
1:31:58
all right they will match the rule and as soon the rule match they won't go to
1:32:04
next rule to check okay so let me reapply this
1:32:11
okay okay save
1:32:16
actually there's a inditionation issue Okay.
1:32:26
Save. Apply. So this also very important point to be not right.
1:32:33
So if you see here in the describe
1:32:38
command according the rule will manage here first SL going to come up. It's not at all the right way. Okay. This line
1:32:46
means there's no further line means right. Means if you write slice in the top the rule will never go to matches
1:32:53
and see third and fourth or second and third. Okay. And even though if you go
1:32:59
to your load balancer also. Okay. In the details
1:33:06
load in the rules. Let me reload this rules.
1:33:16
They might not update here in this way but let me wait for some time but you
1:33:22
see the rules will be matched in that prior they will update also there. Okay.
1:33:32
So they might not m because they might be just creating a rule but uh but uh
1:33:39
the let me say see the demo in this way right. So I click slash they work here
1:33:46
if I sl it is working I think priority does not
1:33:52
makes any sense here I think some version I have tested right it was not
1:33:57
working is working means priority means they're checking the other
1:34:04
sequence also let me do one more thing because sub version I've tested was not working let me do one small change let
1:34:10
me write star Maybe here they are only checking slash
1:34:16
only not SL male. Okay, let me test this part at least. I
1:34:22
think this should give you that clue what I was talking about.
1:34:29
Okay, so the rule has been created and let me describe
1:34:37
SL start. Okay. in my
1:34:43
load balancers again. They have the same format
1:34:48
and uh let me copy
1:34:59
it is still working. I think this was not the good practice. So maybe they might have removed this facility but in
1:35:06
the older version. Okay. what I have seen uh if you write
1:35:13
the rule slashstar okay in the top then they always route
1:35:21
to the slash uh service only they won't move to next okay
1:35:29
so the picture practice was we always recommend don't write slash
1:35:35
in the format
1:35:41
I change this why this one. Let me close.
1:35:53
Yeah. So the actual practice is we always recommend to write this rule in
1:35:59
the last even though here does not matter. We can write in any of the sequence it is working. But that's nice.
1:36:05
That's what we wanted actually to work. Okay. But even though I even though I
1:36:11
still suggest okay that any default matching like a default route you have
1:36:17
to write in the last that's what I am suggesting here. Okay here it does not
1:36:22
makes any sense to add here and there but this is what size I'm discussing here right. So guys this is about the
1:36:28
ingress controller and the rule it now at your
1:36:34
choice how you can create the fur the rules and customize your environment.
1:36:39
One more topic I want to take here guys. If you want to set up the SSL terminus
1:36:46
okay how we can do with EKS and Kubernetes
1:36:52
okay or uh in the simple term if you want to set
1:36:57
up the SSL redirection right if some you know
1:37:03
sometime you see if you type http.google.com google.com, right? They automatically redirect to HTTPS.
1:37:10
So, how can you set up the HTTPS? Okay,
1:37:17
first of all, right now if you see your load balancer
1:37:22
ALB, okay, is working on a protocol
1:37:31
called HTTP. this HTTP not the HTTPS
1:37:37
that's what we can see from command and all also is HTTP
1:37:42
not S obviously we never want to use HTTP right it's not secure okay so if you want to use HTTPS what
1:37:51
can you do okay so that's also guys we can control from our Kubernetes
1:37:58
so in in your rule file by writing some annotation
1:38:04
Okay, we can define that I want my load balancer support HTTPS also.
1:38:13
Okay, so what is the process for this? What can we do? So for this process
1:38:18
guys, you have to take the help from DNS and the certificates.
1:38:26
What I mean by this, right? So again I'm not going for the cryptography discussion here but those who does not
1:38:33
know about what is the use of certificate how to create certificate
1:38:38
what is public key private key CA what is use of host name or domain name and
1:38:45
DNS in the certificate right so if you want to learn everything about the cryptography recently guys we have
1:38:52
hosted our IC connect is our YouTube channel Here I
1:38:58
have a complete series of crypto graphy session. It's a pure practical
1:39:04
training okay free and you will learn anything and everything about
1:39:09
cryptography here okay so we host and you can read from
1:39:15
here cryptography okay from very zero to all the practicals and all the kind of use cases
1:39:22
so that's one thing so I'm not going to describe cryptography here but only thing is what we are looking for uh our
1:39:30
lb is giving us HTTP right now it is not secure I want to move to HTTPS
1:39:39
this is what we are looking for okay and if you're looking for HTTPS who
1:39:45
is giving a HTTP ALB okay so if you want ALB support HTTPS so
1:39:52
for this we have to provide a certificate
1:39:58
to ALB so when I say certificate It mostly means two things. One is a
1:40:05
private key. Okay. So that connections what are data coming from the customer we can encrypt
1:40:12
and decrypt and one is your certificate signed by some CSO CRT certificates.
1:40:20
Okay. So these two things uh we need one more thing guys certificate
1:40:27
is mostly associated with the DNS name or the domain name okay so you also
1:40:34
provide your ALB a domain name like wiml.com and linuxorld.com some
1:40:41
domain name you have to give because certificate normally associated with the domain name because when you create a
1:40:47
certificate they ask you tell me the host name and domain name where your where your server uh running. In my
1:40:54
case, my server is ALB. Why? Because for the client perspective,
1:41:00
client is going to come to ALB. For the client perspective, this is a server.
1:41:05
Okay? So this server we let's say we give the name called alb.lin.com.
1:41:11
So client type this URL, this name or host name.
1:41:17
Okay? Or maybe a domain name. But if a client type https
1:41:23
then alb.linxworld.com it means client want to connect to ALB.
1:41:29
This is one thing. Okay. But how this name will be convert
1:41:34
to IP address. Here the DNS come in place. So in the DNS we create a code for this.
1:41:41
If somebody type this name convert this name to the IP of my ALB. This one thing.
1:41:48
Second thing is if kind of HTTPS it means they're looking for from this ALB that can you
1:41:55
provide your certificate I have to check then we can do a secure connection that
1:42:00
also we have to provide. Okay. So, so my point is here if you
1:42:06
want your uh ALP
1:42:11
work with HTTPS that we can define in Kubernetes ingress
1:42:17
rules and or I can say annotations that I want my ALB work on HTTPS but the
1:42:24
remaining settings okay create a certificate create domain name give a record in DNS
1:42:32
is we have to do Ourself we ask our cloud engineers or our certificate guys
1:42:38
or security guys or or DNS guys they will update this record for you.
1:42:44
Okay it's not a role as the uh require uh you know the role of cubernetes right
1:42:53
so let me do is explain you step by step and then you understood what the process would be. Okay. So, first of all, what
1:43:00
we have to do because we have to give a name to the uh to the
1:43:08
uh ALB. Right? Now, the ALB taking this name or the host name
1:43:16
this this host name. But this host name is given by
1:43:23
by uh AWS. So we can't control much with
1:43:28
this host name or the DNS name or the domain name. So first of all okay we
1:43:34
have to purchase our own domain name. This is
1:43:39
the first step. If you want to work in the public world if you are in the private world you can use any example.com without purchase.
1:43:47
But right now you're looking for the client who is in the public. So you have to purchase some real domain name from
1:43:53
the public. Okay, second step is you have to create
1:43:58
a certificate cryptography certificate where the certificate you associate with
1:44:04
this domain name. It means anybody who come to this domain name with https
1:44:10
we have the certificate assigned for this domain name. Okay, this is the next step you have to
1:44:16
do. And then third step is okay uh my ALB is kind of server they
1:44:25
also have some IP maybe behind the scene but this IP we don't want to use I want
1:44:30
to use simple uh simple name or this host name for the ALB
1:44:35
name maybe for example ALB.inworld.com Linuxworld.com.
1:44:42
So this name we have to create a record
1:44:48
where in the DNS okay the DNS but again you can't take
1:44:54
any domain name here like in this case this is the host name and lw.com is the domain name. So what domain name you
1:45:00
purchase for example if you purchase lw.com so inside this domain this is the one of the record you care for example
1:45:06
google.com is one domain and www is one host name mail.goole.com google.com is
1:45:13
one host name. So every host name has their own IP address that they create in the DNS.
1:45:19
Okay. So these three steps in this sequence some of your cloud engineers or
1:45:25
these guys operation guys have done for you or will do for you. I get one time
1:45:31
setup but in the future after the setup has been done in the future right from the
1:45:39
Kubernetes standpoint of view okay in the ingress rules or the annotation
1:45:45
there you can decide okay you can decide do you want HTTP or
1:45:53
HTTPS if you say right now we are using HTTP
1:45:58
but if you say HTTPS then automatically load balancer start supporting HTTPS
1:46:03
traffic secure traffic from the client.
1:46:08
Okay. And that point in time if you want your ALB will use HTTPS traffic that
1:46:14
point in time you tell the ALB for this traffic you have to use this certificate. You tell two things here.
1:46:21
One I want HTTPS traffic or my scheme is HTTPS. Second for HTTPS I want you use
1:46:28
certificate that is geared by somebody I want this certificate to be used.
1:46:35
Okay. So normally this is done in the AWS world in the ALB.
1:46:40
So in the ALB we do this part but now here uh you have don't have to come to
1:46:46
the ALB uh without coming here in the ingress file both the things to be uh done.
1:46:55
Okay. So even this part is not at all the part of u
1:47:02
uh this training but let me go through the steps. Okay. To have this demo. This is the important part that is very
1:47:08
simple again. So the very simple annotation keywords we have and we just
1:47:13
type it and it will work. Okay. But let me go through the steps to have this
1:47:19
complete uh demo. So first of all guys
1:47:25
I'm going to purchase a new domain name. You can purchase from anywhere but here we have service called route 53 in AWS.
1:47:31
You can purchase the domain name uh from there. So route 53 is one service
1:47:40
there the domain name registration service. Okay.
1:47:46
So what we are going to do uh here we have a top name called registered
1:47:54
domain. We can click here and you can purchase
1:48:00
your own domain name. Obviously this is a public domain. So it should be
1:48:06
available right? So remember if you try to purchase lwindia.com it's not available. It's been purchased by us.
1:48:13
Okay, check it is not available. Okay, but whichever available, let me
1:48:21
take these one just to quick test. 11.org is available and again they're
1:48:27
cheap also compared to 12 compared to right or available India.net net
1:48:33
or let me go for L this this net right so is it's not free first of all right
1:48:40
if you want to do this demo it's not free to purchase this uh domain name so
1:48:48
let me purchase this domain okay add to cart
1:48:53
okay I just want to for one year
1:48:59
okay and uh finally Finally continue. So first step is done.
1:49:05
So I will fill the contact information. Uh what do we require here? Yeah. So let
1:49:12
me guys stop sharing. Let me fill the some contact information here.
1:49:30
orbit.
1:49:46
I'm filling the contact information here.
1:49:52
Okay. Because to do purchasing is need is needed actually. Uh
1:50:00
and that's all.
1:50:06
Finally, this screen is going to come up after I fill the contact information. I want to
1:50:12
complete this order.
1:50:17
Okay. So, order submitted successfully.
1:50:22
Can I go to the domains? This is domain is been purchased. It's still in
1:50:28
progress. It took some time but it will come and we start using it. So this is first step. Okay. We want to purchase
1:50:37
our domain. Okay. In my case I purchase some domain. Let's say uh Z jz India.net.
1:50:48
Okay. Next step is we have to get a certificate. either you can create
1:50:54
yourself or there's a one service in AWS that is a certificate service
1:51:02
okay this was certificate manager service here they help you to create your own certificate very quick so
1:51:09
manage for you okay so here we are going to
1:51:17
create either you have the certificate even though we go to my cryptography classes there I show you how to create
1:51:22
your own. You can also import your certificates. Okay.
1:51:28
Or what can you do? Format. You can create your own certificate. Right. So
1:51:34
format. Let me request a certificate.
1:51:41
Okay. And here I want this certificate to be used for public domain. So I want
1:51:47
this to public certificate. and u in the fully qualified name. Okay,
1:51:54
here you have to give actually this final name. So load balancer which name you want to
1:51:59
use? ALB lens.com. In my case, my domain name is not lennisworld.com. I purchased
1:52:05
a different domain I think jzindia.net.
1:52:11
So you want to give ww.jindia.com or alp.
1:52:18
Okay. So you're creating a certificate for which host name or you can also use
1:52:24
star. So same certificate can use for multiple
1:52:29
host names in the future. This called wild card concept. Okay. So that's what the example they g
1:52:35
you can this one they can do this one. Okay. So sorry.
1:52:42
So uh in my case I want to create star dot
1:52:48
and uh uh zindia.net.
1:52:57
Okay. So this is what the uh name I would like to use. Okay. So name we have
1:53:05
given. Okay. and I want DNS validation. Uh
1:53:12
that's what we do. So guys, this is the certify your purchase. They will validate you with email or the DNS. So I
1:53:19
would like to validate with the the DNS. Okay. And that's all request
1:53:28
and that's all. So this request has been pending. Okay.
1:53:37
So because we have to verify with the DNS. So how we write something on the DNS
1:53:43
uh to to verify it. Okay. So this part is is been done
1:53:50
almost. Okay. Now uh what we do uh next.
1:53:59
Okay. So uh one matter this part has been done.
1:54:05
certificate. Okay. So, one thing we have to do guys because this certificate is in pending
1:54:13
state. Tell them is not verified. It will pending. So, if you click in the
1:54:18
certificate, they will say just go to your DNS
1:54:23
and create this record. Create a record in DNS or route 53.
1:54:31
Then it will be verified. Okay. Okay, you create the record. Okay, with this
1:54:36
domain name with this type with C name and this value.
1:54:42
Okay, so let me export this part in my download this file. I can copy in my
1:54:49
route 53 my DNS. So what I'm going to do, I'm going to my DNS.
1:54:58
Okay. In this DNS uh
1:55:04
even though let me go to my
1:55:10
DNS. So,
1:55:22
so actually we have to verify some payment actually. So guys this again this is not a part for this training I'm
1:55:28
just trying to show you this demo I have to check my verify payment also this account by chance also not belongs to me
1:55:34
also so you but you understood the step right so first we create this domain
1:55:40
when we go and create the certificate okay and then after this domain create
1:55:46
then in your hosted zone this domain name going to come up
1:55:54
Okay. And in this domain after they come up right, we have to
1:56:00
create the one record of this guy then they verified that's
1:56:07
all. So this is the setup we have to do. And finally in the D we to create one record let's say ww.hzindia.net.
1:56:15
So this is one record we have to create. Okay. And after doing this last thing
1:56:22
that as a cubernetes perspective what you have to do that's what the important part I will show you.
1:56:28
Okay. So what you can do so in the Kubernetes 10 standpoint of view if you
1:56:34
search for EKS EKS
1:56:39
uh ingress annotation rules the same page I show you you yesterday.
1:56:48
Okay. In the annotation rule guys, there's a two keyword we have to use
1:56:53
from here. Okay, one the listen
1:56:59
code. If you see listen code and here we have to use this keyword value.
1:57:06
This is one thing we have to do. Okay. So even though let me write very
1:57:12
quickly in my uh this file. So keyword
1:57:18
is listen port. It means I want my uh ALB will listen.
1:57:28
Okay.
1:57:33
Listen on both the port number. 80 for HTTP
1:57:42
and 443 is for HTTPS. any request come up they will listen on
1:57:47
both okay but if somebody come on https
1:57:54
that's called 443 then we need to give a certificate
1:57:59
okay and for the certificate we have to use this certificate ARN
1:58:06
okay where they asking you because you are a alb means you might have a
1:58:13
certificate in um in your certificate manager. So what
1:58:19
is certificate name? You can type here instead of name actually we have to type the ARN.
1:58:25
Okay. So what you do guys when you create a certificate right here they
1:58:30
give you a ar in the certificate every certificate give you a unique name that we can pick from here and you can
1:58:39
type here that's all there are two things you have to do as ingress prospect
1:58:47
okay so it means any traffic come okay okay at this port number not but it
1:58:55
will come on 443 then this certificate will be provided uh to us or to the
1:59:02
customers okay so this is the one thing you'll do now now onward your entire
1:59:08
traffic can be encrypted with SSL so this only thing that as a EKS and the
1:59:14
cubain perspective you do part I I have to verify payment all thing I don't want to go for this but if you
1:59:19
want to learn this also okay how to get a route or rest your domain name set up
1:59:25
a certificate here right so this that's what we normally train in AWS training
1:59:32
so what I do guys for you I ask my team they give those two or three classes to you uh from my AWS classes as a bonus
1:59:40
class if you want to learn if you want to learn then you can go through this classes and do this complete demo
1:59:46
over here okay one more small thing we can do here there's also sometime we'll see for
1:59:52
example when type http P col/ SL Google.com I'm typing http guys here but
1:59:59
as I hit enter google no is not secure right so automatically
2:00:06
okay they will redact me from http to https and if you notice here it become
2:00:13
https right it means google listen both the port but
2:00:19
as that if you go to 80 they redirect me to uh to 80 44 43 west APS.
2:00:26
Okay. Same thing also where I want here. I want I load myself listen both the
2:00:32
port but if they come on port 80. Okay. I want they will connect or redirect
2:00:37
automatically to 443 to further further process. This was a good practice to perform. And for this we have a concept
2:00:45
called SSL reduction. Right. So here they also
2:00:50
can find yeah this is the keyword. Okay SSL
2:00:58
reduction. Okay. And in action guys you have to till the integer and here integer is the
2:01:06
actually the port number. Even if you click here you can see the
2:01:11
detail. Okay. So you have to redirect to the SSL port. Which port number? In my
2:01:17
case I want to 443.
2:01:22
This also good practice to perform. Okay. So now onward
2:01:30
uh any traffic come up. This demo might not work because I don't have uh this certificate verify yet. Okay. But for
2:01:37
the cubernetes point of view, this is the final answer right that you we can
2:01:43
do right. Even though let me run this file uh cubernetes apply
2:01:52
inress right. So one
2:02:00
this file we have some annotation issues.
2:02:12
This is the address issue. We have
2:02:17
indent is actually not sorry.
2:02:25
So we apply this form some more
2:02:36
around
2:02:51
they're saying this line have some issue. What is the issue?
2:02:59
I copy copy from from the page only.
2:03:05
But the comma double quote.
2:03:11
Okay, let me type comma.
2:03:18
Okay, and this is a list. This is a list. So I'm just changing
2:03:25
something the list of port number I'm giving here
2:03:30
http s col 443 and http
2:03:36
col 80. Okay this can be issue
2:03:44
right this is why so this is syntax actually right again key value pair and
2:03:49
then put in the list. Okay. So now this has been created.
2:03:56
Okay. Your ingress has been again uh created. It won't work. The setup is
2:04:03
done from the cubern point of view uh point of view. And now they start
2:04:08
supporting uh 443 also. Okay. And let's try to describe this.
2:04:16
Let me increase my Okay. So
2:04:25
setup will be work on you can't see from here but it will from introduction you
2:04:30
can see here. Okay. But yeah, if you connect to your uh
2:04:37
load balancer, okay, http it was working work. But if
2:04:44
you try to connect HTTPS, okay, it won't work because we haven't
2:04:50
provided the certificate. The server was not valid. So it won't work, right? But
2:04:56
you can see something here is happening here. They're waiting. Last time if you see if you run, they failed very quickly, right?
2:05:02
Because at that time 443 port was not running. Okay. But now at least my loans at least
2:05:09
started 443 port HTTPS port thing is not working because they're looking for certificate. Certificate is not there
2:05:16
and you know why is not there. You can enable certificate and things will work for you. But my my intention is to show
2:05:22
you right to show you that uh that also we can controlled by
2:05:31
by HTTP by by by the cubernetes that's what I
2:05:36
want to uh show you right so that's all guys about uh this particular uh topic
2:05:47
okay so any query if you have Till now you guys can ask me
2:05:53
this part I suggest to do by yourself because you buy all the domain all the
2:06:00
things I'll provide the video just completed the video and that's all you have to do uh remaining part what I
2:06:07
explain you here is exactly the same no difference okay exactly the same these three lines
2:06:15
okay so that's all guys from my side. Okay. So any query if you have you guys
2:06:23
can ask.
2:06:31
So my we are managing multiple ingress here right? If you notice here we already have multiple ingress right. So
2:06:37
we are running with multiple ingress already.
2:06:44
Okay. one Kubernetes multiply and guess we are running already and working both are working right.
2:06:58
So you know guys it uh for the EKS guys it is not the last class some more
2:07:03
discussion will be left okay so that will be done on the next weekend. Next
2:07:08
weekend we will around about to close we can compose close this ease training. uh
2:07:15
those who are in the H2O training today and yesterday we call you guys here only
2:07:20
intention is to explain you the ingress concepts the rule the path based routing
2:07:26
all the things because very much required okay in the topic called ingress gateway
2:07:32
in the service mass okay
2:07:38
so how is helpful in my class I'll talk about this but There you should know
2:07:45
this as a pre visit and mostly we might does not know so we call you guys here
2:07:51
to learn this concept so we can do things very quickly there today's there's no class for you can consider
2:07:57
this a part of your training also or bonus class whatever you can treat there's no class for but this is
2:08:03
remaining classes we will continue from the next weekend okay
2:08:10
uh is one topic as we'll discuss in next class. Okay. In any case, we have forget also uh we will discuss in the
2:08:18
next class or CD also we'll discuss. Okay.
2:08:28
Each and I will upload all right I will upload uh the code in the in your
2:08:36
Google drive. So we will I think we have provide one Google drive otherwise we'll provide to you and I upload the code
2:08:42
over there.
2:08:48
So annotation is Jend it is annotation is
2:08:54
something like this u kind of instructions.
2:09:00
Okay. So somebody has already written okay some functionality for us.
2:09:10
Okay. So example functionality would be I want my cubernates to be launched on
2:09:16
interfacing. So this function is already written and same function we can use again and
2:09:24
again. So technically annotation is more like a functions right. So if you work on Java right so we use annotation. If
2:09:31
you work on Python we use decorator same concept. Okay. So we already have some function
2:09:39
pre-created and we're going to call it since simple term fun is you can think this is a
2:09:44
function function and we are calling it and asking that this is what I want to do
2:09:51
here that is simple meaning of person right
2:10:05
so anything For HTO we will see discuss with the in the H2O classes how to use
2:10:11
ingress controller there concept I think you understood the rule all the things
2:10:16
you understood but how to integrate with ST how to integrate SSL with ST that we
2:10:23
will discuss in upcoming class of ST.
2:10:34
So can you provide architecture diagram prepare according to production Rajasar which use case you are talking about if
2:10:41
you can tell me the use case I will help you the
2:10:46
uh I diagram for particular things right so if you can elaborate what use case
2:10:52
you're talking about
2:10:59
uh we'll talk about upgrade uh if you want to know how we can upgrade the cluster version as per the production
2:11:06
use case. I will try to take this topic in the EKS in my next class.
2:11:12
Okay. Lambst tag. Uh okay. So let me do
2:11:18
one thing. Uh I'll take one this use case also in the next class as a lamp.
2:11:24
Uh so where I use some external database. Okay. And lamp I think M is for
2:11:31
database. So I'll use MySQL from RDS. There's one more new component going to
2:11:37
come up. It's called external resource current database. So I'll take this or
2:11:43
maybe for front end I will use WordPress that will host on the ports. Okay. So
2:11:48
how these pieces connect together. Okay. So I'll take this example Raj
2:11:53
Kumar in the next example and by this example I will explain the entire architecture because when you connect to
2:12:00
the database for example external database in the Kubernetes like RDS and
2:12:06
AWS right then there's one more component come up called external uh name space service for for database
2:12:15
what are this we'll discuss in next class right I'll show show you this entire setup okay and you will get the
2:12:21
proper for you know uh idea about how it work.
2:12:26
Okay. So that's all guys uh from my side. All this code what I using I'll
2:12:33
share with you soon in your respective Google drive and you guys can get this
2:12:38
code and practice the way you want to practice. Right? So that's it from my side guys. See you in the next weekend
2:12:45
with the remaining part. Bye. Take care. Good day. Good night.

