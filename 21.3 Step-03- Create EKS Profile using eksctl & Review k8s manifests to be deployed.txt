# 21.3 Step-03- Create EKS Profile using eksctl & Review k8s manifests to be deployed

-: Welcome back.In this lecture we are going to create a Fargate profileon our EKS Cluster, EKS demo one, right?So before that we are going to verifyany Fargate profiles exist.So EKSCTL get fargateprofile in cluster, EKS demo one.So let's go ahead and then verify that now, right?So I'll go back hereand then I'll say clear and I'll paste it, right?So if any Fargate profiles are there,it is going to list for us, no Fargate profiles found.So we are going to create a Fargate profile.So the template is hyphen hyphen clusterEKSCTL create fargateprofile and the cluster name,and the Fargate profile name if we want to use,and the namespace, whatever we want to use, right?So namespace is the core thing here, which is nothing,but if our application is deployed with this namespace,automatically that respective applications podsare going to get scheduled under this Fargate profile.So what we are going to do is,we are going to copy this and then paste it, right?So the namespace tag, whatever we provide is the critical.So in, if our application deploymentshave a namespace reference to FP Dev, meanslike our deployment related manifest has FP Dev,then that respective podsinside that deployment are going to referenceand then deploy on this respective Fargate profile.So as soon as Fargate profile is created,so there will not be any instances present there.Only when we deploy the workload,which means the deployments,then only the Fargate instances will get created.Okay? So let's wait for this profile to get created.So we can see that Fargate profile got created.So one important thing here is when you are going tocreate this Fargate profile first time, right,in your respective EKS cluster where you alreadyhave existing managed node groups running, right?So at that point, it is also going to createa Fargate pod execution role also.So at that time you're going to see this type of output.So already this is created when I'm testingfor different things.So this output you didn't see now, okay, so you said,you have seen that it tried to create itand then finally created it. Okay?So that's all, but ideally it alsowill create a Fargate pod execution roleas part of whenever you create your first Fargate profileinside your cluster, right?So now let's move on and then review the manifestas part of whatever we are going to deployto our Fargate profile, right?So we are going to deploy a simple Nginx app onewith ingress load balancer.So we cannot use worker node, nodeportfor Fargate pods for two reasons, right?Fargate ports are created in private subnets,so no access to internet to access them.So Fargate ports are created on random worker nodeswhose information is unknown to usto create a nodeport service.That is also another important thing, and,but in our case, when we are doing the mixed modeenvironment with node groups and then Fargate,if we created nodeport service with ingress load balancerand then there is no target type of IP related annotation,still things are going to work because the nodeport servicewhatever you have created is going toalso present on managed node groups also.As part of that, you'll get the worker node portsfrom managed node groups.So that is not a good optionand always it is recommended for Fargate loads to use.Target type is equal to IP as the annotationat the ingress manifest level or if we have a mixed modemultiple applications deploying,for that respective applicationwho needs IP related target typeon our application load balancer, you can use IP.So now the first thing is to createa namespace manifest for us. Okay?So we usually use 01 or 00 for our namespace manifestand namespace is the mandatory one.For our respective applications,we need to map to that respective name space,then only they can be deployedor scheduled to that Fargate profile.So now we are going to create a API version V1kind namespace and the name is FP Dev.So let's go back here and if you see that,namespace zero one,namespace in 0901 Fargate profile basics,you can see zero one namespace.So this is there, and the second one is,update all other manifest with the namespacewhatever we are creating.So one is Nginx app one.So if you see it here in its deployment manifestunder the metadata, you can see namespace FP Dev is addedin the same way it's equal and nodeport service alsounder the metadata, namespace FP Dev is added.So rest all health check URL,all those things we are not changing which is comingfrom previous examples only. Okay?So only namespace added with FP Dev.One more is ALB ingress SSL redirect with the external DNSwhatever we have implemented earlier, right?So in our previous section, the same thing.And here also, under metadata section for ingress service,we have added namespace FP Dev.In addition to that, we are also going to addfor our deployment manifest, right?So we are going to add resources section.So why this resources section?So this is another important thing.So in Fargate, it is super highly recommendedto provide the resources that requestsand then resources that limitsabout our CPU and memory in our deployment manifests.So almost you can make it as mandatory. Okay?So hundred percent we need to use this.That is the good option. Okay?So this will help Fargate to schedulea Fargate host accordingly, means like the Fargate hostwhatever it is going to createfor that pod to be hosted there.So how much resources that Fargate host need to havewill be decided based on how much you provideinside this request section.So it's not going to use whatever you provide here,more than this only it is going to allocate,but there will be some calculation here, okay?So it'll take this much example,you take memory 128 MB you are givingand it is also going to allocateplus 256 MB for its kubelet,and then Kubernetes related core things to runon the worker nodes, right?So for kubelet and other things,and then accordingly it'll decide the valueand then provide the memory for our Fargate host.So in addition to that, as Fargate follows1:1 ratio, host to pod, one pod per host concept,we defining resource section in pod template, right?So deployment pod template spec should beour mandatory option.Even if you forget to define resourcesin our deployment template, low memory using podslike Nginx will come up and then keep running. Okay?So those will not have any issues most of the time.But, high memory using appslike Spring Boot, REST APIs or anything, it will bein the continuous restart mode in your Fargate profile,so which is not good.So always recommended to use resources section.So let's go back to our Nginx app one deployment sectionand you can see we have added the,even it is Nginx I have added, right,in the pod template spec, so under containers.And then for this, you are adding the respectiveresources for this container.For this container, it need this much informationof resources to be allocatedor it requests for this much informationand it can go for this limit whenever it needs.So that's about it.So in addition to that, update ingress manifestwith ALB ingress Kubernetes target type is IP.So as we already discussed multiple times about this one,as we are running our pods on Fargate serverless,we need to change our target to,target type to IP because we really don't haveany dedicated worker nodes here. Okay?So now in addition to that, we will alsoupdate our DNS name to FP Dev dot kuban cloud.com.So let's go to ingress manifest.And you can see it here, this is already addedand external DNS name also I'm going to say,"FP Dev dot kuban cloud.com."So one thing important here,we need to note is like this can be defined evenat the service level here, okay?So you can even define itat the service level based on our set of applications.So in this ingress, you have few applications with theEC2 worker nodes,and then you want to go with nodeport service for themand few applications with Fargateand the same ingress service you are planning to use.So few with the worker node, nodeportand then few with the instance IPif you want to use then you should not define this here.Okay?For all the Fargate deployment related things,we can take this IP and then put itin our respective nodeport service annotations,and we can leave the default, which is target type instancefor other related worker node stuff, okay?So that for deployment related toowhich we are going to host on managed node groups,they directly get the nodeport,nodeport related stuff automatically.Okay?So this completes the review of ourmanifests and alsoabout this creation of our all these Fargate profile.So in our next lecture, we'll focuson deploying these things and then testing.So I'll see you in the next lecture.Until then, bye bye.Thank you.