# 24.9 Step-09- [NEW]Build Stage- Create CodePipeline for build stage

Instructor: Welcome back.In this step,we are going to create a CodePipeline for build stage,which means we are going to implement sourceand build stages as part of this lecture.So let's come back hereand we'll go to CodePipelineand we will create a new pipeline.And in this new pipeline,we'll select the category as Build custom pipelineand click on Nextand provide the pipeline name as eks-devops,and then pipeline, right?And then we'll also provide the execution mode as default,which is queued,and service role is whatever we see here,we can use it or we can change the name accordingly.So I'll try to prepend it with something like 501so that we can easily search it,or something like 551.All things I'll try to add it this wayso that we can easily search with that number, right?And now we are going to add the source here.Source is nothing but our GitHub repository,which is aws-eks-devops.So we'll go here and selectand provide GitHub via GitHub Appas the source provider,which is where our repository is present is GitHub.And then connection which we have created earlier,which is eks-devops GitHub connection.And we'll also provide the repository name as aws-eks-devopsand branch is main.And output artifact format,we will leave it to CodePipeline default.And enable automatic retry on stage failure,so we leave it to default.And even the webhook start your pipelineon push and pull request events,so we'll try to leave it to default.And we'll click on Next.And in the Build section,so earlier you have completed the source stageand now you are implementing the build stage.In build stage, we are going to create,we are going to use the other build providers optionand select AWS CodeBuild.And here in the project name section,we currently didn't create any Build CodeBuild projectso we are going to create now.So if you go back here and search for CodeBuild, right?So if you open it,so here in the CodeBuild,in the Build project section,a build project should be createdand that we need to create it from pipeline itself, okay?So this is the CodePipelineand from here we'll create a project.And in this project,so it has created a new popupto create a CodeBuild project.So here we'll provide the project name.So I'll say, this is a build phase,so I'll say build-eks-devops-551.And project type is default project.And in additional configuration,we can leave it to defaults.And we have something called environment buildspecbatch configuration and logs.So project configuration,it just we have provided that project nameand then project type.And in the environment section,we select the environmenton which our build will get created,which means like on which missionthe build is going to run all our commandswhatever we define,so on which build mission it is going to run.So that we decide in this environment sectionor we specify in this environment section.So in the provisioning model,we are using on demand.So automatically provisions build infrastructurein response to our new builds,so on demand.And environment image,we'll use the AWS managed image for CodeBuild.In compute, we are going to use EC2.In running mode, we are going to use the container.And operating system, Amazon Linux,we are going to use runtime,standard runtime we are going to use.And this is the latest image available in this dropdown,so that is preselected.And image version also,it is always using the latest image version.So all the things we are using the default ones.And this is the role name it is getting created.It also has the 551,means like it'll be easy to search our role namewhen we go to IAM.So for that purpose,I added something some number here.And in additional configurations for environmentso you'll have lot of options availableand we really don't need all these things.And even the environment variable alsowe have already defined itin buildspec YAML file itself, okay?Buildspec-build.yml file itself.So we really don't need to make any changesrelated to additional configurations required for us.So I'll minimize them and we'll go to buildspec here.And in build specifications,we are going to select use a buildspec fileand we will say buildspec-build.yml.So this is the file presentin our aws-eks-devops GitHub repository.In the root context, that same build file,we are using it here.So we don't have anything related to batch configuration.And in the logs also,we are going to leave it to defaults.And then click on continue to CodePipeline.So ideally, when we click on this continue to CodePipeline,this project should be created in CodeBuildand it should return back to our CodePipeline.But sometimes what happens is,it will throw an error.Okay, when it is thrown,but it will create the CodeBuild project.So we can see the CodeBuild project,review it once,and go back and recreate the pipeline one more timeby selecting this project.So I'm going to show that now, okay?So there is a bug here.And most of the time,sometimes it passes, sometimes it failswhen running this continue to CodePipeline.So it will create the project,but it will throw an error.There is no reference to the window opener.So that is fine.So we'll close this window.When it is thrown,we'll try to close this window,leave here, right?And if you go to this CodeBuild, right?So whatever the build eks-devops related project,so this is the CodeBuild.So you can see build-eks-devops551 is createdand source provider is AWS CodePipeline,and it created just now, okay?And if you click on edit that projectand you can see, right?So it sources from CodePipeline.And these are the environment informationand this is the buildspec.All the things are as is from CodePipeline.So we are good, okay?So we'll try to discard here.Our project is created in CodeBuild.So what we'll do is,here, it'll not auto-refreshto get that project listed here.So what we need to do is we need to go back to pipelinesand create a pipeline and build a custom pipeline.One more time we'll try to create a pipeline.So we'll go to developer toolsand we'll go to CodePipeline, right?So we'll go to CodePipelineand we'll try to click on Create Pipeline.And here we'll use Build Custom Pipelineand I will say eks-devops-pipeline.And here only we can give 551.That's fine, okay?And then click on Next.And in source provider,we will select GitHub via GitHub app.We'll select eks-devops related GitHub connectionand aws-eks-devops repositoryand its main branch.And click on Next,rest all defaults and click on Next.And in the other build projects,so we'll select AWS CodeBuild.And here when we search for it,now we have the build-eks-devops51, right?So now we'll select that and we'll click on Next.All these things we'll leave it to defaults.And then in the test stage, we'll skip the test stage,we'll skip the deploy stage,and we'll go ahead and then create the pipeline.So let's wait for this pipeline to get created.So once the pipeline is created,we'll go ahead and then implementsome more things to test the end-to-end build.So let's wait for itand the pipeline is createdand it is going to run also.I'll see you in the next lecture.Until then, bye-bye.Thank you.