# 15.5 Step-05- Ingress Service Demo with External DNS

-: Welcome back.In this demo,we are going to add the external DNS annotationfor our Kubernetes ingress service,and then test itand then see that whether our DNS recordsgot automatically createdby external DNS in Route 53 hosted zones.So let's see the network design once before moving on.So in the ingress service,we are going to add the external DNS-related annotations.And after that,it is going to automatically add the DNS namesin the AWS Route 53 hosted zones,and we'll be able to test those DNS namesby accessing them directly in the browser, right?So now let's go back to our GitHub repositoryand enter into the section 0807,use external DNS for Kubernetes ingress, right?And if you see here,update ingress manifest by adding external DNS annotation.So let's come back hereto our Visual Studio codeand enter into the section 0807,use external DNS for Kubernetes ingressand 010203 Kubernetes manifestfor NGINX app one, app two, app three,no changes coming from the previous sections,and 04ALB ingress SSL redirectwith external DNS is the thingwhich we are going to update here, right?So in this, the name of the ingress serviceis going to be ingress external DNS demo,and load balance, her name is external DNS ingress.And if you come down here,so this is the external DNS-related annotation.And inside that,we are providing comma-separated two DNS names:dnstest901.stacksimplify.com,DNS test 902.stacksimplify.com.So like this, you can add multiple DNSsor multiple subdomains,or even we have provided,currently, we didn't comment this part.We commented this partso that all the hosted zones will be applicable here,which means I have something called DevOps in cloud.So I can say abc.devops in cloud.So one more DNS will be added with abc.devops in cloudinside that DevOps in cloud hosted zone.See domain filter.We didn't provide any filter here.So which means all the applicable domainspresent in hosted zone can be added here,not only stacksimplify.com.So you can use other domains alsobecause you have commented that option hereand said that all the hosted zones presentare applicable here to add the DNS entriesby external DNS.For now, we are going to testwith the dnstest901.stacksimplify.comand dnstest902.stacksimplify.com.In addition to that, another important thing here is,so if you need to ensure that this should be your domain.comand also ensure that your certificate hereare also updated with your own certificate errorin this ingress manifest, right?From your account, whatever the error is there,that one, you update it.So now let's go back to our GitHub reportand move on to the next stepwhich is deploy this Kubernetes manifest and then test it.So let's come back to terminal, clear,and come out of deploy external DNS-related sectionwhich is 0806 and go inside 0807.Use external DNS for ingress Kubernetes.And let's say LS-LRTA and Kube manifestjust to check that we have all the files 01, 02, 03,and then 04, right?And we'll say kubectl, apply-F kube manifest.So this should deploy the app one, app two,app three related deployment and NodePort servicesand also createthe external DNS-related ingress service, right?So now this is created.Another important thing here is the most important thingis let's keep monitoring your external DNS logsso that we'll get the clarity.Let's wait for it.So we can see here, create dns901stacksimplify.comand 902.stacksimplify.com.This is our core goal to verify that, right?So now let's go to Route 53 and go to stacksimplify.comand if you see here, DNS test 901, DNS test 902.And if you see the values inside them, right?So this is the external DNS ingress-related manifestload balancer service, so 144 863 844.So now let's come back hereand go to the EC2 and find the same name here.So let's come back here and go to load balancers,and you should find the load balancer related DNS name,externaldns-ingress-1448638444.And here also, you'll find the same thing, right?1448638444, which means the DNS name,whatever you have created,is associated with your external ingress related DNS name.Load balancer DNS name successfully.So now the next thing here is goand then do the NS lookup tests, right?So let's come back here.So you have verified your external DNS podwith the create, create, create, create.All the things are good.So let's come out and do it,and let's look up test for DNS test 901and it is resolving to the IP addressand also verify for 902and it is resolving to the IP address.So that is good.And if you want, you can access the application DNS test 901and then 902.So let me close this IAM,come back here, and DNS test 901 is goodand this is app one is goodand app two with a DNS test 901 is goodand also we'll access the root context also.So all redirected from http to httpsand everything is accessible with DNS test 901.So now close this taband if you want,you can also access with DNS test 902, right?You are accessing the http URLand it should auto redirect to https, right?You can see the certificate lock symbol here.And app one is good and if we want,we can also access the app two with 902 and that is goodand root context also we can access and then test it.So this completes the verificationof using the external DNS with the ingress service, right?And another important thing here is when you are testing it,this should be you domain name.And now, we'll go ahead and then clean up thisand it should also delete the 901and then 902 DNS records, why?Because if you go back here, right?So if you go back to hereand if you see you have commented this policy upset only,so which means it should be in the full synchronization.Whenever you delete your ingress resource,automatically, the DNS records updatedinside that ingress service, right?Whatever is present inside thatin the external DNS related annotation,so those should get automatically deleted.So let's go here and say kubectl,delete-F, and Kube manifest.And once you delete it, immediately go aheadand then start monitoring your external DNS logs, right?So let it delete, right?Ingress service is getting deleted.So let's wait for the command line to come for us.We'll monitor the logs hereand let's wait for it, wait for the logs.So you can see create logs you have seen.Let's wait further delete logsin the external DNS logs for external DNS pod.In meantime, we can go here and then verifyif our load balancer is successfully deleted.So this is good.So we need to always ensurethat our application load balancer is successfully deleted.By any chance it is present,again, it is going to add cost for us.See now, you are back to your external DNS pod logsand you can see it is having the desire change,which is a delete so and so DNSsand it has deleted those DNSsand successfully updated that hosted zone.So now come back here and go to Route 53and go back and again go inside stacksimplify.comand you should not find anything relatedto DNS test 901 or 902.So which means whenever you have createdthat ingress resource,it has automatically created those external DNS recordsin the Route 53 using external DNS.And whenever you have deletedor destroyed your ingress resourceor you undeployed your ingress resource,automatically, external DNS also remove your DNS entriesfrom your Route 53 service.So this completes the external DNSwith ingress service demo.In the next demo, we are going to do the external DNSwith regular Kubernetes service demo.So I'll see you in the next lecture.Until then, bye-bye. Thank you.