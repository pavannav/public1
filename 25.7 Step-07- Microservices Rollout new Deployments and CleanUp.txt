# 25.7 Step-07- Microservices Rollout new Deployments and CleanUp

-: Welcome back.In this lecture we are goingto work on rollout new deploymentsfor our notification service using three optionsavailable in Kubernetes.One is set image option, kubectl edit,and then update manifest, and then deploy.So in any of the three ways you can upgrade your applicationversion from 1.0.0 to 2.0.0.So before going there,so we'll go to our notification serviceand the current running version you can see is V1, right?So let me go here and then let's do this now, right?Let's go to step 14,rollout new deployment using set image option.So we can say kubectl set imagefor the deployment notification microservice.You can say that notification hyphen serviceis equal to, right?So notification hyphen serviceis nothing but your respective container name.So if you go to your visual studio code hereand then go to kube manifestand then go to notification microservice deployment.See this is the name.So for the deployment notification microservicethis is the name, right?And for the container notification hyphen service container,the image it need to set is 2.0.0.So currently it using 1.0.0.So I want to use 2.0.0and then record this statement, okay?So that's what it is saying.So let me copy this, okay?And then paste it here.And now, automatically kube ctl get pods.We should see that old notification microserviceshould be terminating and the new one should be creating.Okay, so now it got created, so four seconds.So let's, if you want we can verify the logs,but we'll go here and then accessthe tendency notification service, right?So shift. Ah, refreshed it, okay?So you can see I have refreshed itand notification service V2 version is deployedjust with kubectl set image option, right?So whatever we have done with set image for that deployment.So this is one rollout option we haveand default is rolling update.So obviously you have 10 replicas, up to 10 replicas.So it'll be like default rolling update.So we'll not have any downtime, okay?And if you want, we can have the settings also there.How much should be takenin the rolling update model, 25% of 10 parts,or four parts or whatever we want, we can configure.But putting that aside,so now we are seeing the V2 version here.So, now we can go back here.So, you can see rollout status.You can see with this command.So why about now already it's only one pod,it's already rolled out.So we'll not see anything here with this, right?Successfully rolled out, you can say that's all, okay?And you can see the new replica set will be createdwith kubectl get RS, right?So this is the new replica createdfor this respect, new 2.0 rollout, okay?And one important thing is this entire sectionrelated to rollouts,we have seen in our foundation section,which is fundamental section,but now we are completely dealing with microservices.I want to add it as an extra option to see you one more timebut if you already gone through the fundamental sectionand then if you are aware of these commands,you can ignore this section, okay?So if you want, you can see the rollout history also herebecause we said record is equal to true.So now the rollout history is what revision twois nothing but 2.0.0 version, okay?And if you want to roll back to previous versionso you can say kubectl rolloutundo that respect to deployment, okay?So if you do that, then it is going to go backto the older version.So, now if you see kubectl get pods, right?So now the one new one, whatever it has createdis terminate and then it is going to againget the V1 version for us,notification V1 version for us.So if you access now the the notification health status.So let me refresh this and we should get V1 now.Good.So now we have successfully upgraded to new versionmeans like went to the new versionand then again roll back to the new version here, okay?In step 15 again we are goingto do the rollout new deployment using kubectl edit, okay?So kubectl edit will using kubectl editwe can edit the deploymentand then update the respect to image path directly.So, let me show you that, okay?So we are doing the step 15 here.So I'll paste it, kubectl edit, deploymentand then notification microservice.So I can go here, I can go downand then go up from here.So from down if you catch it,it is easy, right?It's a poor definition.Okay?So now let it up,let it up, where is it?Come down, come down.So I need to search for 1.0.0.We got it here, okay?So here is the thing.So images, start simplified kube notificationmicroservice to 1.0.0.So with edit we can change it to 2.0.0and then save it.And if we see this kubectl get partsso it should get getting terminatedand then new one is getting created.And you can even see with the rollout deploymentsour replica sets are all these commentsare common for us, right?So only thing is we can directlyverify our application right?So now it should be again V2.So let me come here and then refresh it.It is V2, that's the thing.So, now what we will do is like if you wantto again roll back, you can use rollout,undo deployment, okay?So, I'll say undo and I'll verify get pods.It's terminating and the new one is getting createdand I'll go back here and it should be V1 now.Good, that's good.So we have rolled back.And one more way is like you can go back to your manifesthere, right?So notification manifestand then change it to 2.0and then say kubectl apply-hyphen cube manifest.And then this also should change us to version 2.0, right?So let's kubectl and then if you say get pods,now it's terminating and then creating new one.And if you go here and if you refresh hereit should be V2.And again if you want to roll back,again you change it to 1.0.0and then say kubtctl apply-F kube manifest.And then kubectl get pods, right?So it is terminating and then creating a new one.So let me refresh here and then it should be.So that's about the entire deployment strategies,means like roll out new deploymentwith the three options we havewhich is a setting image optionor kubectl edit or update manifest and then deploy.So finally we can go ahead and then clean up our stuff.Okay?So let me see here.kubectl delete-F, right?And then kube manifest.And then whatever we have created so far,all will get deleted.That's about it.So this complete server microservices deploymenton AWS EKS with user management microserviceand then notification microservice.So, I'll see you in the next lecture.Until then, bye bye.Thank you.