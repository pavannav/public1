# 24.13 Step-13- [NEW] Deploy Stage- Create STS Assume IAM Role

Instructor: Welcome back.We are going to create a STS Assume IAM Role for CodeBuildto interact with AWS EKS as part of this 07-04 step.And here we are going to use, in code pipeline,We are going to use CodeBuildto deploy Kubernetes manifests to EKS cluster.So for that purpose we need an IAM rolecapable of interacting with EKS cluster.So we'll create a IAM role and add an inline policy,EKS with EKS Describe that we will use in CodeBuild stageto interact with EKS cluster via kubectl, right?So now, CodeBuild stage in the sense inside the CodeBuild,which is the deploy stage, okay?CodeBuild deploy stage, I have missed here.Updated the line accordingly now.So you can see CodeBuild deploy stage here.Now the important thing is we can do this via means likeif you have MacOS, Linux, Windows Git Bash, WSL.So we can run these steps,but if you have Windows PowerShell,then you need to run these steps, okay?So both are different means like on Windows PowerShell,here instead of the slashes, forward slashes,you'll use different code symbols here.So for that purpose, I have given both for MacOSand also Windows.So, if you are using Windows, use and run these commands.And if you're using MacOS, Linux or Windows GIT Bash or WSL,use these commands, okay?Let's go ahead and then run these commandsto create the IAM roleand also associate the EKS describe permissionsfor that IAM role.So we'll start with this variables we are going to set,so I'll say clear and I'll run the command account ID.And if I say, echo $ACCOUNT_ID, this is my AWS account ID.In your case, it is going to be your account ID.And role name, we are going to use this one.So I'll try to use that.And if I say echo $ROLE_NAME,you should see that EKSCodeBuildKubectlRole.And with this command, AWS IAM create-rolewith role-name $ROLE_NAME.And with Azure role policy document,we are going to create this trust policy, okay?So now let me run this command here, right?And once it is created, we are going to verify it.So let me copy this and go to IAM rolesand try to refresh this page once, right?Refreshand here if we go to the roles and search,this is the role name createdand currently we didn't give any permissionsbut in the trust relationships,you can see the trust entities STS AssumeRole, okay,that is the thing.Now we'll go ahead and then create a AWS IAM put-role-policyfor the role $ROLE_NAMEand policy name is eks-describeand provide the permission eks-describe permission.So we are going to create a inline policy now.So let me run thisand this should create a inline policy for us.And if we go back to our CodeBuild roleand try to refresh here in the permission section,if you try to refresh,so EKS describe inline policywith the EKS describe action will be present inside that.So this is about creating the STS Assume IAM role.Now we are going to go ahead and then also create,update the AWS-Auth config map with IAM rolefor CodeBuild in our next step.So I'll see you in the next lecture.Until then, bye-bye. Thank you.