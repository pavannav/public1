# 31.5 Step-05- CloudWatch Alarms for Container Insights Metrics

Instructor: Welcome back, in this lecture,we are going to create CloudWatch Alarmsusing Container Insight metrics.So we are going to createa EKS worker node CPU usagerelated alarm now.So let's go and see how we are going to do that.So we can go into CloudWatch management consoleand then we can go inside alarmsand then start creating the alarm, right?In the metrics section we are going to select a metricwhich belongs to container insights.So all other AWS related metrics are under the namespace AWSbut only the container insight stuff,it came under custom namespaces.So if you go inside there will be lot of metrics.134 metrics available for usin different, different dimensions, okay?Cluster name, instance ID and the node name,we have 16 type of metrics here, okay.So which is related to node memory reserved capacity,node file system utilization, et cetera.In the same way with the cluster name, namespace, pod name,we'll have pod related metrics score.Cluster name, namespace, service primarily dealswith the Kubernetes service related metrics.So pod related metrics, service related metrics,Kubernetes worker node related metrics,and Kubernetes namespaces related metrics.In addition to that cluster related metricsalso we'll find it here, okay.So in EKS demo-1 cluster,so we are going to find a metricwhose node CPU utilization, okay?So if you see here this is the node CPU utilization.So I have selected this and we'll go hereand we can add this metric now, okay.So in period how it need to run, every five minutesor how it need to run also we can check it, okay?So for me if it runs every five minutes is also fineor every one minute is also fine.Anything is fine for me.So I'll leave it to default five minutesor we can even change it to one minute, okay?So every one minute it need to pulland then get the data for us, okay.So select metric and these are the informationabout that metric as of now.So which is always it is less than fourand whenever you put the load it'll go above four.So that's the reason I have put the threshold as four.So to simulate this metric for us,which means like to simulate an alarmand send an email for us,instead of putting the threshold value as 80% or 90%in regular use cases or in real time use cases.The CPU usage is 80 or 90, it need to trigger an alert.I just put 4% because currently it is runningwith less than three.So if I trigger some additional load on thatit might go above four and then provide me a alert.So for that purpose I have put that.So metric name is node CPU utilizationand cluster is EKS demo-1and the period I set it as every one minute it need to runand the threshold type is static thresholdand when it is greater than so and so value, okay,so greater than four, right?So CPU utilization is greater than 4%,then automatically it need to trigger an alarm for us, okay?And data points out of one immediately,means like if one time it occurred,then immediately trigger an alert, one out of one.And the missing data treatment, okay.Treat missing data as missing only, that is fine for us.So I'll click on nextand now alarm state trigger, when it is in alarm,trigger it, okay.So in OK or insufficient datadon't need to trigger an alarmand then send an email for us, okay?And it can send an alarm for us using SNS topicwhich is nothing but using email,simple notification service.So we are going to create a new topic herenamed EKS alerts and I'm going to provide a email,dkalyanreddy@gmail.comand then create the topic.So it will create a new topic and a subscriptionin the simple notification service.So we can go to SNS consoleand then we can see EKS alerts hereand subscription also for our email is provided here.So I can go to my email and wait for that emailand once it comes then I'll confirm the subscription, okay.So now my email confirmation is subscribed.So let me come back, send, and I'll come here.And I'll refresh the subscriptions one more timeto see that it is confirmed, good.So in the topics, if you see hereemail is confirmed for us.So now let me come back hereand move to the next step, okay.So I have added one subscriptionmeans like one email to be alertedor you can give a group email support@so-and-so.comor whatever, okay?And now in autoscaling actionsso you can autoscale when this alarm happens,you can even do autoscaling, okay?So, but our current focus is to just alert.So we are doing that one, okay?Auto scaling also if you create your autoscaling groups,so accordingly you'll be able to alert it.So let me remove this and let's move on to the next step.So alarm name, so it should be something likeEKS node CPU alert, okay?And alarm description.So it can be like this, okay?And I'll click on next.And so if it is anytime above fourthen automatically it is going to generate the alert for us.So, and I'll click on create the alarm, right?So now our alarm is in insufficient statebecause data is currently missing.Within one or two minutes it will get the data, okay?So we'll open this alarmand we need to get the data here.Yeah, okay, so our graph is good here.So now what I'll do is I'll go and then add thisto our dashboard.So we have a EKS performance dashboard here.So to that I am also going to add this, okay?And I'll say add dashboard.So if I go here in EKS performance, right?So I have this now up and running, right?So,now let's come back to our insufficient alarm state hereand let's go back to our GitHub repo and take this command.So which is nothing but we are goingto generate load now, okay.So I'll say clearand paste it.So I copiedeverything, yeah.And then paste it, okay?So it is going to generate a load on our thing.So let's see what is happening here, right?So what happens here we can see every time.So one more time run it.So let's run it.So it is in OK state now and we are running that load.So let's see what happens, okay.So we are throwing the load.So now you can see the alarm wentinto the alarm state, okay?So we can even see the CPU here.So it crossed exactly above fourand then immediately it went into alarm state, okay?So now we'll go to our emailand we can see that we got the notification.So you are receiving this emailbecause your CloudWatch alarmin this respective region has entered the alarm state, okay?Threshold crossed one out of the one data pointsabove 44.4 CPU usage.So which is above four.So it has alerted us.So that's about it.So like this, we can generate multiple alerts for us, okay?So let me stop this.So let me stop this, okay?And we can go here and then like thiswe can even create multiple alarms for usin such a way that you can go hereand then select the metric.There will be some important metrics likepod CPUlimit, means like pod CPU over limit, okay?I'll show you that metric, okay?Podnumber of container restarts, this is one,per pod, okay?So and one is important one, okay?So when your pod is continuously restartingyou should know, right?So pod number of container restartsfor that respective pod you can configure, okay?So and in addition to thatpod CPU utilization over pod limits.So this is also one, you have defined the limitsand above that it is trying to utilize your pod CPU,then we'll come to know this one.So this is also one important metric for us.So like this, there are different metrics availablefor us which we can configure for our applications, okay?So that's about it.So if you want to clean up your container insightsso just use this command and then have the valueswhatever you have,means like kubectl delete -fand then provide EKS demo-1 and then region nameto delete whatever you have installed.And for the sample application,whatever you have installed, if you want to delete it.So you can go ahead and then delete itby going inside 18 EKS monitoring.And then kubectl delete -f kube manifests, okay?So that's about it.And these are some of the reference links,you can click on link and then browse the stuffto understand better about this section, okay?So I'll see you in the next lecture.Until then, bye-bye, thank you.