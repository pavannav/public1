# 6.2 Step-02- PIA Demo Part-1

Welcome back.We are in 0400X pod identity agent section in our course GitHub repository.AWS EKS Kubernetes master class.And here I have provided a detailed high level flow.How this works and all the information about it is provided here.So you can review all these things in detail.So what we are going to do we already discussed in the introductory section.So let's go ahead.And then first thing is to install the EKS pod identity agent.So we'll go to our EKS cluster.So in Amazon Elastic Kubernetes Service in the clusters section you can see here our EKS demo one isrunning.So we'll click on this EKS demo one.And we'll go to the add ons section here and click on Get More Add ons.And here we will install the pod Identity agent.So this is the one Amazon EKS pod identity agent.So this one we will select this.And then we'll go ahead and go down here.Click on next and we'll click on next.We'll leave all these things to default and click on create.And this should install the Amazon ECS pod identity agent.So currently its status is in the creating state.So let's wait for a minute or two so that it will be installed successfully.Now let's click on refresh.And if we go down here we can see ECS pod identity agent is in the active state.In addition to that, if we want we can also verify the same thing via kubectl get daemonset and hyphenn kube system namespace so that you should find the same thing there.So we'll go here kubectl get ds daemonset means ds is the alias for that and hyphen n and we will saykube system kube hyphen system in the kube system namespace.And we can see here X pod identity agent is running.So we have two nodes.And in both nodes it is running.So if we say cube CTL get nodes you can see we have two nodes.And daemonset is nothing.But on each node, whatever you have, whatever you deploy using Daemonset, it will run on each andevery Kubernetes worker node.And if you want you can also say kubectl get pods hyphen n and we will say kube system.Right.And we should see that, uh, this pod identity agent pods are running.And if you want you can also say hyphen o wide.And it should provide the IP addresses of the pods it is running.Right.So it is running on 12.75 and 47.13.And if you say kubectl get nodes hyphen o and then wide you should see those things okay 75 and 130.So that is about installing the installing the pod identity agent.And the next thing is we will deploy the AWS CLI pod without pod identity association.So we'll go here and review those things and deploy it.So we'll go here.And in 0400 ECS pod identity agent.So in cube manifest folder you have something called a simple service account which we are creatingwith name aws, cli, sca and whose namespace is default.We are creating this service account in default namespace okay.And next thing is we are also going to create a simple Kubernetes pod.Okay so kind is pod here.And name of the pod is aws CLI.And where you are going to deploy it in the default namespace.And in the Pod specification you are saying service account name it is using is aws cli sca, whichis nothing but this one.Okay.And then you are also going to provide the name of the container which is AWS CLI and image you areusing is Amazon AWS cli and command you are using is sleep infinite?Which means this CLI part should be continuously running in your ECS cluster.Okay, so now we'll go here and we'll go to zero four.And inside zero four we have 00X pod identity.And here in in 0400 you have the cube manifest folder.So we'll say cube CTL apply hyphen f cube manifest.And this should create the service account.And also the CLI pod.So cube ctl get CA in the default namespace.You can see it is created and kubectl get pods should also provide us AWS cli pod is the service accountand pods.Now let's go ahead and then run the command cube CTL exec hyphen it.And the pod name is aws cli.And you pass the command aws s3 ls.You are trying to list the S3 bucket.So let's try that.So we'll say kubectl exec hyphen it.Pod name is aws cli hyphen hyphen space aws s3 and then ls.And it should provide us with a error.An error occurred access denied when calling the list buckets operation so user with so and so thing.It doesn't have access to list those buckets.So it by default uses the node instance role okay.So which means you are trying this from your Kubernetes.Kubernetes pod is deployed on Kubernetes node.And that node has a IAM role associated with it which is node instance role.So using that instance role it tried to run this command means like it tried to authenticate this commandand it failed okay.So what we will do is we'll move on with creating the IAM role pod identity association, all thosethings in our next lecture.I'll see you in the next lecture.Until then, bye bye.Thank you.