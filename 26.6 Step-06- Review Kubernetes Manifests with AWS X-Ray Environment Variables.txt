# 26.6 Step-06- Review Kubernetes Manifests with AWS X-Ray Environment Variables

-: Welcome back.In this lecture, we are going to reviewthe microservices application deployment manifestand also the Ingress manifests, okay?So, let's move on with the step five review,microservices application deployment manifests.So, we have user management microservice deploymentand then notification microservice deployment.So in our previous microservices deployment section,entire section, we have already created these thingsand then deployed it and then tested it.So what changes we are going to make for these things?That is what we are primarily going to look into, right?So in user management microservices deployment filefor the image tag we are going to use3 dot 0 dot 0 AWS X-Ray my SQL.So the tag very clearly states that 3 dot 0 dot 0and then which is enabled with AWS X-Rayand it connects to the my SQL DBwhich means we need my SQL DB.So why we specifically mentioned my SQL DB is,if you go inside that things here, right?Kubernete, Kube user management microservice.So you'll also have something called H2 DBwhich is in memory DB.So you can directly deploy these H2 DB containerswherein you don't have any microserve,my SQL DB related dependencies.So directly you can deploy them.So you really don't need RDS databaseor my SQL containers or anything.So internal in memory DB will be available for usbut as part of our architecture, right?So we are trying to depict everythingand then leverage every AWS service.So that's the reason I have ensured thatwe are using my SQL DB tag here. Okay?So if you use SQL DB tag, then automaticallyknow my SQL related stuff is not neededbut rest all X-Ray is going to work here as is. Okay?So no changes to X-ray how it is going to work.Only thing is when you create a userthe user will be stored in H2 DBand then whenever you restart your containeror del-, that user will not be therebecause that is only a persistent DB.And if you deploy four or five containersor four or five parts of that,then you'll have a different, different datain different, different in memory DBrespective to that respective part.So it's only for testing purposes we use this type of stuff.This one and then this one.So these are not real time stuff, okay?So, but for convenience purposeI have compiled and then put it there. Okay?But always we try to use my SQL DB real time casesand then we'll use the same thing.So that's about the tag we need to discuss about.And next is the change two is, environmental variablesrelated to AWS X-Ray, right?So these are very, very important ones.So let's discuss one by one. Okay?So, AWS X-Ray tracing name, right?So if you go to our picture here, right?So inside service map you can see hereuser management microservice.So this is the name of our microservice.So whatever you have provided here,it will be displayed here. Okay?So whatever we provide here, you can see.You can see here V1 notification microservice.So the same thing is getting displayed here.So your application name, whatever you want to provide.So that one you need to providemeans like in your application codeyou might have written something else, okay?So in my application code alsoI have written something here so I can show you, right?So if I open it hereso I have said user management microservicejust simply like this, okay?But if you want to override this valueif you want to override this value with this valueso you can use this, send the environmental variable.I always prefer to do everythingvia means like these type of things if availableI try to use via Kubernetes deployment manifestso that I can alter in future also, right?So that's the reason I used this variable nameand then provided my name, whatever is required for me here.Okay? And next thing is AWS X-Ray daemon address.So which means whenever that daemon is runningso it need to know, right?Our respective application container need to knowto which the X-Ray daemon addressit need to send that traces, right?So X-Ray service dot default and then 2000.What does this mean, right?So if you see here in our templates, right?X-Ray service.So you go here and you only created this service, okay?X-Ray service in X-Ray care demonstratein previous lecture we created this service, okay?In name spell default.So X-Ray service dot default will be my nameof my daemon addressand the pod I'm going to use is 2000 pod.Why? Because I exposed it as 2000.We can even see that here.Kube CTL get SVC will provide the X-Ray servicewith the pod is 2000.Okay? So that's good.So that's about that daemon address, right?And next is X-Ray context missing. Okay?So if you use the value log error,it will log an error and then continue.It will not disturb our application. Okay?But if you don't define this and then leave it like that.So that default is to use that runtime error.So when it uses runtime error,it throws a runtime exception,which is default option if not configured.So it's not good, right?So for me, for now it need to log error and then continue.If X-ray is not working, what matters for me?My application should continue to keep running, right?So that's the purpose I defined this way.AWS X-Ray context missing, log error and then continue.The CN3 environmental variables also will be presentfor our notification microservice.Also, in addition to thatthere will be something called for notification microservicealso you'll have 3 dot 0 dot 0 AWS X-Ray tag.So you can find it here, let me go to repositories, right?And you'll have the notification microservice hereand you can see it here.3 dot 0 dot 0 AWS X-Ray, right?And here you'll also have 4 dot 0 dot 0 AWS X-Ray.So which will state that 3 dot 0 dot 0 is V1 versionof your application and then 4 dot 0 dot 0 for X-Rayis V2 version of application.So whenever we are doing the cannery deploymentsin our next sections, so we are also going touse 4 dot 0 x-ray and then distribute the trafficbetween 3 dot 0 and then 4 dot 0.And both will be live for uswhen we are accessing via browser, right?So we are going to see those things also later.So that's the reason everything is compiledand then put it ready for us. Okay.So now image tag we have verifiedin notification microservice also.Let's also view them from our routewhich to your code prospective, right?So in Kube Mainfest you have 02 applicationsand you can see 02 user management microservice deployment.Okay? So there only we addedthese additional environmental variables, okay?And same for our deployment also.Okay? And remaining things, my SQL external limb serviceas is, it is same, okay?And node port service for user management, same.We didn't touch it. Okay?And notification microservice SMTP servicewe didn't touch it, as is. Okay?From previous section which is microservices deploymenton EKS.And notification cluster IP service alsoit is going to be as is.We didn't touch anything. Okay?Now we'll move on to ALB Ingressand then discuss about the ALB Ingress manifest.Okay? So one thing important from your perspectiveis whenever you are using this templateyou need to update your certificate ARN, right?So if you have already updated itin your respective ALB application load balances sectionand then trying to copy paste your templatecontinuously for every section, then there is no issue.Okay? If not, always ensurethat you update your certificate ARN hereand then your external DNS names, okay?You might have your own domain name, right?Mine is Q1 cloud dot com.So yours might be something else.So that one you need to update here for route 53 section.So these are the reviews we need to understandabout our respective deployment manifests.And then Ingress manifest, rest all are going to be same.So in our next lecture we are going to deployand then test it.So I'll see you in the next lecture.Until then, bye bye.Thank you.