# 14.4 Step-04- Update SSL Ingress Annotation, Deploy and Test

-: Welcome back.As part of this step we are going to add annotations relatedto SSL in our zero four ALB ingress SSL dot yamal five.So let's go to our visual studio codeand go into the section which is 0 8 0 4 ALB ingress SSLand 0 1 0 2 0 3 RCM as our previous sectionwhich is 0 8 0 3 ALB ingress context path based routingand in ALB ingress SSL also we will changethe name of my ingress servicewhich is ingress SSL demo.And we will also change the load balancer namewhich is SSL ingressand we will add additional three annotations.So the first annotation is we are goingto add the listen ports.So we are going to add the listen ports 4 43 and then 80.So let's go back and seein cube manifest and in English context, part based routingdo you see any of the listen ports related annotation?We didn't have any listen port related annotation.So which means by default,port 80 listen port will get created.So now whenever we are explicitly defining them, right?So we defined both history, TP ATN 443listeners here in listen portsWhy?Because SSL listen on default 4 43.So now the next thing is certificate ARN.So update the certificate ARN here.So we need to tie the SSL certificatewhatever we have created just now.So in your case the certificate is going tobe the certificate you have created in your AWS account.So let's come back hereand this is the certificate we have createdstar.stacksimplify.comand it's ARN is here.So let me copy that and provide that certificate ARN.And you can see this is SSL policy.We really don't need to specify thisby default whatever is availablein AWS as part of today's standards.So that will be taken automatically.But if you want to explicitly add any specific SSL policyso we can get that policy name and then add it here.And if you go to the annotation reference for thisso you'll find something called SSL in the table of contentsand there you'll find the SSL related additionalannotations available here for your reference.So we already user the certificate ARNand we can also use the SSL policy if you want to use it.So these two are the core things related to SSL.But in addition to that we also use the listen portsunder SSL just for our, what we call to ensurethat all the things are at one place.So even though that is not a SSL related annotationbut there you have have updated the SSL port.So that's the reason we have groupof them and then put them together herein this respective ingress service file.So we can put it anywhere but for just to understandthat as part of this ingress SSL demo onlywe added this annotation and we added this listen port.So that will be clear for us.So now let's go back hereand we have reviewed the ingress annotationand we know that already is 0 1 0 2 0 3related Kubernetes manifestor from our previous demo,which is context part base routing.It's part of step zero fivedeploy all the manifest and them test them.So let's go back to our terminal hereand we will enter into the section zero eightnew ELB application load balances andinside that 0 8 0 4 which is ALB ingress SSL.And if we verify here LS hyphen LRT and cube manifests.So we should find the file 0 1 0 2 0 3and then zero four which is ALB ingress SSL.So I'll say cube CTL apply hyphen F cube benefits.So this should create the app one app twoapp three related deployments and note port services.In addition to that, it'll also create theingress SSL demo related ingress service.So let's say cube CTL get ports should listthe three ports created for us for app oneapp two and then app three.And we'll also see there note port servicescube CTL get S three Cwe app one, app twoand then app three related note port services also created.Finally, we'll also see the cube CTL get ingress.The ingress service related to SSL demo is created now.So let's go back hereand verify the same thing in our AWS management console.So let's go here and goto EC two and go back to load balances.So let me close this and go to load balances.And in load balances we can see SSL ingressand some number and this DNS name we can see here same.You'll find the here whenever you run the commandcube CTL get ingress and in the listenersyou should see both 80 and 4 43 listeners created.So click on these rules for 80, right?And you'll find slash app from slash app twoand we also use it here instead of root context.If you see here, another difference is we directlyuse the default back and forth app three.So in English context, path based routing.So we have given the option likeeither you can use a default backand or you can use this path, right?But now what we have done here is directlywe didn't use the root context pathwe just used it as a default backend.So exploring or giving additional optionfor us to use either a root context or a default backend.So there you have used the root context.So here you have user default back in.So now let's you have seen the rulesfor your port 80 related listener.Also see the rules for port 4 43, right?So the same rules will be applicable for youfor port 4 43 also slash app one slash app twoand default backend is going to be app threeand (indistinct).And if you want to review the target groupsthose are going to be same as how we have reviewedin our INGRES context path based routing demo.So you can see here, so all the health check podsand everything should be app one for app frontapp two for app two andfor root context it is going to be slash index dot html.Another important thing which we need to verify hereis the certificate associated with the 4 43 listener.So if you click on this view certificates here, right?So it has associated the certificate namestar.stacksimplified.com and if you want to verify thatyou can click on this ACM hereand it'll take us to the certificates listand you can come back here and only the star.taxsimplified outcomes certificate is this one.Whatever we have just now created.So that said that for the 4 43 related listen portwe have successfully associated the SSL certificatewhat we have created in our certificate manager service.So how we have associated it, we have associatedusing the let's go back here and see certificateair and related annotationand providing the AR and enough over certificate.So in your case whenever you are implementingin this ingress serviceyour change is going to be adding your certificate herehere rest all is going to be as is.So now let's come back hereand we have successfully verified these thingsand now another thing we need to do isadd the DNS in route 53.So we are in the route 53 and we arein the stack simplifi.com and create a record hereand in the record we'll go back here, right?And we'll provide the name of our record setas SSL demo 1 0 1 stack simplifi.comand we'll select the LES and LES target A over ALB DNS name.So let's come back hereand I will provide SSL demo sum numberand then record typeis a alias right?And alias two load balancer, we should find it here.Application R, classic load balancer andin which region we have this in US East one regionand find the load balancer name dual stack dotSSL English sum eight five double 9 2 1 6 0 8.So you can find the same thing here.If you go to load balances,so go to EC two and go to load balancerand you should find the DNS name here.And in that you can see 8 5 9 2 1 6 0 8, the same thing.Autopopulated here, dual stack dot SSL list 8 5 9 2 1 6 0 8.So I'll click on create the record.So now we have created a record namedSSL demo 1 0 1 stack simplify.com.So let's come back here and first do the MS lookup test.And after that access the URL.Let's say NS lookup SSL demo 1 0 1 dot stack simplify.com.So if our DNS is successfulso it should resolve to the IP addresses here.So you can see the IP addresses some 18.233.56.149and something like this.Also if you want to do the endless lookup of your DNS nameof your load balancer, autogenerated one.So you can also try that, right?And both the values will be same.Only thing is here you are using the custom domainname instead of this Autogenerated name.So are your personal domain name.You can say, so now let me clear this and go backto the browser and access app one, app twoapp three using HTTP URL.So let me close this, close this and close this.And here we are accessing SSL demo one with http URL.You can see it is not secure, right?And now the next thing is we'll alsoaccess the second one which is app two.And this also with not secure with http URLyou have access it.And one more you are going to access,which is the app three which is the root context, right?So this also successfully, right?So now we'll close these thingsand we'll access the SSL URLs.So you can see here SSLwith the SSL you can see the lock symbol here.And if you want you can go to connectionis secure here and certificate is valid.And you can see the certificate it is using isstar.stacksimplifi.com.It is called the wildcard certificate.Any sub mine is accepted here.SSL demo abc SSL demo 1 0 2 2 0 1, anything right?So this is good.So app one is accessible now.So we'll go back here and access the app two nowand app two also should be successful.And finally we'll also test the app three hereright?And app three also accessible via SSL URL.This completes the ingress SSL use case demo.In our next lectures we are going tofocus on SSL redirect demo.So I'll see you in the next lecture.Until then, bye bye.Thank you.