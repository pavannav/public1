# 16.2 Step-02- Implement Ingress NVR Demo

-: Welcome back.Let's go to our GitHub repository.And we are in section 0809 name-based virtual host routing.And as part of introductory section,we already understood aboutwhat is this name-based virtual host routing in ingress.So as part of step two,we are going to review the ingress manifestfor host header routing or name-based virtual host routing.So let's go to our visual studio codeand we are in section 0809 name-based virtual host routing.And inside that, we are in kube manifest folder.And 01, 02, 03 are going to be samefrom our previous sections,which is app one deployment and node port service,app two deployment and node port service,and app three deployment and node port service.So, this is 04 ALB ingress host header routing.And inside this...So as usual, we will change the name of the ingress servicewhich is ingress name-based virtual host demo.And the load balancer namealso we will do name-based hosts ingress,something like this.Whatever relevant name for uswhen we run the kubectl get ingress,so we'll know the exact demo ingress service.And as usual, in your demo,you need to ensure that your certificate ARNshould be updated here.And when coming to external DNS related,host name related annotation,so I have provided default, 101.stacksimplify.com.For our default backend,which is app three Nginx node port service.And so if you go down here, these are the important things.So the default thing is completed here.And now, we'll move on to the core rules.And under rules you have something called host.And in host, you have defined app101.stacksimplify.comwith root context anything comes,app101.stacksimplify.com/,it should go to app one Nginx node port service.And with app201.stacksimplify.com,anything comes with the root contextthen it should go to app two Nginx node port service.So these are the rules related to host header based routingor name-based virtual host routing,which we have defined here.So now, let's go back here and go to step threewhich is deploy all these kube manifests and then verify.So let's come back to our terminal hereand enter into the section 08 new,which is new ALB, application load balancers.And inside that, we are entering into the section 0809name-based virtual host routing.And if you say here, kube manifest ls lrt kube manifest.So, you'll find all the four filesand the fourth file is 04 ALB ingress hosted a routing.yaml.So I'll clear thisand run kubectl apply hyphen F kube manifest.and this should create the app one deploymentand node port service same for app two and then app three.After that, it should also create the ingress service for uswhich is related to ingress name-based virtual host demo.So, let's say kubectl get portand it should display all the three ports for us,app one, app two, and app three, those are running.And we'll also say kubectl get SVC.And you can see here,all the app one, app two and app threerelated node port services also created.And now, we'll go to kubectl get ingress, right?And in get ingress,you should see ingress name-based virtual host demo.And in the host here,you can see app101.stacksimplify.com,and app201.stacksimplify.com.So for this ingress in the host area,you can see it has automatically updated its value.So whatever you have defined as hosts here.So which is this one and this one.In addition to that,you have the standard name-based virtual host related,ALB code DNS name, right?Which is alb.amazonaws.com.So now, let's go back here and also verifyyour load balancer listeners rules and targets.And before that, also verify the external DNS logs.So let's wait for the logs to displayand these logs should show usthat it is going to create three things for us.So let's wait.(mouse clicks)See, it is going to create a desired change ,saying app101.stacksimplify.comis added in the hosted zone as a recordand app 201 also added and default 101 also added.So total, these three recordswere added successfully in our route 53.Also, verify that.So we'll go here and go to route 53and first to verify the DNS records.After that, we'll come back to load balancerand verify additional details.So let's go to hosted zonesand we need to go to the hosted zone, stacksimplify.com.And in stack simplify.com...So we can see here, default 101 created.And in the same way, app 101 and app 201 also createdand all those thingswill reference to the ingress service, right?So, whatever it is created.So ingress service name-based virtual host,ingress service with some number fivetwo double line starting with.So if you see here, kubectl get ingress.So it's nameis name-based virtual host ingress 5299 something.And we'll go back.And also...(keys clacking)go to our load balancer here, in EC2 load balancers.So, we will go ahead and then open this and go to listener.So this load balancer is in active state.So it'll go to listeners here.And this is the default port 80 listener,which will directly redirect from 80 to 443because in our ingress,we already have this SSL redirect related settingin the annotations of our ingress.And now, we will see the 443 related rules here.And if you see here,you can see when your host is app101.stacksimplify.com,go to app one Nginx related target group.And if it is app 201,go to app two Nginx target group.Anything default, go to app three.So now, let's come back here and go to the target groupsand see if they are healthy, right?So now, let's refreshand you can see app one, app two, and then app three.So app one, if you see those were healthyand if you go to app two, so those also should be healthy.And these target groups you can seeyour EKS worker nodes are registeredwith node port services.So node port related informationwith the worker node related instances were registered here.So now, let's come back, right?And...verify the nslookup.So the next step hereis to access application using newly registered DNS name.So, the first thing is verify with the nslookup commands.So let's come back here.and do a nslookup lookup.And it is resolving to IP addresses.And this one also we will try.And it is resolving to IP addresses, app 101 also.And app 201 also, it is resolving to the IP addresses.IP addresses are going to be same here.And if you want, you can also verify the DNSfor your ingress related default DNS namewhich is this one, right?So nslookup and also provide this one.And for all these things,you can see the IP addresses are same.So now let's come back here and access your application.So app one,you are going to access with app101.stacksimplify.comand see this is accessible.And app two you are going to accesswith app201.stacksimplify.com.See, app two is accessible.And default application, you are going to accesswith default101.stacksimplify.comAnd you can see,default Kubernetes fundamental demo related applicationis accessible for us.And negative cases with app101,try to access app2index.html and see what happens.So let's close these things, right?And access this, and 404. Why?Because in app 101, which is nothingbut your app one node port service and app one backend,you are proxying the complete root context, right?So which means in app 101 or in app one,there is no app two related context path with index.html.So from your app one backend, right?So from your app one backend, you have got a 404 request.When you access it, app1.stacksimplify.com with /app2in the same line.So let's come back here and try for app two also.App two, try with app one and it should fail here also. Why?Because in app two related port,you don't have any app one related conceptor context path, you can say simply.And now, if you want you can also trywith default101/app1index.html and app2index.html.See?And this is also failing.So everywhere, it is the same thing.Only with this domain, you can go to app two.And with this domain, you can go to app one.And with this domain you can go to default port.As of now whatever we have configured.See? All these things are not working.So this complete the name-based virtual host routing,our host header-based routing in ingress.So now, we are going to clean upwhatever we have implemented.So let's come back hereand we'll say, kubectl delete hyphen F kube manifest.So this should deleteall the three application related deployments,node port services, and also the ingress service,and also that DNS records created.So to verify that, we'll also put the log, right?So once those were deleted,also let's verify the log now.So let me copy this and paste it here.And in external DNS log, we should see all our three DNS'whatever registered in route 53should be in that delete state.So let's go down.It's opening the log.See? Delete app 101 and app 201 and default 101.So now let's go back here and go to route 53and verify the same thing.Let me go here and go to stacksimplify.com.And you can see here,there is no DNS related to app101 or app 201 or default 101.So now let's come back here, and our Ingres service,whatever it has created,the application load balancer also got deleted.So this completes the name-based virtual host relating demo.Routing demo.And in our next lecture,we are going to focus on SSL discoveryrelated ingress concept.So I'll see you in the next lecture.Until then, bye bye.Thank you.