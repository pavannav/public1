# 31.3 Step-03- Deploy Sample App, Load Test and Verify Container Insights Dashboard

-: Welcome back.So we are going to deploy a simple NGINX applicationand then generate load on our sample NGINX applicationand then access the details on the CloudWatch dashboard.So I'm going to say kubectl apply-kubemanifest.So let me clear this and say kubectl.We are in 18 section 18 EKS monitoring using CloudWatch.So I'll say kube manifest.So what we are deploying,so let's go ahead and then verify the manifest also.So in 18 EKS monitoring with CloudWatch,you can see sample NGINX app.So this is simple sample NGINX app,which will have kube NGINX 1.0.0 versionwhich will have a root index.html inside that.So now what we are going to have hereis the request sectionwhich is important request and then resources.So I'm requesting CPU for IM and then memory for fi EMI.And then limit also I have put only very less.And then I'm going to put huge load on thisand then see what happens.So we are going to access the podusing a simple cluster IP service,which is sample NGINX service.So if you come here and see when I'm generating the load,so I'm going to set kubectl run generate run pod v1and I'm using the Apache bench as my pod nameand I'm going to use image as httpd.And then what I'm going to do here is,this is the service name.Sample NGINX service.default.It is deployed in default namespaceand it is a service SVC and inside the cluster.local.That's all.And it means like every timeI'm going to hit with 1000 requestsand then I'm going to end up at file lack request.So let me generate the load on thatand then see what happens.Before that we can even verify,get all will provide us the information.So we have only our simple sample NGINX serviceand then sample NGINX deployment.So now let me generate the load.So we are generating it.So total of only 3,447 requests completedand then connection reset by peer happens.So we are going to run one more time and let it runand then we'll go back to our Container Insights dashboardand then see what happens.So let me go back here and then go to management consoleand then go for our CloudWatch.So let me, no not cloud search.So we need to go for CloudWatch.So CloudWatch. So this is the one.So now you can see it here,we have something called Container Insights.So it is in beta stage as on today, but it is live also.So now I'll click on this.And we have three options here available.So this is one more brand new feature also,they have added to this Container Insights,which is Container Insights are recently announced.So the Brita, it is for Prometheus metrics monitoringfor EKS and Kubernetes clusters.So this is a very good news.So Prometheus is a very famous toolfor cloud native related stuffand they also integrated that alsowith the Container Insights.For now we are going to do directin Container Insights what is available.So we can list all our container resources hereand we can view everything in our map.So it can do application monitoring,infrastructure and performance monitoringand even troubleshootingand then right sizing all these things,it can take care using Container Insights.So first we'll go and then list our container resources.So let it load what allare our container resources available here.And let me close this.So these all are available for me.In a namespace, Amazon CloudWatch is thereand app one NGINX deployment, AWS node,CloudWatch, code dns,all these other resources available for us.so now if we go to the map.So we can see the map view hereand if you see here in the EKS namespace,means like in the default namespace.This is the EKS demo clusterand in the default namespace,you can find something called NLB app on NGINXand then app one NGINX deployment which I have deleted it.For now it is not there.So now I have something called sample NGINX service,which is nothing but whatever we have created.So sample NGINX service.And we also have sample NGINX deployment.So I'll say smaller. And so this is the one.So if you want we can see in a bigger view.And we also have in kube system namespace,we have kube-dns, AWS nodeand then kube proxy related stuff inside that.And also we have EKS pod also.So these are services and then these are pods.And in CloudWatch namespace which we have recently installedwe have FluentD CloudWatch podand then CloudWatch agent pod.So that's about it.On a very high level,it is also going to show what are the memoryand then CPU usages also about this stuff.So you can see less than 1% CPU average,currently it is showing.So that's about it.In resource view, you can seeor you can see in the list view or in the map viewabout entire our cluster, what we have in detail.Now if we go here we also have the performance dashboard.So for our EKS cluster,we can also see the performance monitoring informationfor last three hours if you want, we can see it.So for the cluster CPU utilization is at 7%and then memory utilization is at 16.6%.You can see for the EKS demo one cluster.EKS clusters and then I have selector,we have only one cluster hereand it's network and then disc cluster failures,number of nodes, everything it is going to show us.So number of nodes at this point of time we have two nodesand disc utilization is 14% and no cluster failures so far.And network utilization is like this,and memory utilization is like this, 16%.And like this we can see every information.So now in addition to EKS clustersyou can even see by EKS namespaces.So and what are the namespaces available for us?Default, we have some information there for the thing.So you can see default CPU utilization, how it is,and then you can see blue little high here.So like that.In the same way, Amazon CloudWatch, it has 2.1.It means like our system resources related to CloudWatchFluentD and then CloudWatch agentis using 2.1 CPU utilization.And never utilization.For all these things you have CPU memory and then network.And CPU utilization over limit,memory utilization over limit also you can see.So now you can see who is hitting the over limit.So CPU utilization for default,for which one it is hitting is?See you can see it here, CPU pod,over pod limit, Container Insights you can see here.So in the default namespace it is using 71.9%.So which clearly says that over limit related statistics,also it is going to provide us.So that's very important thing. So why it is going.So we'll go to the pod view to see that.So this is notes view.Once we go to the pod view,we'll see over limit in a clear manner.So you can see per nodes.Node CPU utilization and result CPU computationand memory utilization.All the information is available here, per nodes.And services.So how the services information is there,we can see it here.Most important is per pod we need. So EKS pods.So you can see that pods,you can see CCP utilization and then memory equalization.3.9% in orange, which is CloudWatch agent.And then for default, how it isand all those details you can see.And now CPU utilization is over pod.So if you see here, over pod limit is this one, blue one,which is nothing but sample NGINX deployment.So that is using the over the pod limit.So if you remember,so to show this over the pod limit informations,so I have defined the limit as 10 M CPUand then all what this it is utilizingand then it is telling us.So that's what is the over the pod limit it is using the CPUand this is a notification for us,telling that it is using over the pod limit.Now this is the time for youto increase your pod limit information.So if you made it 200 or whatever.So like this, you can know the statistics in a detailed way.So that's about the over the pod limit information.So now we have seen pods also,and this Prometheus we still didn't deploy.So we are not going to go into that.So we only deployed EKS related stuff.So we looked into them.So now another important thing is in resources section.So where is this?We need to see my deployment name.So sample NGINX deployment.So if I go inside that we have this information.So this is the sample NGINX pod.So let's see the pod name once whatever is there.So kubectl, get pods on which we have generated the load.So let's get the pod information. It is PMPPPS.So PMPPPS is the information. So I can select that.And you can see here there are few things available here.So for this respective pod you can click on application logsand then performance logs.So first I'll open the application logs for this.And this will take us to the CloudWatch Log Insights.So it'll take us to the CloudWatch Log Insights.Log insights is another important feature.So as part of FluentD, it is pushing the logs here.So now it is pushing the logs here.So now we are seeing the respective to step.We are continuing our section here.So we have seen the CloudWatch dashboard.So we are also going to see CloudWatch Log Insights now.So now we'll come here and if I run the query like this,so we are getting the entire logs for that.So for this one, if you see any of the log,if you want to see it.So what it is accessingand all the information is available for us.What is the logand then what is the log stream it is using and log message.You can see it is trying to get the slashand it is getting the 200 and who is the agent?It is Apache bench is the agent here and the timestamp.And then docker container ID, kuba container,Kubernetes container image, image ID,and then container name, by container name,all the information.So it means like we have tons of informationabout our application which we can moldand then get the information in any way.Write the filters and then get in such a waythat by this container name I need the information.Or from this timestamp to this timestamp,I need the information of logs.So everything you can get.And even this information,whatever the filter you write, that respective filter.So try to get me something called, whatever becomes non 200,404 or 500 related stuff and then add it to the dashboard.So that those details,you will be able to see in the dashboard.So like that you can do lots of information using this data.So you can massage and then use the way,whatever the way you want with this information.So which means FluentD installed as part of our CloudWatchinside the EKS cluster is giving good amountof log information, which we will be able to managein whatever the way we need it.So that's about logs.And one more thing we can see are performance logs.So this is about,again this is another dimension of getting the data.So here you are going to get only,however performance of our applications is available there.So if I click on this.So you can see here you'll get a different dimensional data.So container file system available,container file system capacity, container file system usageand then container file system utilization.So like this, you get the data in a performance view.Also with this also you can generate the dashboardsand then use it.So you need to learn more about insights related filter,send then fields and in using that,you'll be able to write better.And then add them to the dashboards and then use it.But you have the data,you'll be able to do those things easily.So that's about this one.And another thing is we already seen as part of x-rayfor deploying our sample services, application services,we have seen x-ray traces.So if you click on this, this is the NGINX application,I really didn't enable any extra trace here.So ideally will not see anything.But if you have deployedany of the x-ray related application.So you'll be able to see that.So from here itself, you can goand then see the extra traces from this screen itself.You can launch the x-ray tracefor that respective container imageand then see all those traces also.Even those things the service map,whatever you have seen in x-ray,those are also going to get displayed here.So this is about the Container Insights, Log Insightsand then CloudWatch dashboard on a high level.In our next lecture, we'll also see on a very high levelhow the alarms looks like and then we'll wrap up.So I'll see you in the next lecture.Until then, bye bye. Thank you.